window.jBartWidgets = window.jBartWidgets || { vars: {} };
window.jBart = { vars: {}, api: {}, utils: {}, dialogs: {}, bart: {}, db: {} };
var ajaxart = { 
	debugmode: false, trace_level: 2, // 0-input output, 1-also variables, 2-nested values
    xtmls_to_trace: [], traces: [], components: [], componentsXtmlCache: [], usages: [], types: [], plugins: [], gcs: {}, 
    log_str: '', loading_objects: 0, logs: {}, default_values: [], inPreviewMode: false, stack_trace: [], build_version: 'ART_NOW', 
    xml: {}, cookies: {}, ui: {}, yesno: {}, dialog: { openPopups: []}, xmlsToMonitor: [], lookup_cache: {}, occurrence_cache: {}, 
    unique_number: 1, action: {}, runningTimers: {}, runDelayed: [],
    classes: {},
  	base_lib: '//jbartlib.appspot.com/lib', base_images: '//jbartlib.appspot.com/images',
  	STRING_WITH_EXP: /%[^ ,;\(\)]/,
  	NOT_EXP: /^[ ,;\(\)]/,

run: function(data,script,field,context,method,booleanExpression,noDtSupport) 
{
   try {
	 var origData = data;
     if (ajaxart.debugmode && ! aa_isArray(data))
     {
    	 ajaxart.log("run called with input not an array","error");
    	 return [];
     }
     if (script == null) return [];
     if (script.nodeType && script.nodeType == 2) { // attribute
    	 field = script.nodeName;
    	 script = ajaxart.xml.parentNode(script);
    	 if (!script) return [];
     }
     if (field != "" && aa_hasAttribute(script,field) ) {
       if (script.getAttribute("Break") == field)
      	 debugger;
       var out = ajaxart.dynamicText(data,script.getAttribute(field),context,null,booleanExpression);
       
       if (script.getAttribute("Trace") == field) ajaxart.trace(script,data,out,context,field);
       aa_try_probe_test_attribute(script,field,data,out,context,origData);
       return out;
     }
     var field_script = ajaxart.fieldscript(script, field,false);
     if (field_script == null) return [];
     if (field_script.nodeType == 2) return ajaxart.run(data,field_script,'',context,method,booleanExpression); // For Default param values in attributes
      
	 var childElems = [];
	 var node = field_script.firstChild;
	 while (node != null)
	 {
		if (node.nodeType == 1) childElems.push(node);
		node=node.nextSibling;
	 }
     ajaxart.stack_trace.push(field_script);
     // decorators
	 var classDecorator="";
	 var cssStyleDecorator="";
	 var atts = field_script.attributes;
	 for(var i=0;i<atts.length;i++)
	 {
		var aname = atts.item(i).nodeName;
		
		if (aname == "t") {}
		else if (aname == "Condition" && ! aa_bool(data,atts.item(i),"",context))
		{
			ajaxart.stack_trace.pop();
			return [];
		}
		else if (aname == "Data")
		{
			data = [aa_first(data,atts.item(i),'',context)];
			if (data[0] == null) data = [];
		}
		else if( aname == "RunOn")
  	 	  context = ajaxart.calcParamsForRunOn(context,ajaxart.run(data,atts.item(i),"",context));
		else if( aname == "Class") 
			classDecorator = aa_text(data,atts.item(i),"",context);
		else if( aname == "CssStyle") 
			cssStyleDecorator = aa_text(data,atts.item(i),"",context);
		else if( aname == "NameForTrace")
			ajaxart.log(atts.item(i), "actions trace");
	 }
	 
	 var firstVar=true;
	 for(var childElem in childElems)
	 {
	 	if (!childElems.hasOwnProperty(childElem)) continue;
		var item = childElems[childElem]; 
		var tag = item.tagName;  //Todo: if backend use getTagName
		if (tag == "Condition" && ! aa_bool(data,item,"",context))
		{
			ajaxart.stack_trace.pop();
			return [];
		}
		else if (tag == "Data")
		{
			data = [aa_first(data,item,"",context)];
			if (data[0] == null) data = [];
		}
		else if (tag == "RunOn")
  	 	  context = ajaxart.calcParamsForRunOn(context,ajaxart.run(data,item,"",context));
		else if (tag == "Class")
			classDecorator = aa_text(data,item,"",context);
		else if (tag == "CssStyle")
			cssStyleDecorator = aa_text(data,item,"",context);
		else if (tag == "Var")
		{
			if (firstVar) { context = ajaxart.clone_context(context); firstVar = false;}
			var scope = item.getAttribute('varScope') || 'stack';

      var varname = item.getAttribute("name");
      if (varname == "ControlElement") {	// special case. todo: try to fix this
				var elementPointer = {};
        ajaxart.setVariable(context,varname,elementPointer);         
      }
      var var_value = null;
      if (! aa_hasAttribute(item,"t") && ! aa_hasAttribute(item,"value") )
        var_value = data;
      else
        var_value = ajaxart.run(data,item,"",context);

      if (varname == "ControlElement") {	// special case. todo: try to fix this
        elementPointer.controlElement = var_value;
      }
      if (scope == 'Component') {
        context.params[varname] = var_value;
      } else { // scope == stack
        ajaxart.setVariable(context,varname,var_value);
      }
		}
	 }

	 var component = field_script.getAttribute("t") || "";
	 if (component == "") 
	 {
       if (aa_hasAttribute(field_script,"value") ) {
  		 if (field_script.getAttribute("Break") == "true")
  	    	 debugger;
      	 var out = ajaxart.dynamicText(data,field_script.getAttribute("value"),context,null,booleanExpression);
         if (aa_hasAttribute(field_script,"Trace"))
        	 ajaxart.trace(script,data,out,context,field,field_script.getAttribute("Trace"));
		 if (ajaxart.inPreviewMode)
		 	aa_trace_run_for_preview(field_script,data,out,context,origData);

  		 ajaxart.stack_trace.pop();
         return out;
       }
       else {  // maybe CDATA
   		for (var child = field_script.firstChild; child; child=child.nextSibling)
			if (child.nodeType == 4 && child.nodeValue)
				return ajaxart.dynamicText(data,child.nodeValue,context,null,booleanExpression);
       }
       ajaxart.stack_trace.pop();
	   return [];
	 }	   	   	   
	 // component definition
	 var global = aa_componentById(component);
	 if (!global) {
		ajaxart.stack_trace.pop();
		return [];
	 }
	 //aa_mark_component_usage(component,global);	// used for compression- do not delete
	 if (global.getAttribute("execution") == "native")
	 {
	   var gc_component = (method && method.length > 0) ? component + "_" + method : component;
	   var func = aa_componentById(gc_component,'gcs');
	   if (!func) {
		   ajaxart.stack_trace.pop();
		   return [];
	   }
	   if (field_script.getAttribute("Break") == "true")
		   debugger;
       if (ajaxart.profiling_of_globals == null)
    	   out = func(field_script,data,context);
       else {
	 		 var before = new Date().getTime();
        	 out = func(field_script,data,context);
        	 ajaxart.write_profiling_at_end(before,component);
        }
	 }
	 else   // xtml-defined component
	 {
		 var global_xtml = ajaxart.componentsXtmlCache[component]; 
		 if (global_xtml == null) {
	       global_xtml = ajaxart.childElem(global,'xtml');
	       ajaxart.componentsXtmlCache[component] = global_xtml;
		 }
		 if (global_xtml == null)
			 ajaxart.log("missing implementation for component " + component,"error");
		 var paramDefinitions = ajaxart.childElems(global,"Param");
		 var contextForXtml = ajaxart.newContext();
		 contextForXtml.vars = context.vars;
	     contextForXtml.componentContext = context;
	     contextForXtml.counter = (context.counter!=null) ? context.counter+1 : 1;
//	     if (contextForXtml.counter == 50) { debugger; window.alert('endless loop'); throw "endless loop"; }
	     if (contextForXtml.counter > 100) { ajaxart.log("endless loop"); return []; }
		 
		 for(var i=0;i<paramDefinitions.length;i++)
		 {
			 var paramDef = paramDefinitions[i];
			 var param_name = paramDef.getAttribute("name");
			 var param_value;
			 if (aa_hasAttribute(paramDef,"type") && (''+paramDef.getAttribute("type")).indexOf("[]") > 0)  //array
			 {
			   var param_value = [];
			   var subprofiles = ajaxart.childElems(field_script,param_name);
  		       if (paramDef.getAttribute("script") != "true" ) { 
			     for(var j=0;j<subprofiles.length;j++)
  			       ajaxart.concat(param_value, ajaxart.run(data,subprofiles[j],"",context) );
  		       } else { 
  		    	 param_value = { isArrayParamScript: true , script: field_script, field:param_name, context: context };
  		       }
			 }
		     else if (paramDef.getAttribute("script") != "true" ) 
			   param_value = ajaxart.run(data,field_script,param_name,context);
	         else { // script=true
	           param_value = { isParamScript: true }; 
			   param_value.script = ajaxart.fieldscript(field_script, param_name,true,contextForXtml);
	           param_value.compiled = ajaxart.compile(param_value.script,'',context,paramDef.getAttribute("paramVars"));
	         }

			 ajaxart.setParameterVariable(contextForXtml,param_name,param_value);
	     }
	     if (global.getAttribute("useCallerScript") == "true")
			   ajaxart.setVariable(contextForXtml,"_CallerScript", [field_script]);
	     
	     if (ajaxart.profiling_of_globals == null)
	    	 out = ajaxart.run(data,global_xtml,"",contextForXtml,method);
	     else {
	 		 var before = new Date().getTime();
	    	 out = ajaxart.run(data,global_xtml,"",contextForXtml,method);
        	 ajaxart.write_profiling_at_end(before,component);
	     }
	   } 
	   
       // decorators - post function
	   if (out == null) out = [];
	   
	   if (classDecorator != "") {
		 if (ajaxart.ishtml(out))
		   for(var item in out)
		   	if (out.hasOwnProperty(item))
				 jQuery(out[item]).addClass(classDecorator);
       }
	   if (cssStyleDecorator != "") {
		   for(var item in out)
		   	if (out.hasOwnProperty(item) && ajaxart.ishtml(out[item]))
				aa_setCssText(out[item],cssStyleDecorator);
	   }
	   if (global.getAttribute('databind') == "true") {
		   ajaxart.databind(out,data,context,field_script,origData);
	   }
	   try {
	     if (field_script.nodeType == 1 && out.length > 0 && ajaxart.isObject(out[0]))
		   if (global.getAttribute('dtsupport') != "false" && field_script.nodeType == 1 && field_script.getAttribute('dtsupport') != "false" && !noDtSupport)
		     out[0].XtmlSource = [{ script: field_script , input: data, context: context }];
	   } catch(e) {  }
	   
	   // trace
	   if (aa_hasAttribute(field_script,"Trace"))
		   ajaxart.trace(field_script,data,out,context,null,field_script.getAttribute("Trace"));
	   
	   if (aa_hasAttribute(field_script,"Alert")) {
	   	  if (field_script.getAttribute("Alert") == "true")
		   aa_alert(ajaxart.totext_array(out));
		  else
		  	aa_alert(ajaxart.dynamicText(out,field_script.getAttribute("Alert"),context));
		}

	  	if (aa_hasAttribute(field_script,"Name"))
	  	{
	  		var id = ('' + field_script.getAttribute("Name")).replace(/ /g, "_");
			 for(var item in out)
		   		if (out.hasOwnProperty(item) && ajaxart.ishtml(out[item]))
					 out[item].setAttribute("id", id);
	  	}
		if (ajaxart.inPreviewMode)
		 	aa_trace_run_for_preview(field_script,data,out,context,origData);
	   ajaxart.stack_trace.pop();
       return out;
	   } catch (e) {
	   	   if (e && e.BreakPreviewCircuit) 
	   	   		throw e;
	   	   	
		   var prefix = '';
		   if (script) {
			   var field_script = ajaxart.fieldscript(script, field,false) || script;
			   if (script.getAttribute('t')) prefix = 't=' + script.getAttribute('t') + ' - ';
		   }
	   	   ajaxart.logException(e,prefix);
	       return [];
	   };
},
compile_text: function (script, field ,context) {
	var fieldscript = ajaxart.fieldscript(script,field,true);
	if (fieldscript == null) return function() { return ''};
	
	if (fieldscript.nodeType == 2) { 
		var value = fieldscript.nodeValue;
		if (value == "%%" ) return function(data1) { return aa_totext(data1) };
		if (!value.match(ajaxart.STRING_WITH_EXP)) // no vars
		  return function() { return value };
	
		var att = value.match(/^%@([^%]+)%$/);
		if (att) 
			return function(data) { return data[0].getAttribute(att[1]) || ''; };
	}

	return function(data,ctx) { return aa_text(data,script,field,ctx); };  // the default - no compile
},
compile: function (script, field ,context,paramVars,isReadOnly, bool) {
	function normalRun(data,context) { 
		return ajaxart.run(data,script, field, context, '', bool) };

	if (ajaxart.xtmls_to_trace.length > 0 || script == null) return normalRun;
	if (!script) { ajaxart.log('compile with no script','error'); return;	}
	
	var fieldscript = ajaxart.fieldscript(script,field,true);
	if (fieldscript == null) return function(context) { return [];};
	
	var value = null;
	if (fieldscript.nodeType == 1) {
	  var extraAttrs=0;
	  if (aa_hasAttribute(fieldscript,'name')) extraAttrs=1;
	  if (aa_hasAttribute(fieldscript,'paramVars') ) extraAttrs=1;
	  
	  if (fieldscript.attributes.length == 2+extraAttrs && fieldscript.getAttribute("t") == "xtml.UseParam" && fieldscript.firstChild == null) {
		  var param = fieldscript.getAttribute("Param");
		  if (aa_hasAttribute(fieldscript,'Param')) {
			var paramScript = context.params[param];
  		    if (!paramScript || !paramScript.script || aa_isArray(paramScript) ) return normalRun;
  		    if (paramScript.compiled == "same") return aa_same; // aa_same() 
  	        return function(data,context1) {
  	  	  	    var newContext = {};
  		  	    newContext.vars = context1.vars;
  		  	    newContext.params = context.componentContext.params;
  		  	    newContext.componentContext = context.componentContext.componentContext;
  		  	
  		  	    if (paramScript.compiled == null)  
  		  	    	return ajaxart.run(data,paramScript.script,"",newContext);
  	            else
  	            	return paramScript.compiled(data,newContext);
  	        };
		  };
  	      return normalRun;
	  }
 	  if (fieldscript.getAttribute("t") == "js.JavaScript" ) {
	  	var scriptNode = ajaxart.childElem(fieldscript,'Javascript');
	  	if (!scriptNode) return function() { return [] };
			var code = aa_cdata_value(scriptNode) || ajaxart.xml.innerTextStr(scriptNode);
 	  	var run_js = aa_get_func(code);
 	  	return function(data,context) {
				var data_item = data;
				if (data.length == 1)
					data_item = data[0];
				var ret = run_js(data_item,context.vars._ElemsOfOperation ? context.vars._ElemsOfOperation[0] : null,context);
				if (!ret) return [];
				if (typeof(ret) == 'string') return [ret];
				if (typeof(ret) == 'number') return [""+ret];
				if (typeof(ret) == 'boolean') return (ret) ? ["true"] : [];
				if (aa_isArray(ret)) return ret;
				return [ret];
 	  	}
 	  }
	  if (fieldscript.attributes.length <= 3+extraAttrs && fieldscript.getAttribute("t") == "xtml.RunXtml" && fieldscript.firstChild == null) {
		  return aa_compile(fieldscript);
	  }
  	  if (fieldscript.getAttribute("t") == "uiaspect.JavaScriptControl" ) {
      	var func_name = aa_text([],fieldscript,'FunctionName',context);
      	if (func_name != "" && window[func_name] == null) { ajaxart.log("function " + func_name + " does not exist","error"); return []; }
    		return function(data,context) { 
    			var control = jQuery(aa_text(data,fieldscript,'Html',context));
    			if (window[func_name] == null) return control;
    			else return [window[func_name](data,context,control)] };
  	  }
	  if (fieldscript.attributes.length > 1+extraAttrs || fieldscript.firstChild != null) return normalRun;  // no compilation possible
  	  if (fieldscript.getAttribute("t") == "data.Same" ) return aa_same;
	  value = aa_hasAttribute(fieldscript,'value') ? fieldscript.getAttribute('value') : null;
	}
	else if (fieldscript.nodeType == 2) value = fieldscript.nodeValue;
	
	if (value == null) return normalRun;
	if (value == "%%") return aa_same;
	if (!value.match(ajaxart.STRING_WITH_EXP))
		return function(data,context) { return [value]; };
	var items = value.split("%");
	if (items.length == 3) {
		if (items[1].charAt(items[1].length-1) == "\\" || items[2].charAt(items[2].length-1) == "\\") return normalRun;// width:50\%, height:30\%
		if (value.charAt(0) == '%' && value.charAt(value.length-1) == '%' ) { // xpath
			if (value.charAt(1) == '@') { // attribute
				if (value.indexOf('{') != -1) return normalRun;
				var attr = value.substring(2,value.length-1);
				if (isReadOnly) {
					var myFunc = function(attr) { return function(data,context) {
						var out = [];
						for(var i=0;i<data.length;i++) {
							var item = data[0];
							if (typeof(item.nodeType) == "undefined" || item.nodeType != 1) continue;
							if (aa_hasAttribute(item,attr)) out.push(value);
						}
						return out;
					} };
					return myFunc(attr);
				}
				var myFunc = function(attr) { return function(data,context) {
					var out = [];
					for(var i=0;i<data.length;i++) {
						var item = data[0];
						if (typeof(item.nodeType) == "undefined" || item.nodeType != 1) continue;
						var atts = item.attributes;
						for (var j = 0; j < atts.length; j++)
						  if (atts.item(j).nodeName == attr)
							out.push(atts.item(j));
					}
					return out;
				} };
				return myFunc(attr);
			}
			return normalRun;
		}
		if (!bool ) { // text with prefix && suffix. Not for boolean,e.g: %%=='Europe' ==> Europe=='Europe' and not 'Europe'=='Europe'
			var prefix = items[0];
			var suffix = items[2];
			var xpath = items[1];
			if (xpath.length == 0) { // text
				var myFunc = function(prefix,suffix) { return function(data,context) { return [prefix+ajaxart.totext_array(data)+suffix]; } }
				return myFunc(prefix,suffix);
			}
		}
	}
	return normalRun;
},
fieldscript: function (script, field,lookInAttributes) 
{
	if (!field) return script;
	if (lookInAttributes && aa_hasAttribute(script,field))
		return ajaxart.xml.attributeObject(script,field);
	
	var field_script = ajaxart.childElem(script,field);
	if (!field_script) 
		field_script = aa_get_default_value(script.getAttribute("t"),field);
	return field_script;
},
splitCommasForAggregatorParams: function(params_str)
{	// a,'b,d,t',c --> [ 'a', 'b,d,t', 'c' ]
	if (!params_str) return [];
	var out = [];
	var single_quot= false, double_quot= false, last_index= 0;
	for (var i=0; i<params_str.length; i++) {
		if (params_str[i] == '"')
			double_quot = !double_quot;
		else if (params_str[i] == "'")
			single_quot = !single_quot;
		else if (params_str[i] == "," && !single_quot && !double_quot) {
			var param = params_str.substring(last_index,i);
			out.push(param);
			last_index = i+1;
		}
	}
	out.push(params_str.substring(last_index));
	for (var j=0; j<out.length; j++) {
		var match = out[j].match(/^'([^']*)'$/);
		if (match) out[j] = match[1];
		match = out[j].match(/^"([^"]*)"$/);
		if (match) out[j] = match[1];
	}
	return out;
},
runNativeHelperNoParams: function(data,script,helpername,context)
{
	var component = script.getAttribute('t');
	var global = aa_componentById(component);
	if (!global) return [];  // should not happen
	
	var helperXml = aa_xpath(global,'NativeHelper[@name="'+helpername+'"]');
	if (helperXml.length > 0)
		return ajaxart.run(data,helperXml[0],"",context);

	ajaxart.log("calling runNativeHelper for none existing helper - " + helpername);
	return [];
},
runNativeHelper: function(data,script,helpername,context)
{
	var new_context = ajaxart.clone_context(context);
	var comp_context = ajaxart.clone_context(context);
	new_context.params = [];
	
	for (i in context.params)
	   	if (context.params.hasOwnProperty(i))
			comp_context.params[i] = context.params[i];
	
	var field_script = script;
	
	var component = script.getAttribute('t');
	var global = aa_componentById(component);
	if (!global) return [];  // should not happen

  var paramDefinitions = ajaxart.childElems(global,"Param");
  new_context.componentContext = comp_context; // context.componentContext || context; 
	 
	for(var i=0;i<paramDefinitions.length;i++)
	{
		 var paramDef = paramDefinitions[i];
		 var param_name = aa_hasAttribute(paramDef,'name') ? paramDef.getAttribute("name") : null;
		 var param_value;

		 if (aa_hasAttribute(paramDef,"type") && (''+paramDef.getAttribute("type")).indexOf("[]") > 0)  //array
		 {
		   var param_value = [];
		   var subprofiles = ajaxart.childElems(field_script,param_name);
		   if (paramDef.getAttribute("script") != "true" ) { 
		     for(var j=0;j<subprofiles.length;j++)
			       ajaxart.concat(param_value, ajaxart.run(data,subprofiles[j],"",new_context) );
		   } else { 
		   	 param_value = { isArrayParamScript: true , script: script, field:param_name, context: new_context };
		   }
		 } else if (paramDef.getAttribute("script") != "true" ) 
		   param_value = ajaxart.run(data,field_script,param_name,comp_context);
     else { // script=true
       param_value = { isParamScript: true };
       param_value.script = ajaxart.fieldscript(field_script, param_name,true,comp_context);
       param_value.compiled = ajaxart.compile(param_value.script,'',comp_context,paramDef.getAttribute("paramVars"));
     }

		 ajaxart.setParameterVariable(new_context,param_name,param_value);
    }
	
	var helperXml = aa_xpath(global,'NativeHelper[@name="'+helpername+'"]');
	if (helperXml.length > 0)
		return ajaxart.run(data,helperXml[0],"",new_context);

	ajaxart.log("calling runNativeHelper for none existing helper - " + helpername);
	return [];
},
dynamicTextWithAggregator: function(item,str,context)
{
	// =Min(person/@age) or =Concat(person/@name,',') or =gstudio.Selected()
	var match = str.match(/=([a-zA-Z.]+)[(]([^)]*)[)]/);
	if (!match) return '';
	var funcName = match[1];
	var ns = "data";
	if (funcName.indexOf('.') > -1) {
		ns = funcName.split('.')[0];
		funcName = funcName.split('.')[1];
	} else {
		if (!ajaxart.components[ns][funcName]) ns='text';
	}

	var params = match[2];
	var params_arr = ajaxart.splitCommasForAggregatorParams(params); 
	if (ajaxart.components[ns][funcName] == null) return '';
	var extraParams = "";
	var itemArr = item ? [item] : [];
	var data = params_arr[0] ? ajaxart.dynamicText(itemArr,"%"+params_arr[0]+"%",context,itemArr) : itemArr;
	for (var i=1; i<params_arr.length; i++) {
		var shortParams = aa_xpath(ajaxart.components[ns][funcName], "Param[@short='true']/@name");
		if (shortParams.length <= i-1) break;
		var paramText = params_arr[i].replace('{','%').replace('}','%');
		extraParams += ' ' + ajaxart.totext_item(shortParams[i-1]) + '="' + paramText + '" ';
	}
	var script = '<Script t="' + ns + '.' + funcName +'"'+ extraParams+ ' />';
	return aa_first(data,aa_parsexml(script,'aggregator'),"",context);
},
dynamicText: function(data,str,context,origData,booleanExpression,xmlescape) 
{
    function expand(data,func,isFirst) {
    	var result = [];
    	for(var i=0;i<data.length;i++)
    		result = result.concat(func(data[i]))
    	if (!data.length && isFirst)
    		result = [func()];

    	return result;
    }
    function xpathFilterForObjects(item,filterExp) {
    	function opValue(op) {
    		var str_match = op.match(/'[^']*'/) || op.match(/"[^"]*"/);
    		if (str_match) return op.slice(1,-1);
    		return ''+item[op];
    	}
    	var equal_exp = filterExp.match(/([^!=]*)(=|!=|==)(.*)/);
    	if (!equal_exp) return false;
    	var oper = equal_exp[2];
    	var op1 = opValue(equal_exp[1]);
    	var op2 = opValue(equal_exp[3]);
   		return 	(oper == '=' && op1 == op2) || 
				(oper == '==' && op1 == op2) ||
				(oper == '!=' && op1 != op2);
    	return false;
    }
    function calcExp(exp) {
		var createIfNotExist = false,byRef=false;
		if (exp[0] == '=') // e.g =Min(person/@age)
			return expand(data,function(elem) { 
				return ajaxart.dynamicTextWithAggregator(elem,exp,context);
			},true);
		if (exp.indexOf('{') != -1 && exp.match(/{[^}]*}/)) // inner vars
			exp = ajaxart.totext(ajaxart.dynamicText(data,exp.replace(/(^|[^\\]){/g,'$1%')
					.replace(/(^|[^\\])}/g,'$1%')
					.replace(/\\({|})/g,'$1'),context));
    	var items = exp.split('/'); // xpath pipline
    	var result = data;
    	for(var i=0;i<items.length;i++) {
    		var item = items[i];
   			var is_hash_filter = item.indexOf('[#') > -1;
    		var filter_match = null;
    		if (item.indexOf('[') != -1) {
    			filter_match = item.match(/([^\[]*)(\[[^\]]*\])/); // elem[@id=15]
    			if (filter_match) item = is_hash_filter ? filter_match[0] : filter_match[1];
    		}
    		if (item.charAt(0) == '!') { 
    			createIfNotExist = true; item = item.substr(1);
    		}
    		if (item.charAt(0) == '>') { 
    			byRef = true; item = item.substr(1);
    		}
    		if (item.charAt(0) == '$') {
    			result = ajaxart.getVariable(context,item.substr(1));
    		} else if (result[0] && result[0].nodeType && result[0].nodeType == 1 && !createIfNotExist && exp.indexOf('/!') == -1 && ! ajaxart.ishtml_item(result[0]) ) { // xml xpath
    			var remaining_xpath = items.slice(i).join('/');
    			return expand(result,function(elem) { 
    				return aa_xpath(elem,remaining_xpath);
    			});
    		} else if (item == '') { 
    			result = result;
    		} else { // 'path1/path2'
    			result = expand(result,function(elem) { 
    				if (elem.nodeType && !ajaxart.ishtml(elem)) return aa_xpath(elem,item,createIfNotExist);
   					var res = elem[item];
    				if (ajaxart.isObject(elem)) { // JSON support
    					if (item == '..' && elem.ParentNode) return [elem.ParentNode()];
    					if (item == '*') {
    						var result = [];
							for (var p in elem) if (elem.hasOwnProperty(p))
								result.push(aa_new_JsonByRef(elem,p));
    						return result;
    					}
						var last = i == items.length -1;
						if (last && byRef) 
							return [ aa_new_JsonByRef(elem,item) ];
						if (res == null && createIfNotExist) res = elem[item] = {};
					}
   					if (res == null) return [];
   					return aa_isArray(res) ? res: [res]; 
    			});
    		}
    		if (filter_match) {
    			var index = parseInt(filter_match[2].slice(1,-1));
    			if (isNaN(index))
    				result = expand(result,function(elem) { 
    					if (is_hash_filter) return [elem];
    					if (elem.nodeType)
    						return aa_xpath(elem,'self::*'+filter_match[2],createIfNotExist);
    					return xpathFilterForObjects(elem,filter_match[2].slice(1,-1)) ? [elem] : [];
    				});
    			else
    				result = result.slice(index-1,index);
    		}
    	}
    	return result;
    }
	if (!str.match(ajaxart.STRING_WITH_EXP)) return [str.replace(/\\%/g,'%')];
	if (str == "%%") return data;
	var oneVar = str.match(/^%\$([a-zA-Z_0-9]+)%$/); // 12% performance boost
	if (oneVar) {
		var result = ajaxart.getVariable(context,oneVar[1]);
		//if (booleanExpression) 
		//	return result[0] ? ['true'] : ['false'];
		return result;
	}
		
    var arr = str.split("%");
    var escaped=[], i=0;
    while (i < arr.length) { // unifying segments - handle escaped \%
        var segment = arr[i];
        while (segment.substr(segment.length-1) === '\\' && i < arr.length-1)
            segment = segment.slice(0,-1) + '%' + arr[++i];
        escaped.push(segment);
        i++;
    }
    if (escaped.length == 2) return [str]; // non closing %
    if (escaped.length == 3 && escaped[0] == '' && escaped[2] == '') { // one variable - return array result
    	try {
    		return calcExp(escaped[1]);
    	} catch(e) {
//    		debugger;
    	}
    }
    var result=[], in_expression = false;
    for(var i=0;i<escaped.length;i++) {
        var segment = escaped[i];
        if (!in_expression) {
            result.push(segment);
            in_expression = true;
        } else if (segment.match(ajaxart.NOT_EXP)) { // auto escaped %. non-closing % followed by space/comma/etc  
            result.push('%' + segment)
            in_expression = true;
        } else {
        	try {
        		var item_to_add = ajaxart.totext_array(calcExp(segment));
                if (booleanExpression) {
                	// wrap with '' if not a number
                	// example: %@type% == 'company' ==> 'company' = 'company'
                	// example: %@%count% > 4        ==> 5 > 4
                	if (! item_to_add.match(/^([0-9]+|[0-9]*\.[0-9]+)$/) )
                		item_to_add = "'" + item_to_add.replace(/'/g, "\\'") + "'";
                }
	            if (xmlescape) item_to_add = aa_xmlescape(item_to_add);
       			result.push(item_to_add);
        	} catch(e) {
//        		debugger;
        	}
            in_expression = false;
        }
    }
    return [result.join('')];
},
newContext: function() {
	return { vars: {_Images: [aa_base_images()] ,_Lib: [aa_base_lib()]} , params: [] ,componentContext: null};
},
clone_context: function(context)
{
	var new_context = ajaxart.newContext();
	for (i in context.vars) {
	   	if (context.vars.hasOwnProperty(i))
			new_context.vars[i] = context.vars[i];
	}
	new_context.params = context.params;
	new_context.componentContext = context.componentContext;
	new_context._This = context._This;
	
	return new_context;
},
setVariable: function(context,varName,varValue)
{
	if (varName == null) return;
	try {
		context.vars[""+varName] = varValue;
	} catch(e) { ajaxart.log("cannot set variable" + varName,"error"); }
},
setParameterVariable: function(context,varName,varValue)
{
	if (varName == null) return;
	try {
		context.params[''+varName] = varValue;
	} catch(e) { ajaxart.log("cannot set param " + varName,"error"); }
},
getVariable: function(context,varName)
{
	if (!varName) return [];
	varName = '' + varName;
	var val = context.params && context.params[varName];
	if (val) {
		if (val.isParamScript) {
			if (val.script) 
				return [val.script];
			else
				return [];
		}
		return val;
	}
	if (varName == "_This" && context._This) return [context._This];
	
	val = context.vars && context.vars[varName];
	if (val) return val;

	var func = context.vars._AppContext && context.vars._AppContext[0].Vars && context.vars._AppContext[0].Vars[varName];
	func = func || context.vars._GlobalVars && context.vars._GlobalVars[0][varName];
	if ('function' == typeof func) 
		val = func(varName,context);
	if (val) return val;
	
	return [];
},
istrue: function(item)
{
	if (!item) return false;
	return (ajaxart.totext(item) == "true");
},
tobool_array: function(arr)
{
	return ajaxart.totext_array(arr) == "true";
},
totext_array: function(arr)
{
	if (arr == null || arr.length == 0) return '';
	return ajaxart.totext_item(arr[0]);
},
totext: function(item) 
{
	if (aa_isArray(item)) return ajaxart.totext_array(item);
	return ajaxart.totext_item(item);
},
totext_item: function(item)
{
	if (item == null || item == undefined) return '';
	if (typeof item == 'string') return item;
	if (item.nodeType && item.nodeType == 2) return item.nodeValue;
	
	if (ajaxart.ishtml_item(item))
		return ajaxart.xml2text(item);

	if (ajaxart.isxml_item(item))
	{
		if (item.nodeValue != null) return item.nodeValue;
		// if has no sub elements : return inner text
   		for (var child = item.firstChild; child; child=child.nextSibling)
			if (child.nodeType == 4 && child.nodeValue) // promote cdata
				return child.nodeValue;
			else if (child.nodeType == 1) 
				return ''; // mixed 
		if (item.text != null) return item.text;
		return item.textContent;
	}
	if (item.GetValue)
		return '' + item.GetValue();

	return '' + item;
},
subprofiles: function (profile,field) 
{
  return ajaxart.childElems(profile,field);
},
runsubprofiles: function (data,profile,field,context,trycatch_oneachitem)
{
	var subProfs = ajaxart.childElems(profile,field);
	var out = [];
	for(var i=0;i<subProfs.length;i++) {
		if (ajaxart.debugmode)
			ajaxart.concat(out,ajaxart.run(data,subProfs[i],'',context) );
		else {
 		  try {
		    ajaxart.concat(out,ajaxart.run(data,subProfs[i],'',context) );
		  }
		  catch(e) {
			if (trycatch_oneachitem != true) throw(e);
			ajaxart.logException(e);
		  }
		}
	}
	return out;
},
each: function(arr,func)
{
	for(var i=0;i<arr.length;i++)
		func(arr[i],i);
},
load_xtml_content: function(xtml_name,xtml)
{
	if (xtml == null) { 
		alert('could not load xtml ' + xtml_name); 
		if (window.console) console.error('could not load xtml ' + xtml_name); 
		return;
	}
	if (xtml.getAttribute("package") == "true") {
		var plugins = ajaxart.childElems(xtml,"*");
		ajaxart.each(plugins,function(plugin_xml) {
			ajaxart.load_xtml_content(xtml_name,plugin_xml);
		});
		return;
	}
	plugin_name = xtml.getAttribute("ns");
	if (! plugin_name || plugin_name == '')
		plugin_name = xtml.getAttribute("id");
	if (! plugin_name || plugin_name == '') {
		ajaxart.log("xtml file does not have ns or id attribute in the main xtml element. Tag: " + aa_tag(xtml), "error");
		ajaxart.log();
		return;
	}
	xtml.setAttribute("file",xtml_name);
		
	var globalsInFile = ajaxart.childElems(xtml,"*");
	ajaxart.each(globalsInFile,function(item) {
		switch (item.tagName) {
		case "Component":
			var id = item.getAttribute("id");
			if (ajaxart.components[plugin_name] == null)
				ajaxart.components[plugin_name] = [];
			ajaxart.components[plugin_name][id] = item;
			aa_load_inplace_gc(item,plugin_name);
			break;
		case "C":
			var id = item.getAttribute("id");
			if (ajaxart.components[plugin_name] == null)
				ajaxart.components[plugin_name] = [];
			ajaxart.components[plugin_name][id] = item;
			break;
		case "Usage":
			if (ajaxart.usages[plugin_name] == null)
				ajaxart.usages[plugin_name] = [];
			
			ajaxart.usages[plugin_name].push(item);
			break;
		case "Plugin":
			if (ajaxart.plugins[plugin_name] == null)
				ajaxart.plugins[plugin_name] = [];
			
			ajaxart.plugins[plugin_name] = item;
			break;
		case "Type":
			var id = item.getAttribute("id");
			ajaxart.types[plugin_name + "_" + id] = item;
			break;
		}
	});
},
parsexml: function(contents, filename, errorMsgOut, onlyWarning,baseXml)
{
	return aa_parsexml(contents, filename, errorMsgOut, onlyWarning,baseXml);
},
childElem: function(parent,elemName)
{
	if ( parent == null || parent.childNodes == null ) return null;
	var node = parent.firstChild;
	while (node)
	{
		if (node.nodeType == 1) {
			if (elemName == "*") return node;
			if (node.tagName == elemName) return node; 
		}
		node=node.nextSibling;
	}
	return null;
},

childElems: function(parent,elemName)
{
	var out = [];
	if ( parent == null || parent.childNodes == null ) return out;
	var node = parent.firstChild;
	while (node)
	{
		if (node.nodeType == 1) {
			if (elemName == "*") out.push(node);
			if (node.tagName == elemName) out.push(node);   
		}
		node=node.nextSibling;
	}
	return out;
},

childElemByAttrValue: function(parent,elemName,attrName,attrValue)
{
	if ( parent == null || parent.childNodes == null ) return null;
	for(var i=0;i<parent.childNodes.length;i++)
	{
		var node = parent.childNodes.item(i);
		if (node.nodeType != 1) continue;
		if (elemName == "*" || node.tagName == elemName) // TODO: if BackEnd run this loop with node.getTagName
			if (node.getAttribute(attrName) == attrValue)
				return node;
	}
	return null;
},
isxml_array: function(arr)
{
	if (arr.length == 0) return false;
	return ajaxart.isxml_item(arr[0]);
},
isxml_item: function(xml)
{
	if (xml == null) return false;
	return (xml.nodeType != null);
},
isxml: function(xml)
{
	if (aa_isArray(xml)) return ajaxart.isxml_array(xml);
	return ajaxart.isxml_item(xml);
},
isObject_array: function(array) {
	return array.length > 0 && ajaxart.isObject(array[0]); 
},
isObject: function(item) {
    if (!item || item.nodeType) return false; 
	var type =  Object.prototype.toString.call(item);
	if (type === '[object Array]' && item.length > 0) 
		return ajaxart.isObject(item[0]);
	return type === '[object Object]';
},
ishtml_array: function(arr)
{
	if (arr.length == 0) return false;
	return ajaxart.ishtml_item(arr[0]);
},
ishtml_item: function(item)
{
	if (!item || !item.ownerDocument || !item.nodeType) return false;
	return (item.body || item.ownerDocument.body) ? true : false;
},
ishtml: function(item)
{
	if (!item) return false;
	if (aa_isArray(item) && item.length > 0) 
		return ajaxart.ishtml_item(item[0]);
	else
		return ajaxart.ishtml_item(item);
},
urlparam: function(strParamName)
{
    var strHref = window.location.href;
    if (strHref.indexOf('#') > -1) strHref = strHref.substr(0,strHref.indexOf("#"));
    if ( strHref.indexOf("?") > -1 ) {
        var strQueryString = strHref.substr(strHref.indexOf("?")+1);
        var aQueryString = strQueryString.split("&");
        for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
          var aParam = aQueryString[iParam].match(/([^=]*)=(.*)/); 
          if (aParam && aParam[1] == strParamName)
            return aParam[2] && unescape(aParam[2]).replace(/_AMP_/g,'&');
        }
      }
    return "";
},
xtmls: null,
xml: {
	attributeObject: function(parent,attrName)
	{
		if ( parent == null || parent.childNodes == null ) return null;
		for(var i=0;i<parent.attributes.length;i++)
		{
			if (parent.attributes.item(i).nodeName == attrName)
				return parent.attributes.item(i);
		}
		return null;
	}
},
trycatch : function(func, whenerror) {
	if (ajaxart.debugmode)
		return func();
	
	try {
		return func();
	} catch(e) {
		if (e == "endless loop") throw e;
		return whenerror(e);
	};
}
};

function aa_componentById(id,type)
{
	if (!id) return null;
	type = type || 'components';
	var middlePos = id.indexOf('.');
	var ns = id.substring(0,middlePos);
	var compName = id.substr(middlePos+1);
	var result = ajaxart[type][ns] && ajaxart[type][ns][compName];
	if (!result) 
		ajaxart.log('Can not find : ' + id + ' in ' + type,'error');
	return result;
}
function aa_get_default_value(parent_comp,field)
{
	if (!parent_comp) return null;
	var default_value = ajaxart.default_values[parent_comp + "__" + field];
	if (!default_value) {
		var global = aa_componentById(parent_comp);
		var param = ajaxart.childElemByAttrValue(global,"Param","name",field);
		if (param && aa_hasAttribute(param,'Default'))
			default_value = ajaxart.xml.attributeObject(param,"Default");
		else
			default_value = ajaxart.childElem(param,"Default");
		
		field_script = ajaxart.default_values[parent_comp + "__" + field] = default_value || 'none';
	}
	if (default_value === 'none') return null; // === for IE8
	return default_value;
}

function aa_compile(script)
{
	  var xtml = script.getAttribute('Xtml');
	  if (script.getAttribute('Field') != null) return null;
	  
	  if (xtml == null || xtml.length < 4) return null;
	  if (xtml.charAt(0) == '%' && xtml.charAt(1) == '$') {
		  var slashPos = xtml.indexOf('/');
		  if (slashPos == -1) return null;
		  if (xtml.split('/').length != 2) return null;
		  
		  var varName = xtml.substring(2,slashPos);
		  var funcName = xtml.substring(slashPos+1,xtml.length-1);
		  
		  var myFunc = function(varName,funcName) { return function(data,context) { 
			  if (script.getAttribute('Input') != null)
				  data = ajaxart.dynamicText(data,script.getAttribute('Input'),context);
			  
			  var struct = ajaxart.getVariable(context,varName);
			  if (struct == null || ! ajaxart.isObject_array(struct)) { return ajaxart.run(data,script,'',context); }
			  var xtml = struct[0][funcName];
			  if (xtml == null) return [];
			  
			  if (xtml.compiled == "same") return data;
			  
		  	  var newContext = ajaxart.newContext();
		  	  
			  if (xtml.context != null) { // the xtml object comes with its own context
			  	  newContext.params = xtml.context.params;
			  	  newContext.componentContext = xtml.context.componentContext;
			  } 
		      newContext.vars = context.vars;
			  if (xtml.objectForMethod)
				  newContext._This = xtml.objectForMethod[0];
			  
			  if (xtml.compiled == null)
			    return ajaxart.run(data,xtml.script,'',newContext);
			  else
				return xtml.compiled(data,newContext);
			  
		  } }
		  return myFunc(varName,funcName);
	  }
	  return null;
}
function ajaxart_runcompiled_text(compiledFunc, data, profile, field ,context)
{
	if (compiledFunc == 'same') return ajaxart.totext_array(data);
	if (compiledFunc == null)
		return aa_text(data,profile,field,context);
	else
		return ajaxart.totext_array(compiledFunc(data,context));
}
function ajaxart_runcompiled_bool(compiledFunc, data, profile, field ,context, empty_value_is_true)
{
	var text_val;
	if (compiledFunc == 'same') text_val = ajaxart.totext_array(data);
	if (compiledFunc == null)
		return aa_bool(data,profile,field,context,empty_value_is_true);
	else
		text_val = ajaxart.totext_array(compiledFunc(data,context));
    if (text_val == "") return (empty_value_is_true) ? true : false;
    if (text_val == "false") return false;
    if (text_val == "true") return true;

    if (! isNaN(text_val)) return false;// in js : if(2) == true
	var boolean_result = false;
	text_to_eval = "if (" + text_val + ") boolean_result=true;";
	try { eval(text_to_eval); }
	catch(e) { ajaxart.log("Failed to evaluate boolean expression: " + text_val + "," +  e.message
			+ "\n script :" + aa_xtml_path(profile,"id",true),"warning"); }
    return boolean_result;
}

function aa_totext(data)
{
	if (typeof(data) == "string") return data;
	if (data == null || data.length == 0) return "";
	return ajaxart.totext_item(data[0]);
}
function aa_tobool(data)
{
  if (data == null || data.length == 0) return false;
  if (ajaxart.totext_array(data)=="true") return true;
  return false;
}
function aa_frombool(bool) 
{
  return bool ? ["true"] : [];
}
function aa_fromPromise(promise) 
{
	return promise ? [promise] : [];
}
function aa_paramExists(profile,param,excludeEmptyAttribute)
{
  var script = ajaxart.fieldscript(profile,param,true);
  if (script == null) return false;
  if (script.nodeType == 1 && !script.getAttribute('t') && !script.getAttribute('value')) return false;
  if (excludeEmptyAttribute && profile.getAttribute(param) == '') return false;
	  
  return true;
}
function aa_first(data,script,field,params,method) {
	var result = ajaxart.run(data,script,field,params,method);
	if (result.length == 0) return null;
	return result[0];
}
function aa_text(data,script,field,params,method,booleanExpression)
{
	if (booleanExpression) 
		return ajaxart.totext(ajaxart.run(data,script,field,params,method,booleanExpression));
	return ajaxart.totext_array(ajaxart.run(data,script,field,params,method,booleanExpression));
}
function aa_int(data,script,field,params,method)
{
	var result = ajaxart.totext_array(ajaxart.run(data,script,field,params,method));
	if (!result) return null;
	return parseInt(result);
}
function aa_float(data,script,field,params,method)
{
	var result = ajaxart.totext_array(ajaxart.run(data,script,field,params,method));
	if (!result) return null;
	return parseFloat(result);
}
function aa_bool(data,script,field,params,method,empty_value_is_true)
{
	var result = aa_text(data,script,field,params,method,true);

    if (result == "") return (empty_value_is_true) ? true : false;
    if (result == "false") return false;
    if (result == "true") return true;

    if (! isNaN(result)) return false;// in js : if(2) == true
    var boolean_result = false;
    text_to_eval = "if (" + result + ") boolean_result=true;";
    try { 
    	eval(text_to_eval); 
    }	catch(e) { 
    	ajaxart.log("Failed to evaluate boolean expression: " + result + "," +  e.message + "\n script :" + aa_xtml_path(script,"id",true),"warning"); 
    }
    return boolean_result;
}
function aa_tag(item)
{
	return item.tagName;
}
function aa_hasAttribute(elem,attr)
{
	if (window.jBartNodeJS) return jBartNodeJS.hasAttribute(elem,attr);
	return elem.getAttribute(attr) !== null;
}

function aa_gcs(plugin, gcs) {
	if (!ajaxart.gcs[plugin])
		ajaxart.gcs[plugin] = gcs;
	else {
		var plugin = ajaxart.gcs[plugin];
		for (var gc in gcs)
		   	if (gcs.hasOwnProperty(gc))
				plugin[gc] = gcs[gc];
	}
}

function aa_trace_run_for_preview(field_script,data,out,context,origData) {
		for (i=0; i<ajaxart.xtmls_to_trace.length; i++)
		 if (field_script == ajaxart.xtmls_to_trace[i].xtml)
			 ajaxart.fill_trace_result(ajaxart.xtmls_to_trace[i].results,data,out,context,origData);

	if (jBart.previewCircuit) {
		if (ajaxart.xtmls_to_trace && ajaxart.xtmls_to_trace[0].xtml == field_script)	{ // probing current item
			jBart.previewCircuit.itemsFound++;
			if (jBart.previewCircuit.itemsFound >= jBart.previewCircuit.maxItemsToFind) {
				throw { BreakPreviewCircuit:true, message:"Calculation was cut-off after " + jBart.previewCircuit.itemsFound + " items" };
			}
		}
		if (Date.now() - jBart.previewCircuit.startTime > jBart.previewCircuit.maxTime) {
			throw { BreakPreviewCircuit:true, message:"Calculation was cut-off after " + jBart.previewCircuit.maxTime + " ms"};
		}
   }
}
function aa_same(data) { return data; };

aa_determine_device();
function aa_extend(obj,extra) {
	if (!obj || !extra) return obj;
	for (var elem in extra)
		if (extra.hasOwnProperty(elem))
			obj[elem] = extra[elem];
	return obj;
}
function aa_defaults(obj,extra) {
	obj = obj || {};
	for (var elem in extra) {
		if (typeof(obj[elem]) == 'undefined' && extra.hasOwnProperty(elem))
			obj[elem] = extra[elem];
	}
	return obj;
}

// loading dev
function aa_handleHttpError(e,options,context)
{
	try
	{
		var text = "HTTP error. url: " + options.url + " status: " + e.statusText;
	//	if (window.aad_showProgressIndicator)
	//		aad_showProgressIndicator(aa_ctx(ajaxart.newContext(), { ProgressIndicationText: [text] }),true);
		ajaxart.log(text,'error');
	} catch(e) {}
}

aa_extend(ajaxart,{
	load_usage_plugin: function(plugin_name,xtml_name)
	{
	  if ( xtml_name == null)
		  xtml_name = "plugins/"+plugin_name+"/"+plugin_name+"_usage.xtml";
		  
	  
	},
	load_plugin: function(plugin_name,xtml_name)
	{
		if (xtml_name == null)
			xtml_name = "plugins/" + plugin_name + "/" + plugin_name + ".xtml?cacheKiller="+new Date().getTime();
		ajaxart.loading_objects++;
		  $.ajax({
			   type: "GET",
			   url: xtml_name,
			   success: function (xtml_content) {
			   		xtml_content = xtml_content.replace(/\r([^\n])/g,'\r\n$1');	// adding \n when having only \r, otherwise newlines are not shown, most relevant for CDATA content
			  		var xtml = aa_parsexml(xtml_content, xtml_name);
			  		ajaxart.load_xtml_content(xtml_name,xtml);
			  		ajaxart.object_finished_loading();
		  		},
		  		error: function (e){ 
		  			aa_handleHttpError(e,this);
					ajaxart.log("failed loading plugin " + xtml_name + "," + e.message,"error"); 
					ajaxart.object_finished_loading();
				}
		  }); 
	},
	load_xtml: function(file_name)
	{
	  jQuery.ajax({ url: file_name, cache: false, async: false,
		   success: function (xtml_content) {
		  		var xtml = aa_parsexml(xtml_content, file_name);
		  		ajaxart.load_xtml_content(file_name,xtml);
	  		},
	  		error: function (e){ 
	  			aa_handleHttpError(e,this);
				ajaxart.log("failed loading xtml file " + file_name + "," + e.message,"error"); 
			}
	  }); 
	}
});

// loading RT
var ajaxart_altPressed = false;
function aa_register_document_events(context) {
	if (jBart.vars.document_events_registered) return;
	jBart.vars.document_events_registered = true;
  	jQuery(document).keydown(function(event) { 
  		if (event.keyCode == 18)
  			ajaxart_altPressed = true;		  		
	  	if (event.keyCode == 192 && event.ctrlKey && !event.shiftKey) { // ctrl+`  (~)
	  		ajaxart.inPreviewMode = false;
	  		if (ajaxart.gcs.debugui)
	  		  aa_run_component("debugui.ShowDebugUi",[],context);
	  	}
	  	if (event.keyCode == 192 && event.ctrlKey && event.shiftKey) { // ctrl+Shift+`  (~)
	  		aa_run_component("debugui.OpenComponent",[],context);
	  	}
	  	if (event.keyCode == 8) {
  	        var element = (typeof(event.target)== 'undefined')? event.srcElement : event.target;
	  		if (element.tagName.toLowerCase() != 'input' && element.tagName.toLowerCase() != 'textarea' && !$(event.target).hasClass('nicEdit-main')) {
	  		  ajaxart_stop_event_propogation(event);
	  		  return false;
	  		}
	  	}
	  	if (event.keyCode == 88 && ajaxart_altPressed && ajaxart.jbart_studio) { // alt+x
	  		var element = (typeof(event.target)== 'undefined')? event.srcElement : event.target;
	  		ajaxart.runComponent('xtml_dt.GlobalOpenAAEditor',[element]);
	  	}
  	});
  	jQuery(document).keyup(function(event) { ajaxart_altPressed = false; });
} 

aa_extend(ajaxart,{
	start: function(divId,data,script)
	{
		jQuery(document).ready(function() {
			ajaxart.ready(function() {
				if (ajaxart.urlparam('debugmode')=="true") ajaxart.debugmode = true;
				if (ajaxart.isChrome) jQuery("body").addClass('chrome');
				
			  	var scriptXml = aa_parsexml(script);
			  	if (data == null) data = [""];

			  	var context = ajaxart.newContext();
			  	var result = ajaxart.run(data,scriptXml,"",context);
			  	var div = jQuery(divId).addClass("ajaxart ajaxart_topmost " + ajaxart.deviceCssClass);
			  	ajaxart.databind([div[0]],data,context,scriptXml,data);
		  		if (div.length > 0 && ajaxart.ishtml(result)) {
			  		div[0].appendChild(result[0]);
			  		aa_element_attached(result[0]);
				  	aa_register_document_events(context);
			  	} else {
			  		ajaxart.log("scriptxml did not return html","warning");
			  	}
//			  	var debugui = ajaxart.run(data,aa_parsexml('<Control t="debugui.HiddenButton" />'),"",context);
			  	
			  	var loading = jQuery("#ajaxart_loading");
			  	if (loading.length > 0 && ! loading[0].IsUsed)
			  		loading.hide();
	    });
	  }); 
	},
	ready: function(func)
	{
		  ajaxart.ready_func = func;
		  if (ajaxart.loading_objects == 0 ) func();
	},
	object_finished_loading: function()
	{
		var loading_div = jQuery("#ajaxart_loading");
		if (loading_div.length > 0)
			loading_div.html(loading_div.html()+".");
		ajaxart.loading_objects--;
		if (ajaxart.loading_objects == 0 && ajaxart.ready_func != null) 
			  ajaxart.ready_func();
	}
});

// log & trace
function aa_try_probe_test_attribute(script,field,data,out,context,origData)
{
   for (i=0; i<ajaxart.xtmls_to_trace.length; i++)
	   if (ajaxart.xtmls_to_trace[i].xtml.nodeType == 2 && ajaxart.xtmls_to_trace[i].xtml.nodeName == field)
		   if (ajaxart.xml.parentNode(ajaxart.xtmls_to_trace[i].xtml) == script)
			   ajaxart.fill_trace_result(ajaxart.xtmls_to_trace[i].results,data,out,context,origData);
}

function aa_index_of_element(elem)
{
	for (var k=0,e=elem; e = e.previousSibling; ++k);
	return k;
}
function aa_xtml_path(elem)
{
	var path = [];
	while(elem && elem.nodeType != 9 && elem.tagName != 'Component')
	{
		if (elem.nodeType == 1) // Elem 
		{
			var id = elem.getAttribute('id') || elem.getAttribute('ns') || elem.getAttribute('Name') || elem.getAttribute('Of') || ('' + aa_index_of_element(elem));
			path.push(aa_tag(elem) + '[' + id + ']');
		}
		else if (elem.nodeType == 2) // Attribute
			path.push("@" + elem.name);
		elem = elem.parentNode;
	}
	if (elem && elem.nodeType == 1)
		path.push(elem.getAttribute('id') || elem.getAttribute('ns') + ':/');
	return path.reverse().join('/');
}

function aa_st() 
{
	var result = "";
	var last_component = "";
	for(var i=0;i<ajaxart.stack_trace.length;i++)
	{
		var comp_node = aa_xtml_path(ajaxart.stack_trace[i],"id",true).split("@id='");
		if (comp_node.length > 1) 
			comp = comp_node[1].split("'")[0];
		else
			comp = comp_node[0];
		if (last_component == comp) continue;
		result += comp + ",";
		last_component = comp;
	}
	return result;
}

aa_extend(ajaxart,{
	logException: function(e,prefix)
	{
		var msg = e.message || e;
		if (e.stack) {
			msg += '\n' + e.stack;
		}
		if (prefix) msg = prefix + ' - ' + msg;
		ajaxart.log(msg,'error');
	},
	log: function(message,type)
	{
		if (type == null) type = "";
		var log_message = type + " - " + message;
		ajaxart.log_str += log_message + "\n\r";
		if (window.jBart) jBart.logs_str = ajaxart.log_str || '';

		if (type == "") type = "general";
		if (ajaxart.logs[type] == null)
			ajaxart.logs[type] = [];
//		if (type=="error") debugger;
		ajaxart.logs[type].push(message);
		if (type == "error" && ajaxart.debugmode)
			debugger;
		
//		if (ajaxart.log_level == "error" && type == "warning") return;
		if (!window.jBartNodeJS) {
			var msg = typeof(aa_xmlescape) == 'function' ? aa_xmlescape(log_message) : log_message;
			$("#ajaxart_log").append($("<div class='aa_log " + type + "'>"+msg+"</div>"));
		}
		
		try {
		  jBart.trigger(jBart,'log',{ message: message, type: type});
		} catch(e) {}

		if (type=='error' && window.console) console.log('error - ' + log_message);
		if (type == 'error' && ajaxart.jbart_studio) {	// adding error sign
			setTimeout( function() {
				jQuery(".fld_toolbar_errors_sign").removeClass("hidden"),1
			});
		}
	},
	tryShortXmlWithTag: function(xml,attrName)
	{
		if (aa_hasAttribute(xml,attrName))
			return "<" + aa_tag(xml) + " " + attrName + '="' + xml.getAttribute(attrName) + '" .../>';  
	},
	fill_trace_result: function(results, input,output,params,origData)
	{
		var result = { isObject: true, Input: input, Output: output, context:params }
		if (origData != null)
			result.OrigData = origData;
		results.push(result);
	},
	text4trace: function(obj, depth, max_depth)
	{
		if (depth == null) depth=0;
//		if (!max_depth) debugger;
		if (depth >= max_depth) return "...";
		if (typeof(obj) == "undefined") return "";
		
		if (!aa_isArray(obj)) obj=[obj];
		if (typeof(obj) == undefined || obj==null) return "";
		var out = "";
		if (obj.length > 1) out = obj.length + " items : \r\n";
		ajaxart.each(obj, function(item) {
			if (item == null) { return; }
			if (typeof(item) == "function") return;
			if (ajaxart.isxml(item))
			{
			  var xml_val = "";
			  if ( depth+1 == max_depth && item.nodeType == 1)
			  {
				  xml_val = ajaxart.tryShortXmlWithTag(item,"name");
				  if (xml_val == null) xml_val = ajaxart.tryShortXmlWithTag(item,"id")
				  if (xml_val == null) xml_val = ajaxart.tryShortXmlWithTag(item,"Name")
				  if (xml_val == null) xml_val = "<" + aa_tag(item) + " .../>";
			  }
			  else if (item.nodeType == 2) // attribute
				  xml_val = "@" + item.nodeName + '="' + aa_xmlescape(ajaxart.xml2text(item)) + '"';
			  else
				  // xml_val = aa_xmlescape( ajaxart.xml2text(item) );
				  xml_val = ajaxart.xml2text(item);
				 
			  if (ajaxart.ishtml(item))
	  	    out += "html: " +  xml_val;
			  else
			  	out += "xml: " +  xml_val;
			}
			else if (ajaxart.isObject(item)) {
				if (depth+1 == max_depth) {
					out += "object (";
					for (i in item)
						if (item.hasOwnProperty(i) && i != "isObject")
							out += i + ", ";
					out = out.substring(0,out.length-2) + ")";
				}
				else {
					out = { isObject: true };
					for (i in item) {
						if (item.hasOwnProperty(i) && i != "isObject" && i != "XtmlSource") {
							var item_trace = ajaxart.text4trace(item[i],depth+1,max_depth);
							if (item_trace.length > max_depth && item_trace.substring(0,3)=="xml")
								item_trace = { isObject: true, xml:item_trace };
							out[i] = item_trace;
		//				  out += "" + i + ": " + ;
						}
					}
					return out;
				}
			}
			else if (typeof(item.script) != "undefined") {
				out += "script:" + ajaxart.text4trace(item.script,depth+1,max_depth);
			}
			else {
//					var text = aa_xmlescape( ajaxart.totext(item) );
//					out += "text:" + text.replace(new RegExp("\n", "g"), "<br/>");
				out += "text:" + ajaxart.totext(item);
			}
			out += "\r\n";
		});
		return out;
	},
	trace: function(script,input,output,context,trace_param,level) 
	{
		if (ajaxart.xtmls_to_trace.length > 0) return;	// not having trace inside aaeditor tester
		var level_int = 2;	// default
		if (level != null && !isNaN(parseInt(level)))
			level_int = parseInt(level);
		var trace_item = { isObject: true };
		message = "<b>id:</b> " + aa_xtml_path(script,"id",true);
		if (typeof(trace_param) != "undefined")
			message += "/" + trace_param;
//		message += "<br> <b>stack:</b> " + aa_st();
//		message += "<br> <b>input:</b> " + ajaxart.text4trace(input,-1,level_int) + "<br> <b>output:</b> " + ajaxart.text4trace(output,-1,level_int);
		trace_item.id = aa_xtml_path(script,"id",true);
		if (trace_param != null)
			trace_item.id += "/" + trace_param;
		trace_item.stack = aa_st();
		trace_item.input = ajaxart.text4trace(input,-1,level_int);
		trace_item.output = ajaxart.text4trace(output,-1,level_int);
		trace_item.params = [];
		trace_item.context = [];
		if (level_int > 0)
		{
			message += "<b>params:</b> <ul>";
			for (varname in context.params) {
				message += "<li>" + varname + ": " + ajaxart.text4trace(ajaxart.getVariable(context,varname),0,0) + "</li>";
				trace_item["params"].push({ isObject: true,	name:	varname, value: ajaxart.text4trace(ajaxart.getVariable(context,varname),0,level_int)});
			}
			message += "</ul>";
			message += "<br> <b>stack:</b> <ul>";
			for (varname in context.vars) {
				var txt = ajaxart.text4trace(ajaxart.getVariable(context,varname),0,level_int);
				message += "<li>" + varname + ": " + txt + "</li>";
//				if (varname == "_ServerAdapter") debugger;
				trace_item["context"].push({ isObject: true, name: varname, value: [txt] });
			}
			message += "</ul>";
			message += "<b>server data: </b>";
		}
		trace_item["context"] = trace_item["context"].reverse();
		
//		if (typeof(console) != "undefined") 
//		  console.log(message);
		
//		jQuery("#ajaxart_trace_control").append(message);
//		jQuery("#ajaxart_trace_control").append("<br><br>");
		ajaxart.traces.push(trace_item);
		
		if (!window.jBartNodeJS)
			$("#trace_bugs").html("There are traces which can cause performence problems");
	},
	write_profiling_at_end: function(start_time,component_id) {
		 var time_passes = new Date().getTime() - start_time;
		 if (ajaxart.profiling_of_globals[component_id] == null)
			 ajaxart.profiling_of_globals[component_id] = { calls:0, total:0 };
		 ajaxart.profiling_of_globals[component_id].calls++;
		 ajaxart.profiling_of_globals[component_id].total += time_passes;
	}
});

// general
function aa_get_func(code,notReturningValue) { // caching functions to save expensive calls to eval
	if (!ajaxart.functions_cache)
		ajaxart.functions_cache = {};
	if (code == "") return function(){}
	if (code.indexOf('function') != 0) {
		if (notReturningValue) code = 'function() { ' + code + '}';
		else code = 'function() { return ' + code + '}';
	}
	if (!ajaxart.functions_cache[code])
		try {
			ajaxart.functions_cache[code] = eval('f =' + code);
		} catch (e) { 
			ajaxart.log("RunJavaScript: " + e.message + '   code = ' + code, "error"); 
		}
	return ajaxart.functions_cache[code];
}
function aa_run_js_code(code,data,context,elem)
{
	var func = aa_get_func(code);
	if (!elem)
		if (context.vars._ElemsOfOperation && context.vars._ElemsOfOperation.length)
			elem = context.vars._ElemsOfOperation[0];
	elem = elem || aa_var_first(context,'ControlElement');
	
	var data_item = data;
	if (data.length == 1)
		data_item = data[0];
	try {
		if (func)
			return func(data_item,elem,context);
	} catch(e) {
		ajaxart.logException(e,'aa_run_js_code failed, code: ' + code); 
	}
	return null;
}

aa_extend(ajaxart,{
	xmlunescape: function(text) 
	{
		if (aa_isArray(text))
		{
			if (text.length > 0 ) return aa_xmlescape(text[0]);
			return "";
		}
		if (ajaxart.isObject(text))
			return "struct";
		return text.replace(/&amp;/g, "&").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, "\"").replace(/&apos;/g, "'").replace(/&#xa;/g, "\n");  
	},
	isattached: function(elem)
	{
		if (elem == null) return false;
		if (ajaxart.isIE) return jQuery(elem).parents("body").length > 0;
		return (elem.offsetParent || jQuery(elem).parents("body").length > 0);
	},
	getControlElement: function(params, single)
	{
	  var elem = ajaxart.getVariable(params,"ControlElement");
	  if (typeof(elem.controlElement) != "undefined")
		  elem = elem.controlElement;
	  
	  if (single != null && single == true) {
		  if (elem == null || elem.length == 0)
			  return null;
		  return elem[0];
	  }
	  if (elem == null) return [];
	  return elem; 
	},

	writevalue: function(data, newValueObj,disableXmlChangeEvent) {
	var assigned = false;
	if (data == null || data.length == 0 || data[0] == null) return assigned;
	var xml = data[0];
	if (xml.WriteValue) return xml.WriteValue(aa_isArray(newValueObj) ? newValueObj[0] : newValueObj); 
	
	if (ajaxart.isxml(newValueObj))
	{
		var newNode = newValueObj; 
		if (aa_isArray(newValueObj))
			newNode = newValueObj[0];

		if (newNode.nodeType == 1 && xml.nodeType == 1)
		{
		  if (newNode == xml) return;
		  if (aa_tag(newNode) == aa_tag(xml))
			  ajaxart.xml.copyElementContents(xml,newNode);
		  else
			  ajaxart.replaceXmlElement(xml,newNode);
		  assigned=true;
		}
	}
	if (!assigned)
	{
		var newValue = ajaxart.totext(newValueObj);
		if (ajaxart.isxml(xml)) {
			if (xml.nodeType == 2 && window.jBartNodeJS) {
				window.jBartNodeJS.setAttributeValue(xml,newValue);
			} else if (xml.nodeType == 2 || xml.nodeType == 3 || xml.nodeType == 4)  {// attribute or inner text
				if (newValue == xml.nodeValue) return true; // no need to do anything like auto save
				xml.nodeValue = newValue;
			}
			else {// inner xml for element
				var text_node = xml.firstChild;
		   		for (var child = xml.firstChild; child; child=child.nextSibling) // promote cdata
					if (child.nodeType == 4) // cdata
						text_node = child;
				if (text_node && text_node.nodeType == 3 ) // text node
					text_node.nodeValue = newValue;
				else if (text_node && text_node.nodeType == 4) // cdata
					text_node.nodeValue = newValue.replace(/\]\]>/g,']\\]>'); // BUG - escaping cdata end token - http://stackoverflow.com/questions/223652/is-there-a-way-to-escape-a-cdata-end-token-in-xml 
				else
					xml.appendChild(xml.ownerDocument.createTextNode(newValue));
			}
			assigned=true;
		} else if (typeof(xml) == "string")	{
			data[0] = ajaxart.totext(newValueObj);
			assigned=true;
		}
	}
	if (! disableXmlChangeEvent && ajaxart.isxml(xml))
		aa_triggerXmlChange(xml);
	return assigned;
},
body_contents_of_soap_envelope: function(envelope)
{
	for(var i=0;i<envelope.childNodes.length;i++)
	{
		var node = envelope.childNodes.item(i);
		if (node.nodeType == 1 && aa_tag(tagName).toLowerCase() == 'body') {
			for (var j=0;j<node.childNodes.length;j++)
			{
				var innernode = node.childNodes.item(i);
				if (innernode.nodeType == 1) return innernode; 
			}
		}
	}
	return envelope;
},
ajaxart_clean_ns: function(xmltext)
{
	xmltext = xmltext.replace(new RegExp('<[A-Za-z0-9_]*:', 'g'), '<');
	xmltext = xmltext.replace(new RegExp('</[A-Za-z0-9_]*:', 'g'), '</');
	xmltext = xmltext.replace(new RegExp('xmlns[a-zA-Z0-9_:"\'=/.-]*', 'g'), '');
	xmltext = xmltext.replace(new RegExp('[A-Za-z0-9_]*:([A-Za-z0-9_]*)="', 'g'), '$1="');

	return xmltext;
}

});
// studio 
aa_extend(ajaxart,{
	xtmls: aa_parsexml('<Plugins/>')
});
// deprecated
aa_extend(ajaxart,{
	make_array: function(input_array,func,workWithEmptyInput)
	{
		var result = [];
		ajaxart.each(input_array,function(item) {
			var myitem = func([item]);
			if (aa_isArray(myitem))
				ajaxart.concat(result,myitem);
			else if (myitem != null)
		      result.push(myitem);
		});
		if (input_array.length == 0 && (typeof workWithEmptyInput == "undefined" || workWithEmptyInput == true))
		{
			var myitem = func([]);
			if (myitem != null)
				result.push(myitem);
		}
		return result;
	},
	jrootElem: function(elemList)
	{
		var list = elemList.parents();
		if (list.length > 0 ) {
			var rootItem = list[list.length-1];
			return jQuery(rootItem);
		}
		return jQuery([]);
	},
	calcParamsForRunOn: function(params,runOn,startFrom)
	{
		var result = jQuery([]);
		if (ajaxart.ishtml(runOn))
			result = jQuery(runOn);
		else
		{
			runOn = ajaxart.totext(runOn);
//			runOn = runOn.replace(/ /g, "_");
			if (runOn == "") { 
				ajaxart.setVariable(params,"ControlElement",[]);
				return params;
			}
			var old_elem = [];
			if ( typeof(startFrom) != "undefined" ) 
			  old_elem = startFrom;
	    	else 
			  old_elem = ajaxart.getControlElement(params);
	    	
			if (old_elem.length > 0)
			  var baseElem = jQuery(old_elem);
			else
			  var baseElem = jQuery("body");
			
			if (runOn.indexOf('(') == -1) {
			  var jexp = "#"+runOn;
			  if (runOn.charAt(0) == ".") jexp = runOn;
			  try {
			  	var result = baseElem.find(jexp);
			  } catch(e) {
			  	ajaxart.log('RunOn bad expression ' + jexp);
			  	ajaxart.logException('RunOn bad expression',e);
			  	var result = jQuery([]);
			  }
			} else {
				var result = jQuery([]);
			}
			if (runOn.substr(0,3) == "up(") {
				jexp = runOn.substring(3,runOn.length-1);
				if (baseElem.filter(jexp).length != 0) // try ourselves first
					result = baseElem;
				else
					result = baseElem.parents(jexp).slice(0,1);
			}
			if (runOn.substr(0,2) == "$.") {
				var str = "result = baseElem" + runOn.substr(1);
				try { eval(str); } catch(e) {}
			}
			if (runOn.substr(0,7) == "updown(") {
				items = runOn.substring(7,runOn.length-1).split(",");
				if (items.length == 2) {
					var parent = baseElem.filter(items[0]); // try ourselves first
					if (parent.length == 0) 
						parent = baseElem.parents(items[0]);
					result = parent.find(items[1]);
				}
			}
			if (runOn.substr(0,5) == "down(") {
				jexp = runOn.substring(5,runOn.length-1);
				result = baseElem.find(jexp);
			}
			if (result.length == 0 && old_elem.length > 0)
			{
				baseElem.each(function() {
					if (this.getAttribute("id") == runOn)
						result = $([this]);
				});
			}
			try {
			  if (result.length == 0 && jexp) result = ajaxart.jrootElem(baseElem).find(jexp);
			  if (result.length == 0 && jexp) result = jQuery('body').find(jexp);
			} catch(e) {}
			if (result.length == 0)
				ajaxart.log("cannot locate " + jexp,"location");
		}

		var out = [];
		for(var i=0;i<result.length;i++) out.push(result[i]);

		params = ajaxart.clone_context(params);
		ajaxart.setVariable(params,"ControlElement",out);
			
		return params;
	},
	databind: function(bindto,data,params,script,origData)
	{
		ajaxart.each(bindto,function(item) {
			if ( ! ajaxart.ishtml(item) ) return;
			var context = {};
		  	context.data = data;
		  	context.params = params;
		  	context.script = script;
		  	context.origData = origData;
		  	/*
		  	if (ajaxart.isChrome) {	// Fix grabage collection of chrome - that cleans the databinding
		  		if (typeof(ajaxart.databoundeditems) == "undefined")
		  			ajaxart.databoundeditems = [];
		  		ajaxart.databoundeditems.push(item);
		  	}
	*/
		  	if (typeof(item["ajaxart"]) == "undefined")
		  		item["ajaxart"] = context;
		  	else
		  	{
		  		if (script != null)
		  		  item["ajaxart"].script = script;
		  		if (origData != null)
		  		  item["ajaxart"].origData = origData;
		  	}
		});
	}
});

// tests
aa_testFinished = {};
aa_tests_timeout = 0;

aa_extend(ajaxart,{
	stoptests: false,
	testResults: { summaryId : '' , failuresId: '' , successCounter: 0 , failureCounter: 0},
	debugData: [],
	runtests: function(summaryId,failuresId,onlyForPlugin)
	{
		ajaxart.testsStartTime = new Date().getTime();
		ajaxart.testResults.summaryId = summaryId;
		ajaxart.testResults.failuresId = failuresId;
		var runmore = ajaxart.urlparam('more') == "true";
		var allUsages = [];
		// run gallery items
		if (window._GalleryItems) {
		  var gitems = aa_xpath(_GalleryItems,'*');
		  for(var i=0;i<gitems.length;i++) 
			  ajaxart.concat(allUsages,bart_galleryitem_tousages(gitems[i]));
		}
		for (plugin in ajaxart.usages)
		{
			if (onlyForPlugin != null && onlyForPlugin != plugin) continue;
			for (usage in ajaxart.usages[plugin]) {
				var isTest = ajaxart.usages[plugin][usage].getAttribute("IsTest") != "false";
				if (runmore) isTest = ajaxart.usages[plugin][usage].getAttribute("IsTest") == "more";
				if (isTest)
					allUsages.push(ajaxart.usages[plugin][usage]);
			}
		}
		jQuery('#tests_count').text('Running ' + allUsages.length + ' tests');
	    ajaxart.runTestLoop(allUsages,0);
	},
	getTestName: function(prof)
	{
		var testName = '';
		if (aa_hasAttribute(prof,"Of") ) testName = prof.getAttribute("Of");
		if (aa_hasAttribute(prof,"Name") ) {
			if (testName.length > 0 ) testName += ' - ';
			testName += prof.getAttribute("Name");
		}
		return testName;
	},
	handleUsageResult: function(result,usagesArray,index,prof) 
	{
	  var testName = "";
	  if(index+1<usagesArray.length)
	  {
		var prof = usagesArray[index+1];
		if (aa_hasAttribute(prof,"Of") ) testName = prof.getAttribute("Of");
		if (aa_hasAttribute(prof,"Name") ) {
			if (testName.length > 0 ) testName += ' - ';
			testName += prof.getAttribute("Name");
		}
	  }
	  var text = "<div style='color:green;font-weight:bold'>so far " + ajaxart.testResults.successCounter + " tests succeeded. working on " + testName + "</div>";
	  document.getElementById('ajaxart_summary').innerHTML = text;
		
	  var prof = usagesArray[index];

	  if (result.length == 0) {
	    ajaxart.testResults.successCounter++;
	    if ( prof.getAttribute('AssignedTo') ) {
	    	var testName = "";
	    	if (aa_hasAttribute(prof,"Of") ) testName = prof.getAttribute("Of"); 
	    	jQuery("#"+ajaxart.testResults.failuresId).append("<div style='color:darkorange'>Test " + testName + " succeeds but assigned to " + prof.getAttribute('AssignedTo') + '</div>');
	    }
	  }
	  else  
	  {
		var testName = "";
		var href = "";
		var hrefBasic = "http://localhost/ajaxart/showsamples.html#?";
		if (aa_hasAttribute(prof,"Of") ) { testName = prof.getAttribute("Of"); href = hrefBasic + "Of=" + testName + ";"; }
		if (aa_hasAttribute(prof,"Name")) {
			if (testName.length > 0 ) testName += ' - ';
			testName += prof.getAttribute("Name");
			href = hrefBasic + "Name=" + prof.getAttribute("Name") + ";";
		}
		if (aa_hasAttribute(prof,'Of') && prof.getAttribute('Of').indexOf('gallery_') == 0) {
			var gitem = prof.getAttribute('Of').split('gallery_')[1].split('.')[0];
			var ct = jQuery(prof).parents('jbart_project').length>0 ? 'jbart_project' : 'bart_sample';
			href = 'http://localhost/ajaxart/gstudio.html?widget='+gitem+'#?gautotests=true';
		}
		ajaxart.testResults.failureCounter++;
		var assigned = "";
		if (aa_hasAttribute(prof,"AssignedTo") && prof.getAttribute('AssignedTo') != "")
			assigned = " (" + prof.getAttribute('AssignedTo') + ")";
		var failCssClass = (assigned != "") ? 'failing_test_assigned' : 'failing_test_unassigned';
	    jQuery("#"+ajaxart.testResults.failuresId).append("<a target='_blank' class='failing_test "+failCssClass+"' href='" + href + "'>Failed " + testName + assigned + "</a><br/>");
	  }
	  aa_closePopup();
	  
	  if (ajaxart.lastTestTime) {
		 var now = new Date().getTime();
		 var diff = now - ajaxart.lastTestTime;
		 var cls = (diff > 600) ? 'timing_red' : 'timing_ok'; 
		 jQuery('#tests_timing').append('<div>Running time of test ' + (index+1) + ' ('+ajaxart.getTestName(prof)+') is <span class="'+cls+'">' + diff + '<span></div>');
	  }

	  setTimeout( function() { ajaxart.runTestLoop(usagesArray,index+1) }, 1 );
	},
	runTestLoop: function(usagesArray,index,varsContext)
	{
		ajaxart.lastTestTime = new Date().getTime();
		
		if (usagesArray.length == 0) return;
		if (ajaxart.stoptests || index == usagesArray.length) // the end
		{
			var text="";
			if (ajaxart.stoptests)
				text ="<div>tests stopped</div>";
			else if (ajaxart.testResults.failureCounter == 0)
				text = "<div style='color:green;font-weight:bold'>all tests succeeded (" + ajaxart.testResults.successCounter + " tests)</div>";
			else
				text = "<div style='color:red;font-weight:bold'>" + ajaxart.testResults.failureCounter + " tests failed</div>";
			
			jQuery("#"+ajaxart.testResults.summaryId).html(text);	
			var elapsed = (new Date().getTime() - ajaxart.testsStartTime) / 1000;
			var now = '<div style="font-size:12px; margin-top:10px">Tests finished at ' + new Date().getHours() + ":" + new Date().getMinutes() + '</div>';
			jQuery("#ajaxart_tests_time").html("time (seconds): " + Math.round(elapsed) + now);
			return;
		}

		var prof = usagesArray[index];
//		if (prof.getAttribute('onlyme') != 'true') return ajaxart.runTestLoop(usagesArray,index+1,varsContext);
		var canRunNow = true;
		
		var params = ajaxart.newContext();
		if (typeof(varsContext) != "undefined") params = varsContext;
		var dataIsUsage = ( prof.getAttribute("t") == 'bart_usage.JBartUsage');
		
		if (canRunNow)
		{
			if (prof.getAttribute("t") == "ui_async.ControlUsage" ) {
				canRunNow = false;
				if (aa_tests_timeout != 0) clearTimeout(aa_tests_timeout);
				
				aa_tests_timeout = setTimeout(function() {	// fallback. if no answer in 4 seconds we go on 
					if (aa_testFinished[index]) return;
					aa_testFinished[index] = true;
					aa_tests_timeout = 0;
					ajaxart.handleUsageResult([],usagesArray,index,usagesArray[index]);
				},4000);
				
				ajaxart_RunAsync([prof],prof,params,function(result) {
					if (aa_testFinished[index]) return;
					aa_testFinished[index] = true;
					ajaxart.handleUsageResult(result,usagesArray,index,usagesArray[index]);
				});
			} 
			if (prof.getAttribute("t") == "async.JBartWidgetUsage") {
				canRunNow = false;

				var promiseHolder = {};
				var syncResult = ajaxart.run([prof],prof,'',aa_ctx(params,{_AsyncPromiseHolder: [promiseHolder]}));

				$.when(promiseHolder.promise).then(function(result) {
					result = result || syncResult;
					
					if (aa_testFinished[index]) return;
					aa_testFinished[index] = true;
					ajaxart.handleUsageResult(result,usagesArray,index,usagesArray[index]);					
				});

				if (!aa_testFinished[index]) { // fallback. if no answer in 4 seconds we go on 
					aa_tests_timeout = setTimeout(function() {	
						if (aa_testFinished[index]) return;
						aa_testFinished[index] = true;
						aa_tests_timeout = 0;
						ajaxart.handleUsageResult([],usagesArray,index,usagesArray[index]);
					},4000);
				}

			}
			if (prof.getAttribute("t") == "bart_usage.BartDataUsage") dataIsUsage = true;
		}

		if (!canRunNow) return;
	    var result = ajaxart.run(dataIsUsage ? [prof] : [],prof,'',params);
	    ajaxart.handleUsageResult(result,usagesArray,index,prof);
	}
});


// touch
ajaxart.isTouchDevice = function() { return ajaxart.isTouch; }
function aa_determine_device(userAgent) {
	var navigator = window.navigator || { userAgent : ""};
	userAgent = userAgent || navigator.userAgent.toLowerCase();
	ajaxart.isChrome = /chrome/.test(userAgent);
	ajaxart.isIE = /msie/.test(userAgent) || /trident/.test(userAgent);
	ajaxart.isIE7 = /msie 7/.test(userAgent);
	ajaxart.isIE8 = /msie 8/.test(userAgent);
	ajaxart.isIE78 = /msie 7/.test(userAgent) || /msie 8/.test(userAgent);
	ajaxart.isIE9 = /MSIE 9/.test(navigator.appVersion || '');
	ajaxart.isSafari = /safari/.test(userAgent);
	ajaxart.isFireFox = /firefox/.test(userAgent);
	ajaxart.isWebkit = /webkit/.test(userAgent);
	ajaxart.isOpera = /opera/.test(userAgent);
	ajaxart.isiPhone = /cpu iphone/.test(userAgent);
	ajaxart.isIDevice = (/iphone|ipad/gi).test(navigator.appVersion);
	ajaxart.isMobile = (/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));
	ajaxart.isAndroid = /android/.test(userAgent);
	ajaxart.deviceCssClass = "";
	if (ajaxart.isChrome) ajaxart.deviceCssClass += " chrome";
	if (ajaxart.isIE) ajaxart.deviceCssClass += " ie";
	if (ajaxart.isIE7) ajaxart.deviceCssClass += " ie7";
	if (ajaxart.isIE8) ajaxart.deviceCssClass += " ie8";
	if (ajaxart.isSafari) ajaxart.deviceCssClass += " safari";
	if (ajaxart.isFireFox) ajaxart.deviceCssClass += " firefox";
	if (ajaxart.isiPhone) ajaxart.deviceCssClass += " iphone";
	if (ajaxart.isIDevice) ajaxart.deviceCssClass += " idevice";
    try {
       document.createEvent("TouchEvent");
       ajaxart.isTouch = true;
       ajaxart.deviceCssClass += " aa_touch_device";
    } catch (e) {
    	ajaxart.isTouch = false;
    }
}


// gc utils
function aa_run_component(id,input,context,params)
{
		input = input || [];
		context = context || ajaxart.newContext();
	  var xtmlElem = ajaxart.componentsXtmlCache[id];

	  if (xtmlElem == null)
	  {
  	    try 
	    {
	  	  var middlePos = id.indexOf('.');
		  var ns = id.substring(0,middlePos);
		  var compName = id.substr(middlePos+1);
	
		  if (ajaxart.components[ns] == null) { ajaxart.log("cannot find component " + id,"error");return []; }
		  var global = ajaxart.components[ns][compName];
		  if (!global)
			  { ajaxart.log("cannot find component " + id,"error"); return []; }

		  if (global.getAttribute('execution') == 'native') {
			  xtmlElem = ajaxart.componentsXtmlCache[id] = { execution: 'native' }
			  xtmlElem.profile = aa_parsexml('<xtml t=""/>');
			  xtmlElem.gc = ajaxart.gcs[ns][compName]; 
		  }
		  else 
			  xtmlElem = ajaxart.componentsXtmlCache[id] = ajaxart.childElem(global,"xtml");
	    }
   	    catch(e) { return []; }
	  }
	  if (xtmlElem == null) return [];
	  var newContext = {};
	  newContext.vars = context.vars;
	  newContext.componentContext = context.componentContext;

	  if (xtmlElem.execution == 'native') {
	  	var profile = aa_parsexml('<xtml t=""/>');
	  	profile.setAttribute('t',id);
		  for (var j in params) {
		  	newContext.vars['_PARAM_' + j] = params[j];
		  	profile.setAttribute(j,"%$_PARAM_" + j + "%");
		  }
		  return xtmlElem.gc(profile,input,newContext);
	  }	
	  
	  newContext.params = [];
	  // look for default values to get params
	  var defaultProfs = aa_xpath(xtmlElem.parentNode,'Param/Default/..').concat(aa_xpath(xtmlElem.parentNode,'Param/@Default/..'));
	  for(var i=0;i<defaultProfs.length;i++) {
		  var val = ajaxart.run(input,defaultProfs[i],'Default',context);
		  var name = defaultProfs[i].getAttribute('name');
		  if (name != null && name != "")
			  newContext.params[name] = val;
	  }
	  for (var j in params) newContext.params[j] = params[j];
	  return ajaxart.run(input,xtmlElem,'',newContext);
}

ajaxart.runComponent = function(component,data,context) {
	context = context || ajaxart.newContext();
	data = data || [];
	var profile = aa_parsexml('<xtml t="' + component + '" />');
	return ajaxart.run(data,profile,'',context);
}
ajaxart.concat = function(source,toadd) {
	if (toadd == null) return;
	for(var i=0;i<toadd.length;i++)
		source.push(toadd[i]);
}
function ajaxart_addScriptMethod(structItem,structField,profile,field,context,paramVars) 
{
	var fieldscript = (field == "") ? profile : ajaxart.fieldscript(profile,field,true);
	
	structItem[structField] = { 
			script: fieldscript , context: context, objectForMethod: [structItem], 
			compiled: ajaxart.compile(fieldscript,'',context,paramVars) 
	};
}
function ajaxart_addScriptParam_js(structItem,structField,jsFunc,context)
{
	structItem[structField] = {	context: context , compiled: jsFunc };
}
function aa_addMethod_js(structItem,structField,jsFunc,context)
{
	structItem[structField] = {	context: context , compiled: jsFunc, objectForMethod: [structItem] };
}
function aa_ctx(context,vars)
{
  var out = ajaxart.clone_context(context);
  for (var i in vars) out.vars[i] = vars[i];
  return out;
}
function aa_merge_ctx(context,contextVars,moreVars)
{
  var result = { params: context.params , vars: contextVars.vars , componentContext: context.componentContext , _This: contextVars._This};
  if (moreVars)
	  result = aa_ctx(result,moreVars);
  return result;
}

function aa_toint(data)
{
	if (data.length == 0) return 0;
	var txt = aa_totext(data);
	if (txt == '') return 0;
	return parseInt(txt);
}
function ajaxart_toint_array(data)
{
	if (data.length == 0) return 0;
	if (data[0] == '') return 0;
	return parseInt(data[0]);
}
function ajaxart_run_commas(data,script,field,context)
{
  var text = aa_text(data,script,field,context);
  if (text == "") return [];
  return text.split(',');
}
function ajaxart_run_tocommas(data,script,field,context)
{
	var list = ajaxart.run(data,script,field,context);
	var out = ",";
	for(var i=0;i<list.length;i++) {
		out += aa_totext([list[i]]) + ',';
	}
	return out;
}
function ajaxart_arr_indexof(arr,item)
{
  for(var i=0;i<arr.length;i++)
	  if (arr[i] == item) return i;
  return -1;
}
function ajaxart_writabledata()
{
  return aa_xpath(aa_parsexml('<tmp val="" />'),'@val');	
}
function ajaxart_clone_array(array)
{
  var out = [];
  for(var i=0;i<array.length;i++)
	  out.push(array[i]);
  return out;
}

function aa_text2bool(text)
{
    if (text == "" || text == "false") return false;
    if (text == "true") return true;

    if (! isNaN(text)) return true; // a number is true (can allow Condition="%=Count...%")
    
    if (text.indexOf('==') > -1) {
    	var pos = text.indexOf('==');
    	var first = aa_trimQuote(text.substring(0,pos)), second = aa_trimQuote(text.substring(pos+2));
    	return (first == second);
    }
    if (text.indexOf('!=') > -1) {
    	var pos = text.indexOf('!=');
    	var first = aa_trimQuote(text.substring(0,pos)), second = aa_trimQuote(text.substring(pos+2));
    	return (first != second);
    }
    if (text.indexOf('=') > -1) {
    	var pos = text.indexOf('=');
    	var first = text.substring(0,pos), second = text.substring(pos+1);
    	return (first == second);
    }
	var boolean_result = false;
	var text_to_eval = "if (" + text + ") boolean_result=true;";
	try { eval(text_to_eval); }
	catch(e) { 
		ajaxart.log("Failed to evaluate boolean expression: " + text,"warning"); return false;
	}
    return boolean_result ? true : false;
}
function aa_string2id(txt)
{
	if (!ajaxart.hebchars) ajaxart.hebchars = ajaxart.types.text_HebrewText.getAttribute('HebChars'); // cannot put hebrew in the js 
	var heb = ajaxart.hebchars;
	var eng = 'abgdaozhtiklmnsapzkrstnfhz';
	
	var newid = "";
	for(var i=0;i<txt.length;i++) {
		var pos = heb.indexOf(txt.charAt(i));
		if (pos == -1) newid += txt.charAt(i);
		else newid += eng.charAt(pos);
	}
	txt = newid;
	
	txt = txt.replace(/[^0-9a-zA-Z]/g,'-').replace(/(^[0-9]+)/g,'-$1');
	return txt;
}
function aa_trimQuote(text)
{
  text = text.replace(/^\s*/, "").replace(/\s*$/, "");	// first trim spaces
  if (text.length > 0 && text.charAt(0) == "'" && text.charAt(text.length-1) == "'")
	  return text.substring(1,text.length-1);
  return text;
}

function aa_trim(text) {
  if(typeof String.prototype.trim !== 'function') {
  	String.prototype.trim = function() {
    	return this.replace(/^\s+|\s+$/g, ''); 
  	}
  }
  return text.trim();
}

function aa_run(data,profile,field,context) {
	return ajaxart.run(data,profile,field,context);
}
function aa_text_with_percent(data,script,field,params)
{
	var val = script.getAttribute(field);
	if (val) return val;
	return aa_text(data,script,field,params);
}
ajaxart.runScriptParam = function(data,scriptParam,context)
{
	if (scriptParam == null) return [];
	if (typeof(scriptParam) == "function") return scriptParam(data,context); 
	if (scriptParam.compiled == "same") return data;
	if (scriptParam.context == null) debugger;

	var newContext = { params: scriptParam.context.params 
			, vars: context.vars
			, componentContext: scriptParam.context.componentContext} // TODO: avoid this if paramVars == ""
	
    if (scriptParam.objectForMethod)
  	  newContext._This = scriptParam.objectForMethod[0];
	
	if (scriptParam.compiled != null) 
	  return scriptParam.compiled(data,newContext);
    else
      return ajaxart.run(data,scriptParam.script,"",newContext);
}

function aa_new_JsonByRef(parent,prop) {
	if (!window.aa_JsonByRef) aa_init_JsonByRef();
	return new aa_JsonByRef(parent,prop);
}
function aa_init_JsonByRef() {
	aa_JsonByRef = function(parent,prop) { this.parent = parent; this.prop = prop}
	aa_JsonByRef.prototype.GetValue = function() { return this.parent[this.prop] }
	aa_JsonByRef.prototype.WriteValue = function(val) { return this.parent[this.prop] = val }
	aa_JsonByRef.prototype.ParentNode = function() { return this.parent }
}

function aa_load_inplace_gc(comp,ns) {
	if (typeof(aa_xpath) == 'undefined') return;
	
  if (comp.getAttribute('execution') != 'native') return;    
  if (comp.nodeType != 1) return;
	var script = aa_cdata_value( aa_xpath(comp,'Code')[0] );
	if (!script) return;

	var func = null;
	try {
		  eval('func = ' + script);
	} catch(e) {
		ajaxart.logException(e,'could not compile js function for gc ' + comp.getAttribute('id') + ': ' + script);
	}
	if (func) {
		var gc = {};
		gc[comp.getAttribute('id')] = func;
		aa_gcs(ns, gc);
	}
}

function aa_split(text,separator,ignoreEmptyValues) {
	var arr = text.split(separator);
	var out = [];
	for(var i=0;i<arr.length;i++)
		if (arr[i] || !ignoreEmptyValues) out.push(arr[i]);
	return out;
}

function aa_var_first(context,varname) {
	var val = ajaxart.getVariable(context,varname);
	return val ? val[0] : null;
}

function aa_extendJQuery() {
	jQuery.fn.firstOfClass = function(className) {
		var classNameWithSpaces = ' ' + className + ' ';
		var out = this[0] && recursiveIteration(this[0]);
		return out ? jQuery(out) : jQuery([]);

		function recursiveIteration(elem) {
			if (elem.nodeType != 1) return null;
			var elemClasses = elem.className;
			if (elemClasses === className) return elem;
			if (elemClasses.indexOf(className) >-1 && (' '+elemClasses+' ').indexOf(classNameWithSpaces) > -1) return elem;

			for(var child=elem.firstChild;child;child=child.nextSibling) {
				var result = recursiveIteration(child);
				if (result) return result;
			}
			return null;
		}
	}
}
aa_extendJQuery();


function bart_galleryitem_tousages(gitem)
{
  var runmore = ajaxart.urlparam('more') == "true";
  
  var out = [];
  // old gallery tests
  var tests = aa_xpath(gitem,'AutoTests/Test');
  for (var i=0;i<tests.length;i++)
  {
	//  continue;
	  var isTest = tests[i].getAttribute('run_in_all_tests') == 'true';
	  if (runmore) isTest = tests[i].getAttribute('run_in_more_tests') == 'true';
	  if (!isTest) continue;
	  
	  var t="ui.ControlUsage";
	  if (tests[i].getAttribute('isasync')=="true") t="ui_async.ControlUsage";
	  
	  var usage = '<Usage t="'+t+'" Of="gallery_' + gitem.getAttribute('id') + '.' + tests[i].getAttribute('name') + '">';
	  usage += '<Control t="bart_usage.GalleryItemToUsageControl"><GalleryItem t="xml.Xml">' + ajaxart.xml2text(gitem) + '</GalleryItem>';
	  usage += '<Test t="xml.Xml">' + ajaxart.xml2text(tests[i]) + "</Test>";
	  usage += '</Control>';
	  
	  var params = aa_xpath(tests[i],'*');
	  for(var j=0;j<params.length;j++)
		  usage += ajaxart.xml2text(params[j]);
	  
	  usage += "</Usage>";
	  out.push(aa_parsexml(usage));
  }
  // new gallery tests
  tests = aa_xpath(gitem,'Tests/Test');
  for (var i=0;i<tests.length;i++)
  {
	  var test = tests[i];
	  var isTest = test.getAttribute('RunInAllTests') == 'true';
	  if (runmore) isTest = test.getAttribute('RunInAllTests') == 'true';
	  if (!isTest) continue;
	  test.setAttribute('Of','gallery_' + gitem.getAttribute('id') + '.' + test.getAttribute('Name'));
	  if (test.getAttribute('t') == 'bart_usage.JBartUsage' || test.getAttribute('t') == 'bart_usage.JBartStudioUsage')
		  var child = aa_parsexml('<Var name="_WidgetXml" value="%../..%" />','','',false,test);
	  else if (test.getAttribute('DoesNotChangeWidgetData') == 'true')
		  var child = aa_parsexml('<Var name="_TestDB" value="%../../bart_dev/db%" />','','',false,test);
	  else if (test.getAttribute('t') == 'async.JBartWidgetUsage')
		  var child = aa_parsexml('<Var name="_WidgetXml" t="data.Duplicate" Data="%../..%" />','','',false,test);
		else
		  var child = aa_parsexml('<Var name="_TestDB" t="data.Duplicate" Data="%../../bart_dev/db%" />','','',false,test);
	  
	  test.appendChild(child);
	  out.push(test);
  }
  return out;
}

function aa_guid() {
	return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    	var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
    	return v.toString(16);
	});
}

function aa_isArray(obj) {
	return Object.prototype.toString.call(obj) === '[object Array]';
}

function aa_xmlescape(text) {
	if (typeof text === 'string')
		return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&apos;").replace(/[\x00-\x1F]/g, function(x) { return '&#x' + x.charCodeAt(0).toString(16) + ';' } );
	if (aa_isArray(text) && text.length > 0) return aa_xmlescape(text[0]);
	return '';
}

function aa_parsexml(contents, filename, errorMsgOut, onlyWarning,baseXml) {
{
	if ( contents && contents.nodeType ) {
		if (contents.nodeType == 9) // document
			return contents.firstChild;
		return contents;
	}
	filename = filename || '';
  if ( typeof contents != "string" ) return contents;
  var parsing_error_level = onlyWarning ? 'warning' : 'error';
	if (!contents) return null;
 	var doc;
 	try {
 	// fix parsing bug that &#xd;-->\r and not \n
 		contents = contents.replace(/&#xa;&#xd;/g, "&#xa;").replace(/&#xd;&#xa;/g, "&#xa;").replace(/&#10;&#13;/g, "&#xa;").replace(/&#13;&#10;/g, "&#xa;");
		if (contents.indexOf('<') > 0)
			contents = contents.substring(contents.indexOf('<'));
		// contents = contents.replace(/&amp;/g, "&#26;");  // fix unescape bug 

		if (window.jBartNodeJS) return jBartNodeJS.parsexml(contents,baseXml);

		var isIE =  /msie/i.test(navigator.userAgent) || /trident/i.test(navigator.userAgent);
		if (window.ActiveXObject && isIE)
		{
			doc = new ActiveXObject("MSXML2.DOMDocument");
			var loaded = doc.loadXML(contents);
			if (!loaded) {
				var message = doc.parseError.reason + doc.parseError.srcText;
				if (errorMsgOut)
					errorMsgOut.push(message);
				log('Error parsing xml file ' + filename + ' : ' + message + ",xml:"+aa_xmlescape(contents.substring(0)+"..."),parsing_error_level);
	    	return null;
		  }	
		} 
		else if (document.implementation && document.implementation.createDocument)
		{
			    var domParser = new DOMParser();
			    doc = domParser.parseFromString(contents,"text/xml");
			    var errorMsg = null;
			    
			    var parseerrors = doc.getElementsByTagName("parsererror");//chrome & safari
			    if (parseerrors.length > 0) {
			    	errorMsg = "Error parsing xml";	//for empty error;
                	try {
                		errorMsg = parseerrors[0].childNodes.item(1).innerHTML;
                	} catch(e) { errorMsg = "Error parsing xml"; }
                }
			    if (doc.documentElement.nodeName == 'parsererror' ) {	// firefox
			    	errorMsg = doc.documentElement.childNodes.item(0).nodeValue;
			    	if (errorMsg.indexOf("Location") > 0)
			    		errorMsg = errorMsg.substring(0,errorMsg.indexOf("Location")) + errorMsg.substring(errorMsg.lastIndexOf("\n"));
			    }
                if (errorMsg != null) {
					log('Error parsing xml file ' + filename + ' : ' + errorMsg + ",xml:"+aa_xmlescape(contents.substring(0)+"..."),parsing_error_level);
					if (errorMsgOut != null)
						errorMsgOut.push(errorMsg);
			    	return null;
			    }
		}
	}
    catch(e) {
       	log('Error parsing xml file: ' + e + aa_xmlescape(contents.substring(0,50)+"..."),parsing_error_level);
       	return null;
    }
    var out = doc.firstChild;
    while(out.nodeType != 1 && out.nextSibling) out = out.nextSibling;

    out = aa_importNode(out, baseXml);
    
    return out;

    function log(msg) {
    	if (ajaxart.log) 
    		ajaxart.log(msg);
    }
}
}


function aa_importNode(node, target)
{
	if (target == null) return node;
	if (target.ownerDocument != node.ownerDocument && target.ownerDocument.importNode != undefined) {
	  try {
	  	return target.ownerDocument.importNode(node,true);
	  } catch(e) {
	  	return node;
	  }
	}
	return node;
}

function aa_hasParam(xtml,param) {
	return (aa_hasAttribute(xtml,param) || aa_xpath(xtml,param)[0] != null);
}

function aa_map(array,func) {
  if (!array) return [];
  var res = [];
  for(var i in array) {
    var item = func(array[i],i);
    if (aa_isArray(item))
      res = res.concat(item); // to check is faster than: for(var i=0;i<item.length;i++) res.push(item[i]);
    else if (item != null)
      res.push(item);
  }
  return res;
}

function aa_each(arr,func)
{
	for(var i=0;i<arr.length;i++)
		func(arr[i],i);
}



aa_gcs("chart2", {
	Chart: function (profile,data,context)
	{
		var field = { };
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.Title = aa_multilang_text(data,profile,'Title',context);
		var ctx = aa_ctx(context,{_Field: [field]} );
		field.Fields = ajaxart.runsubprofiles(data,profile,'Field',ctx);
		
		field.Control = function(fieldData,ctx) {
			var items = ajaxart.run(data,profile,'ChartItems',aa_merge_ctx(context,ctx));
			var chartObject = aa_createChartObject(items,field.Fields,context);
			chartObject.Title = aa_multilang_text(data,profile,'ChartTitle',context);
			aa_bind(chartObject,'drilldownClick',function(selected) {
				aa_run(selected,profile,'OnDrilldownClick',context);
			});
			field.Chart = aa_first(data,profile,'Chart',ctx);
			if (field.Chart && field.Chart.IsTriplet) {
				chartObject.jElem = jQuery(field.Chart.Html);
				chartObject.control = chartObject.jElem[0];
				
				chartObject.jElem.addClass(aa_attach_global_css(field.Chart.Css,null,'chart'));
				aa_apply_style_js(chartObject,field.Chart,ctx);
			}
			jBart.trigger(field,'initChartObject',chartObject);  // allow non triplets to make effect
			return [chartObject.control];
		};
		
		ajaxart.runsubprofiles(data,profile,'FieldAspect',ctx);
		return [field];
	}
});

function aa_createChartObject(items,fields,context)
{
	var chartObject = {
		Items: items,
		Fields: fields,
		Context: context,
		control: jQuery('<div/>')[0],
		DataMatrix: function(includeHeaders) {
			var out = [];
			if (includeHeaders) {
				var headers = [];
				for(var j=0;j<this.Fields.length;j++) {
					var title = this.Fields[j].Title;
					headers.push(title);
				}
				out.push(headers);
			}
			for(var i=0;i<this.Items.length;i++) {
				var item = this.Items[i];
				var row = [];
				for(var j=0;j<this.Fields.length;j++) {
					var field = this.Fields[j];
					var fieldData = field.FieldData ? field.FieldData([item],context) : item;
					var textValue = aa_totext(fieldData);
					if (field.IsNumber || field.FieldType == 'number') {
						try {
						  textValue = parseFloat(textValue);
						} catch(e) { textValue = 0; }
					}
					row.push(textValue);
				}
				out.push(row);
			}
			return out;
		}
	};
	return chartObject;
}






aa_gcs("control", {
	Button: function(profile, data, context) {
		aa_init_class('Button',{
			action: function(e,extra_vars) {
				if (window.aa_incapture || this.disabled) return;

				var ctx = aa_ctx(this.context, {
					ControlElement: [this.el],
					_DomEvent: [e]
				});
				if (extra_vars)
					ctx = aa_ctx(ctx,extra_vars);
				var out = ajaxart.run(this.data, this.profile, 'Action', ctx);
				if (e && e.stopPropagation) e.stopPropagation();
				if (e) e.cancelBubble = true;
				return out;
			},
			onActionEnd: function(callback) {
				this._isAsync = true;
				jBart.bind(this, 'actionEnd', callback);
			}
		});	

		var field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			Image: aa_first(data, profile, 'Image', context),
			Style: aa_first(data, profile, 'Style', context)
		};
		field.ID = [field.Id];

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);
			var text = aa_multilang_text(field_data, profile, 'ButtonText', ctx2) || field.Title;
			if (field.Image && field.Image.Url) field.Image.StaticUrl = aa_totext(field.Image.Url(field_data, ctx2));

			var image = aa_create_static_image_object(field.Image);
			var disabled = aa_bool(field_data, profile, 'Disabled', ctx2);

			var buttonApiObject = new ajaxart.classes.Button({
				text: text,
				tooltip: aa_multilang_text(field_data, profile, 'Tooltip', ctx2),
				image: image,
				disabled: disabled,
				data: field_data,
				profile: profile,
				field: field,
				field_data: field_data,
				context: ctx2
			});

			var out = aa_renderStyleObject(field.Style, buttonApiObject, ctx2, true);
			if (disabled) jQuery(out).addClass('disabled');
			return [out];
		};
		ajaxart.runsubprofiles(data, profile, 'FieldAspect', aa_ctx(context, {
			_Field: [field]
		}));
		return [field];
	}
});

function aa_button(button,settings) {
	settings = aa_defaults(settings,{
		buttonElement: button.el,
    textElement: button.$el.firstOfClass('hypelink_text')[0] || button.el,
    imageElement: button.$el.firstOfClass('hypelink_img')[0],
    keepImageElement: false
	});

	aa_bind(button,'waiting',function() {
		if (button.field.TextForWaiting) $(settings.textElement).html(button.field.TextForWaiting);
		if (settings.onStartWaiting) settings.onStartWaiting();
	});

	aa_bind(button,'endWaiting',function() {
		if (button.field.TextForWaiting) $(settings.textElement).html(button.text);
		if (settings.onEndWaiting) settings.onEndWaiting();
	});

	var jButton = $(settings.buttonElement);
	button.el.jbButtonElement = settings.buttonElement;

	if (settings.allowHtmlInButtonText)
		$(settings.textElement).html(button.text);
	else 
  	$(settings.textElement).text(button.text);
  
  jButton.attr('title',button.tooltip);
  
  if ($(settings.imageElement)[0])
		aa_setImage($(settings.imageElement),button.image,{ removeIfNoImage: !settings.keepImageElement });

  if (jButton.disabled) jButton.addClass('disabled');

  jButton.click(function(e) { 
  	aa_buttonRunAction(button,e);
  });	

}

function aa_buttonRunAction(button,e) {
  	if (button.disabled) return;
  	var jButton = button.$el;
  	
  	aa_trigger(button,'beforeAction');
  	var result = button.action(e); 

  	if (result && result[0] && result[0].state && result[0].state() == 'pending' ) {
			jButton.addClass('disabled waiting');
			aa_trigger(button,'waiting',{});
			$.when(result[0]).then(function() {
				jButton.removeClass('disabled waiting');
				aa_trigger(button,'endWaiting',{});
				aa_trigger(button,'afterAction');
			},function() {
				jButton.removeClass('disabled waiting');
				aa_trigger(button,'endWaiting',{});
				aa_trigger(button,'afterAction');
			});
		} else {
				aa_trigger(button,'afterAction');			
		}
}





aa_gcs("control", {
	ShowFieldControl: function(profile, data, context) {
		var item = ajaxart.run(data,profile,'Item',context);
		var field = aa_first(data,profile,'Field',context);
		if (!field) return;
		
		var wrapper = document.createElement('div');
		aa_fieldControl({ Field: field, Item: item, Wrapper: wrapper, Context: context });
		return [wrapper];
	},
	Label: function(profile, data, context) // gc of control.Label
	{
		var field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			Style: aa_first(data, profile, 'Style', context),
			TitleAsText: !profile.getAttribute('Text') && !aa_xpath(profile, 'Text')[0]
		};
		field.ID = [field.Id];

		var ctx2 = aa_ctx(context, { _Field: [field] });

		field.Label = function(field_data,ctx) {
			var text = field.TitleAsText ? field.Title : aa_multilang_text(field_data, profile, 'Text', aa_merge_ctx(ctx2, ctx));
//			text = text.replace(/\n/g, "<br/>");
			return [text];
		};
		field.Control = function(field_data, ctx) {
			var text = this.Label(field_data,ctx)[0];

			return [aa_renderStyleObject(field.Style, {
				text: text,
				data: field_data[0]
			}, ctx)];
		};
		ajaxart.runsubprofiles(data, profile, 'FieldAspect', ctx2);
		return [field];
	},
	Layout: function(profile, data, context) {
		aa_init_class('Layout',{
			getControlsCount: function(controlTemplate) {
				return this.fields.length;
			},
			getControl: function(index,wrapper) {
				aa_fieldControl({
					Field: this.fields[index],
					Wrapper: wrapper,
					Item: this.field_data,
					Context: this.context
				});		
			}
		});

		var layout_field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			Style: aa_first(data, profile, 'Layout', context),
			SectionStyle: aa_first(data, profile, 'SectionStyle', context)
		};

		layout_field.Control = function(field_data, ctx) {
			var baseCtx = aa_ctx(ctx, {});
			var ctx2 = aa_merge_ctx(context, baseCtx);
			var fields = ajaxart.runsubprofiles(field_data, profile, 'Field', ctx2);
			var newFields = [];
			for (var i = 0; i < fields.length; i++) { // we do not need the constant hidden fields
				if (!fields[i].RenderHiddenCell) {
					if (fields[i].CalculatedOnly) fields[i].Calculate(field_data, ctx2);
					if (fields[i].IsHidden) continue;
					if (fields[i].IsCellHidden && fields[i].IsCellHidden(field_data, ctx2)) continue;
				}

				newFields.push(fields[i]);
			}
			fields = newFields;
			aa_trigger(layout_field, 'innerFields', {
				Context: ctx2,
				FieldData: field_data,
				Fields: fields
			});

			var layout = new ajaxart.classes.Layout({
				fields: fields,context: ctx2,field_data: field_data, field: layout_field
			});
			var out = aa_renderStyleObject(layout_field.Style,layout,ctx2,true);
			if (layout_field.SectionStyle) {
				return [aa_wrapWithSection(out, layout_field, layout_field.SectionStyle, field_data, ctx2)];
			}
			return [out];
		};

		ajaxart.runsubprofiles(data, profile, 'FieldAspect', aa_ctx(context, {
			_Field: [layout_field]
		}));
		return [layout_field];
	},
	IFrame: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);
		var style = aa_first(data, profile, 'Style', context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			var iframe = { url: aa_text(field_data,profile,'Url',context) };
			return [aa_renderStyleObject2(style,iframe,field_data,field,ctx2,{})];
		};
		return [field];
	},	
	Hyperlink: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);
		var style = aa_first(data, profile, 'Style', context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			var link = { 
				title: aa_fieldTitle(field,field_data,ctx2),
				link: aa_text(field_data,profile,'Link',context),  
				tooltip: aa_text(field_data,profile,'Tooltip',context),
				target: aa_text(field_data,profile,'Target',context)
			};
			return [aa_renderStyleObject2(style,link,field_data,field,ctx2,{})];
		};
		return [field];
	},
	CustomControl: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);

		field.Control = function(field_data, ctx) {
			var style = aa_first(field_data, profile, 'Control', context);;
			return [aa_renderStyleObject(style, {
				Field: field,
				Data: field_data,
				Context: context,
				context: context
			}, context)];
		};
		return [field];
	},
	AudioPlayer: function(profile, data, context)
	{
		var field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			Style: aa_first(data, profile, 'Style', context)
		};
		field.ID = [field.Id];

		var ctx2 = aa_ctx(context, { _Field: [field] });

		field.Control = function(field_data, ctx) {
			var audioUrl = aa_text(field_data,profile,'AudioUrl',context);

			return [aa_renderStyleObject(field.Style, {
				audioUrl: audioUrl,
				data: field_data[0]
			}, ctx)];
		};
		ajaxart.runsubprofiles(data, profile, 'FieldAspect', ctx2);
		return [field];
	}
});

function aa_horizontalVerticalLayout(layout,settings) {
	settings = aa_defaults(settings,{
		isVertical: layout.params.IsVertical == 'true',
		horizSpacing: layout.params.HorizSpacing
	});

  if (settings.isVertical) {
  	layout.$el.addClass('aa_vertical');
  	aa_layout(layout);
  } else
   aa_horizontalBoxLayout(layout,{ spacing: settings.horizSpacing });	
}
function aa_horizontalBoxLayout(layout,settings) {
	settings = aa_defaults(settings,{
		spacing: '0',
		fullWidth: false
	});
	settings.spacing = settings.spacing.split('px')[0];
	var isIE_above10 = ajaxart.isIE && !ajaxart.isIE9 && !ajaxart.isIE78;
	var css3 = ajaxart.isWebkit || ajaxart.isFirefox || isIE_above10;

	if (css3) {
		var cssForTop = '',cssForField = '';

		if (ajaxart.isWebkit || ajaxart.isFirefox)
			cssForTop = '#this { display: -webkit-box; -webkit-box-orient: horizontal; } ';	// we replace webkit with moz in attach_global_css
		if (ajaxart.isIE)
			cssForTop = '#this { display: -ms-flexbox; -ms-box-orient: horizontal; } ';	

		if (settings.fullWidth) {
			cssForField = '#this { -webkit-box-flex: 1; -ms-flex:1; } ';
			cssForTop += '#this { width:100%;} ';
		}
		if (settings.spacing) {
			cssForField += "#this:not(:last-child) { margin-right: " + settings.spacing + "px; } ";
			cssForField += ".right2left #this:not(:last-child) { margin-left: " + settings.spacing + "px; margin-right:0; } ";
		}

		layout.$el.addClass(aa_attach_global_css(cssForTop));
		var cssClassForField = aa_attach_global_css(cssForField);
		layout.$el.firstOfClass('field')[0].jbRefresh = function() {
			$(this).addClass(cssClassForField);
		};
		layout.$el.firstOfClass('field')[0].jbRefresh();
	} else {
		// add table/tr/td
		var table = $('<table cellpadding="0" cellspacing="0" ><tr><td class="field" style="vertical-align:top" /></tr></table>');
		aa_empty(layout.el);
		layout.el.appendChild(table[0]);

		layout.$el.firstOfClass('field').addClass(aa_attach_global_css("#this:not(:last-child) { padding-right: " + settings.spacing + "px; } .right2left #this:not(:last-child) { padding-left: " + settings.spacing + "px; padding-right:0; } "));
		if (settings.fullWidth)
			table.addClass(aa_attach_global_css("#this { width:100%; }"));
	}

  aa_layout(layout,settings);	
}

function aa_layout(layout,settings) {
	settings = settings || {};
	settings.controlElement = settings.controlElement || layout.$el.find('.field');

	var controlEl = $(settings.controlElement)[0];

	if (layout.addFields && layout.Fields) {
     layout.addFields(controlEl,function(field) { 
        field.setControl(); // backward compatability
     });		
	} else {
		var count = layout.getControlsCount();
		for(var i=0;i<count;i++) {
			var j = settings.flipControlOrder ? count-1-i : i;
			var $wrapper = $(controlEl).clone();
			$wrapper[0].jbRefresh = $(controlEl)[0].jbRefresh;
			controlEl.parentNode.insertBefore($wrapper[0], controlEl);
			layout.getControl(j,$wrapper[0]);
		}
		$(controlEl).remove();
	}
}

function aa_create_base_field(data, profile, context) {
	var field = {
		Id: aa_text(data, profile, 'ID', context),
		Title: aa_multilang_text(data, profile, 'Title', context),
		Image: aa_first(data, profile, 'Image', context),
		Style: aa_first(data, profile, 'Style', context)
	};
	field.ID = [field.Id];
	ajaxart.runsubprofiles(data, profile, 'FieldAspect', aa_ctx(context, {
		_Field: [field]
	}));
	return field;
}

function aa_textLabel(labelObj) {
	var text = labelObj.text.replace(/\n/g, "<br/>");
	labelObj.$el.html(text);
}


aa_gcs("control", {
	ExpandableSection: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			field.Fields = ajaxart.runsubprofiles(data,profile,'Field',ctx2);
			var expandableSection = {
				title: aa_text(field_data,profile,'SectionTitle',context) || aa_fieldTitle(field ,field_data, context,true),
				renderContent: function(parentDiv) {
					var fields = ajaxart.runsubprofiles(field_data, profile, 'Field', ctx2);
					var newFields = [];
					for (var i = 0; i < fields.length; i++) { // we do not need the constant hidden fields
						if (!fields[i].RenderHiddenCell) {
							if (fields[i].CalculatedOnly) fields[i].Calculate(field_data, ctx2);
							if (fields[i].IsHidden) continue;
							if (fields[i].IsCellHidden && fields[i].IsCellHidden(field_data, ctx2)) continue;
						}

						newFields.push(fields[i]);
					}
					fields = newFields;
					aa_trigger(field, 'innerFields', { Context: ctx2, FieldData: field_data, Fields: fields });

					for(var i=0;i<fields.length;i++) {
						var wrapper = $('<div/>').appendTo(parentDiv)[0];
						aa_fieldControl({	Field: fields[i],	Wrapper: wrapper,	Item: field_data,	Context: this.context	});
					}
				}
			};

			return [aa_renderStyleObject2(field.Style,expandableSection,field_data,field,ctx)];
		};
		return [field];
	}
});

aa_gcs("fld_aspect", {
	ExpandableSectionProperties: function(profile, data, context) {
		var field = context.vars._Field[0];
		aa_bind(field,'initApiObject',function(args) {
			args.apiObject.RefreshOnExpand = aa_bool(data,profile,'RefreshOnExpand',context);
		});
	}
});

function aa_expandableSection(expandableSection,settings) {
	settings = aa_defaults(settings,{
		sectionTitleElement: expandableSection.$el.firstOfClass('section_title'),
		sectionTextElement: expandableSection.$el.firstOfClass('section_title_text'),
		sectionToggleElement: expandableSection.$el.firstOfClass('section_title_toggle'),
		sectionBodyElement: expandableSection.$el.firstOfClass('section_body')
	});
	var expandedClass = 'aa_section_exapnded';
	
	var titleElem = $(settings.sectionTitleElement)[0];
	if (expandableSection.renderSectionTitle) {
		aa_empty(titleElem);
		expandableSection.renderSectionTitle(titleElem);
	} else {
		$(settings.sectionTextElement).text( expandableSection.title );
	}

	$(titleElem).click(function() {
		expandableSection.$el.toggleClass(expandedClass);
		refresh();
	});

	if (expandableSection.expandedByDefault) {
		expandableSection.$el.addClass(expandedClass);
		refresh();
	}

	function refresh() {
		var bodyElem = $(settings.sectionBodyElement)[0];
		if (expandableSection.$el.hasClass(expandedClass)) {
			if (!bodyElem.jbRendered || expandableSection.RefreshOnExpand) {
				aa_empty(bodyElem);
				expandableSection.renderContent(bodyElem);
			}
			$(bodyElem).show();
		} else {
			$(bodyElem).hide();
		}
	}
}


aa_gcs("control", {
	ImageGallery: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);
		field.Control = function(field_data, ctx) {
			var images = ajaxart.run(field_data, profile, 'Images', context);
			var ctx2 = aa_merge_ctx(context, ctx);
			return [aa_renderStyleObject(field.Style, {
				images: images
			}, ctx2, true)];
		};
		return [field];
	}
});

aa_gcs("imagegallery", {
	ImageGallery: function(profile, data, context) {
		aa_init_class_image();

		var field = aa_create_base_field(data, profile, context);
		field.Style = aa_first(data,profile,'Style',context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);
			var images = ajaxart.run(field_data, profile, 'Images', ctx2);
			var imageObjects = [];
			for(var i=0;i<images.length;i++) {
				if (!images[i].image) continue;
				images[i].image.title = images[i].title;
				imageObjects.push(images[i].image);
			}

			var imageGallery = {
				images: imageObjects
			};
			return [aa_renderStyleObject2(field.Style,imageGallery,field_data,field,ctx2)];
		};
		return [field];
	}
});

aa_gcs("imagegallery_style", {
	SlideShow: function(profile, data, context) {
		var imageStyle = aa_first(data,profile,'ImageStyle',context);
		var buttonStyle = aa_first(data,profile,'Buttons',context);
		var transitionStyle = aa_first(data,profile,'Transition',context);
		var frameWidth = aa_int(data,profile,'FrameWidth',context);
		var frameHeight = aa_int(data,profile,'FrameHeight',context);
		var adjustSize = aa_first(data,profile,'AdjustImageSize',context);

		return [{
			render: function(imageGallery) {
				var out = $('<div />').width(frameWidth).height(frameHeight)[0];
				var field_data = imageGallery.field_data,field = imageGallery.field, context = imageGallery.context;

				var $poster = $('<div class="poster"/>').appendTo(out);

				for(var i=0;i<imageGallery.images.length;i++) {
					aa_extend(imageGallery.images[i],{
						width: frameWidth,
						height: frameHeight,
						adjustSize: adjustSize	
					});
				}

				if (imageGallery.images.length == 0) return out;

				var slideshow = {
					imageGallery: imageGallery,
					el: out,
					$el: $(out),
					$poster: $poster,
					frameWidth: frameWidth,
					frameHeight: frameHeight,
					index: 0,
					showNextImage: function(loop) {
						if (this.index == imageGallery.images.length-1) {
							if (loop) this.showImageByIndex(0);
							return;
						}
						this.showImageByIndex(this.index+1);
					},
					showPrevImage: function() {
						if (index == 0) return;
						this.showImageByIndex(this.index-1);
					},
					showImageByIndex: function(index,no_transition) {
						var prevIndex = this.index;
						this.index = index;

						if (no_transition || !transitionStyle) {
							showImage(imageGallery.images[index],$poster[0]);
							return;
						}
						var $incoming = $('<div/>').addClass('incoming');
						var $outgoing = $('<div/>').addClass('outgoing');
						
						showImage(imageGallery.images[index],$incoming[0]);
						showImage(imageGallery.images[prevIndex],$outgoing[0]);

						var transitionObject = {
							slideshow: this,
							$incoming: $incoming,
							$outgoing: $outgoing
						};
						aa_hide($poster[0]);
						aa_renderStyleObject2(transitionStyle,transitionObject,field_data,field,context,{ funcName: 'animate' });
					},
					endAnimation: function() {
						showImage(imageGallery.images[this.index],$poster[0]);
						this.$el.find('.incoming').remove();
						this.$el.find('.outgoing').remove();
						aa_show($poster[0]);
					}
				};
				aa_renderStyleObject2(buttonStyle,{ slideshow: slideshow },field_data,field,context,{ funcName: 'add' });
				slideshow.showImageByIndex(0,true);

				return out;

				function showImage(image,el) {
					aa_empty(el);
					el.appendChild( aa_renderStyleObject2(imageStyle,{image: image},field_data,field,context) );
				}
			}
		}];
	}
});

function aa_image_transition_slide(transition,settings) {
	var slideshow = transition.slideshow;
	var $incoming = transition.$incoming, $outgoing = transition.$outgoing;

	settings = aa_defaults(settings);
	$incoming.on('webkitTransitionEnd', onEnd);

	slideshow.$el.css('position','relative').css('overflow','hidden');

	$incoming.add($outgoing).css({
		position: 'absolute',
		top:0,
		left:0
	});
	$incoming.css('left',slideshow.frameWidth+'px');
	slideshow.$el.append($outgoing).append($incoming);
	$incoming.add($outgoing).css('-webkit-transition',settings.timing + ' ' + settings.duration);

	setTimeout(function() {
		$incoming.css('left','0');
		$outgoing.css('left','-'+slideshow.frameWidth+'px');
	},0);

	function onEnd() {
		slideshow.endAnimation();
	}
}

function aa_image_transition_fade(transition,settings) {
	var slideshow = transition.slideshow;
	var $incoming = transition.$incoming, $outgoing = transition.$outgoing;

	settings = aa_defaults(settings,{});
	$incoming.on('webkitTransitionEnd', onEnd);

	slideshow.$el.css('position','relative').css('overflow','hidden');

	$incoming.add($outgoing).css({
		position: 'absolute',
		top:0,
		left:0
	});
	$incoming.css('opacity','0');
	slideshow.$el.append($outgoing).append($incoming);
	$incoming.add($outgoing).css('-webkit-transition',settings.timing + ' ' + settings.duration);

	setTimeout(function() {
		$incoming.css('opacity','1');
		$outgoing.css('opacity','0');
	},0);

	function onEnd() {
		slideshow.endAnimation();
	}

}

function aa_image_transition_toss(transition,settings) {
	var slideshow = transition.slideshow;
	var $incoming = transition.$incoming, $outgoing = transition.$outgoing;

	settings = aa_defaults(settings,{});
	$incoming.on('webkitTransitionEnd', onEnd);

	slideshow.$el.css('position','relative');

	$incoming.add($outgoing).css({
		position: 'absolute',
		top:0,
		left:0
	});
	transform = 'rotate(-30deg) scale(1.3) translate(-20px,-250px)';

	$incoming.css('-webkit-transform',transform).css('opacity','0');
	slideshow.$el.append($outgoing).append($incoming);
	$incoming.add($outgoing).css('-webkit-transition',settings.timing + ' ' + settings.duration);

	setTimeout(function() {
		$incoming.css('-webkit-transform','rotate(0) scale(1) translate(0,0)').css('opacity',1);
		$outgoing.css('opacity','0');
	},0);

	function onEnd() {
		slideshow.endAnimation();
	}

}

function aa_slideshow_buttons(slideshowButtons) {
	var slideshow = slideshowButtons.slideshow;

	slideshow.$el.click(function() {
		slideshow.showNextImage(true);
	}).css('cursor','pointer');
}

// https://docs.google.com/a/artwaresoft.com/document/d/1o6Uv_k3rlnm-Wp_Z7-oRVaAbfAYHcbecHzr39_0gNbU/edit#heading=h.n6saixge6b2n


aa_gcs("control", {
	PropertySheet: function(profile, data, context) {
		aa_init_class_PropertySheet();

		var field = aa_create_base_field(data, profile, context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);

      var fields = ajaxart.runsubprofiles(field_data,profile,'Field',ctx2);

			aa_trigger(field,'innerFields',{ Fields: fields});

      var visibleFields = [];
      for(var i=0;i<fields.length;i++) {
				if (!fields[i].RenderHiddenCell) {
	        if (fields[i].IsFieldHidden && fields[i].IsFieldHidden(field_data,ctx) ) continue;
	        if (fields[i].IsCellHidden && fields[i].IsCellHidden(field_data,ctx) ) continue;
	        if (fields[i].IsHidden) continue; 
	      }
        visibleFields.push(fields[i]);
      }

			var propertySheetObject = new ajaxart.classes.PropertySheet({
				fields: visibleFields,
				profile: profile,
				field: field,
				field_data: field_data,
				context: ctx2
			});

			return [aa_renderStyleObject(field.Style, propertySheetObject, ctx2, true)];
		};
		return [field];
	}
});

function aa_propertySheet(propertySheet,settings) {
	// descriptionLocation can be: 'after content' or 'after field name' or ''
	settings = aa_defaults(settings, {
		propertyElement: propertySheet.$el.firstOfClass('aa_property'),
		propertySettings: function(propertyElement) {
			return {
				titleElement: $(propertyElement).firstOfClass('aa_property_title'),
				contentElement: $(propertyElement).firstOfClass('aa_property_content')
			};
		},
		descriptionLocation: 'after content',
		addColonToTitle: true
	});

	var count = propertySheet.getFieldCount();

	for(var i=0;i<count;i++) {
		var fieldTitle = propertySheet.getFieldTitle(i);
		if (fieldTitle && settings.addColonToTitle) fieldTitle += ':';

		var property = $(settings.propertyElement).clone().insertBefore(settings.propertyElement);
		var propertySettings = settings.propertySettings(property);
		if (propertySheet.isFieldHidingTitle(i)) {
			property.addClass('aa_hiding_title');
		} else {
			$(propertySettings.titleElement).html(fieldTitle);
		};		
		propertySheet.getField(i,$(propertySettings.contentElement)[0]);
		var description = propertySheet.getFieldDescription(i);
		if (description && settings.descriptionLocation == 'after content') 
			$('<div class="aa_property_description" />').html(description).appendTo($(propertySettings.contentElement));
		if (description && settings.descriptionLocation == 'after field name') {
			$('<div class="aa_property_description" />').appendTo($(propertySettings.titleElement));
			$(propertySettings.titleElement).attr('title',description);
		}

		if (propertySheet.isFieldMandatory(i))
			property.addClass('aa_mandatory');
	}
	$(settings.propertyElement).remove();
}

function aa_init_class_PropertySheet() {
	
	if (ajaxart.classes.PropertySheet) return;

	ajaxart.classes.PropertySheet = function(settings) {
		aa_extend(this, settings);
	};
	ajaxart.classes.PropertySheet.prototype.getFieldCount = function(controlTemplate) {
		return this.fields.length;
	};
	ajaxart.classes.PropertySheet.prototype.isFieldMandatory = function(index) {
		return this.fields[index].Mandatory;
	};
	ajaxart.classes.PropertySheet.prototype.isFieldHidingTitle = function(index) {
		return this.fields[index].HideTitle || this.fields[index].HidePropertyTitle;
	};
	ajaxart.classes.PropertySheet.prototype.getFieldTitle = function(index) {
		var field = this.fields[index];
		if (field.DynamicTitle) {
			return aa_fieldTitle(field,this.field_data,this.context);
		} 
		return field.Title;
	};
	ajaxart.classes.PropertySheet.prototype.getFieldDescription = function(index) {
		return this.fields[index].Description;
	};
	ajaxart.classes.PropertySheet.prototype.getField = function(index,wrapper) {
		aa_fieldControl({
			Field: this.fields[index],
			Wrapper: wrapper,
			Item: this.field_data,
			Context: this.context
		});		
	};
}



aa_gcs("searchbox",{
	SearchBox: function(profile,data,context) {
		aa_init_class_Searchbox();

		var field = aa_create_base_field(data, profile, context);
		var itemDisplayPage = aa_first(data,profile,'ItemDisplayPage',context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);

			var items = ajaxart.run(field_data,profile,'Items',ctx2);
			var itemObjects = [];
			for(var i=0;i<items.length;i++) {
				var img = aa_first([items[i]],profile,'ItemImage',ctx2);
				if (img) img.StaticUrl = aa_totext(img.Url([items[i]], ctx2));

				itemObjects.push({
					item: [items[i]],
					text: aa_text([items[i]],profile,'ItemText',ctx2),
					extraText: aa_text([items[i]],profile,'ItemExtraText',ctx2),
					image: aa_create_static_image_object(img)
				});
			}

			var searchboxObject = new ajaxart.classes.Searchbox({
				profile: profile,
				field: field,
				field_data: field_data,
				context: ctx2,
				items: itemObjects,
				descriptionForEmptyText: aa_fieldTitle(field,aa_getItemData(ctx), ctx2,true),
				itemDisplayPage: itemDisplayPage
			});

			return [aa_renderStyleObject(field.Style, searchboxObject, ctx2, true)];
		};
		return [field];		
	}
});

function aa_searchbox(searchbox,settings) {
	settings = settings || {};
	settings.inputElement = settings.inputElement || searchbox.$el.firstOfClass('aa_searchbox_input');
	settings.popupElement = settings.popupElement || searchbox.$el.firstOfClass('aa_searchbox_popup');
	settings.popupItemElement = settings.popupItemElement || searchbox.$el.firstOfClass('aa_searchbox_item');	
	settings.popupItemSettings = settings.popupItemSettings || function(itemElement) {
		return {
			itemTextElement: $(itemElement).firstOfClass('aa_searchbox_item_text'),
			itemImageElement: $(itemElement).firstOfClass('aa_searchbox_item_image'),
			itemExtraTextElement: $(itemElement).firstOfClass('aa_searchbox_item_extra_text')
		};
	};
	settings.maxItemsToShow = settings.maxItemsToShow || 20;
	settings.popupShowAllElement = settings.popupShowAllElement || searchbox.$el.firstOfClass('aa_searchbox_show_all');	

	settings.search = settings.search || aa_searchbox_search;	// for Compress: aa_searchbox_search() 

	var $input = $(settings.inputElement);
	var $popupItemParent = $(settings.popupItemElement).parent();
	var $popupItemTemplate = $(settings.popupItemElement).remove();

	$input.attr('placeholder',searchbox.descriptionForEmptyText||'');
	initPopups();
	var items = searchbox.items;

	$input.click(function() {
		if (!ajaxart.isattached(searchbox.selectorPopup.frameElement))
			openPopup();
	});
	$input.keydown(function(e) {
		if (e.keyCode == 13) {
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected) {
				selectItem(selected);
				return;
			}
		}
		if (e.keyCode == 40) { // arrow down
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected && selected.nextSibling) {
				$(selected).removeClass('selected');
				$(selected.nextSibling).addClass('selected');
				makeItemVisible(selected);
				return;
			}
		}
		if (e.keyCode == 38) { // arrow up
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected && selected.previousSibling) {
				$(selected).removeClass('selected');
				$(selected.previousSibling).addClass('selected');
				makeItemVisible(selected);
				return;
			}
		}
		openPopup();
	});

	function initPopups() {
		searchbox.selectorPopup = aa_createLightPopup({
			el: $(settings.popupElement)[0],
			launchingElement: $input[0],
			location: aa_popupNearLauncherLocation({minWidthAsLauncherElement: true}),
			features: [

			],
			apiObject: searchbox,
			type: 'searchbox',
			popupSettings: {
				closeWhenClickingOutside: 'except launching element'
			}
		});

		if (aa_isStudioRefreshAndPopupIsOpen('searchbox',searchbox)) {
			setTimeout(openPopup,100);
		}			
		$(settings.popupShowAllElement).text(searchbox.TextForShowAll || 'Show All');
	}	

	function openPopup() {		
		refreshPopupOptions();
	}
	function refreshPopupOptions(showAll) {
		settings.search($input.val(),items);

		while ($popupItemParent[0].firstChild)
			aa_remove($popupItemParent[0].firstChild,true);

		var added = 0;
		for(var i=0;i<items.length;i++) {
			if (!items[i].passed) continue;
			var $item = $popupItemTemplate.clone().appendTo($popupItemParent);
			$item[0].jbItem = items[i];
			if (! searchbox.injectItemControl($item[0],items[i],$input.val()) ) {
				var innerSettings = settings.popupItemSettings($item[0]);
				$(innerSettings.itemTextElement).text(items[i].text);
				highlightText($(innerSettings.itemTextElement),$input.val());

				$(innerSettings.itemExtraTextElement).text(items[i].extraText);
				highlightText($(innerSettings.itemExtraTextElement),$input.val());

				aa_setImage($(innerSettings.itemImageElement)[0],items[i].image);
			}

			if (added == 0) $item.addClass('selected');
			if (++added >= settings.maxItemsToShow && !showAll) {
				addShowAll();
				break;
			}
		}
		$popupItemParent.children().click(function() {
			if (this == $(settings.popupShowAllElement)[0]) return;
			selectItem(this);
		});
		$popupItemParent.children().mouseover(function() {
			if (this == $(settings.popupShowAllElement)[0]) return;
			if ( $(this).hasClass('selected') ) return;
			$popupItemParent.children().removeClass('selected');
			$(this).addClass('selected');
		});

		searchbox.selectorPopup.show();
	}

	function selectItem(itemElement) {
		searchbox.selectorPopup.close();
		searchbox.onSelect(itemElement.jbItem.item);
		$input.val('');
	}

	function addShowAll() {
		$(settings.popupShowAllElement).appendTo($popupItemParent);
		$(settings.popupShowAllElement).click(function() {
			var lastItem = this.previousSibling && this.previousSibling.jbItem;
			refreshPopupOptions(true);

			var children = $popupItemParent.children();
			for(var i=0;i<children.length;i++)
				if (children[i].jbItem == lastItem) {
					if (children[i].tabIndex == -1) children[i].tabIndex = 0;
					children[i].focus();
					children[i].tabIndex = -1;
				}
		});
	}

	function highlightText($elem,searchtext) {
		$elem.html( ajaxart_field_highlight_text($elem.text(),searchtext,'.aa_highlight') );
	}
}

function aa_init_class_Searchbox() {
	
	if (ajaxart.classes.Searchbox) return;

	ajaxart.classes.Searchbox = function(settings) {
		aa_extend(this, settings);
	};
	ajaxart.classes.Searchbox.prototype.onSelect = function(item) {
		ajaxart.run(item,this.profile,'OnSelect',this.context);
	};
	ajaxart.classes.Searchbox.prototype.getItemControl = function(item) {
		ajaxart.run(item,this.profile,'OnSelect',this.context);
	};
	ajaxart.classes.Searchbox.prototype.injectItemControl = function(parentDiv,item) {
		if (!this.itemDisplayPage) return false;
		$(parentDiv).children().remove();
		aa_fieldControl({ Field: this.itemDisplayPage, FieldData: item.item, Wrapper: parentDiv, Context: this.context });
		return true;
	}
}

function aa_searchbox_search(searchtext,items) {
	searchtext = searchtext.toLowerCase();
	for(var i=0;i<items.length;i++) {
		var item = items[i];
		if (!searchtext) {
			item.passed=true;
			continue;
		}
		var text = item.extraText ? item.text + '  ' + item.extraText : item.text;
		
		if (!item.searchCache) item.searchCache = (text).toLowerCase();

		if (item.searchCache.indexOf(searchtext) > -1) {
			item.passed=true;
			continue;
		}
		item.passed = false;
	}
}

// TODO in searchbox:
// 2. Add (+) icon
// 4. better looking scrollbar
// 5. show all
// 6. search algorithm generic (with tests) - also sort results



aa_gcs("control", {
	TabControl: function(profile, data, context) // gc of control.TabControl
	{
		var field = aa_create_base_field(data, profile, context);

		aa_init_class_TabControl();

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			field.Fields = ajaxart.runsubprofiles(data,profile,'Field',ctx2);
			var tabControl = new ajaxart.classes.TabControl({
				fields: field.Fields,
				data: field_data, profile: profile, context: ctx2, field: field, field_data: field_data,
				disableFurtherNextTabs: field.DisableFurtherNextTabs,
				checkValidationsWhenMovingForward: field.CheckValidationsWhenMovingForward,
				transition: field.TabTransition,
				tabContentsWidth: field.TabContentsWidth,
				tabContentsHeight: field.TabContentsHeight
			});

			var out = aa_renderStyleObject(field.Style,tabControl,ctx2,true);
			$(out).addClass('aa_tabcontrol');
			return [out];
		};
		return [field];
	}
});

aa_gcs("fld_aspect", {
	TabControlProperties: function(profile, data, context)
	{
		var field = context.vars._Field[0];

		field.KeepSelectedTab = aa_first(data,profile,'KeepSelectedTab',context);
		field.RefreshTabsOnSelect = aa_bool(data,profile,'RefreshTabsOnSelect',context);
		field.TabTransition = aa_first(data,profile,'Transition',context);
		field.TabContentsWidth = aa_int(data,profile,'TabContentsWidth',context);
		field.TabContentsHeight = aa_int(data,profile,'TabContentsHeight',context);

		field.DoOnTabChange = function(prevtab,newtab,fromUser) {
			ajaxart.run(data,profile,'DoOnTabChange',aa_ctx(context,{ PrevTab: [prevtab], NewTab: [newtab], OriginatedByUser: aa_frombool(fromUser) }));
		};
		aa_bind(field,'TabControlSelect',function(props) {
			ajaxart.run(data,profile,'DoOnTabChange',aa_ctx(context,{ NewTab: [props.TabField], PrevTab: [props.PrevTabField], OriginatedByUser: aa_frombool(props.fromUser) }));			
		});
		field.KeepHiddenTabInTheDOM = aa_bool(data,profile,'KeepHiddenTabInTheDOM',context);
	},
	ControlInTab: function(profile, data, context) {
		context.vars._Field[0].ControlInTab = function(data1,ctx) {
			ctx = aa_merge_ctx(context,ctx);
			var page = aa_first(data1,profile,'Page',ctx);
			if (page) {
				var out = $('<div/>')[0];
				aa_fieldControl({Wrapper: out, Field: page, Item: data1, Context: ctx });
				return [out];
			}
		};
	},
	TabControlAsWizard: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.DisableFurtherNextTabs = aa_bool(data,profile,'DisableFurtherNextTabs',context);
		field.CheckValidationsWhenMovingForward = aa_bool(data,profile,'CheckValidationsWhenMovingForward',context);
	}
});

aa_gcs("tabcontrol",{
	RefreshTabControlTitles: function(profile, data, context) {
		var field_id = aa_text(data,profile,'TabControl',context);
		var tabControl = aad_find_field(field_id)[0];
		if (tabControl && tabControl.jbApiObject)
			tabControl.jbApiObject.refreshTitles();
	}
});

function aa_init_class_TabControl() {
	aa_init_class('TabControl',{
		_ctor: function() {
			var field_data = this.field_data,context = this.context;

			this.tabs = [];
			for(var i=0;i<this.fields.length;i++) {
				var tabField = this.fields[i];
				if (tabField.IsHidden) continue;
				if (tabField.IsFieldHidden && tabField.IsFieldHidden(field_data,context)) continue;
				if (tabField.IsCellHidden && tabField.IsCellHidden(field_data,context)) continue;
					
				var tabInfo = {
					id: tabField.Id,
					text: aa_fieldTitle(tabField ,field_data, context,true),
					image: aa_init_image_object(tabField.TabImage,field_data,context),
					tabField: tabField,
					buildControl: function() {
				    var tab_data = ajaxart_field_calc_field_data(this.tabField,field_data,context);
				    var control = $('<div/>')[0];
				    aa_fieldControl({Field: this.tabField, FieldData: tab_data, Item: field_data, Wrapper: control, Context: context});
				    return control;
					},
					refreshControlOnSelect: this.field.RefreshTabsOnSelect
				};
				if (tabField.ControlInTab) {
					tabInfo.controlInTab = function() {
						return this.tabField.ControlInTab(field_data,context)[0];
					};
				}
				this.tabs.push(tabInfo);
			}
			this.firstSelectedTabIndex = this.field.KeepSelectedTab ? this.field.KeepSelectedTab.get(this.field.Id) : 0;
		},
		selectTab: function(moveTo,tabID) {
			this.el.jbChangeTab(moveTo,tabID);
		},
		onSelectTab: function(selectedTab,previousTab,fromUser) {
			try {
				if (this.field.KeepSelectedTab) { 
					this.field.KeepSelectedTab.set(this.field.Id,selectedTab.index);
				}
			} catch(e) { 
				ajaxart.logException('keep selected tab',e);
			}
			aa_trigger(this.field,'TabControlSelect',{ TabField: selectedTab.tabField, PrevTabField: previousTab && previousTab.tabField, fromUser: fromUser });
		},
		refreshTitles: function() {
			for(var i=0;i<this.tabs.length;i++) {
				var tabField = this.fields[i];
				this.tabs[i].text = aa_fieldTitle(tabField ,this.field_data, this.context,true);
			}
			aa_trigger(this,'refreshTitles');
		}
	});	
}

function aa_tabcontrol(tabcontrol, settings) {
	settings = settings || {};
	settings.tabElement = settings.tabElement || tabcontrol.$el.find('.aatabs_tab');
	settings.tabContents = settings.tabContents || tabcontrol.$el.find('.aatabs_contents');
	settings.tabSettings = settings.tabSettings || function(tab,$tab) {
		return {
			tabTextElement: $tab.find('.aatabs_tab_text'),
			tabImageElement: $tab.find('.aatabs_tab_image'),
			tabIndexElement: $tab.find('.aatabs_tab_index')			
		};
	};
	var tabContents = $(settings.tabContents);
	var tabTemplate = $(settings.tabElement);

	var tabs = tabcontrol.tabs;

	for(var i=0;i<tabs.length;i++) {
		var tabInfo = tabs[i];
		tabInfo.index = i;
		var $tab = tabTemplate.clone().insertBefore(tabTemplate);

		var tabSettings = settings.tabSettings($tab[0],$tab);
		$(tabSettings.tabTextElement).text( tabInfo.text );
		aa_setImage($(tabSettings.tabImageElement),tabInfo.image,true);
		$(tabSettings.tabIndexElement).text(i+1);
		var controlInTab = tabInfo.controlInTab && tabInfo.controlInTab();
		if (controlInTab)
			$(controlInTab).insertAfter(tabSettings.tabTextElement).addClass('aa_tabs_control_in_tab');

		aa_extend($tab[0],{
			jbTabInfo: tabInfo,
			jbTabControl: tabcontrol
		});
		tabInfo.$tabElement = $tab;

		$tab.click(function() {
			if ($(this).hasClass('disabled')) return;
			selectTab(this.jbTabInfo,true);
		});
	}
	tabTemplate.remove();

	var firstSelected = tabcontrol.firstSelectedTabIndex || 0;
	if (!tabs[firstSelected]) firstSelected = 0;

	if (tabs[firstSelected]) {
		selectTab(tabs[firstSelected]);
	}

	setTabContentsSize();

	function selectTab(tabInfo,fromUser) {
		if (!tabInfo) return;
		var currentTabInfo = tabcontrol.el.jbCurrentTabInfo;
		if (currentTabInfo == tabInfo) return;

		if (currentTabInfo && tabcontrol.checkValidationsWhenMovingForward) 
			if ( tabInfo.index > currentTabInfo.index && !aa_checkValidations(currentTabInfo.control) )
				return;

		if (!tabInfo.control || tabInfo.refreshControlOnSelect) {
			aa_remove(tabInfo.control,true);
			tabInfo.control = $(tabInfo.buildControl())[0];
		}

		if (tabcontrol.transition && currentTabInfo) {
			prevTabInfo = currentTabInfo;
			aa_replace_transition({
	            transition: tabcontrol.transition,
	            elOriginal: currentTabInfo.control, 
	            elNew: tabInfo.control,
				removeOriginal: function() { 
					removePrevTab(prevTabInfo);
	            },
	            onTransitionEnd: function() {
					aa_element_attached(tabcontrol.el);	            	
	            }
	        },tabcontrol.context);
		} else {
			if (currentTabInfo) {
				removePrevTab(currentTabInfo);
			}
			aa_empty(tabContents[0],true);
			tabContents[0].appendChild(tabInfo.control);				
		}
		tabcontrol.el.jbCurrentTabInfo = tabInfo;
		tabInfo.$tabElement.addClass('aa_selected_tab');
		tabInfo.$tabElement.parent().children().removeClass('aa_next_to_selected_tab');
		tabInfo.$tabElement.next().addClass('aa_next_to_selected_tab');
		
		if ($(tabInfo.control).hasClass('jbHidden')) {
			$(tabInfo.control).removeClass('jbHidden');
			tabInfo.control.style.display = 'block';
		}
		aa_element_attached(tabcontrol.el);

		if (tabcontrol.onSelectTab) tabcontrol.onSelectTab(tabInfo,currentTabInfo,fromUser);

		refreshEnabledTabs(tabInfo);
	}

	function removePrevTab(tabInfo) {
		if (tabcontrol.keepHiddenTabInTheDOM) {
			tabInfo.control.style.display = 'none';
			$(tabInfo.control).addClass('jbHidden');
		} else {
			aa_remove(tabInfo.control,false);
//			tabInfo.control = null;
		}
		tabInfo.$tabElement.removeClass('aa_selected_tab');
		aa_element_detached(tabInfo.control);		
	}

	function refreshEnabledTabs(currentTabInfo) {
		if (tabcontrol.disableFurtherNextTabs) {
			for(var i=0;i<tabcontrol.tabs.length;i++) {
				if (i <= currentTabInfo.index+1)
					tabcontrol.tabs[i].$tabElement.removeClass('disabled');
				else 
					tabcontrol.tabs[i].$tabElement.addClass('disabled');
			}
		}
	}

	function setTabContentsSize() {
		if (tabcontrol.tabContentsWidth) $(tabContents).width(tabcontrol.tabContentsWidth);
		if (tabcontrol.tabContentsHeight) $(tabContents).height(tabcontrol.tabContentsHeight);
	}

	// jbChangeTab is needed for the ChangeTab operation
	tabcontrol.el.jbChangeTab = function(moveto,tabid) {
			if (moveto == "refresh current tab") selectTab(tabcontrol.el.jbCurrentTabInfo);
			var newTab = null;
			if (moveto == 'first tab' && tabs.length) {
				newTab = tabs[0];
			}
			else if (moveto == 'specific tab') {
				for(var i=0;i<tabs.length;i++) {
					if (tabs[i].id == tabid) {
						newTab = tabs[i];
						break;
					}
				}
			}
			if (moveto == "next tab" || moveto == "previous tab") {
				if (!tabcontrol.el.jbCurrentTabInfo) return;
				var newIndex = tabcontrol.el.jbCurrentTabInfo.index + (moveto == "next tab" ? 1 : -1);
				if (tabs[newIndex]) newTab = tabs[newIndex];
			}
			if (newTab && newTab != tabcontrol.el.jbCurrentTabInfo) selectTab(newTab);
	};

	aa_addOnDetach(tabcontrol.el,function() {
		for(var i=0;i<tabs.length;i++) {
			if (tabs[i].control && tabs[i].$tabElement && !tabs[i].$tabElement.hasClass('aa_selected_tab'))
				aa_empty(tabs[i].control,true);
		}		
	});
}

function aa_tabcontrolAsAccordion(tabcontrol, settings) {
	settings.tabElement = settings.tabElement || tabcontrol.$el.find('.aatabs_tab');
	settings.tabContents = settings.tabContents || tabcontrol.$el.find('.aatabs_contents');
	settings.collapseAnimationTime = settings.collapseAnimationTime || 200;
	settings.expandAnimationTime = settings.expandAnimationTime || 200;

	settings.tabSettings = settings.tabSettings || function(tab,$tab) {
		return {
			tabTextElement: $tab.find('.aatabs_tab_text'),
			tabImageElement: $tab.find('.aatabs_tab_image'),
			tabToggleElement: $tab.find('.aatabs_tab_toggle'),			
			tabCaptionElement: $tab.find('.aatabs_tab_caption'),			
			tabContentsElement: $tab.find('.aatabs_tab_contents')
		};
	};
	var tabTemplate = $(settings.tabElement);

	var tabs = tabcontrol.tabs;
	for(var i=0;i<tabs.length;i++) {
		var tabInfo = tabs[i];
		tabInfo.index = i;
		var $tab = tabTemplate.clone().insertBefore(tabTemplate);

		var tabSettings = settings.tabSettings($tab[0],$tab);
		tabInfo.tabSettings = tabSettings;

		$(tabSettings.tabTextElement).text( tabInfo.text );
		aa_setImage($(tabSettings.tabImageElement),tabInfo.image,true);
		var controlInTab = tabInfo.controlInTab && tabInfo.controlInTab();
		if (controlInTab)
			$(controlInTab).insertAfter(tabSettings.tabTextElement).addClass('aa_tabs_control_in_tab');
		
		aa_extend($tab[0],{
			jbTabInfo: tabInfo,
			jbTabControl: tabcontrol
		});
		tabInfo.$tabElement = $tab;
		$(tabSettings.tabCaptionElement)[0].jbTabInfo = tabInfo;

		$(tabSettings.tabCaptionElement).click(function() {
			toggleTab(this.jbTabInfo);
		});

		if (settings.autoExpand == 'all') expandTab(tabInfo,true);
	}
	tabTemplate.remove();

	var firstSelected = tabcontrol.firstSelectedTabIndex || 0;

	if (tabs[firstSelected] && settings.autoExpand != 'none' && settings.autoExpand != 'all') {
		toggleTab(tabs[firstSelected],true);
	}

	aa_bind(tabcontrol,'refreshTitles',function() {
		for(var i=0;i<tabs.length;i++) {
			var tabInfo = tabs[i];
			var $tab = tabInfo.$tabElement;
			var tabSettings = settings.tabSettings($tab[0],$tab);

			$(tabSettings.tabTextElement).text( tabInfo.text );
			aa_setImage($(tabSettings.tabImageElement),tabInfo.image,true);
		}
	});

	function toggleTab(tabInfo,firstTime) {
		if (!tabInfo) return;
		if (tabInfo.$tabElement.hasClass('expanded')) {
			collapseTab(tabInfo);
			tabcontrol.el.jbCurrentTabInfo = null;
			return;
		}
		var currentTabInfo = tabcontrol.el.jbCurrentTabInfo;
		if (currentTabInfo == tabInfo) return;
		if (currentTabInfo) collapseTab(currentTabInfo);
		expandTab(tabInfo,firstTime);
	}
	function collapseTab(tabInfo) {
		var tabElement = $(tabInfo.tabSettings.tabContentsElement)[0];
		var tabContentsElement = $(tabInfo.tabSettings.tabContentsElement)[0];
		if (settings.doCollapse) {
		 settings.doCollapse( tabInfo.$tabElement );
		} else {
			if (window.aa_intest) 
				$(tabContentsElement).hide();
			else 
				$(tabContentsElement).animate({ height: 'hide'},settings.collapseAnimationTime);
		}
		tabInfo.$tabElement.removeClass('expanded');
	}
	function expandTab(tabInfo,firstTime) {
		if (!tabInfo.control || tabInfo.refreshControlOnSelect) {
			aa_remove(tabInfo.control,true);
			tabInfo.control = $(tabInfo.buildControl())[0];
		}

		var tabElement = $(tabInfo.tabSettings.tabContentsElement)[0];
		if (tabInfo.control.parentNode != tabElement) {
			aa_empty(tabElement,true);
			tabElement.appendChild(tabInfo.control);
			aa_element_attached(tabInfo.control);
		}

		tabInfo.$tabElement.addClass('expanded');
		if (window.aa_intest || firstTime) 
			$(tabElement).show();
		else
			$(tabElement).animate({ height: 'show'},settings.collapseAnimationTime);
		tabcontrol.el.jbCurrentTabInfo = tabInfo;

		if (tabcontrol.onSelectTab) tabcontrol.onSelectTab(tabInfo);	
	}
	// jbChangeTab is needed for the ChangeTab operation
	tabcontrol.el.jbChangeTab = function(moveto,tabid) {
			if (moveto == 'specific tab') {
				for(var i=0;i<tabs.length;i++) {
					if (tabs[i].id == tabid)
						return toggleTab( tabs[i] );
				}
			}
			if (moveto == "refresh current tab") toggleTab(tabcontrol.el.jbCurrentTabInfo);
			if (moveto == "next tab" || moveto == "previous tab") {
				if (!tabcontrol.el.jbCurrentTabInfo) return;
				var newIndex = tabcontrol.el.jbCurrentTabInfo.index + (moveto == "next tab" ? 1 : -1);
				if (tabs[newIndex]) toggleTab(tabs[newIndex]);
			}			
	};
}





aa_gcs("data",	{
	  Switch: function (profile,data,context)
	  {
		  return aa_switch(profile,data,context);
	  },
	  StringifyJson: function (profile,data,context) {
		  var obj = aa_first(data,profile,'Object',context) || {};
		  var xtmlSource = obj.XtmlSource;
		  var dtsupport = obj.dt_support;
		  delete obj.XtmlSource;
		  delete obj.dt_support;
		  if (aa_bool(data,profile,'PrettyPrint',context))
		  	var result = JSON.stringify(obj,null, '  ');
		  else
		  	var result = JSON.stringify(obj);

		  if (xtmlSource) obj.XtmlSource = xtmlSource;
		  if (dtsupport) obj.dt_support = dtsupport;
		  return [result];
	  },
		RemoveNullProperties: function (profile,data,context) {
		  var orig = aa_first(data,profile,'Object',context) || {};
		  var out = {};
		  for (i in orig)
		 	if (orig.hasOwnProperty(i) && orig[i] != null) out[i] = orig[i];
		  return [out]
	  },
	  DataWithPreAction: function (profile,data,context) {
	  	aa_run(data,profile,'Action',context);
	  	return aa_run(data,profile,'Query',context);
	  },
	  ParseJson: function (profile,data,context) {
	  	var result= JSON.parse(aa_text(data,profile,'JSON',context));
	    if (aa_isArray(result)) return result;
	  	return [result || '{}'];
	  },
	  Subset: function (profile,data,context)
	  {
	    var from = aa_int(data,profile,'From',context)-1;
	    var count = aa_int(data,profile,'Count',context);
	    if (isNaN(count)) count = data.length;
	    return data.slice(from,from+count);
	  },
	  SubsetWithMore: function (profile,data,context)
	  {
	    var from = aa_int(data,profile,'From',context)-1;
	    var count = aa_int(data,profile,'Count',context);
	    if (isNaN(count)) count = data.length;
	    var out = data.slice(from,from+count);
	    if (out.length < data.length) {
		    out.push(aa_first(data,profile,'ItemForMore',context));
	    }
	    return out;
	  },
	  JustInTimeCalculation: function (profile,data,context)
	  {
		  var out = { isObject:true, Content:null };
		  out.GetContent = function(data1,ctx) {
			  if (out.Content == null) {
				  out.Content = ajaxart.run(data1 || data,profile,'Content',aa_merge_ctx(context,ctx));
			  }
			  return out.Content;
		  }
		  out.CleanContent = function() {
		  	out.Content = null;
		  }
		  return [out];
	  },
	  JavaScript: function (profile,data,context)
	  {
			var ret = aa_run_js_code(aa_text(data,profile,'Code',context),data,context);
			if (!ret) return [];
			if (typeof(ret) == 'string') return [ret];
			if (typeof(ret) == 'number') return [""+ret];
			if (typeof(ret) == 'boolean') {
				if (ret) 
					return ["true"];
				else
					return [];
			}
			if (aa_isArray(ret)) return ret;
			return [ret];
	  },
	  AddSeparator: function (profile,data,context)
	  {
	    var addBefore = aa_first(data,profile,'AddBefore',context);
	    var addAfter = aa_first(data,profile,'AddAfter',context);
	    
			var out = [];
			if (addBefore) out.push(addBefore);

	  	ajaxart.each(data,function(item,i) {
	  	    var Separator = aa_first(data,profile,'Separator',context);
	  			out.push(item);
	  			if (i+1 < data.length && Separator != null)
	  		  	out.push(Separator);
	  	});
	  	if (addAfter) out.push(addAfter);
	  	return out;  	
	  },
	  NewValueWithItemIndex: function (profile,data,context)
	  {
	  	return aa_map(data,function(item,index) {
	  		return aa_first([item],profile,'Value',aa_ctx(context,{ Index: [index] }));
	  	});
	  },
	  Count: function (profile,data,context)
	  {
		  var items = ajaxart.run(data,profile,'Items',context);
			return [items.length];
	  },
	  FirstSucceeding: function (profile,data,context)
	  {
	    var itemProfiles = ajaxart.subprofiles(profile,'Item');

	    for(var i=0;i<itemProfiles.length;i++)
	    {
				var subresult = ajaxart.run(data,itemProfiles[i],"",context);
				if (subresult.length > 0) return subresult;
			}
			return [];
	  },
	  IfThenElse: function (profile,data,context)
	  { 
		return aa_ifThenElse(profile,data,context);
	  },
	  ItemByID: function (profile,data,context)
	  {
		  var list = ajaxart.run(data,profile,'List',context);
		  var id = aa_text(data,profile,'ID',context);
		  
		  for(var i=0;i<list.length;i++)
			  if (list[i].ID == id) return [ list[i] ];
		  
		  return [];
	  },
	  ItemsByIDs: function (profile,data,context)
	  {
		  var list = ajaxart.run(data,profile,'List',context);
		  var ids = "," + aa_text(data,profile,'IDs',context) + ",";
		  if (ids == ",*,") return list;
		  
		  var out = [];
		  
		  for(var i=0;i<list.length;i++) 
			  if (list[i].Id != "" && ids.indexOf(list[i].Id) != -1) out.push(list[i]);
		  
		  return out;
	  },
	  List: function (profile,data,context)
	  {
	    var items = ajaxart.subprofiles(profile,'Item');
	  	var out = [];
	  	
	  	for(var i=0;i<items.length;i++) {
	  	  var next = ajaxart.run(data,items[i],"",context);
	  	  ajaxart.concat(out,next);
	  	};
	  	
	  	var aggs = ajaxart.subprofiles(profile,'Aggregator');
		  for(var i=0;i<aggs.length;i++)
				out = ajaxart.run(out,aggs[i],'',context); 

	  	return out;  	
	  },
	  Pipeline: function (profile,data,context)
	  {
			if (data.length > 1) data = [ data[0] ];
			var itemProfiles = ajaxart.subprofiles(profile,'Item');
			var nextData = data;

			for(var i=0;i<itemProfiles.length;i++) {
				var itemProfile = itemProfiles[i];
				var arr = [];
				if (nextData.length === 0 && i != 0) {
					nextData = [];
					break;
				}

				if (data.length <= 1 && i === 0)
					arr = ajaxart.run(nextData,itemProfile,"",context);
				else 
				{
					var compiledFunc = ajaxart.compile(itemProfile,'',context);

					if (compiledFunc == "same") continue;
					
					if (compiledFunc == null)
						for(var j=0;j<nextData.length;j++) 
							ajaxart.concat(arr,ajaxart.run([ nextData[j] ],itemProfile,"",context) );
					else
						for(var j=0;j<nextData.length;j++) 
							ajaxart.concat(arr,compiledFunc([nextData[j]],context) );
				}
				
				nextData = arr;
			}

			// now aggregators
		  var aggProfiles = ajaxart.subprofiles(profile,'Aggregator');
			  
		  for(var i=0;i<aggProfiles.length;i++) {
				nextData = ajaxart.run(nextData,aggProfiles[i],'',context); 
			}

			return nextData;
		},
		RunActionAndKeepInput: function (profile,data,context)
	  {
		  ajaxart.run(data,profile,'Action',context);
		  return data;
	  },
	  Same: function (profile,data,context)
	  {
	  	return data;
	  },
	  CleanNS: function (profile,data,context)
	  {
		  if (data[0] && typeof(data[0]) == 'object' && ! data[0].nodeType ) // json or csv
				return jbart_data(data[0],'single');

		  return jbart_data(ajaxart.totext_array(data),'single');
	  },
 	  IndexOfValueInCSV: function(profile, data, context) {
			var values = aa_text(data,profile,'Values',context);
			var value = aa_text(data,profile,'Value',context);
			var vals = values.split(',');
			var result = [];
			for(var i=0;i<vals.length;i++) 
				if (vals[i] == value) result.push('' + (i+1));
			return result;
		},
	  CSVValueByIndex: function(profile, data, context) {
			var values = aa_first(data,profile,'Values',context);
			var index = aa_int(data,profile,'Index',context);
			if (!values) return [];

			if (values.nodeType == 2) // att
				return [new aa_CSVValByRef(values,index-1)];
			return [aa_text(data,profile,'Values',context).split(',')[index-1]];
	  },
		CSVValuesByCode: function(profile, data, context) {
			var out = {};
			var codes = jQuery.trim(aa_text(data,profile,'Codes',context));
			var values = aa_first(data,profile,'Values',context);
			if (!values) return [];
			if (values.nodeType != 2) // att
				values = aa_text(data,profile,'Values',context).split(',');

			var codes_ar = codes.split(',');
			if (values.nodeType == 2) {
				for(var i=0;i<codes_ar.length;i++)
					out[codes_ar[i]] = new aa_CSVValByRef(values,i);
			} else {
				for(var i=0;i<codes_ar.length;i++)
					out[codes_ar[i]] = values[i];
			}
			return [out];
		},
		ObjectToCSV: function(profile, data, context) {
			var out = [];
			var atts = jQuery.trim(aa_text(data,profile,'Atts',context)).split(',');
			var obj = aa_first(data,profile,'Object',context);
			for(var i=0;i<atts.length;i++)
				out.push(ajaxart.totext_item(obj[atts[i]]));
			return [out.join(',')];
		},
		MatrixByColumns: function(profile, data, context) {
			var items = ajaxart.run(data,profile,'Items',context);
			var no_of_cols = aa_int(data,profile,'NoOfColumns',context);
			if (items.length ==0) return [];

			var result = [],row=[items[0]];
			for (var i=1;i<items.length;i++) {
				if (i % no_of_cols == 0) {
					result.push(row);
					row = [];
				}
				row.push(items[i]);
			}
			result.push(row);
			return result;
		},
		SwapRowsAndColumns: function(profile, data, context) {
			var result = [];
			var items = ajaxart.run(data,profile,'Items',context);
			var no_of_cols = aa_int(data,profile,'NoOfColumns',context);
			var new_no_of_cols = Math.floor(items.length/no_of_cols);
			for (var i=0;i<items.length;i++) {
				var col=i % no_of_cols,row=Math.floor(i/no_of_cols);
				var rev_index = col*new_no_of_cols+row;
				//console.log(row,col,rev_index);
				result[rev_index] = items[i]; // reverse col and Columns
			}
			return result;
		},
  Zip: function (profile,data,context)
  {
	var lists = [];
  	var itemProfiles = ajaxart.subprofiles(profile,'List');
  	for(var i=0; i<itemProfiles.length; i++)
  		lists.push({list:ajaxart.run(data,itemProfiles[i],"",context) });
	  
	var i=0;
	var result = [];
	if (lists.length == 0) return result;
	var result_length = 0;
	for(var j=0; j<lists.length; j++)
		result_length = Math.max(result_length,lists[j].list.length);
	
	for(var i=0;i<result_length;i++)
	{
	  var item = { isObject: true};
	  for(var j=0; j<lists.length; j++)
		  item['' + j] = (i < lists[j].list.length) ? lists[j].list[i] : '';
	  result.push(item);
	}
	return result;
  },
  Csv: function (profile,data,context)
  {
	  var content = aa_text(data,profile,'Content',context);
	  var fieldNames = aa_text(data,profile,'FieldNames',context).split(',');
	  var lines = content.split('\n');
	  var result = [];
	  var first_line = 0;
	  if (fieldNames == '') 
	  {
		  fieldNames = lines[0].split(',');
		  first_line = 1;
	  }
	  for(var i=first_line;i<lines.length;i++)
	  {
		  if (lines[i] == '') continue;
		  var fields = lines[i].split(',');
		  var obj = { isObject: true, __index: i};
		  for (var j=0;j<fieldNames.length;j++)
			  obj[fieldNames[j]] = fields[j];
		  result.push(obj);
	  }
	  return result;
  },
  Reduce: function (profile,data,context)
  {
    var result = ajaxart.run(data,profile,'InitialValue',context);
    var items = ajaxart.run(data,profile,'Items',context);

    for(var i=0;i<items.length;i++)
    	result = ajaxart.run(result,profile,'Formula',aa_ctx(context,{ Item : [items[i]] } ) );
  	
  	return [result];  	
  },
  Math: function (profile,data,context)
  {
	  var exp = aa_text(data,profile,'Expression',context);
	  var fix = aa_bool(data,profile,'FixFloatingPointResult',context);
	  try
	  {
		  eval('var val = ' + exp);
	  	  if (fix) 
	  		  val = ((val*10000).toFixed(5)/10000);
		  return [ '' + val ];
	  }
	  catch(e)
	  {
		  return [];
	  }
  },
  Percent: function (profile,data,context) {
	  var result = [];
	  var exp = aa_text(data,profile,'Part',context) + '/' + aa_text(data,profile,'Whole',context);
	  try {
		  eval( 'var val = "" + 100*' + exp);
		  result.push(val);
	  }
	  catch(e) { 
		  ajaxart.log("Can not calc percent expression: " + exp,'Error');
	  }
	  return result;
  },
  Cookie: function(profile, data, context) {
    var name = aa_text(data,profile,'CookieName',context);
    return [{
      name: name,
      WriteValue: function(newval) {
        aa_writeCookie(name,aa_totext(newval));
      },
      GetValue: function() {
        return aa_valueFromCookie(name);
      }
    }];
  },
	SessionStorage: function(profile, data, context) {
    var key = aa_text(data,profile,'Key',context);
    if (aa_bool(data,profile,'ValueAsText',context) ) {
			var val = sessionStorage[key];
      return val ? [''+val] : [];
    }
    return [{
      key: key,
      WriteValue: function(newval) {
        sessionStorage[key] = aa_totext(newval);
			},
      GetValue: function() {
				var val = sessionStorage[key];
        return val ? [val] : [];
      }
    }];
  },
	LocalStorage: function(profile, data, context) {
    var key = aa_text(data,profile,'Key',context);
    if (aa_bool(data,profile,'ValueAsText',context) ) {
			var val = localStorage[key];
      return val ? [''+val] : [];
    }
    return [{
      key: key,
      WriteValue: function(newval) {
        localStorage[key] = aa_totext([newval]);
			},
      GetValue: function() {
				var val = localStorage[key];
        return val ? [val] : [];
      }
    }];
  },
  Parents: function(profile, data, context)
  {
	var max_depth = aa_int(data,profile,'MaxIterations',context);
	var item = data[0],out = [];
	if (aa_bool(data,profile,'IncludeItself',context)) out.push(item);
	
	while (item && max_depth >0) {
	  max_depth--;
	  if (aa_bool([item],profile,'StopWhen',context))
		  return out;
	  item = aa_first([item],profile,'ParentRelation',context);
	  if (item)
		  out.push(item);
	}
	return out;
  },
  RandomPick: function (profile,data,context)
  {
	  if (data.length <= 1) return data;
	  
	  var rnd = Math.random();
	  var num = Math.floor( rnd * data.length );
	  return [ data[num] ];
  },
  RandomNumber: function (profile,data,context)
  {
	  var from = aa_int(data,profile,'From',context);
	  var to = aa_int(data,profile,'To',context);
	  var rnd = Math.random();
	  var num = Math.floor( rnd * (to-from+1) ) + from;
	  return [ num ];
  },
  RandomShuffle: function (profile,data,context)
  {
	  if (data.length <= 1) return data;

	  var o = [];
	  for(var i=0;i<data.length;i++) o[i] = data[i];
	  
	  for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
	  
	  return o;
	  
  },
  Last: function (profile,data,context)
  {
	  if (data.length == 0) return [];
	  return [ data[data.length-1] ];
  },
  Slice: function (profile,data,context)
  {
    var from = aa_int(data,profile,'From',context);
    var to = aa_int(data,profile,'To',context);
    if (to == null && from == null) return data;
    if (to == null) return data.slice(from);
    if (from == null) return data.slice(to);
    
		return data.slice(from,to);
  },
  Min: function (profile,data,context)
  {
  	var items = ajaxart.run(data,profile,'ToCompare',context);
  	var numbers = $.map($.map(items,ajaxart.totext_item),parseFloat);
	
    var result = 0;
    for(var i=1;i<numbers.length;i++)
    	if (numbers[i] < numbers[result]) result = i;
	  return [data[result]];
  },
  Max: function (profile,data,context)
  {
  	var items = ajaxart.run(data,profile,'ToCompare',context);
  	var numbers = $.map($.map(items,ajaxart.totext_item),parseFloat);
	
    var result = 0;
    for(var i=1;i<numbers.length;i++)
    	if (numbers[i] > numbers[result]) result = i;
	  return [data[result]];
  },
  Average: function (profile,data,context)
  {
  	var digits = aa_int(data,profile,'Digits',context);
    var count=0,sum=0;
    if (data.length == 0) return [0];
    for(var i=0;i<data.length;i++) {
    	count++;
    	sum += Number(ajaxart.totext_item(data[i]));
    }
    if (isNaN(sum)) return [];
    var base = Math.pow(10,digits);
    var num = Math.round(base * sum / count) / base;
		return [num];
  },
  Sum: function (profile,data,context)
  {
    var sum=0;
    for(var i=0;i<data.length;i++)
    	sum += Number(ajaxart.totext_item(data[i]));
    
    if (isNaN(sum)) return [];
	return [sum];
  },
  InPreviewMode: function (profile,data,context)
  {
	if (typeof(ajaxart) != "undefined" && ajaxart.inPreviewMode) return ["true"];
	return [];
  },
  RecursiveScan: function (profile,data,context)
  {
	  var onlyLeaves = aa_bool(data,profile,"OnlyLeaves",context);
	  var maxItems = aa_text(data,profile,"MaxItemsToAvoidInfinitiveLoop",context);
	  var scanOrder = aa_text(data,profile,"ScanOrder",context);
	  
	  var result = [];
	  var nodes = data;
	  var current_node_index = 0;
	  var total = 0;
	  
	  while (nodes.length > current_node_index) {
	  	var current_node;
	  	if (scanOrder == "Depth first search")
	  		current_node = nodes.pop();
	  	else {
	  		current_node = nodes[current_node_index];
	  		current_node_index++;
	  	}
		  var nextLevel = ajaxart.run([current_node],profile,'ChildNodes',context);
		  if (scanOrder == "Depth first search")
		  	nextLevel = nextLevel.reverse();
		  ajaxart.concat(nodes,nextLevel);
		  if (!onlyLeaves || nextLevel.length ==0)
		  	result.push(current_node);
		  if (total++ > maxItems) {
		  	ajaxart.log("RecursiveScan - exceeded max items, might be infinitive loop, max items:" + total,"error");
		  	break;
		  }
	  }
	  return result;
  },
  UniqueNumber: function (profile,data,context)
  {
	  var prefix = aa_text(data,profile,'Prefix',context);
	  var suffix = aa_text(data,profile,'Suffix',context);
	  var num = prefix + (ajaxart.unique_number++) + suffix;
	  
	  return [num];
  },
  Demote: function (profile,data,context)
  {
	  var demote = "," + aa_text(data,profile,'Items',context) + ",";
	  var i=0;
	  var out = [], last = [];
	  for(var i=0;i<data.length;i++) {
		  var itemText = aa_text([data[i]],profile,'ItemText',context);
		  if (demote.indexOf(","+itemText+",") == -1) out.push(data[i]); else last.push(data[i]);
	  }
	  for(var i=0;i<last.length;i++) out.push(last[i]);
	  return out;
  },
  Single: function (profile,data,context)
  {
	  var items = ajaxart.run(data,profile,"Items",context);
	  return [items];
  },
  Url: function (profile,data,context)
  {
	  var str = "" + window.location.href;
	  return [str];
  },
  IsInSelectedItems: function (profile,data,context)
  {
		var list = "," + ajaxart.totext_item(ajaxart.getVariable(context,'SelectedItems')[0]) + ",";
		var txt = "," + ajaxart.totext_item(data[0]) + ",";
		if (list.indexOf(txt) != -1)
			return ["true"];
		return [];
  },
  IsCodeInSelectedItems: function (profile,data,context)
  {
		var list = "," + ajaxart.totext_item(ajaxart.getVariable(context,'SelectedItems')[0]) + ",";
		var txt = "," + aa_text(data,profile,'Code',context) + ",";
		if (list.indexOf(txt) != -1)
			return ["true"];
		return [];
  },
  ValueFromCookie: function (profile,data,context)
  {
	var name = aa_text(data,profile,'Cookie',context);
	var asXml = aa_bool(data,profile,'AsXml',context);
	var result = aa_valueFromCookie(name);
	if (result == null) return [];
	if (asXml)
	  if (result == "") return [];
	  else return [aa_parsexml(result,"cookie " + name)];
	return [result];
  },
  Object: function (profile,data,context)
  {
	  var out = { isObject: true };
	  var elem = profile.firstChild;
	  while (elem != null)
	  {
		  if (elem.nodeType == 1) 
		  {
			  var tag = aa_tag(elem);
			  var name = elem.getAttribute('name');
			  if (name == null || name == "") { elem = elem.nextSibling;  continue; }
			  
			  if (tag == 'Property') {
				  out[name] = ajaxart.run(data,elem,'',context);
			  } else if (tag == 'LightMethod') {
				  out[name] = { script: elem , context: context, compiled: ajaxart.compile(elem,'',context,elem.getAttribute("paramVars")) };
			  } else if (tag == 'Method') {
				  out[name] = { script: elem , context: context, objectForMethod: [out], compiled: ajaxart.compile(elem,'',context,elem.getAttribute("paramVars")) };
			  }
		  }
	    elem = elem.nextSibling;
	  }
			
	  return [out];
  },
  MakeUnique: function (profile,data,context)
  {
  	var item_names = {};
  	var out = [];
  	for(var i=0;i<data.length;i++) {
  	 var item = data[i];
      var id = "_" + aa_text([item],profile,'Identifier',context);
      var used = true;
      if (!item_names[id]) {
      	item_names[id] = true;
      	out.push(item);
      }
  	}
  	return out;
  },
  CreateDateRangesFromNow: function (profile,data,context) {
  	var count = aa_int(data,profile,'Count',context);
  	var resolution = aa_text(data,profile,'Resolution',context);

  	var out = [];
  	var now = new Date();
  	var tomorrowMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime() + 1000*60*60*24;

  	var diff = 0;
  	if (resolution == 'days') diff = 1000*60*60*24;
  	if (resolution == 'weeks') diff = 1000*60*60*24*7;

  	if (resolution == 'days' || resolution == 'weeks') {
  		var lastValue = tomorrowMidnight;
  		if (resolution == 'weeks') {
  			lastValue += (6 - new Date().getDay()) * 1000*60*60*24;
  		}
	  	for(var i=0;i<count;i++) {
	  		out.push({ From: lastValue - diff, To: lastValue-1 });
	  		lastValue -= diff;
	  	}
	  }
	  if (resolution == 'months') {
	  	var year = now.getFullYear();
	  	var month = now.getMonth();

	  	for(var i=0;i<count;i++) {
	  		var month2 = month+1,year2 = year;
	  		if (month2>12) { month2=1; year2++; }
	  		out.push({ From: new Date(year,month,1).getTime(), To: new Date(year2,month2,1).getTime()-1 });
	  		
	  		month--;
	  		if (month==0) { year--;month=12;}
	  	}
	  }

  	return out;
  },
  GroupBy: function (profile,data,context)
  {
  	var groups = [];
  	var group_ids = {};
  	var items = ajaxart.run(data,profile,"Items",context);
  	for(var i=0;i<items.length;i++) {
  		var item = items[i];
      var id = "_" + aa_text([item],profile,'GroupBy',context);
      if (group_ids[id] == null) {
    	group_ids[id] = groups.length;
    	groups.push({ ID:id.substring(1), Items:[item]});
      } else
    	  groups[ group_ids[id] ].Items.push(item);
  	}
  	var out = [];
  	for(var i=0;i<groups.length;i++) 
  		out.push ( aa_first([groups[i]] ,profile, 'Group', context) );
  	
  	return out;
  },
  ExpandWithRelated: function (profile,data,context)
  {
	var max_depth = aa_int(data,profile,'MaxDepth',context);
	var log_relations_to = ajaxart.run(data,profile,'LogRelationsTo',context);
	var log = '';
	var has_log = log_relations_to.length>0;
  	var group = {}, new_items = [];
  	ajaxart.each(data,function(item) {
  		var id = aa_text([item],profile,'Identifier',context);
  		group[id] = { id: id, Item: item, RefCount: 0};
  		new_items.push(id);
  	});
  	
  	function expand(items)
  	{
  		var new_items = [];
  		for(var j=0;j<items.length;j++)
  		{
  			var item = items[j];
  			var related = ajaxart.run([group[item].Item],profile,'Relation',context);
  			for(var i=0;i<related.length;i++)
  			{
  				var related_id = aa_text([related[i]],profile,'Identifier',context);
  				if (!group[related_id]) {
  					group[related_id] = { id: related_id, Item: related[i], RefCount: 0};
  					new_items.push(related_id);
  				}
				if (has_log) log += '<rel from="' + item + '" to="' + related_id + '"/>\n';
  			}
  		}
  		return new_items;
  	};
  	for(var count = 0;new_items.length > 0 && count < max_depth;count++) {
  		new_items = expand(new_items);
  	}
  	if (count >= max_depth) 
  		ajaxart.log("expand error. more than " + max_depth + " levels deep");
  	
  	var out=[];
	for(item in group)
	 	if (group.hasOwnProperty(item))
			out.push(group[item]);
	ajaxart.writevalue(log_relations_to,[ajaxart.totext_array(log_relations_to) + log]);
  	return out;
  },
  CountUnique: function(profile,data,context)
  {
	  var out = 0;
	  var uniques = {};
	  for(var i=0; i<data.length; i++)
	  {
		  var key = '' + data[i];
		  if (uniques[key]) continue;
		  uniques[key] = true;
		  out++;
	  }
	  return [out];
  },
  MakeUniqueAndCount: function (profile,data,context)
  {
  	var item_count = {};
  	var out = [];
  	ajaxart.each(data,function(item) {
      var id = ajaxart.totext_item(item);
      var used = true;
      if (item_count[id] == null)
    	  item_count[id] = 0;
      item_count[id]++;
  	});
  	for (x in item_count)
  	{
	  if (!item_count.hasOwnProperty(x)) continue;
  	  var it = { };
  	  it.text = x;
  	  it.count = item_count[x];
  	  out.push(it);
  	}
  	out.sort(function(a, b) { return a.count - b.count; });
  	return out;
  },
  Struct: function (profile,data,context)
  {
	  return ajaxart.make_array(data,function(item) {
		  var itemProfs = ajaxart.subprofiles(profile,'Item');
		  var out = { isObject: true };
		  ajaxart.each(itemProfs,function(itemProf) {
			  var name = aa_text(data,itemProf,'Name',context);
			  var val = ajaxart.run(data,itemProf,'Value',context);
			  out[name] = val;
		  });
		  return out;
	  },true);
  },
  Aggregate: function (profile,data,context)
  {
   	  var aggProfiles = ajaxart.subprofiles(profile,'Aggregator');
	  
   	  var nextData = data;
   	  ajaxart.each(aggProfiles,function(aggProfile) {
   		  nextData = ajaxart.run(nextData,aggProfile,'',context); 
   	  });
	  return nextData;
  },
  RuntimeObjectType: function (profile,data,context)
  {
	  if (data.length == 0) return ["empty"];
	  if (ajaxart.ishtml_array(data)) return ["html"];
	  if (ajaxart.isxml_array(data)) return ["xml"];
	  if (ajaxart.isObject(data)) return ["struct"];
	  if (data[0].params != null && data[0].vars != null)
		  return ["context"];
	  if (typeof(data[0]) == "function") return ["function"];
	  return ["text"];
  },
  HtmlToCleanText: function (profile,data,context)
  {
	var str = aa_totext(data);
	
	while (str.indexOf('<') > -1) {
		var pos1 = str.indexOf('<');
		var pos2 = str.indexOf('>',pos1);
		if (pos2 > pos1) str = str.substring(0,pos1) + str.substring(pos2+1);
		else return [str];
	}
	return [str];
  },
  ReverseOrder: function (profile,data,context)
  {
  	var out = [];
    ajaxart.each(data,function(item) {
    	out.push(item);
  	});
    out.reverse();
    return out;
  },
  HashPassword: function (profile,data,context)
  {
	  var pwd = ajaxart.totext(data);
	  return [ ajaxart_hashPassword(pwd) ];
  },
  DuplicateNTimes: function (profile,data,context)
  {
  	var times = aa_int(data,profile,'Times',"",context);
  	if (data.length == 0) return [];
  	var out = [];
  	for (var i=0; i<times; i++)
  		out.push( ajaxart.xml.clone( data ) );
  	return out;
  },
  Subtract: function (profile,data,context)
  {
    var list = ajaxart.run(data,profile,'List',context);
    var sub = ajaxart.run(data,profile,'Subtract',context);
    
    var out = [];
    for(var i=0; i<list.length; i++)
    {
    	var item = list[i];
    	var add = true;
    	for(var j=0; j<sub.length; j++)
    	{
    		var subitem = sub[j];
    		if (aa_itemsEqual(item,subitem))
    		{
    			add = false;
    			break;
    		}
    	}
    	if (add) out.push(item);
    }
    return out;
  },
  Sort: function (profile,data,context)
  {
  	var type = aa_text(data,profile,'Type',context);
  	var order = aa_text(data,profile,'Order',context);
  	var sortPath = aa_text(data,profile,'SortByPath',context);
  	var sortAtSource = aa_bool(data,profile,'SortAtSource',context);
  	var hasSortPath = (sortPath != "");
  	
  	var sort_function = function (item1,item2)
  	{
  		if (item1.sortby < item2.sortby) return -1;
  		if (item2.sortby < item1.sortby) return 1;
  		return 0;
  	};
  	var items = [];
  	for(var i=0;i<data.length;i++) {
  		var value="";
  		if (hasSortPath)
  			value = ajaxart.totext( aa_xpath(data[i],sortPath) );
  		else
  			value = aa_text([data[i]],profile,'SortBy',context);
  		
  		if (type == "number") value = Number(value);
  		if (type == "date") value = aadate_date2int(value);
  		items.push( { data : data[i], sortby : value } );
  	};
  	items.sort(sort_function);
  	if (order == 'Descending')
  		items = items.reverse();
  	var out = [];
  	ajaxart.each(items,function(item) {
  		out.push(item.data);
  	});
  	if (sortAtSource)
  	{
  		// check for same xml parent
  		var parent = null;
  		for (var i=0;i < items.length; i++)
  		{
  			var new_parent = items[i].data.parentNode;
  			if (new_parent != parent && i != 0) return out;
  			parent = new_parent;
  			if (parent == null || parent == undefined) return out;
  		}
  		
  		// remove and add as sorted
  		for (var i=0;i < items.length; i++)
  			parent.removeChild(items[i].data);
  		for (var i=0;i < items.length; i++)
  			parent.appendChild(items[i].data);
  	}	
  	return out;
  },
  VariableValue: function (profile,data,context)
  {
  	var variable = aa_text(data,profile,'Variable',context);
  	return ajaxart.getVariable(context,variable);
  },
  RoundCents: function (profile,data,context)
  {
	  var str = "" + Math.round(data[0] * 100);
	  return [str.substring(0, str.length - 2) + "." + str.substring(str.length - 2, str.length)];
  },

  CreateIfDoesNotExist: function (profile,data,context)
  {
	  var result = ajaxart.run(data,profile,'Query',context);
	  if (result.length > 0) return result;
	  ajaxart.run(data,profile,'Create',context);
	  var result = ajaxart.run(data,profile,'Query',context);
	  if (result.length == 0) ajaxart.log('CreateIfDoesNotExist - Create does not make query ');
	  return result;
  },
  ReplaceItemByIndex: function(profile, data, context) {
	  var index = aa_int(data,profile,'Index',context);
	  var newItem = aa_first(data,profile,'NewItem',context);
	  if (index < 1 || index > data.length || newItem == null) return data;
	  var out = [];
	  for(var i=0;i<data.length;i++)
		  if (i == index-1) out.push(newItem); else out.push(data[i]);
	  
	  return out;
  },
  IsInCommaSeparatedList: function (profile,data,context)
  {
  	var sep = aa_text(data,profile,'Separator',context);
  	var items = aa_text(data,profile,'Item',context).split(sep);
  	var list = ',' + aa_text(data,profile,'List',context) + ',';
  	for(var i=0;i<items.length;i++)
  		if (list.indexOf(','+items[i]+',') != -1) return ["true"];
  	return [];
  },
  CreateNumbers: function (profile,data,context)
  {
    var from = aa_int(data,profile,'From',context);
    var to = aa_int(data,profile,'To',context);
    
    if (to < from) return [];
    var out = [];
    for(var i=from;i<=to;i++) out.push(i);
    
    return out;
  },
  ByIndexFromList: function(profile, data, context) 
  {
    var items = ajaxart.run(data,profile,'List',context);
    var index = aa_int(data,profile,'Index',context);
    var base = aa_text(data,profile,'Base',context);
    if (base == "0-Based Index" && index < items.length)
    	return [items[index]];
    if (base == "1-Based Index" && index-1 < items.length)
    	return [items[index-1]];
    return [];
  },
  BuildCategories : function(profile, data, context) {
		var categories = ajaxart.run(data,profile,'Categories',context);
		var sep = aa_text(data,profile,'Separator',context);
		
		var result = [];
		for (var i=0;i<categories.length;i++)
		{
			var category = categories[i];
			var items = category.split(sep);
			var inner_result = result;
			for(var j=0;j<items.length;j++)
			{
				var item = items[j];
				if (inner_result[item] == null)
					inner_result[item] = [];
				inner_result = inner_result[item];
			}
		}
		return result;
	},
	  NextLevelCategory : function(profile, data, context) {
		var categories = ajaxart.run(data,profile,'Categories',context);
		var parent = aa_text(data,profile,'Parent',context);
		var sep = aa_text(data,profile,'Separator',context);
		
		var inner_category = categories;
		var items = parent.split(sep);
		for(var j=0;j<items.length;j++)
		{
			var item = items[j];
			if (item.length > 0)
				inner_category = inner_category[item];
		}

		var result = [];
		if (parent.length == 0)
		{
			for (var i in inner_category)
				if (inner_category.hasOwnProperty(i))
					if (i != null && i != undefined)
						result.push(i);
		}
		else
		{
			for (var i in inner_category)
				if (inner_category.hasOwnProperty(i))
					result.push(parent + sep + i);
		}

		return result;
	},
   RunNativeHelperTest: function (profile,data,context)
   {
	  var txt = ajaxart.totext(ajaxart.runNativeHelper(data,profile,'FullName',context));
	  return ["name: " + txt];
   },
  Duplicate: function (profile,data,context)
  {
	  if (data.length == 0) return [];
	  var item = data[0];
	  if (typeof(item) == 'string' || typeof(item) == 'number' )
		  return [ "" + item ];
	  if (ajaxart.isxml_item(item) && item.nodeType == 1)// xml element
		  return [aa_parsexml(ajaxart.xml2text(item))];
		  //return [ ajaxart.xml.clone(data) ];
	  if (ajaxart.isxml_item(item) && item.nodeType == 2)// xml attribute : duplicate to string
		  return [ ajaxart.xml.clone(data) ];
	  // handle struct ...
	  return data;
  },
  StructEntryNames: function (profile,data,context)
  {
	  if (!ajaxart.isObject(data)) return [];
	  var out = [];
	  for (i in data[0])
		  if (data[0].hasOwnProperty(i) && i != 'isObject' && i != 'XtmlSource')
			  out.push(i);
	  return out;
  },
  BrowserTitle: function (profile,data,context) {
  	return [document.title];
  },
  MeasureCalculationTime: function (profile,data,context)
  {
		var before = new Date().getTime();
		var out = ajaxart.run(data,profile,'Calculation',context);
		var time_passes = new Date().getTime() - before;
		var obj = aa_first(data,profile,'PutTimeInObject',context);
		var property = aa_text(data,profile,'PutTimeInProperty',context);
		if (obj != null && property != "")
			obj[property] = [time_passes];
		return out;
  }
});

aa_gcs("js", {
  JavaScript: function (profile,data,context)
  {
		var scriptNode = ajaxart.childElem(profile,'Javascript');
		if (!scriptNode) return [];
		var code = aa_cdata_value(scriptNode) || ajaxart.xml.innerTextStr(scriptNode);
		var ret = aa_run_js_code(code,data,context);
		if (!ret) return [];
		if (typeof(ret) == 'string') return [ret];
		if (typeof(ret) == 'number') return [""+ret];
		if (typeof(ret) == 'boolean')
			return ret ? ['true'] : []
		if (aa_isArray(ret)) return ret;
		return [ret];
  }
});

aa_gcs("data_items", {
	LoadFullItem: function (profile,data,context)
	{
		var item = aa_first(data,profile,'Item',context);
		if (!item) return;
		var dataitems = aa_first(data,profile,'DataItems',context);
		if (dataitems && dataitems.LoadFullItem) 
			dataitems.LoadFullItem([item],context)
		else 
		{
		  var info = aa_getXmlInfo(item,context);
		  if ( info && info.LoadFullItem ) info.LoadFullItem([item],context);
		}
	},
	DoSave: function (profile,data,context)
	{
		var data_items = aa_first(data,profile,'DataItems',context);
		var fields = ajaxart.run(data,profile,'Fields',context);
		ajaxart_dataitems_save(data_items,fields,context,function(){
			ajaxart.run(data,profile,'OnSuccess',context);
		});
		
		return [];
	},
	Filter: function (profile,data,context)
	{
		var data_items = ajaxart_dataitem_getItems(context);
		var originalItems = data_items.Items;
		var items = [];
		for(var i=0;i<originalItems.length;i++)
		{
			var item = originalItems[i];
			if (aa_bool([item],profile,'Filter',context))
				items.push(item);
		}
		data_items.Items = items;

		return [];
	},
	Aspects: function (profile,data,context)
	{
		ajaxart.runsubprofiles(data,profile,'Aspect',context);
		return [];
	},
	Writable: function (profile,data,context)
	{
		var obj = ajaxart_dataitem_getItems(context);
		ajaxart_addScriptMethod(obj,'SubsetForNewItem',profile,'SubsetForNewItem',context);
		ajaxart_addScriptMethod(obj,'DeleteItem',profile,'DeleteItem',context);
		ajaxart_addScriptMethod(obj,'CanAcceptExternal',profile,'CanAcceptExternal',context);
		
		// TODO: let Shai look at it and hear his opinion
		var myFunc = function(obj) { return function(data1,context1) {
			ajaxart_async_Mark(context1);
			ajaxart_RunAsync(data1,ajaxart.fieldscript(profile,'DeleteItem'),context1,function (data2,context2) {
				var newValue = [];
				if (obj.Value != null && data1.length > 0 && data1[0].nodeType == 1) {
				  var id = data1[0].getAttribute('id');
				  for(var i=0;i<obj.Value.length;i++) {
					  if (obj.Value[i].getAttribute == null || obj.Value[i].getAttribute('id') != id)
					    newValue.push( obj.Value[i] );
				  }
				  
				  obj.Value = newValue;
				}
				ajaxart_async_CallBack(data2,context2);
			}); 
			return [];
		} };
		ajaxart_addScriptParam_js(obj,'DeleteItem',myFunc(obj),context);
		
		if (ajaxart.fieldscript(profile,'NewValueFromDetached') != null)
			aa_addLightMethod(obj,'NewValueFromDetached',profile,'NewValueFromDetached',context);
		
		return [];
	},
	NextLevel: function (profile,data,context)
	{
		var obj = ajaxart_dataitem_getItems(context);
		ajaxart_addScriptMethod(obj,'NextLevel',profile,'NextLevel',context);
		return [];
	},
	RecursiveNextLevel: function (profile,data,context)
	{
		var obj = ajaxart_dataitem_getItems(context);
		var nextlevel = function(data1,ctx)
		{
			var items = ajaxart.run(data1,profile,'NextLevel',context);
			if (items.length > 0)
			  aa_addControlMethod_js(items[0],'NextLevel',nextlevel,context);
			return items;
		}
		aa_addControlMethod_js(obj,'NextLevel',nextlevel,context)
	},
	OverrideItems: function (profile,data,context)
	{
		var out = ajaxart.run(data,profile,'Items',context);
		var newContext = aa_ctx(context,{_Items: out} );
		ajaxart.runsubprofiles(data,profile,'Aspect',newContext);

		return out;
	},
	Permission: function (profile,data,context)
	{
		var obj = ajaxart_dataitem_getItems(context);
		var perm = aa_text(data,profile,'Permission',context);
		if (perm == "read only") obj.ReadOnly = ["true"];
	}
});

ajaxart_dataitem_getItems = function(context) {
	  var field = context.vars['_Items'];
	  if (field == null || field.length == 0) return null;
	  return field[0];
	}

function ajaxart_hashPassword(pwd)
{
  if (pwd == "") return "";
  var num = 0;
  for(var i=0;i<pwd.length;i++)
    num += ( pwd.charCodeAt(i) * i*i );
	  
  return "" + num;
}
function eval_math_formula(formula,digits)
{
	  try
	  {
		  eval('var val = ' + formula);
		  if (typeof(val) != 'number')
			  return Number.NaN;
		  var num = val;
		  if (digits)
		  {
			  var base = Math.pow(10,digits);
			  num = Math.round(base * val) / base;
		  }
		  return num;
	  }
	  catch(e)
	  {
		  return Number.NaN;
	  }
}
function aa_xmlitem_byid(items,id)
{
	for (var i=0;i<items.length;i++)
		if (items[i].getAttribute('id') == id)
			return items[i];
	return null;
}

function aa_aggregate_Sum(cells)
{
	var sum = 0;
	var not_numbers = false;
	for(var i=0;i<cells.length;i++)
	{
		var val = parseInt(ajaxart.totext_item(cells[i]));
		if (! isNaN(val))
			sum += val;
		else
			not_numbers = true;
	}
	return not_numbers ? '' : '' + sum;
}
function aa_aggregate_Average(cells)
{
	var sum = aa_aggregate_Sum(cells);
	if (sum == '') return '';
	return '' + Math.floor(sum * 100/cells.length) / 100;
}
function aa_aggregate_Count(cells)
{
	return '' + cells.length;
}
function aa_aggregate_Concat(cells)
{
	return jQuery(cells).map(function() { return ajaxart.totext_item(this) } ).get().join(", ");
}

function aa_csv_toggle(list,item)
{
	if (list.indexOf(',' + item +',') == -1)
		return list + item + ',';
	return list.replace(',' + item +',',',');
}

function aa_CSVValByRef(att,index) { aa_init_CSVValByRef(); this.att = att; this.arr = att.nodeValue.split(','); this.index = index}
function aa_init_CSVValByRef() {
	if (aa_CSVValByRef.prototype.GetValue) return;
	aa_CSVValByRef.prototype.GetValue = function() { return this.arr[this.index]; }
	aa_CSVValByRef.prototype.WriteValue = function(val) { 
		this.arr[this.index] = val;
		this.att.nodeValue = this.arr.join(',');
	}
	aa_CSVValByRef.prototype.ParentNode = function() { return this.att }
}

ajaxart.unique_number = 1;

function aa_switch(profile,data,context)
{
	var value = aa_text(data,profile,"Value",context);
	var cases = ajaxart.subprofiles(profile,'Case');
	for (var i=0; i<cases.length; i++) {
		var pass = (value != "") && (value == aa_text(data,cases[i],'If',context));
		if (!pass)
			pass = aa_bool(data,cases[i],'IfCondition',context);
		if (pass)
			return ajaxart.run(data,cases[i],'Then',context);
	}
	return ajaxart.run(data,profile,'Default',context);
}

function aa_ifThenElse(profile,data,context)
{
	if (aa_bool(data,profile,'If',context))
		return ajaxart.run(data,profile,'Then',context);
	else
		return ajaxart.run(data,profile,'Else',context);
}

function aa_valueFromCookie(name) {
	if (name == "") return null;
	var nameEQ = name + "=";
	var ca = document.cookie.split(';');
	for(var i=0;i < ca.length;i++) {
		var c = ca[i];
		while (c.charAt(0)==' ') c = c.substring(1,c.length);
		if (c.indexOf(nameEQ) == 0) return decodeURIComponent(c.substring(nameEQ.length,c.length));
	}
	return null;	
}

function aa_writeCookie(cookie,value) {
		var val = encodeURIComponent( value );
		cookie = encodeURIComponent(cookie);
		if (cookie == "") return;
		
	 	 var date = new Date();
		 date.setMonth(date.getMonth()+1);
			  
		 if (cookie != "") 
		   document.cookie = cookie+"="+val+";"+" expires="+date.toUTCString();	
}
function aa_cleanCookies(prefix) {
	var ca = decodeURIComponent(document.cookie).split(';');
	for(var i=0;i < ca.length;i++) {
		var c = ca[i];
		while (c.charAt(0)==' ') c = c.substring(1,c.length);
		if (c.indexOf(prefix) == 0) aa_writeCookie(c.split('=')[0],'');
	}
}

function aa_csv_splitLine(line) {
	return line.split(','); // TODO: handle escaping
}
function aa_csv_constructLine(arr) {
	return arr.join(','); // TODO: handle escaping
}

function aa_arrayUnique(arr,idFunc) {
	idFunc = idFunc || function(a) { return a;}
	var added = {},out=[];
	arr.forEach(function(a) {
		var k = ''+idFunc(a);
		if (!added[k]) out.push(a);
		added[k] = true;
	})
	return out;
}


ajaxart.gcs.object =
{
  IsObject: function (profile,data,context)
  {
		if (data.length == 0) return [];
		return ajaxart.isObject(data[0]) ? ["true"] : [];
  },
  Object: function (profile,data,context)
  {
	  var out = { };
	  var elem = profile.firstChild;
	  while (elem != null)
	  {
		  if (elem.nodeType == 1) 
		  {
			  var tag = elem.tagName;
			  var name = elem.getAttribute('name');
			  if (name == null || name == "") { elem = elem.nextSibling;  continue; }
			  
			  if (tag == 'Property') {
				  out[name] = ajaxart.run(data,elem,'',context);
			  } else if (tag == 'SingleProperty') {
				  out[name] = aa_first(data,elem,'',context);
			  } else if (tag == 'TextProperty') {
				  out[name] = aa_text(data,elem,'',context);
			  } else if (tag == 'IntegerProperty') {
				  out[name] = aa_int(data,elem,'',context);
			  } else if (tag == 'BooleanProperty') {
				  out[name] = aa_bool(data,elem,'',context);
			  } else if (tag == 'Method') {
				  aa_addMethod(out,name,elem,'',context);
			  }
		  }
	    elem = elem.nextSibling;
	  }
		var atts = profile.attributes;			// adding attributes as properties
		for (var i=0; i < atts.length; i++) {
			var att_name = atts.item(i).nodeName;
			if (att_name != "t" && att_name != "value" && att_name != 'Data' && att_name != "name" && att_name != "Trace")
				out[att_name] = ajaxart.totext_array(ajaxart.dynamicText(data,atts.item(i).nodeValue,context));
		}
			
	  return [out];
  },
  ExtendObject: function (profile,data,context)
  {
	  var overrides = ajaxart.gcs.object.Object(profile,data,context)[0];
	  var out = aa_first(data,profile,'Object',context);
	  if (out == null) return [];
	  for(var i in overrides)
		if (overrides.hasOwnProperty(i))
		  out[i] = overrides[i];
	  
	  var addToProperty = aa_xpath(profile,'AddToProperty');
	  for(var i=0;i<addToProperty.length;i++) {
		  var name = addToProperty[i].getAttribute('name');
		  out[name] = out[name] || [];
		  ajaxart.concat(out[name],ajaxart.run(data,addToProperty[i],'',context));
	  }
	  
	  return [out];
  },
  ObjectFromParams: function (profile,data,context)
  {
	  var out = { isObject: true };

	  for(var i in context.params) {
	 	if (!context.params.hasOwnProperty(i)) continue;
		  var name = i;
		  var val = context.params[i];
		  if (val.isParamScript == true) {
			  out[name] = val;
			  out[name].context = context.componentContext;
		  }
		  else
		    out[name] = val;
	  }
	  
	  var elem = profile.firstChild;
	  while (elem != null)
	  {
		  if (elem.nodeType == 1) 
		  {
			  var tag = elem.tagName;
			  var name = elem.getAttribute('name');
			  if (name == null || name == "") { elem = elem.nextSibling;  continue; }
			  
			  if (tag == 'Property') {
				  out[name] = ajaxart.run(data,elem,'',context);
			  } else if (tag == 'Method') {
				  out[name] = { script: elem , context: context, objectForMethod: [out], compiled: ajaxart.compile(elem,'',context,elem.getAttribute("paramVars")) };
			  }
		  }
	    elem = elem.nextSibling;
	  }

	  return [out];
  },
  Clone: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  if (obj == null) return [];
	  var out = {}
	  for(var i in obj) 
		if (obj.hasOwnProperty(i))
	  		out[i] = obj[i];
	  return [out];
  },
  HasMethod: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var method = aa_text(data,profile,'Method',context);
	  if (obj != null && obj[method] != null) return ["true"];
	  return [];
  },
  FastRunMethod: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var method = aa_text(data,profile,'Method',context);
	  if (obj == null || method == "" || typeof(obj[method]) != 'function') return [];
	  return obj[method](data,context);
  },
  RunMethod: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var method = aa_text(data,profile,'Method',context);
	  var input = data;
	  if (profile.getAttribute("Input") != null || aa_xpath(profile,'Input').length > 0)
        input = ajaxart.run(data,profile,'Input',context);
	  
	  if (obj == null) return [];
	  var scriptParam = obj[method];
	  if (scriptParam == null) return [];
	  var newContext = context;

	  var params = aa_xpath(profile,'Param');
	  if (params.length > 0) newContext = ajaxart.clone_context(context);
	  for(var i=0;i<params.length;i++)
		  newContext.vars[params[i].getAttribute('name')] = ajaxart.run(data,params[i],'',newContext); 

	  if (typeof(scriptParam) == "function") return scriptParam.call(obj,input,newContext);
	  return ajaxart.runScriptParam(input,scriptParam,newContext);
  },
  SetProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  if (obj == null || prop == "") return [];
	  if (aa_bool(data,profile,'IsSingleProperty',context))
		obj[prop] = aa_first(data,profile,'Value',context);
	  else
	    obj[prop] = ajaxart.run(data,profile,'Value',context);
	  
	  return ["true"];
  },
  ClearProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  if (obj && prop) delete obj[prop];
  },
  SetTextProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  if (obj == null || prop == "") return [];
	  obj[prop] = aa_text(data,profile,'Value',context);
  },
  SetNumericProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  if (obj == null || prop == "") return [];
	  obj[prop] = aa_int(data,profile,'Value',context);
  },
  SetBooleanProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  if (obj == null || prop == "") return [];
	  obj[prop] = aa_bool(data,profile,'Value',context);
	  
	  return ["true"];
  },
  SetMethod: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var method = aa_text(data,profile,'Method',context);
	  if (obj == null || method == "") return [];

	  var cmpl = ajaxart.compile(profile,'Xtml',context,'');
	  if (cmpl == "same") { 
		  obj[method] = function(data1) { return data1;} 
	  }
	  else if (cmpl != null) {
		  var methodFunc = function(obj,cmpl) { return function(data1,ctx) {
			  var newContext = aa_merge_ctx(context,ctx);
			  newContext._This = obj;
			  return cmpl(data1,newContext);
		  }}
		  obj[method] = methodFunc(obj,cmpl);
	  }
	  else {
		  var methodFunc = function(obj) { return function(data1,ctx) {
			  var newContext = aa_merge_ctx(context,ctx);
			  newContext._This = obj;
			  return ajaxart.run(data1,profile,'Xtml',newContext);
		  }}
		  obj[method] = methodFunc(obj);
	  }
	  
	  return ["true"];
  }, 
  AddToProperty: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  var prop = aa_text(data,profile,'Property',context);
	  var value = ajaxart.run(data,profile,'Value',context);
	  if (obj == null || prop == "") return [];
	  if (obj[prop] == null) obj[prop] = [];
	  ajaxart.concat(obj[prop],value);
	  
	  return ["true"];
  }
}


function aa_addLightMethod(object,method,profile,field,context,paramVars)
{
	var fieldscript = (field == "") ? profile : ajaxart.fieldscript(profile,field,true);
	
    object[method] = { 
      script: fieldscript , context: context, 
      compiled: ajaxart.compile(fieldscript,'',context,paramVars) 
    };
}
function aa_setMethod(object,method,profile,field,context)
{
	var compiled = ajaxart.compile(profile,field,context);
	var init = function(compiled) {
		object[method] = function(data1,ctx) {
			var newContext = aa_merge_ctx(context,ctx);
			newContext._This = object;
			if (compiled == "same") return data1; 
			else if (compiled) 
			  return compiled(data1,newContext);
			else
			  return ajaxart.run(data1,profile,field,newContext);
		}
	}
	init(compiled);
}
function aa_addMethod(object,method,profile,field,context,moreVars)
{
	var compiled = ajaxart.compile(profile,field,context);
	if (compiled == "same") { object[method] = function(data1) { return data1; }; return;}
	var init = function(compiled) {
		object[method] = function(data1,ctx) {
			var newContext = aa_merge_ctx(context,ctx,moreVars);
			newContext._This = object;
			if (compiled) 
			  return compiled(data1,newContext);
			else
			  return ajaxart.run(data1,profile,field,newContext);
		}
	}
	init(compiled);
//	var fieldscript = (field == "") ? profile : ajaxart.fieldscript(profile,field,true);
//	
//    object[method] = { 
//      script: fieldscript , context: context, objectForMethod: [object],
//      compiled: ajaxart.compile(fieldscript,'',context,paramVars) 
//    };
}

function aa_addMethod_js(object,method,jsFunc,context)
{
	object[method] = {	context: context , compiled: jsFunc, objectForMethod: [object] };
}

function aa_runMethod(data,object,method,context)
{
	if (!object || !method ) return [];
	var scriptParam = object[method];
	if (scriptParam == null) return [];
	if (typeof(scriptParam) == "function") return scriptParam.call(object,data,context);
	if (scriptParam.compiled == "same") return data;

	var newContext = { params: scriptParam.context.params 
			, vars: context.vars
			, componentContext: scriptParam.context.componentContext} // TODO: avoid this if paramVars == ""
	
	newContext._This = object;
	
	if (scriptParam.compiled) 
	  return scriptParam.compiled(data,newContext);
  else
    return ajaxart.run(data,scriptParam.script,"",newContext);
	
	return [];
}



aa_gcs("fld_type", {
	Date: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data,profile,'Style',context);
		field.FieldType = 'date';
		field.DateStorageFormat = aa_text(data,profile,'StorageFormat',context);
		field.DateDisplayFormat = aa_text(data,profile,'DisplayFormat',context);
		field.DateConverter = aa_first(data,profile,'DateConverter',context);

		field.Control = function(field_data,ctx) {
			ctx = aa_merge_ctx(context,ctx);
			var date = {
				value: aa_totext(field_data)
			};			
			date.valueInMillis = field.DateConverter.ToMillis(date.value,field.DateStorageFormat);
			date.displayText = field.DateConverter.FromMillis(date.valueInMillis,field.DateDisplayFormat);

			return [aa_renderStyleObject2(field.Style,date,field_data,field,ctx)];
		};

		field.SortType = {
	    compileValue: function(value) {
	        return field.DateConverter.ToMillis(aa_totext(value),field.DateStorageFormat);
	    },
	    sort: function(a,b) { return a.value-b.value; }
    };
	}
});

aa_gcs("date", {
		JBartDateConverter: function (profile,data,context) {
			return [{
				ToMillis: function(value,format) {
					if (format == '@') return parseInt(value);
					return aa_moment(value, format).toDate().getTime();
				},
				FromMillis: function(value,format) {
					if (!value) return '';
					if (format == '@') return value;
					return aa_moment(parseInt(value)).format(format);
				}				
			}];
		},
		Now: function (profile,data,context)
		{
			var format = aa_text(data,profile,'Format',context);
			var date = new Date();
			
			var timeZone = aa_text(data,profile,'TimeZone',context); 
			if (timeZone.indexOf('GMT') != -1)
			{
				try
				{
					var offset = parseInt(timeZone.substring(3)); // + date.getTimezoneOffset();
					date = new Date(date.getTime() +  offset * 60000);
				}
				catch(e) {}
			}
			if (format == "std")
			{
				var str = "" + ajaxart.pad2digits(date.getDate()) + '/' + ajaxart.pad2digits(date.getMonth()+1) + '/' + date.getFullYear();
				// str += " " + ajaxart.pad2digits(date.getHours()) + ":" + ajaxart.pad2digits(date.getMinutes());
				return [ str ];
			}
			if (format == "with time")
			{
				var str = "" + ajaxart.pad2digits(date.getDate()) + '/' + ajaxart.pad2digits(date.getMonth()+1) + '/' + date.getFullYear();
				str += " " + ajaxart.pad2digits(date.getHours()) + ":" + ajaxart.pad2digits(date.getMinutes());
				return [ str ];
			}
			if (format == "with time and seconds")
			{
				var str = "" + ajaxart.pad2digits(date.getDate()) + '/' + ajaxart.pad2digits(date.getMonth()+1) + '/' + date.getFullYear();
				str += " " + ajaxart.pad2digits(date.getHours()) + ":" + ajaxart.pad2digits(date.getMinutes()) + ":" + ajaxart.pad2digits(date.getSeconds());
				return [ str ];
			}
				         
			return ["" + date.getTime()];
		},
		GreaterThan: function (profile,data,context)
		{
			var date1 = aa_text(data,profile,'Date',context);
			var date2 = aa_text(data,profile,'GreaterThan',context);
			
			return aa_frombool(aadate_date2int(date1) > aadate_date2int(date2)); 
		}
});

function aa_dateLabel(dateObj) {
	dateObj.$el.text(dateObj.displayText);
}
ajaxart.pad2digits = function(num)
{
  if (num < 10) return "0" + num;
  return "" + num;
};

function str2Int(str)
{
	if (str == null) return 0;
	str = str.replace(/^0*/,'');
	var result = parseInt(str);
	if (isNaN(result))
		return 0;
	return result;
}
function aadate_currentYear()
{
		var d = new Date();
		var year = d.getYear();
		if (year < 1000)
			year += 1900;
		return year;
}
function aadate_currentMonth()
{
		return (new Date().getMonth())+1;
}

function aadate_date2int(date,endOfPeriod)
{
	if (date == null || date == '' || date == 'any') return endOfPeriod ? 10000000000 : 0;
	var result = new Date();
	result.setMinutes(0,0,0);
	if (date == 'today')
		resolution = 'day';

	var datePlusTime = date.split(" ");
	var date_part = datePlusTime[0];
	var parts = date_part.split("/");
	var resolution = '';
	if (parts.length == 1 && str2Int(parts[0]) < 32 && str2Int(parts[0]) > 0) // day only
	{
		result.setDate(str2Int(parts[0]));
		resolution = 'day';
	}
	else if (parts.length == 1 && str2Int(parts[0]) > 32) // year only
	{
		result.setFullYear(str2Int(parts[0]),endOfPeriod ? 11 : 0, endOfPeriod ? 31 : 1);
		resolution = 'year';
	}
	else if (parts.length == 2 && str2Int(parts[1]) < 13) // day and month
	{
		result.setFullYear(aadate_currentYear(),str2Int(parts[1]) -1, str2Int(parts[0]));
		resolution = 'day';
	}
	else if (parts.length == 2 && str2Int(parts[1]) > 1900) // month and year
	{
		result.setFullYear(str2Int(parts[1]),str2Int(parts[0]) -1, 1);
		if (endOfPeriod)
			result.setTime( result.setFullYear(str2Int(parts[1]),str2Int(parts[0]), 1)-1);
		resolution = 'month';
	}
	else if (parts.length == 3) // day month year
	{
		result.setFullYear(str2Int(parts[2]),str2Int(parts[1]) -1, str2Int(parts[0]));
		resolution = 'day';
	}
	result.setHours(0,0,0,0);
	if (datePlusTime.length > 1)
	{
		var times = datePlusTime[1].split(":");
		if (datePlusTime.length > 2 && datePlusTime[2] == 'PM')
			times[0] = '' + (str2Int(times[0]) + 12);
		result.setHours(str2Int(times[0]),str2Int(times[1]),str2Int(times[2]),0);
		resolution = 'minute';
	}
	var result = result.getTime();
	if (endOfPeriod && resolution == 'day')
		result += 86400000 -1;
	return result;
}
function aadate_stdDate2DateObj(date)
{
	var datePlusTime = date.split(" ");
	var date_part = datePlusTime[0];
	var parts = date_part.split("/");
	if (parts.length > 2 && parts[2].length == "2") parts[2] = "20" + parts[2];   // handle 1/1/05 -> 1/1/2005  
	if (datePlusTime.length == 0) return null;
	if (datePlusTime.length == 1)
		var d = new Date(str2Int(parts[2]), str2Int(parts[1],10)-1, str2Int(parts[0],10),0,0,0,0);
	else {
		var times = datePlusTime[1].split(":");
		if (times.length == 3) 
			var d = new Date(str2Int(parts[2]), str2Int(parts[1],10)-1, str2Int(parts[0],10), str2Int(times[0],10), str2Int(times[1],10),str2Int(times[2],10));
		else 
			var d = new Date(str2Int(parts[2]), str2Int(parts[1],10)-1, str2Int(parts[0],10), str2Int(times[0],10), str2Int(times[1],10));
	}
	
	return d;
}
function aadate_dateObj2StdDate(date)
{
	var year = date.getYear();
	if (year < 1000)
		year += 1900;
	var out = date.getDate()+"/"+ (date.getMonth()+1) +"/" + year;
	if (date.getHours() > 0 || date.getMinutes() > 0)
	  out += " " + ajaxart.pad2digits(date.getHours()) + ":" + ajaxart.pad2digits(date.getMinutes());
	return out;
}

function aadate_addToDate(date,amount_to_add,interval)
{
   var multipleBy = 86400000;  // day is default
   if (interval == 'hour') multipleBy = 3600000;
   if (interval == 'minute') multipleBy = 60000;
   if (interval == 'second') multipleBy = 1000;
	
	var d = aadate_stdDate2DateObj(date);
	d.setTime(d.getTime() + (amount_to_add * multipleBy));
	return aadate_dateObj2StdDate(d);
}



aa_gcs("field_feature", {
	HandleEvent: function(profile, data, context) {
		var eventAction = {
			run: function(data1, ctx) {
				var ctx2 = aa_merge_ctx(context, ctx);
				if (ctx2.vars.EventAction) delete ctx2.vars.EventAction;
				ajaxart.run(data1, profile, 'Action', ctx2);
			}
		};
		ajaxart.run(data, profile, 'Event', aa_ctx(context, {
			EventAction: [eventAction]
		}));
	},
	Update: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnUpdate', function(field, field_data, input, e, extra) {
			var ctx1 = (input && input.ajaxart) ? aa_merge_ctx(context, input.ajaxart.params) : context;
			var parent_elem = jQuery(input).parents('.aa_item')[0];
			var item = parent_elem && parent_elem.ItemData;
			var newContext = aa_ctx(ctx1, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input],
				_Item: item || []
			});
			if (extra) newContext = aa_ctx(newContext, extra);

			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	Click: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'ModifyControl', function(cell, field_data, cell_presentation, ctx, item) {
			cell.onclick = function(e) {
				if (window.aa_incapture) return;
				context.vars.EventAction[0].run(field_data, aa_ctx(ctx, {
					ControlElement: [cell.firstChild || cell],
					_DomEvent: [e]
				}));
			};
		}, 'MouseClick');
	},
	Blur: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnBlur', function(field, field_data, input, e, extra) {
			var newContext = aa_ctx(context, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input]
			});
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	KeyDown: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnKeydown', function(field, field_data, input, e, extra) {
			var newContext = aa_ctx(context, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input]
			});
			if (extra && extra.KeyCode) newContext.vars.KeyCode = extra.KeyCode;
			if (extra && extra.CtrlKey) newContext.vars.CtrlKey = extra.CtrlKey;
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	KeyUp: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnKeyup', function(field, field_data, input, e, extra) {
			var newContext = aa_ctx(context, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input]
			});
			if (extra && extra.KeyCode) newContext.vars.KeyCode = extra.KeyCode;
			if (extra && extra.CtrlKey) newContext.vars.CtrlKey = extra.CtrlKey;
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	EnterPressed: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnKeyup', function(field, field_data, input, e, extra) {
			if (aa_totext(extra.KeyCode) != 13 || aa_tobool(extra.CtrlKey)) return;
			var newContext = aa_ctx(context, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input]
			});
			if (extra && extra.KeyCode) newContext.vars.KeyCode = extra.KeyCode;
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	CtrlEnterPressed: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnKeyup', function(field, field_data, input, e, extra) {
			if (aa_totext(extra.KeyCode) != 13 || !aa_tobool(extra.CtrlKey)) return;
			var newContext = aa_ctx(context, {
				_Field: [field],
				_FieldData: field_data,
				_Input: [input],
				ControlElement: [input]
			});
			if (extra && extra.KeyCode) newContext.vars.KeyCode = extra.KeyCode;
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	ControlAttached: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'ModifyControl', function(cell, field_data, cell_presentation, ctx, item) {
			aa_addOnAttachMultiple(cell, function() {
				context.vars.EventAction[0].run(field_data, aa_ctx(ctx,{ ControlElement: [cell.firstChild || cell] }));
			});
		}, 1000);
	},
	BeforeRenderingControl: function(profile, data, context) {
		aa_bind(context.vars._Field[0], 'ModifyInstanceContext', function(args) {
			context.vars.EventAction[0].run(args.FieldData, aa_merge_ctx(context, args.Context));
		});
	},
	AfterRenderingControl: function(profile, data, context) {
		aa_bind(context.vars._Field[0], 'ModifyControl', function(args) {
			context.vars.EventAction[0].run(args.FieldData, aa_merge_ctx(context, args.Context, { ControlElement: [args.Wrapper.firstChild || args.Wrapper]} ));
		});
	},
	Load: function(profile, data, context) {
		context.vars.EventAction[0].run(data, context);
	},
	Focus: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'OnFocus', function(field, field_data, input, e, extra) {
			var newContext = aa_ctx(context, {
				_Input: [input],
				ControlElement: [input]
			});
			context.vars.EventAction[0].run(field_data, newContext);
		});
	},
	MouseOver: function(profile, data, context) {
		aa_field_handler(context.vars._Field[0], 'ModifyControl', function(cell, field_data, cell_presentation, ctx, item) {
			cell.onmouseover = function() {
				if (!cell.isInside) {
					context.vars.EventAction[0].run(field_data, aa_ctx(ctx, {
						ControlElement: [cell]
					}));
				}
				cell.isInside = true;
			};
			cell.onmouseout = function() {
				cell.isInside = false;
			};
		}, 'MouseOver');
	}

});
function aa_clear_jb_classes(elem)
{
    var classes = elem.className.split(' ');
    for(var i=0;i<classes.length;i++)
   	 if (classes[i].indexOf('jb') == 0) 
   		 jQuery(elem).removeClass(classes[i]);
}


function aa_find_field_controls(settings) 
{
/**
 * Finds field instances in the DOM
 *
 * You can look for the dom instances of a field giving its id and search scope
 * @param settings of javascript object with the following properties:
 *   - fieldID
 *   - scope (can be 'screen','parent','siblings'), default is 'screen' 
 *   - result (can be 'content','wrapper'), default is 'content'
 *   - context
 * @return an array of dom elements
 * @example var myButtonElement = aa_find_field_controls({ fieldId: 'my_button', context: context })[0];
 * 
 * @category General
 */
 	settings.result = settings.result || 'content';
	settings.scope = settings.scope || 'screen';
	
	var top = aa_intest ? aa_intest_topControl : document;
	var ctrls = jQuery(top).find(".fld_" + settings.fieldID);

	var cls = "fld_" + settings.fieldID;
	var ctrls = (settings.scope == 'parent') ? jQuery(top).parents('.'+cls).get() : jQuery(top).find('.'+cls).get();
	if (jQuery(top).hasClass(cls)) ctrls.push(top);
	
	if (settings.result == 'content') return ctrls;
	if (settings.result == 'wrapper') {
		var out = [];
		for(var i=0;i<ctrls.length;i++) {
			var wrapper = ctrls[i].parentNode || ctrls[i];
			out.push(wrapper);
		}
		return out;
	}
}
function aa_refresh_cell(cell,context,transition,moreVars,recreateField)
{
   var td = $(cell).hasClass('aa_cell_element') ? cell : jQuery(cell).parents('.aa_cell_element')[0];
   if (!td) return;

   aa_show(td);
   
   var newContext = td.jbContext || (td.jbApiObject && td.jbApiObject.context);
   if (moreVars) newContext = aa_ctx(newContext,moreVars);

   if (td.Refresh) return td.Refresh();
   var field = td.Field;
   if (!field) return;
   if (recreateField) {
      var xtmlSource = field.XtmlSource[0];
      newContext = xtmlSource.context;
      if (moreVars) newContext = aa_ctx(newContext,moreVars);
      field = aa_first(xtmlSource.input,xtmlSource.script,'',newContext);
   } else if (field.Refresh) field.Refresh([],newContext);

   transition = transition || field.TransitionForRefresh;
   var field_data = td.FieldData;
   var item_data = td.ItemData;
   var parent = jQuery(td).parents('.aa_container')[0];
   var cntr = parent ? parent.Cntr : {}; 
   var scrollPos = {x: window.scrollX, y: window.scrollY};
//   newContext = aa_ctx(context,{_Field: [field], FieldTitle: [field.Title], _Item: item_data, _Cntr: [cntr] });
   field_data = ajaxart_field_calc_field_data(field,item_data,newContext);
   
   if (transition && td.childNodes.length == 1) {
     var oldElem = td.firstChild;
     while (td.firstChild) aa_remove(td.firstChild,true);
     jBart.trigger(td,'cleanWrapper',{});
     if (td.jbRefresh) td.jbRefresh();
     ajaxart_field_createCellControl(item_data,cntr,td,td.CellPresentation,field,field_data,newContext);
     var newElem = td.firstChild;
     td.insertBefore(oldElem,td.firstChild);
     transition.replace(oldElem,newElem,context);
   }
   else {
     aa_empty(td,true);
     aa_clear_jb_classes(td);
     aa_clear_events(td);
     jBart.trigger(td,'cleanWrapper',{});
     if (td.jbRefresh) td.jbRefresh();
     
 	 if (field.AsSection && !field.HideTitle) {
 		var section = jQuery(td).parents('.aa_section')[0];
 		if (!section || !section.parentNode) return;
 		td = section.parentNode;
 		aa_empty(td,true);
	    aa_clear_jb_classes(td);
		td.appendChild(aa_buildSectionControl(cntr,field,field_data,item_data,newContext));
	 } else {
	 	 if (td.jbFrom_aa_fieldControl) {
	 	 	aa_fieldControl({Field: field, Wrapper: td, Item: item_data, FieldData:field_data, Context: newContext });
	 	 } else {
		 	ajaxart_field_createCellControl(item_data,cntr,td,td.CellPresentation,field,field_data,newContext);
		 }
	 }
   }
   aa_element_attached(td);
   window.scrollTo(scrollPos.x,scrollPos.y);
}

function aa_find_field_input(wrapper)
{
  if (!wrapper) return null;
	if (wrapper.tagName.toLowerCase() == 'input') return wrapper;
	return jQuery(wrapper).find('input')[0] || jQuery(wrapper).find('.field_control')[0];
}

// settings contains: Field, Item, Wrapper, FieldData (optional), Context
function aa_fieldControl(settings,runAfterAsyncAction) {
    try {
    var field = settings.Field;
    var wrapper = settings.Wrapper;
    wrapper.jbFrom_aa_fieldControl = true;

    var ctx = aa_ctx(settings.Context, { _Field: [field], Item: settings.Item, Wrapper: [wrapper] });

    if (field.AsyncActionRunner && !runAfterAsyncAction) {
    	return field.AsyncActionRunner(settings);
    }

    var field_data = settings.FieldData;
    if (!field_data) field_data = field.FieldData ? field.FieldData(settings.Item, ctx) : settings.Item;

    for (i in ajaxart.xtmls_to_trace) {  // Tracing field data
        if (ajaxart.xtmls_to_trace.hasOwnProperty(i) && field.XtmlSource[0].script == ajaxart.xtmls_to_trace[i].xtml) {
            ajaxart.xtmls_to_trace[i].fieldData = ajaxart.xtmls_to_trace[i].fieldData || [];
            ajaxart.xtmls_to_trace[i].fieldData = ajaxart.xtmls_to_trace[i].fieldData.concat(field_data);
        }
    }
    
    aa_trigger(field,'ModifyInstanceContext',{ Context: ctx, FieldData: field_data});

    aa_extend(wrapper, {
    	Field: field, FieldData: field_data, 
    	ItemData: settings.Item, jbContext: settings.Context
    })
    jQuery(wrapper).addClass('aa_cell_element');
    var contentCtrl;
    try {
        contentCtrl = field.Control && field.Control(field_data, ctx)[0];
    } catch(e) {
        ajaxart.logException(e);
        contentCtrl = document.createElement("DIV");
    }
    if (contentCtrl) { 
      wrapper.appendChild(contentCtrl);
   	  wrapper.jbControl = contentCtrl;
   	  
      jQuery(contentCtrl).addClass('field_control fld_'+field.Id);
      contentCtrl.jbCell = wrapper;
      contentCtrl.Field = field;
    	
	  jBart.trigger(field,'ModifyControl',{ Wrapper: wrapper, FieldData: field_data, Context: ctx, Item: settings.Item });
      if (field.ModifyControl) { 
	    	for (var i = 0; i < field.ModifyControl.length; i++)
	    		field.ModifyControl[i](wrapper, field_data, 'control', ctx, settings.Item);
	  }
    }

    jBart.trigger(field,'ModifyCell',{ Wrapper: wrapper, FieldData: field_data, Context: ctx, Item: settings.Item });
    if (field.ModifyCell) { 
    	for (var i = 0; i < field.ModifyCell.length; i++)
    		field.ModifyCell[i](wrapper, field_data, 'control', ctx, settings.Item);
    }
    
    if (contentCtrl) aa_element_attached(contentCtrl);

    if (settings.DoAfterShow) settings.DoAfterShow(settings);
    } catch(e) {
        ajaxart.logException('error rendering field ' + (settings.Field && settings.Field.Id),e);
    }   
}

aa_gcs("fld_type",{
	Picklist: function (profile,data,context)
	{
		var field = context.vars._Field[0];

		field.RefreshOptions = function(data1,ctx) {
			field.Options = ajaxart.run(data1,profile,'Options',aa_ctx(context,ctx));
		}
		field.Style = aa_first(data,profile,'Style',context);
		field.AllowEmptyValue = aa_bool(data,profile,'AllowEmptyValue',context);
		field.AllowValueNotInOptions = aa_bool(data,profile,'AllowValueNotInOptions',context);
		
		field.Control = function(field_data,ctx) {
			if (field.DelayOptionCalculation) {
				field.Options = [];
				field.Options.delayedCalculation = true;
			} else {
				if (!field.Options) { field.RefreshOptions(data,context); }
			}
			var picklist = {};
			aa_initPicklistObject(picklist,field,field_data,ctx);
			
			var out = jQuery(aa_renderStyleObject(field.Style,picklist,ctx,true)).addClass('aa_picklist').get();
			
			if (!picklist.getValue() && !field.AllowEmptyValue) {
				var code = field.Options && field.Options[0] && field.Options[0].code;
				if (code) {
					ajaxart.writevalue(field_data,code);					
					out = jQuery(aa_renderStyleObject(field.Style,picklist,ctx,true)).addClass('aa_picklist').get();
				}
			}

			return out;		
		};
	}
});

aa_gcs("editable_picklist",{
	OptionsTable: function (profile,data,context)
	{
		return ajaxart.runsubprofiles(data,profile,'Option',context);
	},
	Option: function (profile,data,context)
	{
		return [{
		  code: aa_text(data,profile,'Code',context),
		  text: aa_multilang_text(data,profile,'DisplayName',context),
		  image: aa_text(data,profile,'Image',context)
		}];
	},
	OptionsByCommas: function (profile,data,context)
	{
		var options = aa_text(data,profile,'Options',context).split(',');
		var out = [];
		for(var i=0;i<options.length;i++) {
			var code = ajaxart_multilang_text(options[i],context);
			if (!code) continue;
			out.push({ code: code, text: code });
		}
		return out;
	},
	DynamicOptions: function (profile,data,context)
	{
		var options = ajaxart.run(data,profile,'Options',context);
		var out = [];
		for(var i=0;i<options.length;i++) {
			var option = [ options[i] ];
			out.push({
				code: aa_text(option,profile,'OptionCode',context),
				text: aa_text(option,profile,'OptionDisplayName',context),
				image: aa_text(option,profile,'OptionImage',context) || null,
				base: options[i],
				disabled: aa_bool(option,profile,'IsDisabled',context)
			});
		}
		return out;
	},
	AutoFilterOptions: function (profile,data,context) {
		var options = [];
		var uniqueOptions = {};

		var cntr = context.vars.ItemListCntr[0];
		var filterField = context.vars._Field[0];

		var items = cntr.AllItems || cntr.Items;
		for (var i = 0; i < items.length; i++) {
			var value = aa_totext ( filterField.FilterData( [items[i]] , context ) );
			if (value && !uniqueOptions[value])
				options.push({ code: value, text: value });
			uniqueOptions[value] = true;
		}
		return options;
	},
	SelectedOptionInPopup: function (profile,data,context)
	{
		var picklist = context.vars.ApiObject[0];
		var code = picklist.getValue();
		var items = data;
		for(var i=0;i<items.length;i++)
			if (items[i].code == code) 
				return [items[i]];
	},
	PicklistSelect: function (profile,data,context)
	{
		var option = aa_first(data,profile,'Option',context);
		if (!option) return;
		var picklist = context.vars.ApiObject[0];
		
		var code = option.code;
		picklist.setValue(code,{Option: [option.base]});
		if (picklist.wrapperForStyleByField.jbPopup) picklist.wrapperForStyleByField.jbPopup.close();
		if (picklist.Refresh) picklist.Refresh();

		aa_refresh_cell(picklist.wrapperForStyleByField,context);	// because the picklist is implemented by StyleByField 
	},
	AddValueNotInOptionsToList: function (profile,data,context)
	{
		var cntr = context.vars.ItemListCntr[0];
		var items = cntr.AllItems || cntr.Items;
		// last option is the one not in options
		var optionNotInOptions = items[items.length-1];
		if (!optionNotInOptions || !optionNotInOptions.isValueNotInOptions) {
			optionNotInOptions = { isValueNotInOptions: true }; 
			items.push(optionNotInOptions);
		}
		optionNotInOptions.text = optionNotInOptions.code = aa_text(data,profile,'OptionText',context);
		cntr.RefreshDataColumns();
	}
});

aa_gcs("fld_aspect",{
	PicklistDisplayNameInPicklistBox: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.DisplayNameInPicklistBox = function(data1,ctx) {
			return ajaxart.run(data1,profile,'IdToDisplayName',aa_merge_ctx(context, ctx));
		}
	},
	PicklistProperties: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.HideSearchBox = aa_bool(data,profile,'HideSearchBox',context);
		field.AutoRecalcOptions = aa_bool(data,profile,'AutoRecalcOptions',context);
		field.DelayOptionCalculation = aa_bool(data,profile,'DelayOptionCalculation',context);
		field.CustomPopupContents = aa_first(data,profile,'PopupContents',context);
		field.TextForNoResults = aa_text(data,profile,'TextForNoResults',context);
		field.TextForShowAll = aa_text(data,profile,'TextForShowAll',context);
		field.MaxItemsToShow = aa_int(data,profile,'MaxItemsToShow',context);
		field.TextForEmptyValueInPopup = aa_text(data,profile,'TextForEmptyValueInPopup',context);
		field.TextForEmptyValueInRadio = aa_text(data,profile,'TextForEmptyValueInRadio',context);
		field.SelectOnHover = aa_text(data,profile,'SelectOnHover',context);

		field.OnOpenPopup = function(field_data,ctx) {
			if (field.AutoRecalcOptions || field.Options.delayedCalculation) {
				field.RefreshOptions(field_data,ctx);
				field.Options.delayedCalculation = false;
			}
		};
	},
	HideUnselectedPicklistOptions: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		aa_bind(field,'ModifyControl',function(settings) {
			aa_addOnAttach(settings.Wrapper,function() {
				showhide_fields(settings.Wrapper,settings.FieldData)
			});
		});
		jBart.bind(field,'update', function(settings) {
			showhide_fields(settings.wrapper,settings.FieldData);
		});

		function showhide_fields(wrapper,field_data)
		{
			var selected = ',' + aa_totext(field_data) + ',';
			for(var i=0;i<field.Options.length;i++) {
				var option = ',' + field.Options[i].code +',';
				var show = selected.indexOf(option) != -1;
				showhide_field(wrapper,aa_string2id(field.Options[i].code),show);
			}
		}
		function showhide_field(srcElement,fieldID,show)
		{
			var parent = srcElement.parentNode;
			if (!parent || parent.tagName == 'body') return;
			var ctrls = $(parent).find('.fld_'+fieldID);
			if (show)
				$(ctrls).show();
			else
				$(ctrls).hide();
			if (ctrls.length == 0)
				showhide_field(parent,fieldID,show);
		}
	}
});

aa_gcs("itemlist_filter", {
    Occurrences: function (profile, data, context)
    {
        var field = context.vars._Field[0]; 
        field.OccurrencesStyle = aa_first(data,profile,'Style',context);
        var filteredOccurrences = aa_bool(data,profile,'ShowFilteredOccurrences',context);
        var filterId = field.Id;
	     	var sort = aa_bool(data,profile,'SortByOccurrences',context);

     		field.SortPicklistOptions = function(options,ctx,picklist) {
     			var cntr = ctx.vars.ItemListCntr[0];
     			aa_calculateFilterOccurrences(cntr,filterId,filteredOccurrences);

     			picklist.useFilteredOcc = filteredOccurrences && cntr.FilteredOccurrences[filterId];
     			if (picklist.useFilteredOcc) {
     				// there must be a filter other than our own
     				picklist.useFilteredOcc = false;
     				for(var i in cntr.FilterData || {})
     					if (i != filterId && cntr.FilterData[i]) picklist.useFilteredOcc = true;
     			}

     			for(var i=0;i<options.length;i++) {
     				var code = options[i].code
     				options[i].occ = cntr.Occurrences[filterId][code] || 0;
     				if (picklist.useFilteredOcc) {
     					options[i].filteredOcc = cntr.FilteredOccurrences[filterId][code] || 0;
     				}

     				if (!code && field.AllowEmptyValue) options[i].occ = '300000';
     			}
     			if (sort) {
     				if (picklist.useFilteredOcc) {
            	options.sort(function(a,b) { return b.filteredOcc - a.filteredOcc; });     				
     				} else {
            	options.sort(function(a,b) { return b.occ - a.occ; });     				
            }
     			}

					return options;
     		};

				aa_bind(field,'picklistRenderOption',function(args) {
            var cntr = args.context.vars.ItemListCntr[0];
            var code = args.option.code;
            if (code == '' && field.AllowEmptyValue) return;

            var count = args.option.occ;
            var filteredCount = args.option.filteredOcc;
            
            aa_renderStyleObject2(field.OccurrencesStyle,{ 
                count: count,
                filteredOccurrences: args.picklist.useFilteredOcc,
                filteredCount: filteredCount,
                optionTextEl: args.optionTextEl
            },data,field,args.context,{ funcName: 'add' });
     		},'Occurrences');
    }
});

function aa_picklist_optionByCode(options,code) {
	if (!options) return;
	for(var i=0;i<options.length;i++) {
		if (options[i].code == code) return options[i];
	}
	return null;
}

function aa_initPicklistObject(picklist,field,field_data,context)
{
	if (!field_data || !field_data.length) ajaxart.log("No field data for picklist");

	aa_extend(picklist,{
		apiObjectType: 'picklist',
		Field: field, FieldData: field_data, data: field_data[0],Context: context,context: context,
		field: field, field_data: field_data,
		type: 'picklist',
		getValue: function() {
			return aa_totext(field_data);
		},
		getImage: function() {
			var code = aa_totext(field_data,context);
			var option = aa_picklist_optionByCode(picklist.Field.Options,code);
			return option && option.image;
		},
		setValue: function(newValue,extra,settings) {
			settings = settings || {};
			var oldValue = this.getValue();
			if (oldValue == newValue && !settings.forceUpdate) return;
			ajaxart.writevalue( field_data, newValue );
			var content = this.control; // TODO: fix this
			aa_invoke_field_handlers(field.OnUpdate,content,null,field,field_data,{ OldValue: [oldValue] });
			jBart.trigger(field,'update',{ FieldData: field_data, wrapper: content ? content.parentNode : null, extra: extra });
		},
		totext: function() {
			var code = aa_totext(field_data,context);
			if (this.field.DisplayNameInPicklistBox)
				return aa_totext(this.field.DisplayNameInPicklistBox(field_data,context));

			var option = aa_picklist_optionByCode(picklist.Field.Options,code);
			return option ? option.text : code;
		},
		Refresh: function() {}
	});
}

function aa_picklist_radio_buttons(picklist,settings)
{
  settings = aa_defaults(settings,{
    OptionElement: picklist.$el.find('.aa_option')[0],
    OptionInnerElements: function(optionEl) {
      return {
        RadioElement: jQuery(optionEl).find('.aa_option_radio')[0],
        TextElement: jQuery(optionEl).find('.aa_option_text')[0]        
      }
    }    
  });
  
	aa_global_vars().uniqueRadioCounter = aa_global_vars().uniqueRadioCounter || 0;
	var radioGroup = 'aaradio' + ++aa_global_vars().uniqueRadioCounter;
	var currentValue = picklist.getValue();
	
	var optionTemplate = settings.OptionElement;
	var templateParent = optionTemplate.parentNode;
	
	var options = picklist.Field.Options;

	if (picklist.Field.AllowEmptyValue && settings.addRadioButtonForEmptyValue)
		options = [{ code: '', text: picklist.field.TextForEmptyValueInRadio || 'none' }].concat(options);

	for(var i=0;i<options.length;i++) {
		var option = options[i];
		var optionElem = optionTemplate.cloneNode(true);
		var optionSettings = settings.OptionInnerElements(optionElem);
		optionElem.jbOption = option;
		if (optionSettings.TextElement) { 
			optionSettings.TextElement.innerHTML = option.text; 
			optionSettings.TextElement.jbRadio = optionSettings.RadioElement; 
			optionSettings.TextElement.jbOption = option;
			if (i == options.length-1) $(optionElem).addClass('aa_last');

			if (option.disabled) {
				$(optionElem).addClass('disabled');
			} else {
				optionSettings.TextElement.onclick = function() {
					$(this.jbRadio).click();
				};
			}
		}
		if (optionSettings.RadioElement) {
			optionSettings.RadioElement.setAttribute('name',radioGroup);
			optionSettings.RadioElement.jbOption = option;
			optionSettings.RadioElement.onclick = function(){
				if ($(this).closest('.aa_disabled')[0]) return;
        $(this).parents('.aa_option').siblings().removeClass('selected');
        $(this).parents('.aa_option').addClass('selected');
				picklist.setValue(this.jbOption.code);
			};
		}
			
    if (currentValue == option.code) {
    	optionSettings.RadioElement.setAttribute('checked','checked');
     	$(optionSettings.RadioElement).parents('.aa_option').addClass('selected');
    }        
		
		$(optionTemplate).before(optionElem);
	}	
	templateParent.removeChild(optionTemplate);
}


function aa_picklist_open_options(picklist,settings)
{
	settings = aa_defaults(settings,{
		OptionElement: picklist.$el.firstOfClass('aa_option'),
		OptionInnerElements: function(optionElem) {
			return {
				TextElement: $(optionElem).firstOfClass('aa_option_text'),
				ImageElement: $(optionElem).firstOfClass('aa_option_image')
			};
		}
	});

	var currentValue = picklist.getValue();
	
	var optionTemplate = $(settings.OptionElement)[0];
	var templateParent = optionTemplate.parentNode;
	
	var options = picklist.Field.Options;
	for(var i=0;i<options.length;i++) {
		var option = options[i];
		var optionElem = optionTemplate.cloneNode(true);
		var optionSettings = settings.OptionInnerElements(optionElem);
		optionElem.jbOption = option;
		$(optionSettings.TextElement).text(option.text);

		aa_setImage($(optionSettings.ImageElement)[0],option.image,false);
		
		$(optionElem).click(function(){
			setSelected(this,true);
		});
		
		if (currentValue == option.code) setSelected(optionElem);
		
		$(optionTemplate).before(optionElem);
		if (i == options.length-1) $(optionElem).addClass('last');
		if (option.disabled) $(optionElem).addClass('disabled');
	}	
	templateParent.removeChild(optionTemplate);

	function setSelected(optionElem,alsoUpdate) {
		if (optionElem.jbOption.disabled) return;

		if (alsoUpdate) {
			picklist.setValue(optionElem.jbOption.code);
		}
		$(optionElem).siblings().removeClass('selected');
		$(optionElem).addClass('selected');
	}
}


function aa_picklist_native_combo(picklist,settings)	// used by native combo style
{
	settings.OnOptionElem = settings.OnOptionElem || function() {};
	settings.Element = settings.Element || picklist.control;
	
	var element = settings.Element;
	var currentOption = picklist.getValue();
	
	var field = picklist.Field;
	var options = field.Options;
	if (field.AllowEmptyValue)
		jQuery('<option/>').appendTo(element);
	for(var i=0;i<options.length;i++) {
		var option = options[i];
		var optionElem = jQuery('<option/>')[0];
		optionElem.value = option.code;
		optionElem.innerHTML = option.text;
		if (option.disabled) optionElem.setAttribute('disabled','disabled');

		settings.OnOptionElem(optionElem,option);
		element.appendChild(optionElem);
	}
	element.value = currentOption;
	
	element.onchange = function() {
		var field_data = picklist.FieldData;
		var newValue;
		var index = element.selectedIndex;
		if (field.AllowEmptyValue)	// first option is the empty value
			index--;
		if (index == -1) 
			newValue = "";	// empty value
		else 
			newValue = options[index].code;
		picklist.setValue(newValue);
	};
}

function aa_picklist(picklist,settings) {
	settings = settings || {};
	settings.baseElement = settings.baseElement || picklist.$el.firstOfClass('aa_picklist_div');
	settings.textElement = settings.textElement || picklist.$el.firstOfClass('aa_picklist_text');
	settings.imageElement = settings.imageElement || picklist.$el.firstOfClass('aa_picklist_image');
	settings.popupElement = settings.popupElement || picklist.$el.firstOfClass('aa_picklist_popup');
	settings.popupInputElement = settings.popupInputElement || picklist.$el.firstOfClass('aa_picklist_popup_input');	
	settings.popupNoResultsElement = settings.popupNoResultsElement || picklist.$el.firstOfClass('aa_picklist_no_results');	
	settings.popupShowAllElement = settings.popupShowAllElement || picklist.$el.firstOfClass('aa_picklist_show_all');	
	settings.popupItemElement = settings.popupItemElement || picklist.$el.firstOfClass('aa_picklist_item');	
	settings.imageWidth = settings.imageWidth || 16;
	settings.imageHeight = settings.imageHeight || 16;
	settings.longTextLength = settings.longTextLength || 20;

	settings.popupItemSettings = settings.popupItemSettings || function(itemElement) {
		return {
			itemTextElement: $(itemElement).firstOfClass('aa_picklist_item_text'),
			itemImageElement: $(itemElement).firstOfClass('aa_picklist_item_image')
		};
	};
	settings.maxItemsToShow = picklist.field.MaxItemsToShow || 50;

	settings.search = settings.search || aa_searchbox_search; // for Compress: aa_searchbox_search()

	var $base = $(settings.baseElement);
	var $popupItemParent = $(settings.popupItemElement).parent();
	var $popupItemTemplate = $(settings.popupItemElement).remove();
	var $input = null;
	var disableSelectionOnHover = false;

	initPopup();

	$base.click(function() {
		if (!ajaxart.isattached(picklist.selectorPopup.el))
			openPopup();
		else
			picklist.selectorPopup.close();
	});
	refreshPicklistBase();

	function refreshPicklistBase() {
		var imageObject = aa_create_static_image_object(picklist.getImage());
		if (imageObject && imageObject.url) {
			imageObject.keepImageProportions = imageObject.fillImage = imageObject.centerImage =  true;
			imageObject.height = settings.imageHeight;
			imageObject.width = settings.imageWidth;
		}

		aa_setImage($(settings.imageElement)[0],imageObject,false);
		var txt = picklist.totext();
		$(settings.textElement).html(txt);
		if (txt.length > settings.longTextLength) 
			$(settings.textElement).addClass('picklist-long-text');
		else
			$(settings.textElement).removeClass('picklist-long-text');

		if (!picklist.totext() && picklist.field.DescriptionForEmptyText) {
			$(settings.textElement).addClass('placeholder');
			$(settings.textElement).html(picklist.field.DescriptionForEmptyText);
		} else {
			$(settings.textElement).removeClass('placeholder');
		}
	}
	// tab and keyboard support
	$(settings.baseElement).attr('tabindex',0);
	$(settings.baseElement).keydown( function(e) { 
		if (picklist.selectorPopup && !picklist.selectorPopup.isOpen || !picklist.selectorPopup.isOpen()) {	// popup is closed
			if (e.keyCode == 13 || e.keyCode == 32 || e.keyCode == 40) {	// enter, space or arrow down opens the popup
				openPopup(); 
				return aa_stop_prop(e);
			}
		} else if (picklist.field.HideSearchBox) {	// popup is open and no searchbox, we pass the keys events to the searchbox
			handleInputEvents(e.keyCode);
			return aa_stop_prop(e);
		}
	});

	function initPopup() {
		picklist.selectorPopup = aa_createLightPopup({
			el: $(settings.popupElement)[0],
			launchingElement: $base[0],
			location:  aa_popupNearLauncherLocation({ minWidthOfLaunchingElement: true }),
			features: [
				aa_popup_feature_closeOnEsc(),
				aa_popup_feature_autoFocus()
			],
			apiObject: picklist,
			type: 'picklist',
			popupSettings: {
				closeWhenClickingOutside: 'except launching element',
				reusablePopup: true
			}
		});

		if (picklist.field.SelectOnHover) {
			aa_bind(picklist.selectorPopup,'close',function(args) {
				if (args.closeType != 'OK' && picklist.selectorPopup.valueWhenOpened != picklist.getValue())
					picklist.setValue(picklist.selectorPopup.valueWhenOpened);
			});
		}
		if (aa_isStudioRefreshAndPopupIsOpen('picklist',picklist)) {
			setTimeout(openPopup,100);
		}
		if (picklist.field.HideSearchBox) $(picklist.selectorPopup.el).addClass('aa_hide_searchbox');
		$(settings.popupNoResultsElement).text(picklist.field.TextForNoResults || 'No results match your search');
		$(settings.popupShowAllElement).text(picklist.field.TextForShowAll || 'Show All');
		aa_bind(picklist.selectorPopup, 'close', function() {	// after closing, bring the focus back to the base
			$(settings.baseElement).focus();
			setTimeout( function() { 	
				if (!document.activeElement || document.activeElement == $("body")[0]) 	// if the popup was closed by clicking non focusable area, we catch it and refocus
					$(settings.baseElement).focus();
			},1);
		});
	}	

	function openPopup() {
		if (picklist.field.OnOpenPopup) {
			picklist.field.OnOpenPopup(picklist.field_data,picklist.context);
		}
		if (picklist.field.CustomPopupContents) {
			showPicklistCustomContents();
		} else {
			bindPopupInputEvents();
			refreshPopupOptions();
		}
		picklist.selectorPopup.valueWhenOpened = picklist.getValue();
		picklist.selectorPopup.show();
		aa_trigger(picklist,'popupShow',picklist.selectorPopup);
	}

	function showPicklistCustomContents() {
		var obj = {
			SelectAndClose: function(data1) {
				var code = aa_totext(data1);
				picklist.selectorPopup.close('OK');
				picklist.setValue(code);
				refreshPicklistBase();
			}
		};
		aa_empty(picklist.selectorPopup.el.firstChild);
		aa_fieldControl({ 
			Field: picklist.field.CustomPopupContents, 
			Wrapper: picklist.selectorPopup.el.firstChild,
			FieldData: [],
			Context: aa_ctx(picklist.context,{ _Picklist: [obj]})
		});
	}
	function handleInputEvents(keyCode) {
		$input = $(settings.popupInputElement);
		$input[0].jbValueForKeyDown = $input.val();
		if (keyCode == 13) { // enter
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected) {
				selectItem(selected);
				return;
			}
		}
		if (keyCode == 27) { // escape
			picklist.selectorPopup.close();
		}
		if (keyCode == 40) { // arrow down
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected && selected.nextSibling) {
				$(selected).removeClass('selected');
				$(selected.nextSibling).addClass('selected');
				makeItemVisible(selected.nextSibling,'down');
				return;
			}
		}
		if (keyCode == 38) { // arrow up
			var selected = $popupItemParent.find('>.selected')[0];
			if (selected && selected.previousSibling) {
				$(selected).removeClass('selected');
				$(selected.previousSibling).addClass('selected');
				makeItemVisible(selected.previousSibling,'up');
				return;
			}
		}
	}
	function bindPopupInputEvents() {
		$input = $(settings.popupInputElement);
		$input.val('');
		if ($input[0].EventsBounded) return;
		$input[0].EventsBounded = true;	// avoid multiple bindind
		$input.keydown(function(e) {
			handleInputEvents(e.keyCode)
		});
		$input.keyup(function(e) {
			if (this.jbValueForKeyDown == $(this).val()) return;
			refreshPopupOptions();
		});
	}

	function refreshPopupOptions(showAll) {
		while ($popupItemParent[0].firstChild)
			aa_remove($popupItemParent[0].firstChild,true);

		var items = picklist.Field.Options;
		if (picklist.Field.AllowEmptyValue && picklist.getValue() && !settings.dontShowEmptyValueItem) {
			items = [{ code: '', text: picklist.field.TextForEmptyValueInPopup || '' }].concat(items);
		}
		settings.search($input.val(),items);

		var added = 0;
		if (picklist.field.AllowValueNotInOptions && $input.val()) {
			items = items.concat([{ code: $input.val(), text: $input.val(), passed: true }]);
		}

		if (picklist.field && picklist.field.SortPicklistOptions) 
			items = picklist.field.SortPicklistOptions(items,picklist.context,picklist);

		for(var i=0;i<items.length;i++) {
			if (!items[i].passed) continue;
			var $item = $popupItemTemplate.clone().appendTo($popupItemParent);
			$item[0].jbItem = items[i];
			if (items[i].disabled) $item.addClass('disabled');

			var innerSettings = settings.popupItemSettings($item[0]);
			$(innerSettings.itemTextElement).text(items[i].text);
			highlightText($(innerSettings.itemTextElement),$input.val());

			aa_trigger(picklist.field,'picklistRenderOption',{ optionTextEl: $(innerSettings.itemTextElement)[0], context: picklist.context, option: items[i], picklist: picklist });

			var imageObject = aa_create_static_image_object(items[i].image);
			if (imageObject && imageObject.url) {
				imageObject.keepImageProportions = imageObject.fillImage = imageObject.centerImage =  true;
				imageObject.height = settings.imageHeight;
				imageObject.width = settings.imageWidth;				
			}
			aa_setImage($(innerSettings.itemImageElement)[0],imageObject);

			try {
				if (settings.onRenderOption) settings.onRenderOption($item[0],items[i]);
			} catch(e) {
				ajaxart.logException('error calling onRenderOption',e);
			}

			if (added === 0) $item.addClass('selected');
			if (++added >= settings.maxItemsToShow && !showAll) {
				addShowAll();
				break;
			}
		}
		$popupItemParent.children().click(function() {
			if (this == $(settings.popupShowAllElement)[0]) return;

			selectItem(this);
		});
		$popupItemParent.children().mouseover(function() {
				if (this == $(settings.popupShowAllElement)[0] || disableSelectionOnHover) return;

				if ( $(this).hasClass('selected') ) return;
				$popupItemParent.children().removeClass('selected');
				$(this).addClass('selected');

				if (picklist.field.SelectOnHover)
					picklist.setValue(this.jbItem.code);
		});
		if (!added && items.length > 0) {
			$(settings.popupNoResultsElement).appendTo($popupItemParent);
		}
		if (settings.rtl) setTimeout(popupRTLKeepRightPosition,1);
	}

	function popupRTLKeepRightPosition() {
		var popupEl = picklist.selectorPopup.$el[0];
		var popupRight = aa_absLeft(popupEl,true) + popupEl.offsetWidth;
		var baseRight = aa_absLeft($base[0],true) + $base.outerWidth();

		var currentLeft = Number(popupEl.style.left.split('px')[0]);
		popupEl.style.left = (currentLeft - (popupRight-baseRight) ) + 'px';
	}
	function selectItem(itemElement) {
		if (itemElement.jbItem.disabled) return;
		var code = itemElement.jbItem.code;

		picklist.selectorPopup.close('OK');
		picklist.setValue(code);
		refreshPicklistBase();
	}

	function addShowAll() {
		$(settings.popupShowAllElement).appendTo($popupItemParent);
		$(settings.popupShowAllElement).click(function() {
			var lastItem = this.previousSibling && this.previousSibling.jbItem;
			refreshPopupOptions(true);

			var children = $popupItemParent.children();
			for(var i=0;i<children.length;i++)
				if (children[i].jbItem == lastItem) {
					if (children[i].tabIndex == -1) children[i].tabIndex = 0;
					children[i].focus();
					children[i].tabIndex = -1;
				}
		});
	}

	function highlightText($elem,searchtext) {
		$elem.html( ajaxart_field_highlight_text($elem.text(),searchtext,'.aa_highlight') );
	}

	function makeItemVisible(element,direction) {
		if (!element) return;

		var frame = picklist.selectorPopup.frameElement;
		var top = aa_relTop(element,frame);
		var bottom = top + $(element).outerHeight();
		var scrollY = $(frame).scrollTop();
		var frameHeight = $(frame).height();

		disableSelectionOnHover = true;

		if (direction == 'down') {
			if (bottom > scrollY + frameHeight ) {
				$(frame).scrollTop(bottom-frameHeight);  
			}
		}
		if (direction == 'up') {
			if (top < scrollY) {
				$(frame).scrollTop(top);
			}
		}

		setTimeout(function() {			// to prevent the selection to go to the mouse
			disableSelectionOnHover = false;
		},100);
	}

}





aa_gcs("slider", {
	Unit: function (profile,data,context)
	{
		var unit = {
			symbol: aa_text(data,profile,'Symbol',context),
			min: parseFloat(aa_text(data,profile,'Min',context)),
			max: parseFloat(aa_text(data,profile,'Max',context)),
			initialPixelsPerUnit: parseFloat(aa_text(data,profile,'InitialPixelsPerUnit',context)),
			step: aa_float(data,profile,'Step',context),
			sliderText: function(value,field) {
				if (value == '' && field.AllowEmptyValue) 
					return field.TextForEmptyValue;
				return aa_text([value],profile,'SliderText',aa_ctx(context,{Symbol:[this.symbol]}));
			},
			valueToSave: function(numericVal,field) {
				if (numericVal === '' && field.AllowEmptyValue) 
					return '';
				return aa_text([numericVal],profile,'DataFormat',aa_ctx(context,{Symbol:[this.symbol]}));
			},
			numericPart: function(val,field) { 
				var parts = (''+val).match(/([^0-9\.\-]*)([0-9\.\-]+)([^0-9\.\-]*)/);
				var value = parts && parts[2];
				value = value || (field.AllowEmptyValue ? '' : '0');
				var v = parseFloat(value);
				if (!isNaN(v)) 
					value = '' + this.fixValue(v);
				return value;
			},
			fixValue: function(val) {
				var unit = this;
				if (!isNaN(unit.min)) val = Math.max(val,unit.min);
				if (!isNaN(unit.max)) val = Math.min(val,unit.max);
				val = Math.round(val/unit.step)*unit.step; 
				val = parseFloat(val.toFixed(3)+''.replace(/0+$/,''));
				return val;
			}
		}
		return [unit];
	},
	Slider: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.SliderStyle = aa_first(data,profile,'Style',context);
		field.AllowEmptyValue = aa_bool(data,profile,'AllowEmptyValue',context);
		field.TextForEmptyValue = aa_bool(data,profile,'TextForEmptyValue',context);
		aa_field_handler(field,'ModifyControl',function() {},'resizer'); // disable the resizer
		var units = ajaxart.run(data,profile,'Units',context);
		var unit = units[0];
		if (!unit) {
			var min = aa_text(data,profile,'Min',context);
			var xtml = aa_parsexml('<xtml t="slider.Unit" Min="' + min + '" />');
			unit = aa_first(data,xtml,'',context);
		}
		
		field.Control = function(field_data,ctx) {
			var field = this;
			var style = field.SliderStyle;
			var jSlider = jQuery(style.Html);
			var numericValue = unit.numericPart(ajaxart.totext_array(field_data),field);
			
			var slider = aa_api_object(jSlider,{
				initSizes: function() {
					var sliderWidth = parseInt(slider.width.split('px')[0] || '0' );
					slider.scaleWidth = jQuery(slider.jbScaleElem).width() || sliderWidth;
					slider.fromPixel = aa_absLeft(slider.jbScaleElem);
					slider.toPixel = slider.fromPixel + slider.scaleWidth;
					slider.center = Math.round(slider.fromPixel+ slider.scaleWidth/2);
					if (!isNaN(unit.min)) slider.from = unit.min;
					if (!isNaN(unit.max)) slider.to = unit.max;
					if (!isNaN(unit.initialPixelsPerUnit)) slider.ratio = slider.ratio || unit.initialPixelsPerUnit;
					if (!slider.ratio && slider.from != null && slider.to != null)
						slider.ratio = slider.scaleWidth/(slider.to - slider.from);
					if (!slider.ratio)
						slider.ratio = 1/unit.step;
					if (slider.from != null && slider.to != null)
						slider.range = slider.to - slider.from;
					else 
						slider.range = slider.scaleWidth / slider.ratio; 
	
					if (slider.from != null)
						slider.offset = slider.from * slider.ratio;
					slider.thumbWidth = Math.round(jQuery(slider.jbThumbElem).outerWidth()/2);
				},
				setValue: function(val,state) {
					numericValue = unit.numericPart(val,field);
					var value_to_save = unit.valueToSave(numericValue,field);

					if ( aa_totext(field_data) == value_to_save) return slider; // no change - so do not save & fire events
					ajaxart.writevalue(field_data,[value_to_save]);
					if (field.RefreshOn == 'every click' || state != 'slide')
						aa_invoke_field_handlers(field.OnUpdate,slider,{},field,field_data);

					return slider;
				},
				width: aa_text(data,profile,'Width',context),
				adjustScale: function() {
					var val = parseFloat(numericValue);
					var distanceFromSide = Math.min(val - slider.from, slider.to - val) * slider.ratio;
					if (distanceFromSide > 10) return slider; // far from sides, no need to adjust
					if (isNaN(val)) val = unit.fixValue(0);
					// put in the middle
					if (isNaN(unit.min))
						slider.from = (val - slider.range/2).toFixed(2);
					if (isNaN(unit.max))
						slider.to = (val + slider.range/2).toFixed(2);
					if (unit.min == 0 && isNaN(unit.max))
						slider.to = Math.max(slider.to,val+slider.range);
					slider.offset = slider.from * slider.ratio;
					slider.range = slider.to - slider.from;
					slider.ratio = slider.scaleWidth/slider.range;
					return slider;
				},
				pixelToUnits: function(x) { 
					return (x+slider.offset)/slider.ratio;
				},
				setThumbPosition: function() {
					var val = parseFloat(numericValue);
					if (isNaN(val)) val = unit.fixValue(0);
					if (!slider.ratio) return;
					if (val < slider.from || val > slider.to)
						return;
				  if (numericValue == '') 
				   	jSlider.addClass('empty_value') 
				  else 
				  	jSlider.removeClass('empty_value'); 
					var xPixels = Math.round(val * slider.ratio - slider.offset);
					xPixels = Math.max(xPixels,0);
					xPixels = Math.min(xPixels,slider.scaleWidth);
		      jQuery(slider.jbThumbElem).css('left', xPixels- slider.thumbWidth);
		      jQuery(slider.jbTextElem).html(unit.sliderText(numericValue,field));
				},
		        keyDown: function(e) {
		    		e = e || event;
		    		var str = String.fromCharCode(e.keyCode);
		    		if (e.keyCode == 189) str = "-";
		    		if (str.match(/[\-0-9]/)) {
		    			aa_first([slider],profile,'PopupEditor',aa_ctx(context,{Value:[str],Slider:[slider],ControlElement: [slider.jbThumbElem]}));
		    			return true;
		    		}
		    		if (e.keyCode == 46 && field.AllowEmptyValue) { // delete
		    			slider.setValue(field,'');
		    			slider.adjustScale(true);
		    		}
		    		if (str == '0') slider.setValue('0');
		    		//jBart.trigger(slider.jbThumbElem,'keydown',{code:e.keyCode, str: str});
		    		var val = parseFloat(numericValue);
		    		if (isNaN(val)) val = 0;
		    		if (e.keyCode == 37 || e.keyCode == 39) { // right/left
		    			if (e.keyCode == 39)
		    				val += unit.step * (e.shiftKey ? 10 : 1);
		    			else
		    				val -= unit.step * (e.shiftKey ? 10 : 1);
			            slider.setValue(val);
			            aa_stop_prop(e);
		    		}
		    		slider.setThumbPosition();
		    		return true;
		    	}
			});
			jQuery(slider).addClass(aa_attach_global_css(style.Css));
			aa_defineElemProperties(slider,'init'); 
			
			slider.init = function(scale,thumb,text) {
				var slider = this;
				slider.jbScaleElem = this.getInnerElement(scale);
				slider.jbTextElem = this.getInnerElement(text);
				jQuery(slider.jbTextElem).mousedown(function(){
					aa_first(data,profile,'PopupEditor',aa_ctx(context,{Value:[numericValue],Slider:[slider],ControlElement: [slider.jbThumbElem]}));
					return false;
				});
				slider.jbThumbElem = this.getInnerElement(thumb);
				slider.jbThumbElem.tabIndex = 1;
				jQuery(slider.jbScaleElem).css('width',aa_text(data,profile,'Width',context));
				jQuery(slider.jbThumbElem).bind('mousedown',dragBegin);
				jQuery(slider.jbThumbElem).bind('keydown',slider.keyDown);
			
				aa_addOnAttach(slider,function () {
					slider.initSizes();
					slider.adjustScale();
					slider.setThumbPosition();
				});

				function dragBegin(e) {            
		        	if (aa_incapture) return true;
		        	slider.initSizes(); 
		        	slider.adjustScale(); 
		        	slider.setThumbPosition();
		        	
		        	slider.jbStartDragTime = new Date().getTime();
		        	slider.jbSuspectClick = true;
		            document.onmousemove = function(e) { drag(e) }
		            document.onmouseup   = function(e) { slider.dragEnd(e) }
		            jQuery(slider.jbThumbElem).focus();
		            drag(e);
		            return false;
		        }
		        function drag(e) {
		        	if (slider.jbSuspectClick) {
		        		if (new Date().getTime() - slider.jbStartDragTime < 100) return;
		        		slider.jbSuspectClick = false;
		        	}
					slider.fromPixel = aa_absLeft(slider.jbScaleElem);
		            var pos = aa_mousePos(e);
		            pos.x = Math.max(pos.x,slider.fromPixel);
		            pos.x = Math.min(pos.x,slider.toPixel);
		            var xPixels = pos.x - slider.fromPixel;
		            slider.setValue(slider.pixelToUnits(xPixels)).setThumbPosition();
		         }
		         slider.dragEnd = function(e) {
		            document.onmouseup = null;
		            document.onmousemove = null;
		        	if (!slider.jbSuspectClick) {
		        		slider.setValue(numericValue);
		        		slider.adjustScale().setThumbPosition();
		        	}
		        	slider.jbSuspectClick = false;
		            jQuery(slider.jbThumbElem).focus();
		         }
			}
			aa_apply_style_js(slider,field.SliderStyle);
			return jSlider.get();
		}
	}	
});


function aa_jbart_slider(editableNumber, settings) {
	var unit = editableNumber.format;
	unit.field = editableNumber.field; 
	if (!unit) {
		ajaxart.log('slider - no units defined for slider');
		return;
	}

	var numericValue = '' + (editableNumber.value && unit.parse(''+editableNumber.value));
	var slider = editableNumber.slider = {
		scaleElem: settings.scaleElement,
		textElem: settings.textElement,
		thumbElem: settings.thumbElement,
		inputElem: settings.inputElement,
	    init: function() {
			var slider = this;
			slider.thumbElem.tabIndex = 1;
			jQuery(slider.scaleElem).css('width',slider.width);
			if (!(editableNumber.field.IsDisabled && editableNumber.field.IsDisabled())) {
				jQuery(slider.thumbElem).bind('mousedown',dragBegin);
				jQuery(slider.thumbElem).bind('keydown',slider.keyDown);
				jQuery(slider.inputElem).bind('keydown',slider.inputKeyDown).bind('blur',slider.setInputValue).hide();
				jQuery(slider.textElem).bind('mousedown',function(){
					jQuery(slider.inputElem).show().focus();return false;
				});
			} else {
			  var disableText = (editableNumber.field.DisableText && editableNumber.field.DisableText()) || '';
			  jQuery(slider.thumbElem).attr('title',disableText).addClass('aa_disabled');
			  jQuery(slider.textElem).attr('title',disableText).addClass('aa_disabled');
			  jQuery(slider.scaleElem).attr('title',disableText).addClass('aa_disabled');
			  jQuery(slider.inputElem).hide();
			  ajaxart_disableSelection(slider.scaleElem);
			}
		
			aa_addOnAttach(settings.$el[0],function () {
				slider.initSizes();
				slider.adjustScale();
				slider.setThumbPosition();
			});

			function dragBegin(e) {            
	        	if (aa_incapture) return true;
	        	slider.initSizes(); 
	        	slider.adjustScale(); 
	        	slider.setThumbPosition();
	        	
	        	slider.startDragTime = new Date().getTime();
	        	slider.suspectClick = true;
	            document.onmousemove = function(e) { drag(e) }
	            document.onmouseup   = function(e) { slider.dragEnd(e) }
	            jQuery(slider.thumbElem).focus();
	            drag(e);
	            return false;
	        }
	        function drag(e) {
	        	if (slider.suspectClick) {
	        		if (new Date().getTime() - slider.startDragTime < 100) return;
	        		slider.suspectClick = false;
	        	}
				slider.fromPixel = aa_absLeft(slider.scaleElem);
	            var pos = aa_mousePos(e);
	            pos.x = Math.max(pos.x,slider.fromPixel);
	            pos.x = Math.min(pos.x,slider.toPixel);
	            var xPixels = pos.x - slider.fromPixel;
	            slider.setValue(slider.pixelToUnits(xPixels)).setThumbPosition();
	         }
	         slider.dragEnd = function(e) {
	            document.onmouseup = null;
	            document.onmousemove = null;
	        	if (!slider.suspectClick) {
	        		slider.setValue(numericValue);
	        		slider.adjustScale().setThumbPosition();
	        	}
	        	slider.suspectClick = false;
	            jQuery(slider.thumbElem).focus();
	         }
        },
		initSizes: function() {
			slider.scaleWidth = jQuery(slider.scaleElem).width();
			slider.fromPixel = aa_absLeft(slider.scaleElem);
			slider.toPixel = slider.fromPixel + slider.scaleWidth;
			slider.center = Math.round(slider.fromPixel+ slider.scaleWidth/2);
			if (!isNaN(unit.min)) slider.from = unit.min;
			if (!isNaN(unit.max)) slider.to = unit.max;
			if (!isNaN(unit.initialPixelsPerUnit)) slider.ratio = slider.ratio || unit.initialPixelsPerUnit;
			if (!slider.ratio && !isNaN(slider.from) && !isNaN(slider.to))
				slider.ratio = slider.scaleWidth/(slider.to - slider.from);
			if (!slider.ratio)
				slider.ratio = 1/unit.step;
			if (!isNaN(slider.from) && !isNaN(slider.to))
				slider.range = slider.to - slider.from;
			else 
				slider.range = slider.scaleWidth / slider.ratio; 

			if (slider.from != null)
				slider.offset = slider.from * slider.ratio;
			slider.thumbWidth = Math.round(jQuery(slider.thumbElem).outerWidth()/2);
		},
		setValue: function(val,state) {
			var fix1 = applyRangeAndResolution(unit,val);
			numericValue = isNaN(fix1) ? '' : '' + fix1;
			var value_to_save = unit.getDataString(fix1);
			editableNumber.setValue(value_to_save);

			return slider;
		},
		adjustScale: function() {
			var val = parseFloat(numericValue);
			var distanceFromSide = Math.min(val - slider.from, slider.to - val) * slider.ratio;
			if (distanceFromSide > 10) return slider; // far from sides, no need to adjust
			if (isNaN(val)) val = applyRangeAndResolution(unit,0) || 0;
			// put in the middle
			if (isNaN(unit.min))
				slider.from = applyRangeAndResolution(unit,val - slider.range/2);
			if (isNaN(unit.max))
				slider.to = applyRangeAndResolution(unit,val + slider.range/2);
			if (unit.min == 0 && isNaN(unit.max))
				slider.to = Math.max(slider.to,val+slider.range);
			slider.offset = slider.from * slider.ratio;
			if (!isNaN(slider.from) && !isNaN(slider.to))
				slider.range = slider.to - slider.from;
			if (!isNaN(slider.range))
				slider.ratio = slider.scaleWidth/slider.range;
			return slider;
		},
		pixelToUnits: function(x) { 
			return (x+slider.offset)/slider.ratio;
		},
		setThumbPosition: function() {
			var val = parseFloat(numericValue);
			if (isNaN(val)) val = applyRangeAndResolution(unit,0) || 0;
			if (!slider.ratio) return;
			if (val < slider.from || val > slider.to)
				return;
	    if (numericValue == '') 
	    	settings.$el.addClass('empty_value'); 
    	else 
		   	settings.$el.removeClass('empty_value'); 
			var xPixels = Math.round(val * slider.ratio - slider.offset);
			xPixels = Math.max(xPixels,0);
			xPixels = Math.min(xPixels,slider.scaleWidth);
      jQuery(slider.thumbElem).css('left', xPixels- slider.thumbWidth);
      jQuery(slider.textElem).text(unit.getDisplayString(parseFloat(numericValue)));
		},
    keyDown: function(e) {
    		e = e || event;
    		var str = String.fromCharCode(e.keyCode);
    		if (e.keyCode == 189) str = "-";
    		if (str.match(/[\-0-9]/)) {
    			jQuery(slider.inputElem).show().focus();
    			return true;
    		}
    		if (e.keyCode == 46) { // delete
    			slider.setValue('');
    			slider.adjustScale(true).setThumbPosition();
    		}
    		if (str == '0') slider.setValue('0');
    		//jBart.trigger(slider.jbThumbElem,'keydown',{code:e.keyCode, str: str});
    		var val = parseFloat(numericValue);
    		if (isNaN(val)) val = 0;
    		if (e.keyCode == 37 || e.keyCode == 39) { // right/left
    			if (e.keyCode == 39)
    				val += unit.step * (e.shiftKey ? 10 : 1);
    			else
    				val -= unit.step * (e.shiftKey ? 10 : 1);
	            slider.setValue(val);
	            aa_stop_prop(e);
    		}
    		slider.setThumbPosition();
    		return true;
    	},
    	setInputValue: function() {
        	slider.setValue(slider.inputElem.value);
        	slider.adjustScale();
   			slider.setThumbPosition();
   			jQuery(slider.inputElem).hide();
    	},
    	inputKeyDown: function(e) {
    		e = e || event;
    		if (e.keyCode == 13) // enter
	        	slider.setInputValue();
    		return true;
    	}

	}
	slider.init();

	function applyRangeAndResolution(unit,val) {
		if (isNaN(val) || val === '') return NaN;
		if (!isNaN(unit.min)) val = Math.max(val,unit.min);
		if (!isNaN(unit.max)) val = Math.min(val,unit.max);
		val = Math.round(val/unit.step)*unit.step; 
		val = parseFloat(val.toFixed(3)+''.replace(/0+$/,''));
		return val;		
	}
}





aa_gcs("img", {
	Image: function(profile,data,context) {
		aa_init_class_image();

		var origWidthRef = ajaxart.run(data,profile,'OriginalWidth',context);
		var origHeightRef = ajaxart.run(data,profile,'OriginalHeight',context);

		var ctx2 = aa_ctx(context,{ ImageOriginalWidth: origWidthRef, ImageOriginalHeight: origHeightRef });
		var frameWidth = aa_first(data,profile,'FrameWidth',ctx2);
		var frameHeight = aa_first(data,profile,'FrameHeight',ctx2);

		var image = new ajaxart.classes.Image({
			url: aa_text(data,profile,'Url',context),
			originalWidth: parseInt(aa_totext(origWidthRef)),
			originalHeight: parseInt(aa_totext(origHeightRef)),
			originalWidthRef: origWidthRef,
			originalHeightRef: origHeightRef,
			width: frameWidth ? frameWidth.val : 0,
			height: frameHeight ? frameHeight.val : 0,
			adjustSize: aa_first(data,profile,'AdjustSize',context),
			needsRefreshOnResize: (frameWidth && frameWidth.refreshOnResize) || (frameHeight && frameHeight.refreshOnResize),
			refresh: function() {
				var frameWidth = aa_first(data,profile,'FrameWidth',ctx2);
				var frameHeight = aa_first(data,profile,'FrameHeight',ctx2);

				this.width = frameWidth ? frameWidth.val : 0;
				this.height = frameHeight ? frameHeight.val : 0;

				aa_trigger(this,'refresh');
			}
		});

		return [image];
	},
	ImageInSprite: function(profile,data,context) {
		aa_init_class_sprite_image();

		var image = new ajaxart.classes.SpriteImage({
			url: aa_text(data,profile,'Url',context),
			width: aa_int(data,profile,'Width',context),
			height: aa_int(data,profile,'Height',context),
			positionInSprite: aa_text(data,profile,'PositionInSprite',context),
			positionForHover: aa_text(data,profile,'PositionForHover',context),
			positionForClick: aa_text(data,profile,'PositionForClick',context)			
		});

		return [image];
	},
	Center: function(profile,data,context) {
		aa_init_class('CenterImage',{
			fix: function(image,div,innerDiv,settings) {
				var backgroundWidth = image.width,backgroundHeight = image.height;
				if (image.width / image.height > image.originalWidth / image.originalHeight) {
					backgroundWidth = parseInt(backgroundHeight * image.originalWidth / image.originalHeight);
					var marginType = this.isRTL ? 'margin-right' : 'margin-left';
					$(innerDiv).css(marginType,Math.abs(parseInt((image.width - backgroundWidth)/2)) + 'px');
				} else {
					backgroundHeight = parseInt(backgroundWidth * image.originalHeight / image.originalWidth);
					$(innerDiv).css('margin-top',Math.abs(parseInt((image.height - backgroundHeight)/2)) + 'px');
				}
				$(innerDiv).width(backgroundWidth).height(backgroundHeight);
			}
		});
		return [new ajaxart.classes.CenterImage({ isRTL: aa_bool(data,profile,'RightToLeft',context)})];
	},
	Fill: function(profile,data,context) {
		aa_init_class('FillImage',{
			fix: function(image,div,innerDiv,settings) {
				var backgroundWidth = image.width,backgroundHeight = image.height;
				if (image.width / image.height > image.originalWidth / image.originalHeight) {
					backgroundHeight = parseInt(backgroundWidth * image.originalHeight / image.originalWidth);
					$(innerDiv).css('margin-top','-'+Math.abs(parseInt((image.height - backgroundHeight)/2)) + 'px');
				} else {
					backgroundWidth = parseInt(backgroundHeight * image.originalWidth / image.originalHeight);
					$(innerDiv).css('margin-left','-'+Math.abs(parseInt((image.width - backgroundWidth)/2)) + 'px');
				}
				$(innerDiv).width(backgroundWidth).height(backgroundHeight);
			}
		});
		return [new ajaxart.classes.FillImage()];
	},
	CustomFill: function(profile,data,context) {
		return [{
			fix: function(image,div,innerDiv,settings) {
				var backgroundWidth = image.width,backgroundHeight = image.height;
				if (image.width / image.height > image.originalWidth / image.originalHeight) {
					backgroundHeight = parseInt(backgroundWidth * image.originalHeight / image.originalWidth);
				} else {
					backgroundWidth = parseInt(backgroundHeight * image.originalWidth / image.originalHeight);
				}
				$(innerDiv).width(backgroundWidth).height(backgroundHeight);
				$(innerDiv).css('margin-top','-'+aa_text(data,profile,'MarginTop',context) + 'px');
				$(innerDiv).css('margin-left','-'+aa_text(data,profile,'MarginLeft',context) + 'px');
			}
		}];
	},
	Stretch: function(profile,data,context) {
		aa_init_class('StretchImage',{
			fix: function(image,div,innerDiv,settings) {
				var backgroundWidth = image.width,backgroundHeight = image.height;
				$(innerDiv).width(backgroundWidth).height(backgroundHeight);
			}
		});
		return [new ajaxart.classes.StretchImage()];
	},
	FixedWidth: function(profile,data,context) {
		return [{ val: aa_int(data,profile,'Width',context)}];
	},
	FixedHeight: function(profile,data,context) {
		return [{ val: aa_int(data,profile,'Height',context)}];
	},
	ContainerWidth: function(profile,data,context) {
		var visualCntr = aa_findVisualContainer(null,context);
	  var num = visualCntr.width;

		var perc = aa_int(data,profile,'Percentage',context);
		num = parseInt(num * (perc / 100));		
	  num -= aa_int(data,profile,'Margin',context);
	  
	  return [{ val: num, refreshOnResize: true }];
	},
	DeviceHeight: function(profile,data,context) {
	  var num = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
	  
	  if ($('.jbart_screen_simulator')[0])
	  	num = $('.jbart_screen_simulator').height();
		else if (context.vars._PagePreview) {
			num = context.vars._PagePreview[0].Height;
		}
		var perc = aa_int(data,profile,'Percentage',context);
		num = parseInt(num * (perc / 100));
	  num -= aa_int(data,profile,'Margin',context);
	  
	  return [{ val: num, refreshOnResize: true }];
	},
	CalculateImageSize: function(profile,data,context) {
		var url = aa_text(data,profile,'Url',context);
		var deferred = $.Deferred();
		aa_calc_image_size(url,function(width,height) {
			deferred.resolve([{ Width: [width], Height: [height]}]);
		});
		return aa_asyncDataPromiseResult(deferred.promise());
	}
});

aa_gcs("img_type", {
	Image: function(profile,data,context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);
		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			var image = aa_first(field_data, profile, 'Image', ctx2);
			if (!image || !image.url)
				image = aa_first(field_data, profile, 'DefaultImage', ctx2);

			return [aa_renderStyleObject(field.Style, {
				field: field, field_data: field_data, context: ctx2,
				image: image
			}, ctx2, true)];
		};
	},
	EditableImage: function(profile,data,context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		aa_init_class_image();
		aa_init_class_EditableImage2();

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);

			var origWidthRef = aa_run(field_data,profile,'FieldDataForImageWidth',context);
			var origHeightRef = aa_run(field_data,profile,'FieldDataForImageHeight',context);

			var frameWidth = aa_first(data,profile,'PreviewWidth',context);
			var frameHeight = aa_first(data,profile,'PreviewHeight',context);

			var imageObject = new ajaxart.classes.Image({
				url: aa_totext(field_data),
				originalWidth: parseInt(aa_totext(origWidthRef)),
				originalHeight: parseInt(aa_totext(origHeightRef)),
				originalWidthRef: origWidthRef,
				originalHeightRef: origHeightRef,
				width: frameWidth ? frameWidth.val : 0,
				height: frameHeight ? frameHeight.val : 0,
				adjustSize: aa_first(data,profile,'AdjustSizeForPreview',context)
			});

			var editableImage = new ajaxart.classes.EditableImage2({
				field: field, field_data: field_data, context: context,
				image: imageObject,
				value: imageObject.url,
				emptyImageUrl: aa_first(data,profile,'EmptyImageURL',context),
				placeholder: field.DescriptionForEmptyText || ''
			});
			return [aa_renderStyleObject(field.Style, editableImage, ctx2, true)];
		};
	}
});

function aa_init_class_image() {
	if (ajaxart.classes && ajaxart.classes.Image) return;

	aa_init_class('Image',{
		_ctor: function() {
			this.css3Image = true;
		},
		render: function(settings) {
			var image = this;
			var el = settings.el;
			$(el).addClass('aa_image_outer');

			aa_empty(el,true);

			if (!this.originalWidth || !this.originalHeight) {
				aa_calc_image_size(image.url,function(width,height) {
					if (!width) return; // an invalid url
					image.originalWidth = width;
					image.originalHeight = height;
					image.render(settings);
				});
				// if (this.width) $(el).width(this.width);
				// if (this.height) $(el).height(this.height);
				return;
			}

			var innerImg = $('<img class="aa_image"/>').appendTo(el).attr('src',this.url);
			if (!innerImg[0].width) {
				innerImg.addClass('loading_image');
				innerImg.load(function() {
					innerImg.removeClass('loading_image');
				});
			}


			if (!this.width && !this.height) {
				this.width = this.originalWidth;
				this.height = this.originalHeight;
			}
			if (this.width && !this.height) {
				this.height = Math.ceil( this.originalHeight * this.width / this.originalWidth );
			}
			if (this.height && !this.width) {
				this.width = Math.ceil( this.originalWidth * this.height / this.originalHeight );
			}

			$(el).css({ overflow: 'hidden' , 'margin-left': 0, 'margin-top': 0 }).width(this.width).height(this.height);

			if (!this.adjustSize) {
				innerImg.width(this.width).height(this.height);
			} else {
				this.adjustSize.fix(image,el,innerImg[0],settings);
			}

			if (this.url.indexOf('//static.wix.com/media/') > -1) {
				// images hosted at wix
				var newUrl = aa_wix_image_url(this.url,{ width: this.width, height: this.height });
			}
		}
	});
}

function aa_init_class_sprite_image() {
	if (ajaxart.classes && ajaxart.classes.SpriteImage) return;

	aa_init_class('SpriteImage',{
		_ctor: function() {
			this.css3Image = true;
		},
		render: function(settings) {
			var image = this;
			var el = settings.el;
			aa_empty(el,true);
			var $innerDiv = $('<div />').css('display','inline-block').appendTo(el);

			$innerDiv.css('width',this.width+'px').css('height',this.height+'px');
			var position = '-' + this.positionInSprite.replace(/,/,'px -') + 'px';
			$innerDiv.css('background','url('+this.url+') no-repeat ' + position);

			var css = '';
			if (this.positionForHover) {
				var hoverPosition = '-' + this.positionForHover.replace(/,/,'px -') + 'px';
				css += '#this:hover { background-position: ' + hoverPosition + ';} ';
			}
			if (this.positionForClick) {
				var activePosition = '-' + this.positionForClick.replace(/,/,'px -') + 'px';
				css += '#this:active { background-position: ' + activePosition + ';} ';
			}

			$innerDiv.addClass(aa_attach_global_css(css));
		}
	});
}

function aa_image(image, settings) {
	if (!settings && !settings.el) return;
	if (!image && settings.hideForEmpty) aa_hide(settings.el);
	if (!image) return;
	if (image.url) image.url = image.url.replace(/_jbartImages_/g,aa_base_images());
	if (image && image.render) image.render(settings);

	if (image.needsRefreshOnResize) {
		aa_addActionOnWindowResize(settings.el,function() {
			image.refresh();
			aa_image(image,settings);
		},'refresh image');
	}
}

function aa_calc_image_size(url,callback) {
	if (!url) return callback();

	var img = $('<img/>')[0];
	var doneCalled = false;

	img.onload = function() {
		if (!doneCalled)
			callback(img.width,img.height); 
	};

	img.onerror = function() {
		doneCalled=true;
		callback(); 
	};

	img.setAttribute('src',url);			
	if (img.width) { doneCalled = true; callback(img.width,img.height); } // already loaded
}


function aa_init_class_EditableImage2() {
	if (ajaxart.classes && ajaxart.classes.EditableImage2) return;

	aa_init_class('EditableImage2', {
		setValue: function(url) {
			this.setImageValue(url);
		},
		setImageValue: function(url, width, height,isErrorInImage) {
			var that = this;
			if (this.image.originalWidthRef[0]) {
				if (!width && !isErrorInImage) { // we need to calculate the image size and then call setImage
					aa_calc_image_size(url,function(width,height) {
						that.setImageValue(url, width, height, !width);
					});
					return; // wait fot the onload
				}
				ajaxart.writevalue(this.image.originalWidthRef, [width]);
				ajaxart.writevalue(this.image.originalHeightRef, [height]);
				this.image.originalWidth = width;
				this.image.originalHeight = height;
			}
			this.value = this.image.url = url;
			ajaxart.writevalue(this.field_data, [url]);
			aa_invoke_field_handlers(this.field.OnUpdate, this.el, null, this.field, this.field_data, {});
			aa_trigger(this.field, 'update', {
				FieldData: this.field_data,
				wrapper: this.el.parentNode
			});
			aa_trigger(this, 'change');
			if (this.refresh) this.refresh();
		}
	});
}

function aa_init_class_EditableImage() {
		aa_init_class('EditableImage', {
			setValue: function(url) {
				this.setImageValue(url);
			},
			setImageValue: function(url, width, height,errorInImage) {
				if (aa_totext(this.field_data) == url) return;
				if (this.imageWidthData[0]) {
					if (!width && !errorInImage) { // we need to calculate the image size and then call setImage
						var that = this;
						aa_calc_image_size(url,function(width,height) {
							that.setImageValue(url, width, height, !width);
						});
						return; // wait fot the onload
					}
					ajaxart.writevalue(this.imageWidthData, [width]);
					ajaxart.writevalue(this.imageHeightData, [height]);
					this.imageWidth = width;
					this.imageHeight = height;
				}
				this.value = this.image.url = url;
				ajaxart.writevalue(this.field_data, [url]);
				aa_invoke_field_handlers(this.field.OnUpdate, this.el, null, this.field, this.field_data, {});
				aa_trigger(this.field, 'update', {
					FieldData: this.field_data,
					wrapper: this.el.parentNode
				});
				aa_trigger(this, 'change');
			},
			CalcImageSize: function(data1) {
				if (! this.imageWidthData[0]) return;
				var url= aa_totext(this.field_data);
				var that = this;

				aa_calc_image_size(url,function(width,height) {
					ajaxart.writevalue(that.imageWidthData, [width]);
					ajaxart.writevalue(that.imageHeightData, [height]);
					that.imageWidth = width;
					that.imageHeight = height;
				});
			}			
		});	
}

function aa_editableImage_default(editableImage,settings) {
	settings = settings || {};
	aa_editableImageBase(editableImage,settings);

	editableImage.$el.click(function() {
		var url = window.prompt(settings.message,editableImage.image.url);
		editableImage.setValue(url);
	});		
}

function aa_editableImageBase(editableImage,settings) {
	settings = aa_defaults(settings,{
		message: editableImage.params.Question || 'Please enter image url:',
		imageWrapper: editableImage.el,
		inputElement: editableImage.$el.find("input")[0]
	});
	var $imageWrapper = $(settings.imageWrapper);

	$imageWrapper.width(editableImage.image.width).height(editableImage.image.height);

	editableImage.refresh = function() {
		$imageWrapper.toggleClass('aa_empty_image',editableImage.image.url == '');
		editableImage.$el.toggleClass('aa_empty_image',editableImage.image.url == '');
		if (editableImage.image.url) {
			aa_empty($imageWrapper[0],true);
			aa_image(editableImage.image,{el: settings.imageWrapper});
		}	else if (editableImage.emptyImageUrl) {
			var imageObj = aa_defaults({ url: editableImage.emptyImageUrl }, editableImage.image);
			aa_image(imageObj, {el: settings.imageWrapper});
		}	else
			aa_empty($imageWrapper[0],true);
	}

  	editableImage.refresh();
    if (settings.inputElement) {
		var $input = $(settings.inputElement);
		$input.css('width', editableImage.params.TextBoxWidth );
		$input.attr("placeholder",editableImage.placeholder);
		$input.val(editableImage.image.url);
		$input.on('input', function() {
			var inputValue = $input.val();
			if ($input.val() != editableImage.image.url) {
				editableImage.setValue($input.val());
			}
		});
	}
	var mask = editableImage.$el.find(".aa_drop_sink_mask");
	if (mask.length)
		mask[0].jbDropImage = function (e) {
			var files = e.dataTransfer.files;
			for(var i=0;i<files.length;i++) {
				editableImage.$el.addClass('uploading');
				$.when(editableImage.doUpload({file: files[i]})).then(function(image_url) { 
					editableImage.setValue(image_url);
					editableImage.$el.removeClass('uploading');
					if ($input) $input[0].value = image_url;
				}, function(er) { editableImage.$el.removeClass('uploading'); } );
				return; // one file is enough at this stage ...
			}

			var items = e.dataTransfer.items;
			if (items) {	// Chrome
				for(var i=0;i<items.length;i++)
					if (items[i].type == "text/html" )
						items[i].getAsString(useDroppedHtml);
			}
			else {	// Firefox
				useDroppedHtml(e.dataTransfer.getData('text/html'));
			}
			function useDroppedHtml(html){ 
	          var image_url = html.match(/src="([^"]*)/);
	          if (image_url && image_url[1]) {
	          	editableImage.setValue(image_url[1]);
	            if ($input) $input[0].value = image_url[1];
	          }
			}
		}
	aa_init_dropImage();
}

function aa_init_dropImage() {
	if (window.aa_dropImageInitialized) return;
	window.aa_dropImageInitialized = true;

 	function dragover(e) {
        e.stopPropagation();
        e.preventDefault();	
        var box = $(e.target).parents('*').andSelf().filter('.image_drop_area');
        if (box.length > 0) {
        	$(".aa_drop_sink_mask").hide();	// hide other drop masks
            box.addClass('hover');
            var mask = box.find('.aa_drop_sink_mask');
            var borderWidth = parseInt(mask.css('border-width')) || 0;
            mask.width(box.width()-borderWidth*2);
            mask.height(box.height()-borderWidth*2);
            box.css('position','relative');
            mask.show();
        }
	}

	function dragleave(e) {
        e.stopPropagation ();
        e.preventDefault();
        $(e.target).parents('*').andSelf().filter('.aa_drop_sink_mask').hide();
	}

	function drop(e) {
        e.stopPropagation();
        e.preventDefault();	
        var mask = $(e.target).parents('*').andSelf().filter('.aa_drop_sink_mask');
        if (mask.length > 0) {
            mask[0].jbDropImage && mask[0].jbDropImage(e);
        }
        $('.aa_drop_sink_mask').hide();
	}
	document.addEventListener('drop', drop, false);
	document.addEventListener('dragover', dragover, false);
	document.addEventListener('dragleave', dragleave, false);
}


function aa_editableImageTextAndPreview(editableImage,settings) {
	settings = aa_defaults(settings,{ imageWrapper: editableImage.$el.find("span")[0] });
	aa_editableImageBase(editableImage, settings);
}
function aa_editableImageInPopup(editableImage,settings) {
	var $imageWrapper = editableImage.$el.find(".main_image_wrapper");
	settings = aa_defaults(settings,{ imageWrapper: $imageWrapper[0] });
	aa_editableImageBase(editableImage, settings);
	var popup = aa_createLightPopup({
		el: editableImage.$el.find(".popup")[0],
		launchingElement: $imageWrapper[0],
		location:  aa_popupNearLauncherLocation({ minWidthOfLaunchingElement: true }),
		features: [
			aa_popup_feature_closeOnEsc(),
			aa_popup_feature_autoFocus()
		],
		apiObject: editableImage,
		type: 'image',
		popupSettings: {
			closeWhenClickingOutside: 'except launching element',
			reusablePopup: true
		}
	});
	$imageWrapper.click( function() {
		if (!ajaxart.isattached(popup.el))
			popup.show();
		else
			popup.close();
	} );
}
// allows drag and drop of items
function aa_dragDropItems(settings)
{
	var list = settings.parent;
	var isTable = list.tagName.toLowerCase() == 'tbody';
	var listTopDiv = list;

	var draggedElem = null,spaceElem = null,DAndDOwner = "",SuspectItemDrag = null,OriginalElem = null;
	var onmousemoveOrig=null,listOriginalPosition=null,onkeydownOrig=null;
	
	aa_bind_ui_event(list,'mousedown',suspectDrag);
	aa_bind_ui_event(list,'mouseup',unSuspectDrag);
		
	function inElem(elem,top,left) {
		return (elem.offsetTop < top && elem.offsetLeft < left && 
				elem.offsetTop + elem.offsetHeight > top && 
				elem.offsetLeft + elem.offsetWidth > left); 
	}
	function elemAtPosition(top,left) {
		for(var elem=list.firstChild;elem;elem=elem.nextSibling) {
			if (inElem(elem,top,left) && settings.isItemElement(elem)) 
				return elem;
		}
	}
	function numbersBetween(num,num1,num2) {
		return ((num1 <= num && num <= num2) || (num2 <= num && num <= num1)); 
	}
	function findCandidate(elemAtPos,spaceElem,mousepos) {
		for(var iter=spaceElem;iter;iter=iter.nextSibling) {
			if (iter == elemAtPos) {
				var sameLine = (spaceElem.nextSibling && spaceElem.nextSibling.offsetTop == spaceElem.offsetTop);
				if (!sameLine && draggedElem.jbLastMouse &&  mousepos.y < draggedElem.jbLastMouse.y) return null;
				return spaceElem.nextSibling;
			}
		}
		var sameLine = (spaceElem.previousSibling && spaceElem.previousSibling.offsetTop == spaceElem.offsetTop);
		if (!sameLine && draggedElem.jbLastMouse && mousepos.y > draggedElem.jbLastMouse.y) return null;
		return spaceElem.previousSibling;
	}
	
	function drag(e) {
		var offsetParent = listTopDiv;
		
		var mousepos = aa_mousePos(e,true);
		var mouseTop = mousepos.y - aa_absTop(offsetParent);
		var mouseLeft = mousepos.x - aa_absLeft(offsetParent);
		var posyDelta = aa_absTop(offsetParent);

		if (SuspectItemDrag)
		{
			var distance = Math.abs(mousepos.y - SuspectItemDrag.mousePos.y) + Math.abs(mousepos.x - SuspectItemDrag.mousePos.x);
			if (distance < 5) return aa_stop_prop(e);
			var elemAtMousePos = elemAtPosition(mouseTop,mouseLeft);
			if (! elemAtMousePos)
				unSuspectDrag();
			else
				dragBegin(elemAtMousePos,e);
			SuspectItemDrag = null;
			
			return true;
		}
		if (!draggedElem) return true;
		var elemAtMousePos = elemAtPosition(mouseTop,mouseLeft);

		// move dragged elem
		draggedElem.style.top = (mouseTop - posyDelta - draggedElem.initialMouseOffset.top)  + 'px'; 
		draggedElem.style.left = (mouseLeft - draggedElem.initialMouseOffset.left)  + 'px';
		if (isTable) {
			draggedElem.style.left = '0px';
		}
			
		if (elemAtMousePos == spaceElem) return aa_stop_prop(e);

		if (!elemAtMousePos) return aa_stop_prop(e); // can be fixed so the external elem will be the candidate
		var candidate = findCandidate(elemAtMousePos,spaceElem,mousepos);
		if (!candidate) return aa_stop_prop(e);
		
		$(spaceElem).css('box-shadow','inset 0 0 5px 0 #999');
		if (isTable) {
			if (candidate.nextSibling && isGoingDown(candidate,spaceElem))
			  list.insertBefore(spaceElem,candidate.nextSibling); // going down
			else 
			  list.insertBefore(spaceElem,candidate); // going up
		} else {
			var margin = 3;
			var candidateBeforeSpace = (candidate.nextSibling == spaceElem);

			if (candidateBeforeSpace)
				list.insertBefore(spaceElem,candidate);
			else 
				list.insertBefore(spaceElem,candidate.nextSibling);		
		}
		
		draggedElem.jbLastMouse = mousepos;
		return aa_stop_prop(e);
	}
	function isGoingDown(candidate,spaceElem) {
		for(var iter=candidate;iter;iter=iter.nextSibling)
			if (iter == spaceElem) return false;
		return true;
	}
	function dragEnd(e,cancel) {
	  ajaxart_restoreSelection(document.body);
		jBart.trigger(settings.cntr,'dragEnd');
		list.removeChild(draggedElem);
		if (!cancel)
			jQuery(spaceElem).replaceWith(OriginalElem);
		else
			list.removeChild(spaceElem);
		OriginalElem.style.display = '';
		OriginalElem.display = '';
		

		list.onmousemove = onmousemoveOrig;
		list.style.position = listOriginalPosition;
		document.onkeydown = onkeydownOrig;
		document.onmouseup = null;
		draggedElem = null;
		
		var nextElem = null;
		for(var elem=OriginalElem.nextSibling;elem;elem=elem.nextSibling) {
			if (settings.isItemElement(elem)) {
				nextElem = elem;
				break;
			}
		}
		
		try {
			if (nextElem) 
				settings.moveBefore(OriginalElem,nextElem);
			else 
				settings.moveToEnd(OriginalElem);
		} catch(e) {
			ajaxart.logException(e,'Could not complete drag and drop in the model');
		}
		
	  DAndDOwner = "";
		return aa_stop_prop(e);
	}
	function dragBegin(item_elem,e) {
		jBart.trigger(settings.cntr,'dragBegin');
		ajaxart_disableSelection(list);
		DAndDOwner = "DragAndDropItems";
		var posx = aa_absLeft(item_elem);
		var posy = aa_absTop(item_elem);
		var offsetParent = listTopDiv;
		var posyDelta = aa_absTop(offsetParent);
		
		draggedElem = item_elem.cloneNode(true);
		OriginalElem = item_elem;
		list.appendChild(draggedElem);
		spaceElem = item_elem.cloneNode(true);
		spaceElem.jbItem = item_elem.jbItem;
		list.insertBefore(spaceElem,OriginalElem);
		
		OriginalElem.style.display = 'none';
		OriginalElem.display = 'none';

		jQuery(draggedElem).addClass(settings.draggedCssClass);
		jQuery(spaceElem).addClass(settings.draggedSpaceCssClass);

		if (isTable) {
			var tds = jQuery(draggedElem).find('>td');
			for(var i=0;i<tds.length;i++)
				jQuery(tds[i]).width(jQuery(tds[i]).width());
		}
		
		draggedElem.style.position = 'absolute';
		
		var mousepos = SuspectItemDrag.mousePos;
//		draggedElem.initialMouseOffset = { top: mousepos.y - posy, left: mousepos.x - posx } ;
		draggedElem.initialMouseOffset = { top: mousepos.y - posy - posyDelta, left: mousepos.x - posx } ;
		draggedElem.style.left = posx + 'px';
		draggedElem.style.top = (posy - posyDelta) + 'px';

		document.onmouseup = dragEnd;
		onkeydownOrig = document.onkeydown; 
		document.onkeydown = function(e)
		{
			if (e.keyCode == 27) 
				dragEnd(e,true);
			return true;
		}
		
		ajaxart_disableSelection(document.body);
		return aa_stop_prop(e);
	}

	function suspectDrag(e) {
		if (DAndDOwner != "") return true;
		if (settings.canStartDrag && !settings.canStartDrag(e.clientX,e.clientY)) return;
		
	    listTopDiv = list.tagName.toLowerCase() == 'div' ? list : jQuery(list).closest('div')[0];

		listOriginalPosition = listTopDiv.style.position;
		listTopDiv.style.position = 'relative';
		
		SuspectItemDrag = { mousePos : aa_mousePos(e,true), time: new Date().getTime()};
		onmousemoveOrig = list.onmousemove;
		list.onmousemove = drag;
		return true;
	}

	function unSuspectDrag(e) {
		if (DAndDOwner != "") return true;
		ajaxart_restoreSelection(list);
		if (SuspectItemDrag)
		{
			SuspectItemDrag = null;
			list.onmousemove = onmousemoveOrig;
			listTopDiv.style.position = listOriginalPosition;
		}
		return true;
	}
}
// This file contains utility functions for drag and drop

function aa_dragAndDropTableColumns(table,settings)
{
	settings = aa_extend({
		draggedSpaceCssClass: 'aa1_dragged_space_elem',
		draggedCssClass: 'aa1_dragged_elem',
		onDrop: function() {},
		rtl: false
	},settings);  
	
	var thead = $(table).find('>thead')[0];
	if (!thead || table.jbDragAndDropColsInitialized) return;
	table.jbDragAndDropColsInitialized = true;
	
	aa_registerTableHeaderEvent(thead,'mousedown',suspectDrag,'TableColumnsDragAndDrop','no dominant');
	aa_registerTableHeaderEvent(thead,'mousemove',checkSuspection,'TableColumnsDragAndDrop','suspect');
	aa_registerTableHeaderEvent(thead,'mouseup',unSuspectDrag,'TableColumnsDragAndDrop','suspect');
	aa_registerTableHeaderEvent(thead,'mouseout',unSuspectDrag,'TableColumnsDragAndDrop','suspect');
	aa_registerTableHeaderEvent(thead,'mousemove',_drag,'TableColumnsDragAndDrop','dominant');

	var ltr = !settings.rtl;
	var rtl = !ltr;

	function _drag(e,thead,th) 
	{
		var mousepos = aa_mousePos(e);
		var oElem = thead.draggedElem;
		if (!oElem) return true;
				
		oElem.style.left = (mousepos.x - oElem.mouseX) + 'px'; 

		var spaceLeft = aa_absLeft(thead.spaceElem);
		var nextRight = ltr ? -1 : 5000;
		if ($(thead.spaceElem).next().length > 0)	{
			var next = $(thead.spaceElem).next()[0];
			nextRight = aa_absLeft(next) + ltr * next.offsetWidth;
		}
		var prevLeft = ltr ? -1 : 5000;
		if ($(thead.spaceElem).prev().length > 0)	{
			var prev = $(thead.spaceElem).prev()[0];
			prevLeft = aa_absLeft(prev) + rtl * prev.offsetWidth;
		}

		var draggedRight = aa_absLeft(oElem) + ltr * (oElem.offsetWidth + oElem.deltaMouseX);
		var draggedLeft = aa_absLeft(oElem) + rtl * (oElem.offsetWidth + oElem.deltaMouseX);
		var nearRight = nextRight < draggedRight + 5;
		if (rtl) nearRight = !nearRight;
		var nearLeft = prevLeft > draggedLeft - 5;
		if (rtl) nearLeft = !nearLeft;

		var trs = $(table).find('>tbody>tr').get();
		
		if (nearRight) {
			if (thead.spaceElem.nextSibling.nextSibling) {
				var colIndex = calcColumnIndex(thead.spaceElem);
				
				for(var j=0;j<trs.length;j++)
				{
					var tr = trs[j];
					var tds = $(tr).find('>td');
					$(tds[colIndex]).insertAfter(tds[colIndex+1]);
				}
				$(thead.spaceElem).insertAfter(thead.spaceElem.nextSibling);
				thead.jbDropColumnIndex = colIndex+1;
			}
		}
		if (nearLeft) {
			if (thead.spaceElem.previousSibling) {
				var colIndex = calcColumnIndex(thead.spaceElem);
				
				for(var j=0;j<trs.length;j++)
				{
					var tr = trs[j];
					var tds = $(tr).find('>td');
					tr.insertBefore(tds[colIndex],tds[colIndex-1]);
				}
				$(thead.spaceElem).insertBefore(thead.spaceElem.previousSibling);
				thead.jbDropColumnIndex = colIndex-1;
			}
		}
		return aa_stop_prop(e);
	}
		 
	function _dragEnd(e) {
		$(thead.spaceElem).removeClass(settings.draggedSpaceCssClass);
		thead.draggedParent.removeChild(thead.draggedElem);
		document.onmouseup = thead.origDocMouseup;
		thead.draggedElem = null;
		thead.Suspect = null;
		thead.Owner = null;
		
		if (thead.jbDropColumnIndex != -1)
			settings.onDrop(thead.jbDragColumnIndex,thead.jbDropColumnIndex);
		return aa_stop_prop(e);
	}
	 
	function suspectDrag(e,thead,th) {
		thead.Suspect = { owner: "TableColumnsDragAndDrop", mousePos : aa_mousePos(e) };
		return aa_stop_prop(e);
	}

	function checkSuspection(e,thead,th) {
		var mousepos = aa_mousePos(e);
		if (thead.Suspect) {
			var distance = Math.abs(mousepos.x - thead.Suspect.mousePos.x);
			if (distance < 5) return true;
			thead.Suspect = null;
			dragBegin(e,thead,th);
		}
	}

	function unSuspectDrag(e,thead,th) {
		if (thead.Owner == "TableColumnsDragAndDrop") return true;
		thead.Suspect = null;
		return true;
	}

	function dragBegin(e,thead,th) {
		ajaxart_disableSelection(thead);
		thead.Owner = "TableColumnsDragAndDrop";

		var posx = aa_absLeft(th,false);
		var posy = aa_absTop(th,false);

		for(var iter=th;iter && iter != document.body;iter=iter.parentNode) {
			var iterPos = $(iter).css('position');
			if (iterPos == 'absolute' || iterPos == 'fixed' || iterPos == 'relative') {
				posy -= aa_absTop(iter,false);
				posx -= aa_absLeft(iter,false);
				if (iterPos == 'fixed') { posX -= window.scrollX; posY -= window.scrollY; }
				break;
			}
		}
		var oElem = thead.draggedElem = th.cloneNode(true);
		thead.draggedParent = th.parentNode; 
		thead.draggedParent.appendChild(oElem);

		thead.spaceElem = th; 

		$(oElem).addClass(settings.draggedCssClass);
		$(thead.spaceElem).addClass(settings.draggedSpaceCssClass);

		thead.jbDragColumnIndex = calcColumnIndex(th);
		thead.jbDropColumnIndex = -1;
		
		var mousepos = aa_mousePos(e);
		oElem.mouseX = mousepos.x - posx;
		oElem.deltaMouseX = mousepos.x - aa_absLeft(th,false);

		$(oElem).css('position','absolute').css('top',posy+'px').css('left',posx+'px').css('width',$(th).width()+'px');
		thead.origDocMouseup = document.onmouseup;
		document.onmouseup = _dragEnd;
		if(e.preventDefault) e.preventDefault();
		return aa_stop_prop(e);
	}
	
	function calcColumnIndex(th) {
		var parent = th.parentNode;
		var index = 0;
		for(var iter=parent.firstChild;iter;iter = iter.nextSibling) {
			if (iter == th) return index;
			if (iter.tagName.toLowerCase() == 'th') index++;
		}
	}
}


function aa_registerTableHeaderEvent(thead,eventType,func,ownerId,activation_mode)
{
	if (thead.EventHandler == null)
	{
		aa_defineElemProperties(thead,'handlers,EventHandler');
		thead.handlers = [];
		thead.EventHandler = function(e)
		{
			var elem = $( (typeof(event)== 'undefined')? e.target : (event.tDebug || event.srcElement)  ); 
		    e = e || event; // IE
		    
		    if (elem[0].tagName.toLowerCase() == 'th')
		    	var th = elem;
		    else
		    	var th = elem.parents('th');
		    if (th.length == 0) return true;
		    
		    if (e.type == 'mousedown')
		    	thead.LastMouseDown = { th: th[0] }; 
		    if (e.type == 'mouseout')
		    	thead.LastMouseDown = null;
		    
			for(var i=0;i<thead.handlers.length;i++)
			{
				var handler = thead.handlers[i];
				if (handler.eventType != e.type) continue;
				if (e.button == 2)
				{
					if (handler.activation_mode == 'right mouse')
						handler.func(e,thead,th[0]);
				}
				else
				{
					var activate = 
						(handler.activation_mode == 'no dominant' && thead.Owner == null) ||  
						(handler.activation_mode == 'suspect' && thead.Suspect != null && thead.Owner == null) ||
						(handler.activation_mode == 'dominant' && thead.Owner == handler.ownerId);
					if (activate)
						handler.func(e,thead,th[0]);
				}
			}
		}
		thead.onmousedown = thead.onmouseout =thead.onmouseup = thead.onmousemove = thead.EventHandler;
	}
	thead.handlers.push({eventType : eventType, func: func, ownerId: ownerId, activation_mode : activation_mode } )
}






aa_gcs("itemlist", {
    XmlItems: function (profile, data, context) {
        var parent = aa_first(data,profile,'ParentXml',context);
        if (!parent) { 
        //    ajaxart.log("XmlItems - parent is empty","error"); 
            return []; 
        }
        var tag = aa_text(data,profile,'Tag',context);
        var items = aa_xpath(parent,tag);
        if (aa_paramExists(profile,'Filter')) {
            var newitems = [];
            for(var i=0;i<items.length;i++)
                if ( aa_bool([items[i]],profile,'Filter',context) )
                    newitems.push( items[i] );
            
            items = newitems;
        }
        items.Parent = parent;
        items.Tag = tag;
        items.addItem = function(item,addSettings) {
            if (item.nodeType != 1) 
                return ajaxart.log('trying to add non xml item to XmlItems','error');

            addSettings = addSettings || { location: 'last' };
            var added = false;
            if (addSettings.location == 'afterItem') {
                var index = addSettings.itemIndex;
                if (index == this.length-1) {
                    addSettings.location = 'last'; 
                } else {
                    parent.insertBefore(item,this[index+1]);
                    this.push(this[index]);
                    this[index] = item;
                    added = true;
                }
            }
            if (!added && addSettings.location == 'first' && this.length > 0) {
                parent.insertBefore(item,this[0]);
                this.push(this[0]);
                this[0] = item;

                added = true;
            }
            if (!added) {  // last
                this.push(item);
                parent.appendChild(item);
            }
            aa_triggerXmlChange(item);
        };
        items.MoveBefore = function(item,beforeItem) {
            parent.insertBefore(item,beforeItem);
            aa_triggerXmlChange(parent);
        };
        items.MoveToEnd = function(item) {
            parent.appendChild(item);
            aa_triggerXmlChange(parent);
        };
        items.doDeleteItem = function(item) {
            aa_remove(item);
            aa_triggerXmlChange(parent,{ type: 'delete', deletedElem: item });
        };
        ajaxart.run(data,profile,'AutoFirstItem',aa_ctx(context,{ XmlItems:items }));
        return items;
    }
});
aa_gcs("xmlitems", {
    AutoFirstItem: function(profile, data, context) {
        var items = context.vars.XmlItems;

        var defaultXml = aa_first(data,profile,'DefaultXml',context);
        var itemsCount = aa_int(data,profile,'ItemsCount',context);
        for (i=items.length; i<itemsCount; i++)
            addEptyItem(i);

        function addEptyItem(index) {
            var newItem = aa_createElement(items.Parent,items.Tag);

            if (defaultXml)
                ajaxart.xml.copyElementContents(defaultXml,newItem);

            items.push(newItem);

            var listenerID = aa_bindXmlChange(newItem,function(changeType) {

                if (changeType == 'default value') return;

                var addAfter;
                for (i=index; i<itemsCount; i++)// if one of the items after us was already attached, we should come before
                    if (items[i].parentNode)
                        addAfter = items[i];

                if (addAfter)
                    items.Parent.insertBefore(newItem,addAfter);
                else
                    items.Parent.appendChild(newItem);     // TODO: insert first

                aa_unbindXmlChange(listenerID);

                ajaxart.run(data,profile,'OnAdded',context);

            },context);

            aa_bind(items,'initContainer',function(itemlistCntr) {
                aa_bind(itemlistCntr,'detach',function() {
                    aa_unbindXmlChange(listenerID);
                });
            });
        }
    }
});

aa_gcs("field", {
    ItemList: function (profile, data, context) 
    {
        var field = {
            Title: aa_multilang_text(data, profile, 'Title', context),
            FieldData: function (data) { return data; },
            IsItemList: true
        };
        field.Id = aa_text(data, profile, 'ID', context);
        field.ID = [field.Id];
        field.SectionStyle = aa_first(data,profile,'SectionStyle',context);
        
        var ctx = aa_ctx(context, { _Field: [field] });
        field.View = aa_first(data, profile, 'View', ctx);
        field.Control = function (data1, ctx) {
            var ctx2 = aa_ctx(ctx,{});
            aa_trigger(field,'ModifyInstanceContext',{ Context: ctx2, FieldData: data1 });
            
            var itemlist = aa_create_itemList(field,ctx2,data1);
            itemlist.Fields = ajaxart.runsubprofiles(data, profile, 'Field', aa_merge_ctx(context, ctx2));
            itemlist.VisibleFields = [];
            for(var i=0;i<itemlist.Fields.length;i++) {
                if (itemlist.Fields[i].CalculatedOnly) itemlist.Fields[i].Calculate(data1,ctx2);
                if (itemlist.Fields[i].IsHidden ) continue;
                if (itemlist.Fields[i].IsFieldHidden && itemlist.Fields[i].IsFieldHidden(data1,ctx) ) continue;
                itemlist.VisibleFields.push(itemlist.Fields[i]);
            }
            aa_trigger(field,'innerFields',{ Context: ctx2, FieldData: data1, Fields: itemlist.VisibleFields });

            aa_renderStyleObject2(field.View,itemlist,data1,field,ctx2);
            itemlist.el.jbApiObject = itemlist.el.jbItemList = itemlist;
            aa_trigger(field, 'initItemList', itemlist); // allows aspects to alter the itemlist (e.g. incremental build)

            itemlist.Refresh();
            itemlist.el.jbContext = ctx2;
            
            if (field.SectionStyle) return [ aa_wrapWithSection(itemlist.el,field,field.SectionStyle,data1,ctx2) ];
            return [itemlist.el];
        };
        ajaxart.runsubprofiles(data, profile, 'FieldAspect', ctx);

        return [field];
    },
    DragAndDropItemsHandle: function(profile,data,context) {
        var field = {
          Id: aa_text(data,profile,'ID',context),
          Title: aa_multilang_text(data,profile,'Title',context),
          Style: aa_first(data,profile,'Style',context)
        };
        field.ID = [field.Id];
        field.Control = function(field_data,ctx) {
            if (ctx.vars.ItemList) {
                if (ctx.vars.ItemList && !ctx.vars.ItemList[0].DragAndDropInitiated) {
                    ctx.vars.ItemList[0].DragAndDropInitiated = true;
                    var itemlist = ctx.vars.ItemList[0];
                    var draggedCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedElement',context) , null, 'draggedItem' );
                    var draggedSpaceCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedSpace',context) , null, 'draggedItemSpace' );

                    var items = itemlist.itemlistCntr.Items;
                    if (!items.MoveBefore) {
                        ajaxart.log("DragAndDropItemsHandle : itemlist does not support moving items","error");
                        return [ document.createElement("div") ];
                    }
                    
                    aa_dragDropItems({
                        parent: itemlist.ParentOfItems,
                        isItemElement: function(elem) { return elem.jbItem != null; },
                        moveBefore: function(elem,beforeElem) {
                            items.MoveBefore(elem.jbItem[0],beforeElem.jbItem[0]);
                        },
                        moveToEnd: function(elem) {
                            items.MoveToEnd(elem.jbItem[0]);
                        },
                        draggedSpaceCssClass: draggedSpaceCssClass,
                        draggedCssClass: draggedCssClass,
                        canStartDrag: function(mouseX,mouseY) {
                            var elem = document.elementFromPoint(mouseX, mouseY);
                            if ($(elem).hasClass('fld_' + field.Id))
                                return true;
                            else if ($(elem).parents(".fld_" + field.Id).length && 
                                $(elem).parents(".fld_" + field.Id).parents().is(itemlist.Ctrl))
                                return true;
                            else 
                                return false;
                        }
                    });
                }
            }
            if (ctx.vars.ItemList[0].itemlistCntr.Items.MoveBefore) {   // support D&D
                var ctx2 = aa_merge_ctx(context,ctx);
                return [aa_renderStyleObject(field.Style,{},ctx2,true)];
            } else return [ document.createElement("div")];
        }
        ajaxart.runsubprofiles(data,profile,'FieldAspect',aa_ctx(context,{_Field: [field]}));
        
        return [field];
    }
});
aa_gcs("field_aspect", {
    ItemListContainer: function (profile, data, context) {
        var field = context.vars._Field[0];
        jBart.bind(field,'ModifyInstanceContext',function(args) {
            var items = ajaxart.run(args.FieldData, profile, 'Items', aa_ctx(context,args.Context));
            args.Context.vars.ItemListCntr = [aa_itemlistContainer(items,field.Id,field)];
            
            jBart.trigger(field,'initItemlistCntr',args.Context.vars.ItemListCntr[0]);
        });
        field.hasItemlistContainer = true;
    },
    ItemListSelectionWithKeyboard: function (profile,data,context)
    {
        var field = context.vars._Field[0];
        var enterActivatesClick = aa_bool(data,profile,'EnterActivatesItemClick',context);

        aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
            var input = $(cell).find('input');
            var cntr = ctx.vars.ItemListCntr && ctx.vars.ItemListCntr[0];

            input.keydown(function(e) {
                if (e.keyCode == 40 || e.keyCode == 38) {   // arrow down/up
                    if (cntr.SelectionKeyDown) cntr.SelectionKeyDown(e); // delegate to cntr selection
                    return false;
                } else if (e.keyCode == 13 && cntr.SelectedElement && enterActivatesClick) {
                    var selected = cntr.SelectedElement;
                    $(selected).click();
                }
                
              return true;                  
            });
        },'ItemListSelectionWithKeyboard');
    },    
    CustomizeTableHeader: function (profile, data, context) {
        var field = context.vars._Field[0];
        var cssClass = aa_attach_global_css( aa_text(data,profile,'Css',context) , null, field.Id+'_header' );
        var colspan = aa_int(data,profile,'ColSpan',context);
        
        jBart.bind(field,'ModifyTableHeader',function(args) {
            $(args.th).addClass(cssClass);
            if (colspan) $(args.th).attr('colspan',colspan);
        },'CustomizeTableHeader');
    },
    PopupOfTableHeader: function (profile, data, context) {
        var field = context.vars._Field[0];
        var popupStrategy = aa_first(data,profile,'OpenPopup',context);

        jBart.bind(field,'ModifyTableHeader',function(args) {
          var ctx2 = aa_ctx(context,{ControlElement: [args.th]});

          var popupAdapter = {
            wrapper: args.th,
            $wrapper: $(args.th),
            openPopup: function() {
              ajaxart.runNativeHelper(data,profile,'OpenPopup',ctx2);
            },
            closePopup: function() {
            }
          };
          aa_renderStyleObject(popupStrategy,popupAdapter,ctx2,true,{ funcName: 'attach'});
          aa_apply_style_js(popupAdapter,popupStrategy,ctx2,'attach');
        },'PopupOfTableHeader');
    }
});

aa_gcs("itemlist_aspect", {
    ItemSelection: function (profile, data, context) 
    {
        var selectionClass = aa_attach_global_css( aa_text(data,profile,'Css',context) , null, 'selected' ) + ' aa_selected';
        var mouseSupport = aa_text(data,profile,'MouseSupport',context);
        var alwaysOneSelected = aa_bool(data,profile,'AlwaysOneSelected',context);
        var hasSelectedByDefault = aa_paramExists(profile,'SelectedByDefault');
        jBart.bind(context.vars._Field[0], 'initItemList', function (itemlist) 
        {
            var ItemListCntr = itemlist.itemlistCntr;
            
            ItemListCntr.SetNewSelected = function(selectedElement) {
                var prevSelectedElement = ItemListCntr.SelectedElement; 
                if (prevSelectedElement == selectedElement) return;
                ItemListCntr.SelectedElement = selectedElement;

                var args = { 
                    PrevSelectedElem: prevSelectedElement, 
                    PrevSelectedItem: prevSelectedElement && prevSelectedElement.jbItem,
                    SelectedElem: ItemListCntr.SelectedElement, 
                    SelectedItem: ItemListCntr.SelectedElement && ItemListCntr.SelectedElement.jbItem
                };
                ItemListCntr.trigger('showSelection',args);
                ItemListCntr.trigger('selectionChanged',args);
            }
            ItemListCntr.bind('showSelection',function(selectionArgs) {
                if (selectionArgs.PrevSelectedElem)
                    $(selectionArgs.PrevSelectedElem).removeClass(selectionClass);
                
                $(selectionArgs.SelectedElem).addClass(selectionClass);
            },'ItemSelection');

            ItemListCntr.SelectionKeyDown = function(e) { ItemListCntr.trigger('selectionKeyDown',e); }
            ItemListCntr.bind('selectionKeyDown',function(e) {
                var current = ItemListCntr.SelectedElement;
                var isDown = e.keyCode == 40, isUp = e.keyCode == 38;
                var elements = itemlist.GetElements();
                var index = -1;
                for(var i=0;i<elements.length;i++) {
                    if (elements[i]==current) {
                        index = i;
                        break;
                    }
                }
                var newSelected = elements[0];
                if (isDown && index+1<elements.length) newSelected = elements[index+1];
                if (isUp && index-1>=0) newSelected = elements[index-1];
                
                ItemListCntr.SetNewSelected(newSelected);
            },'ItemSelection');

            if (aa_paramExists(profile,'OnSelect',true)) {
                ItemListCntr.bind('selectionChanged',function(selectionArgs) {
                    var item = selectionArgs.SelectedItem;
                    var ctx = aa_ctx(itemlist.Context,{ ControlElement: selectionArgs.SelectedElem });
                    ajaxart.run(item,profile,'OnSelect',aa_merge_ctx(context,ctx));
                },'ItemSelection');
            }
            
            if (mouseSupport != 'none') {
                itemlist.bind('itemElement',function(element) {
                    var evt = 'mousedown';
                    if (mouseSupport == 'mouse click') evt = 'click';
                    if (mouseSupport == 'mouse hover') evt = 'mouseover';
                    
                    $(element).bind(evt,function() {
                        ItemListCntr.SetNewSelected(element);
                    });
                },'ItemSelection');
            }
            
            function ensureOneSelected() {
                if (ItemListCntr.SelectedElement) return;
                var elements = itemlist.GetElements();
                if (elements[0]) ItemListCntr.SetNewSelected( elements[0] );
            }
            function selectByDefault() {
                var selectedItem = aa_first(ItemListCntr.Items,profile,'SelectedByDefault',context);
                var elements = itemlist.GetElements();
                for(var i=0;i<elements.length;i++) {
                    if (elements[i].jbItem[0] == selectedItem) {
                        ItemListCntr.SetNewSelected( elements[i] );
                        return;
                    }
                }
            }
            
            itemlist.bind('refresh',function() {
                var prevSelection = ItemListCntr.SelectedElement;
                ItemListCntr.SelectedElement = null;
                if (hasSelectedByDefault) selectByDefault();
                if (!ItemListCntr.SelectedElement && alwaysOneSelected) ensureOneSelected();

                if (!ItemListCntr.SelectedElement) {
                    ItemListCntr.SelectedElement = prevSelection;
                    ItemListCntr.SetNewSelected(null);
                }
            });
            itemlist.bind('refreshItemElement',function(args) {
                if (ItemListCntr.SelectedElement == args.PreviousElement) {
                    ItemListCntr.SetNewSelected(args.NewElement);
                }
            });
            
            if (alwaysOneSelected) {
                ItemListCntr.bind('afterItemDeleted',function(args) {
                    if (args.ItemElement == ItemListCntr.SelectedElement) {
                        ItemListCntr.SelectedElement = null;
                        ensureOneSelected();
                    }
                },'ItemSelection');
                ItemListCntr.bind('afterItemAdded',function(args) {
                    if (!ItemListCntr.SelectedElement) ensureOneSelected();
                },'ItemSelection');
            }
            
        },'ItemSelection');
    },
    UpdateOnAddOrDeleteItem: function (profile, data, context) 
    {
        jBart.bind(context.vars._Field[0], 'initItemList', function (itemlist) 
        {
            ItemListCntr = itemlist.itemlistCntr;
            
            aa_bind(ItemListCntr,'itemDeleted',function(args) {
                itemlist.ParentOfItems.removeChild( args.ItemElement );
            },'UpdateOnAddOrDeleteItem');
            aa_bind(ItemListCntr.Items,'itemDeleted',function(args) {
                itemlist.ParentOfItems.removeChild( args.ItemElement );
            },'UpdateOnAddOrDeleteItem');
            
            aa_bind(ItemListCntr,'itemAdded',function(args) {
                itemAdded(itemlist,args);
            },'UpdateOnAddOrDeleteItem');

            aa_bind(ItemListCntr.Items,'itemAdded',function(args) {
                itemAdded(itemlist,args);
            },'UpdateOnAddOrDeleteItem');
            
        },'UpdateOnAddOrDeleteItem');

        function itemAdded(itemlist,args) {
            var elem = itemlist.ElementOfItem(args.Item);
            args.ItemElement = elem;
            itemlist.AppendItemElement(elem,args.addSettings);
            aa_element_attached(elem);
            elem.scrollIntoView();        
        }
    },
    RefreshOnItemsChange: function (profile, data, context)
    {
        var field = context.vars._Field[0];
        aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
            if (!ctx.vars.ItemListCntr) return;
            var ItemListCntr = ctx.vars.ItemListCntr[0];
            ItemListCntr.bind('itemsChanged',function() {
                aa_refresh_cell(cell,ctx);
            },'RefreshOnItemsChange'+field.Id);
            
        },'RefreshOnItemsChange');      
    },
    CssForItem: function (profile, data, context)
    {
        var cssClass = aa_attach_global_css( aa_text(data,profile,'Css',context) , null, 'item' );
        aa_bind(context.vars._Field[0],'initItemList',function(itemlist) {
            itemlist.bind('itemElement',function(element) {
                if (aa_bool(element.jbItem,profile,'ConditionOnItem',context))
                    $(element).addClass(cssClass);
            });
        });     
    },
    CssClassForItem: function (profile, data, context)
    {
        var cssClass = aa_text(data,profile,'CssClass',context);
        aa_bind(context.vars._Field[0],'initItemList',function(itemlist) {
            itemlist.bind('itemElement',function(element) {
                if (aa_bool(element.jbItem,profile,'ConditionOnItem',context))
                    $(element).addClass(cssClass);
            });
        });     
    },
    ItemClick: function (profile, data, context)
    {
        var cssClass = aa_cssClass(data,profile,'Css',context);

        jBart.bind(context.vars._Field[0],'initItemList',function(itemlist) {
            itemlist.bind('itemElement',function(element) {
                $(element).addClass(cssClass);
                $(element).click(function() {
                    var ctx = aa_ctx(context,{ ControlElement: [element], ItemList: [itemlist], ItemListCntr: [itemlist.cntr]});
                    ctx = aa_contextWithEventExtraVars(ctx);
                    ajaxart.run(element.jbItem,profile,'OnClick',ctx);
                });
            },'ItemClick');
        },'ItemClick');     
    },
    RefreshOnSelectionChange: function (profile, data, context)
    {
        aa_field_aspect_RefreshOnSelectionChange(data,profile,context,'ItemListCntr');
    },
    Filter: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        field.FieldData = function(data1,ctx) {
            var out = aa_xpath(data1[0],'@'+field.Id,true);   // TODO: Talk about it with Shai to understand the limitations
            if (field.HasDefaultValue)
                aa_trigger(field, 'FieldData', { Item: data1, FieldData: out, Context: ctx });
            return out;
        };
        field.FilterData = function(data1,ctx) {
            return ajaxart.run(data1,profile,'FieldData',context);
        };
        field.GetFilterObject = function(itemListCntr) {
            return {
                Id: field.Id,
                FieldDataCompiled:ajaxart.compile(profile,'FieldData',context),
                FieldData: function(item) {
                    return this.FieldDataCompiled([item],context);
                },
                FilterType: aa_first(data,profile,'FilterType',context)
            }
        }
        field.InitFilter = function(itemListCntr) {
            aa_initContainerFilters(itemListCntr);
            if (itemListCntr.Filters[field.Id]) return; // already initialized            
            
            var filterObject = this.GetFilterObject(itemListCntr);
            itemListCntr.AddFilter(filterObject);
        };
        aa_field_handler(field,'ModifyControl', function(wrapper,field_data,cell_presentation,ctx,item) {
            if (!ctx.vars.ItemListCntr) return;
            var ItemListCntr = ctx.vars.ItemListCntr[0];
            wrapper.jbItemListCntr = ItemListCntr;
            wrapper.jbQueryXml = ctx.vars._ItemListQueryXml[0];
            field.InitFilter(ItemListCntr);
        },'Filter');
        
        if (aa_bool(data,profile,'ImmediateFilter',context)) {
            aa_field_handler(field,'OnUpdate',function(field,field_data,input,e,extra){
                var cell = input.parentNode;
                if (aa_intest) { runQuery(cell); }
                else {
                    if (cell.jbItemListCntr.filterTimeoutID) clearTimeout(cell.jbItemListCntr.filterTimeoutID);
                    cell.jbItemListCntr.filterTimeoutID = setTimeout(function() { runQuery(cell); },200);
                }
            },'Filter');            
        }
        
        if (context.vars.ItemListCntr) {
            // for dt preview
            var item = context.vars.ItemListCntr[0].Items[0];
            if (item) ajaxart.run([item],profile,'FieldData',context);
        }

        function runQuery(cell) {
            cell.jbItemListCntr.RunQuery(cell.jbQueryXml);
        }
    },
    TableColumnDragAndDrop: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        var draggedCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedElement',context) , null, 'draggedColumn' );
        var draggedSpaceCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedSpace',context) , null, 'draggedColumnSpace' );
        
        jBart.bind(field,'initItemList',function(itemlist) {
            var table = $(itemlist.Ctrl).find('table')[0];
            if (!table && itemlist.Ctrl.tagName.toLowerCase() == 'table') table = itemlist.Ctrl;
            if (!table) return;
            
            var reorderHappened = false;
            
            var permutation = [];
            
            aa_dragAndDropTableColumns(table,{
                draggedSpaceCssClass: draggedSpaceCssClass,
                draggedCssClass: draggedCssClass,
                onDrop: function(dragIndex,dropIndex) {
                    reorderHappened = true; 
                    var maxIndex = Math.max(dragIndex,dropIndex);
                    if (permutation.length < maxIndex) {
                        for(var i=permutation.length;i<=maxIndex;i++)
                            permutation[i] = i;
                    }
                    if (dropIndex > dragIndex) {
                        for(var i=dragIndex;i<dropIndex;i++) 
                            swap(permutation,i,i+1);
                    } else {
                        for(var i=dragIndex;i>dropIndex;i--) 
                            swap(permutation,i-1,i);
                    }
                }
            });
            
            itemlist.bind('itemElement',function(itemElement) {
                if (!reorderHappened) return;
                // we need to reorder the tds by the drag and drop order
                var tds = $(itemElement).find('>td');
                for(var index=0;index<tds.length;index++) {
                    var nextIndex = (index < permutation.length) ? permutation[index] : index;
                    var nextTD = tds[nextIndex];
                    if (nextTD)
                        itemElement.appendChild(nextTD);
                }
            });
        },'TableColumnDragAndDrop');

        function swap(arr,i,j) {
            var x = arr[i];
            arr[i] = arr[j];
            arr[j] = x;            
        }
    },
    DragAndDropItems: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        var draggedCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedElement',context) , null, 'draggedItem' );
        var draggedSpaceCssClass = aa_attach_global_css( aa_text(data,profile,'CssForDraggedSpace',context) , null, 'draggedItemSpace' );

        jBart.bind(field,'initItemList',function(itemlist) {
            var items = itemlist.itemlistCntr.Items;
            if (!items.MoveBefore) return;
            
            aa_dragDropItems({
                parent: itemlist.ParentOfItems,
                isItemElement: function(elem) { return elem.jbItem != null; },
                moveBefore: function(elem,beforeElem) {
                    items.MoveBefore(elem.jbItem[0],beforeElem.jbItem[0]);
                    aa_run(data,profile,'OnDrop',context);
                },
                moveToEnd: function(elem) {
                    items.MoveToEnd(elem.jbItem[0]);
                    aa_run(data,profile,'OnDrop',context);
                },
                draggedSpaceCssClass: draggedSpaceCssClass,
                draggedCssClass: draggedCssClass,
                cntr: itemlist.itemlistCntr
            });
        });     
    },
    LongList: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        var style = aa_first(data,profile,'Style',context);
        var maxTimeToRenderItems = aa_int(data,profile,'MaxTimeToRenderItems',context);
        var maxItems = aa_int(data,profile,'MaxItemsPerPage',context);
        var showMoreText = aa_multilang_text(data,profile,'TextForShowMore',context);
        var autoAddAll = aa_bool(data,profile,'ShowAllItemsOnTimer',context);

        jBart.bind(field,'initItemList',function(itemlist) {
            itemlist.IsLongList = true;
            itemlist.ShowItems = function (fromIndex) {
                if (itemlist.ShowMoreItems) {
                    if (itemlist.ShowMoreItems) itemlist.ShowMoreItems.detach();
                    itemlist.ShowMoreItems = null;
                }
                fromIndex = fromIndex || 0;
                var startTime = new Date().getTime();
                
                var items = this.itemlistCntr.Items;
                // Incremental build is done by an aspect - this code is simple rendering
                for (var i = fromIndex; i < items.length; i++) {
                    var item = [items[i]];
                    var elem = itemlist.ElementOfItem(item,i+1);
                    this.AppendItemElement(elem);
                    
                    var tooLong = false;
                    if (maxTimeToRenderItems && new Date().getTime() - startTime > maxTimeToRenderItems) tooLong = true;
                    if (!tooLong && maxItems && ((fromIndex+i+1) % maxItems) == 0) tooLong = true;
                    if (tooLong && i >= items.length-2) tooLong = false;

                    if (tooLong) {
                        if (autoAddAll) {
                            setTimeout(function() {
                                itemlist.ShowItems(i+1);
                            },200);
                            return; // and do not show ui for 'more items'
                        }

                        itemlist.ShowMoreItems = aa_renderStyleObject(style,{ 
                            nextIndex: i+1,
                            text: showMoreText,
                            itemlist: itemlist,
                            attachShowMore: function(parent) {
                                $(this.control).addClass('jb_show_more');
                                parent.appendChild( this.control );
                            },
                            detach: function() {
                                aa_remove(this.control);
                            },
                            showMore: function() {
                                itemlist.ShowItems(this.nextIndex);
                                aa_element_attached(itemlist.el);
                            }
                        },context);
                        
                        itemlist.ShowMoreItems.attachShowMore(itemlist.ParentOfItems);
                        return;
                    }
                }

            };            
            itemlist.EnsureItemElementExists = function(item) {
                var showMore = $(itemlist.ParentOfItems).find('>.jb_show_more')[0];
                if (!showMore) return;

                var elems = itemlist.GetElements();
                for(var i=0;i<elems.length;i++)
                    if (elems[i].jbItem == item) return elems[i];

                var items = this.cntr.Items;
                for(var i=showMore.jbApiObject.nextIndex;i<items.length;i++) {
                    var elem = this.ElementOfItem([items[i]]);
                    this.AppendItemElement(elem);
                    if (items[i] == item) {
                        itemlist.ParentOfItems.appendChild(showMore);                
                        return elem;
                    }
                }
            }

        });     
    },
    ShowTextWhenNoItems: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        var style = aa_first(data,profile,'Style',context);

        aa_bind(field,'initItemList',function(itemlist) {
            var itemListCntr = itemlist.itemlistCntr;
            var parent = itemlist.ParentOfItems;
            if (!parent) return;

            var no_items_text = aa_multilang_text(data,profile,'Text',context);
            var no_items_after_filter = aa_multilang_text(data,profile,'TextWhenNoItemsMatchFilter',context) || no_items_text;
            var noItemsElement = aa_renderStyleObject(style,{ text: no_items_text, data: no_items_text, itemlist: itemlist },context).el;
            var noItemsFilterElement = aa_renderStyleObject(style,{ text: no_items_after_filter, data: no_items_after_filter, itemlist: itemlist },context).el;
                        
            var refreshFunc = function() { refresh(itemListCntr,parent,noItemsElement,noItemsFilterElement); };
            itemlist.bind('refresh',refreshFunc,'ShowTextWhenNoItems');
            aa_bind(itemListCntr,'afterItemDeleted',refreshFunc,'ShowTextWhenNoItems'+field.Id);
            aa_bind(itemListCntr,'afterItemAdded',refreshFunc,'ShowTextWhenNoItems'+field.Id);
            
        });

        function refresh(itemListCntr,parent,noItemsElement,noItemsFilterElement) {
            if (itemListCntr.Items.length == 0 && itemListCntr.AllItems && itemListCntr.AllItems.length > 0) 
                parent.appendChild(noItemsFilterElement);
            else {
                if (noItemsFilterElement.parentNode == parent) parent.removeChild(noItemsFilterElement);                    
                if (itemListCntr.Items.length == 0) 
                    parent.appendChild(noItemsElement);
                else if (noItemsElement.parentNode == parent)
                    parent.removeChild(noItemsElement);
            }
        }        
    },
    SelectedItemByFilter: function(profile,data,context)
    {
        var items = data;
        for(var i=0;i<items.length;i++)
            if (aa_bool([items[i]],profile,'Filter',context))
                return [items[i]];
    },
    SelectedItemByTextValue: function(profile,data,context)
    {
        var value = aa_text(data,profile,'Value',context);
        for(var i=0;i<data.length;i++)
            if (aa_text([data[i]],profile,'ItemValue',context) == value)
                return [data[i]];
    },
    FilterGroup: function(profile,data,context)
    {
        var field = context.vars._Field[0];
        field.IsFilterGroup = true; 
        var storage = aa_first(data,profile,'StorageForQuery',context);
        var storageID = 'filters_' + (context.vars.ItemListCntr ? context.vars.ItemListCntr[0].Id : '');

        field.FieldData = function() {
            var xmlStr = '';
            if (storage) {
                var value = storage.get(storageID);
                if (value && value.charAt(0) == '<')
                    xmlStr = value;
            }
            return [jBart.parsexml(xmlStr || '<query/>')];
        }
        jBart.bind(field,'ModifyInstanceContext',function(args) {
            args.Context.vars._ItemListQueryXml = args.FieldData; 
        });
        
        jBart.bind(field,'ModifyControl',function(args) {
            var content = args.Wrapper.jbContent || args.Wrapper.firstChild;
            var ctx = content.jbContext;
            var queryXml = ctx.vars._ItemListQueryXml && ctx.vars._ItemListQueryXml[0];
            var cntr = ctx.vars.ItemListCntr && ctx.vars.ItemListCntr[0];
            
            if (queryXml && aa_notEmptyQuery(queryXml) && cntr && cntr.RunQuery) {
                cntr.RunQuery(queryXml);
            }

            if (storage) {
                aa_bind(cntr,'runQuery',function() {
                    storage.set(storageID,ajaxart.xml2text(queryXml));
                });
            }
        });
    }
});

aa_gcs("itemlist_filter", {
    Text: function (profile, data, context) 
    {
        return [{
            FieldDataToColumnData: function(fieldData) {
                return aa_totext(fieldData);
            },
            PrepareQueryData: function(expression) {
                return expression.toLowerCase();
            },
            Match: function(queryData,columnData) {
                if (columnData.toLowerCase().indexOf(queryData) > - 1) return true;
                return false;
            },
            HighlightSelectedText: function(control,highlightClass,queryData) {
                var pattern = queryData;
                
                if (control.innerHTML.toLowerCase().indexOf(pattern) != -1)
                   control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,pattern,highlightClass);
            }
        }];
    },
    TextWords: function (profile, data, context) 
    {
        return [{
            FieldDataToColumnData: function(fieldData) {
                return aa_totext(fieldData);
            },
            PrepareQueryData: function(expression) {
                return aa_text_capitalizeToSeperateWords(expression).toLowerCase();
            },
            Match: function(queryData,columnData) {
                var words = aa_split(queryData,' ',true);
                for (var i=0;i<words.length;i++)
                    if (columnData.toLowerCase().indexOf(words[i]) == - 1) return false;

                return words.length > 0;
            },
            HighlightSelectedText: function(control,highlightClass,queryData) {
                var pattern = queryData;
                
                if (control.innerHTML.toLowerCase().indexOf(pattern) != -1)
                   control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,pattern,highlightClass);
            }
        }];
    },
    ExactMatch: function (profile, data, context) 
    {
        return [{
            FieldDataToColumnData: function(fieldData) {
                return aa_totext(fieldData);
            },
            PrepareQueryData: function(expression) {
                return expression;
            },
            Match: function(queryData,columnData) {
                return (columnData == queryData || (queryData == '{$empty}' && columnData == ''));
            }
        }];
    },
    NumberGTOrEquals: function (profile, data, context) 
    {
        return [{
            FieldDataToColumnData: function(fieldData) {
                return aa_toint(fieldData);
            },
            PrepareQueryData: function(expression) {
                return parseInt(expression);
            },
            Match: function(queryData,columnData) {
                return (columnData >= queryData);
            }
        }];
    },
    ValuesFromItems: function (profile, data, context)
    {
        var field = context.vars._Field[0]; 
        field.RecalculateForEachCell = true; // so ItemListCntr will be available 
        if (!context.vars.ItemListCntr || !field.InitFilter) return;
        var itemListCntr = context.vars.ItemListCntr[0];
        var filterId = field.Id;
        
        var options = [],uniqueNames = {};
        // look in filter values
        field.InitFilter(itemListCntr);
        var dataCol = itemListCntr.DataColumns[filterId];
        for(var i=0;i<dataCol.length;i++) {
            var val = dataCol[i];
            if (uniqueNames[val]) {
                uniqueNames[val]++;
                continue;
            }
            uniqueNames[val] = 1;
            options.push({ code: val });
        }
        
        return [{ Options: options } ];
    }
});

aa_gcs("itemsort", {
    SortItems: function (profile, data, context) 
    {
        var sortDirection = aa_text(data,profile,'SortDirection',context);
        var sortType = aa_first(data,profile,'SortType',context);
        var field = context.vars._Field[0];
        
        aa_register_init_itemlistCntr(field,function(cntr) {
            aa_bind(cntr,'sortItems',function() { doSort(cntr); },'SortItems');
            aa_bind(cntr,'originalItemsChanged',function() {
                cntr.Items = cntr.OriginalItems;
                doSort(cntr);
            });
            
            aa_bind(field,'innerFields',function(args) {
                doSort(cntr);
            },'SortItems_InnerFields');                       

        },'SortItems');

        function doSort(cntr) {
            aa_sort_items(cntr,{
                direction: sortDirection,
                sortType: sortType,
                itemValue: function(item) {
                    return ajaxart.run(item,profile,'ItemValueToSort',context);
                },
                context: context
            });
        }

    },
    Lexical: function (profile, data, context)
    {
        return [{
            compileValue: function(value) {
                return aa_totext(value).toLowerCase();
            },
            sort: function(a,b) {
                if (a.value > b.value) return -1;
                if (a.value == b.value) return 0;
                return 1;
            }
        }];
    },
    Numeric: function (profile, data, context)
    {
        return [{
            compileValue: function(value) {
                return parseInt( aa_totext(value) );
            },
            sort: function(a,b) { return a.value-b.value; }
        }];
    },
    PromoteValues: function (profile, data, context)
    {
        var promoted = aa_split( aa_text(data,profile,'ValuesToPromote',context), ',',true);
        var promotedIndex = {};
        for(var i=0;i<promoted.length;i++)
            promotedIndex[promoted[i]] = i+1;
            
        var maxIndex = promoted.length+1;
        
        return [{
            compileValue: function(value) { return aa_totext(value); },
            sort: function(a,b) {
                var aIndex = promotedIndex[a.value] || maxIndex;
                var bIndex = promotedIndex[b.value] || maxIndex;
                
                return aIndex - bIndex; 
            }
        }];
        
    },
    TableColumnSort: function (profile, data, context)
    {
        var field = context.vars._Field[0];
        var defaultSortType = aa_first(data,profile,'DefaultSortType',context);
        var keepSortState = aa_first(data,profile,'KeepSortState',context);
        var itemlist,thList;
            
        jBart.bind(field,'initItemList',function(_itemlist) {
            itemlist = _itemlist;
            var table = $(itemlist.Ctrl).find('table')[0];

            var sortState = keepSortState && keepSortState.get('') && JSON.parse(keepSortState.get(''));
            var thead = $(table).find('>thead')[0];
            thList = $(thead).find('>tr>th').get();
            aa_registerHeaderEvent(thead,'mouseup',clickHandler,'Sort','no dominant');
            
            if (sortState && sortState.index > -1)
                thClicked(thead,thList[sortState.index]);

            itemlist.itemlistCntr.bind('sortItems',doSort,'TableColumnSort');           
        },'TableColumnSort');

        function clickHandler(e,thead,th) {
            if (!thead.LastMouseDown || thead.LastMouseDown.th != th) return;
            thClicked(thead,th);
        }
        function thClicked(thead,th) {
            if (!th) return;
            if ($(th).hasClass('sort_ascending')) {
                removeCssClasses(thead);
                $(th).addClass('sort_descending');
                changeSort(th,'descending');
            } else if ($(th).hasClass('sort_descending')) {
                removeCssClasses(thead);
                changeSort(null);  // remove the sort
            } else {
                removeCssClasses(thead);
                $(th).addClass('sort_ascending');
                changeSort(th,'ascending');
            }
        }

        function removeCssClasses(thead)    {
            $(thead).find('th').removeClass('sort_ascending').removeClass('sort_descending');
        }

        function changeSort(th,direction) {
            if (th) {
                sortState = { 
                    index:  thList.indexOf(th),
                    direction: direction
                }
            } else 
                sortState = {}; // clear sort
            
            if (keepSortState) keepSortState.set('',JSON.stringify(sortState));
            
            doSort(sortState);
        }
        
        function doSort(sortState) {
            $('body').css('cursor','progress');
            if (!sortState || sortState.index == -1) {
                aa_unsort_items(itemlist.itemlistCntr);
            } else {
                var field = thList[sortState.index] && thList[sortState.index].jbField;
                if (!field) return;
                aa_sort_items(itemlist.itemlistCntr,{
                    direction: sortState.direction,
                    sortType: field.SortType || defaultSortType,
                    itemValue: function(item) {
                      var field_data = field.FieldData ? field.FieldData(item,context) : item;
                      if (field.Label) return field.Label(field_data,context);
                      return field_data;                            
                    }
                });
            }
                
            itemlist.Refresh();
            $('body').css('cursor','auto');
        }

    }
});

aa_gcs("itemlist_item", {
    ItemOfList: function (profile, data, context)
    {
        var elem = aa_first(data,profile,'Item',context);
        if (!elem) return [];
        if (aa_text(data,profile,'Result',context) == 'element') return [elem];
        return elem.jbItem;
    },
    ItemInContext: function (profile, data, context) 
    {
        var elem = context.vars.ControlElement && context.vars.ControlElement[0];
        for(;elem && elem.nodeType == 1;elem = elem.parentNode) {
            if (elem.jbItemElement) return [elem.jbItemElement];
            if ($(elem).hasClass('aa_item')) return [elem];
        }
    },
    ItemLaunchingThePopup: function (profile, data, context) 
    {
        var elem = aa_var_first(context,'PopupLaunchingElement');
        for(;elem && elem.nodeType == 1;elem = elem.parentNode) {
            if (elem.jbItemElement) return [elem.jbItemElement];
            if ($(elem).hasClass('aa_item')) return [elem];
        }
    },
    SelectedItem: function (profile, data, context) 
    {
        var itemListCntr = context.vars.ItemListCntr && context.vars.ItemListCntr[0];
        if (!itemListCntr || !itemListCntr.SelectedElement) return [];
        return [itemListCntr.SelectedElement];
    },
    SpecificItem: function (profile, data, context) {
        var itemList = aa_findItemList(null,context); 
        var item = aa_first(data,profile,'Item',context);
        if (!item || !itemList) return [];
        var elems = itemList.GetElements();
        for(var i=0;i<elems.length;i++) 
            if (elems[i].jbItem[0] == item) return [elems[i]];
        return [];
    },
    LastItem: function (profile, data, context)
    {
        var itemList = context.vars.ItemList && context.vars.ItemList[0];
        return itemList.GetElements().slice(-1);
    }
});

aa_gcs("itemlist_action", {
    DeleteItem: function (profile, data, context) 
    {
        aa_itemlist_deleteItem({
            cntr: aa_var_first(context,'ItemListCntr'),
            itemElement: aa_first(data,profile,'Item',context)
        });
    },
    AddItemToItemList: function (profile, data, context)
    {
        var item = aa_first(data,profile,'Item',context);
        var addObject = aa_itemlist_addItem({
            context: context,
            item: item,
            itemlistID: aa_text(data,profile,'ItemList',context),
            updateAddObject: function(ao) {
                ajaxart.run([ao],profile,'Location',context); // adds addSettings to addObject
            }
        });
        if (addObject) {
          ajaxart.run([item],profile,'DoOnAddedItem',aa_ctx(context,{
              ControlElement: addObject.ItemElement ? [addObject.ItemElement] : []
          }));
        }
    },
    AsLastItem: function (profile, data, context)
    {
        data[0].addSettings = { location: 'last' };
    },
    AsFirstItem: function (profile, data, context)
    {
        data[0].addSettings = { location: 'first' };
    },
    BeforeOrAfterAnItem: function (profile, data, context)
    {
        var id = aa_text(context.vars.Item,profile,'SpecificItemID',context);
        var items = data[0].items;
        var isBefore = (aa_text(data,profile,'Location',context) == 'before');

        for(var i=0;i<items.length;i++) {
            var itemid = aa_text([items[i]],profile,'ItemIdentifier',context);
            if (id == itemid) {
                if (isBefore) {                    
                    if (i == 0) data[0].addSettings = { location: 'first' };
                    else data[0].addSettings = { location: 'afterItem', itemIndex: i-1, item: items[i-1] };
                } else { // after
                    data[0].addSettings = { location: 'afterItem', itemIndex: i, item: items[i] };
                }
                return;
            }
        }
    },
    CloseDetailsReplacingAll: function (profile, data, context)
    {
        if (!context.vars._DetailsReplacingAll) {
            if (!context.vars.ItemList) return;
            var itemlist = context.vars.ItemList[0];
            var topControl = $(itemlist.el).parents('.fld_'+itemlist.cntr.Id)[0].parentNode;
            if (!topControl.jbDetailsReplacingAll) return;
            var detailsReplacingAllObject = topControl.jbDetailsReplacingAll.jbDetailsReplacingAllObject;
        } else {
            var detailsReplacingAllObject = context.vars._DetailsReplacingAll[0];
        }

        var topControl = detailsReplacingAllObject.topControl;
        var itemElement = detailsReplacingAllObject.itemElement;
        var itemlist = detailsReplacingAllObject.itemlist;
        var transition = aa_first(data,profile,'Transition',context);

        if (!transition || window.aa_intest || ajaxart.isIE78) {
            aa_remove(topControl.jbDetailsReplacingAll,true);
            topControl.jbOriginalCtrl.style.display = 'block';
            topControl.jbDetailsReplacingAll = null;
            if (itemElement) {
              itemElement = itemlist.RefreshItemElement(itemElement);
              //aa_scrollToShowElement(itemElement, '');
              itemElement.scrollIntoView();
            }
        } else {
            if (itemElement) itemElement = itemlist.RefreshItemElement(itemElement);
            aa_replace_transition({
              transition: transition,
              elOriginal: topControl.jbDetailsReplacingAll, 
              elNew: topControl.jbOriginalCtrl,
              itemElement: itemElement,
              onBeforeTransitionBegin: function() { $(topControl.jbOriginalCtrl).css({display: 'block'}); },
              onTransitionEnd: function() {
                //aa_scrollToShowElement(itemElement, '');
                if (aa_bool(data,profile,'AutoScrollToMasterItem',context))
                    itemElement.scrollIntoView();
              }
            },context);
        }
        aa_trigger(itemlist,'backFromDetails',{ itemElement: itemElement, context: context });
    },
    NextItemOfDetailsReplacingAll: function (profile, data, context) {
        if (!context.vars._DetailsReplacingAll) return [];
        var detailsReplacingAllObject = context.vars._DetailsReplacingAll[0];
        var item = detailsReplacingAllObject.item[0];
        while(item) {
            item = aa_cntr_getNextItem(detailsReplacingAllObject.cntr,item);
            if (item && aa_bool([item],profile,'FilterForNextItem',context))
                return [item];
        }       
    },
    PrevItemOfDetailsReplacingAll: function (profile, data, context) {
        if (!context.vars._DetailsReplacingAll) return [];
        var detailsReplacingAllObject = context.vars._DetailsReplacingAll[0];
        var item = detailsReplacingAllObject.item[0];
        while(item) {
            item = aa_cntr_getPrevItem(detailsReplacingAllObject.cntr,item);
            if (item && aa_bool([item],profile,'FilterForPrevItem',context))
                return [item];
        }       
    },
    DetailsReplacingAllGotoItem: function (profile, data, context)
    {
        if (!context.vars._DetailsReplacingAll) return;
        var detailsReplacingAllObject = context.vars._DetailsReplacingAll[0];
        var transition = aa_first(data,profile,'Transition',context);

        var newItem = aa_first(data,profile,'Item',context);        
        if (!newItem) return;        
        var newItemElement = aa_find_itemElement(detailsReplacingAllObject.itemlist,newItem);
        if (!newItemElement) return;

        aa_remove(detailsReplacingAllObject.topControl.jbDetailsReplacingAll,true);
        
        aa_openDetailsReplacingAll({
            transition: transition,
            topControl: detailsReplacingAllObject.topControl,
            itemElement: newItemElement,
            itemlist: detailsReplacingAllObject.itemlist,
            detailsPage: detailsReplacingAllObject.detailsPage,
            context: context
        });
    },
    ChangeItemsOfItemlist: function (profile, data, context) {
        var cntr = aa_find_itemlist_container(context,aa_text(data,profile,'ItemListContainer',context));
        if (!cntr) return;

        cntr.Items = ajaxart.run(data,profile,'Items',context);
        if (cntr.RefreshDataColumns) {
            cntr.AllItems = cntr.Items;
            cntr.RefreshDataColumns();    
        }
    },
    OpenDetailsReplacingAll: function (profile, data, context)
    {
        var itemlist;
        var fieldToReplace = aa_text(data,profile,'FieldToReplace',context);
        if (aa_text(data,profile,'ItemList',context)) {             // 1. If specified, use specific itemlist
            var itemlistID =  aa_text(data,profile,'ItemList',context)
            var root = ajaxart.xml.root(context.vars.ControlElement[0]);
            var jItemlistElem = $(root).find('.fld_' + itemlistID);
            if (jItemlistElem && jItemlistElem[0] && jItemlistElem[0].jbItemList)
                itemlist = jItemlistElem[0].jbItemList;
            else {
                ajaxart.log("cannot find itemlist for " + itemlistID, jItemlistElem.length ? "error" : "location");
                return [];
            }
        }
        if (!itemlist)                                             // 2. If in context, use our itemlist
            itemlist = context.vars.ItemList && context.vars.ItemList[0];
        if (!itemlist) {                                           // 3. Use the last item list from container
            var itemlistContainer = context.vars.ItemListCntr && context.vars.ItemListCntr[0];
            itemlist = itemlistContainer.ItemLists.slice(-1)[0];   
        }
        var itemElement = aa_first(data,profile,'Item',aa_ctx(context, {ItemList: [itemlist]} ));
        var itemlist = aa_findItemList(itemElement);
        if (!itemlist) return;
        var itemlistContainer = itemlist.itemlistCntr;
        
        var topControlContent = $(itemElement).parents('.fld_'+itemlistContainer.Id)[0];
        if (fieldToReplace && aad_find_field(fieldToReplace)[0])
            topControlContent = aad_find_field(fieldToReplace)[0];
        if (!topControlContent || !topControlContent.parentNode) return;
        var topControl = topControlContent.parentNode;
        topControl.jbOriginalCtrl = topControlContent;
        
        var detailsField = aa_first(data,profile,'Details',context);
        if (!detailsField) return;
        var replaceTransition = aa_first(data,profile,'Transition',context);

        aa_openDetailsReplacingAll({
            transition: replaceTransition,
            topControl: topControl,
            itemElement: itemElement,
            itemlist: itemlist,
            detailsPage: detailsField,
            context: context
        });
    },
    RefreshItem: function (profile, data, context)
    {
        var itemElement = aa_first(data,profile,'Item',context);
        var itemlist = aa_findItemList(itemElement);
        if (!itemlist) return;
        itemlist.RefreshItemElement( itemElement );
    },
    ClickOnItem: function (profile, data, context)
    {
        var itemElement = aa_first(data,profile,'Item',context);
        if (!itemElement) return;

        var old_in_test = window.aa_intest;
        var old_intest_topControl = window.aa_intest_topControl;

        var noTransition = aa_bool(data,profile,'NoTransitions',context);
        if (noTransition) {
            window.aa_intest = true;
            window.aa_intest_topControl = document;
        }

        aa_setEventExtraVariables( ajaxart.runsubprofiles(data,profile,'ExtraVariable',context) );
        $(itemElement).click();
        aa_removeEventExtraVariables();
        if (noTransition) {
            window.aa_intest = old_in_test;
            window.aa_intest_topControl = old_intest_topControl;
        }
    },
    ToggleDetailsInplace: function (profile, data, context)
    {
        var itemElement = aa_first(data,profile,'Item',context);
        var itemlist = aa_findItemList(itemElement);
        if (!itemlist) return;
        if (itemElement.jbDetailsOpen || ( itemElement.nextSibling && itemElement.nextSibling.jbIsDetailsOpen) ) {
            // close
            if (itemlist.CloseInplace) itemlist.CloseInplace(itemElement);
            itemElement.jbDetailsOpen = false;
            // now refresh the item
            itemlist.RefreshItemElement( itemElement );
        } else {
            // open
            var detailsField = aa_fieldById(aa_text(data,profile,'DetailsField',context),itemlist.Fields);
            var detailsElement = document.createElement('div');
            detailsElement.jbItem = itemElement.jbItem;
            detailsElement.jbItemElement = itemElement;
            
            if (detailsField) {
                aa_fieldControl({ Field: detailsField, Item: itemElement.jbItem, Wrapper: detailsElement, Context: itemlist.Context });
                aa_show(detailsElement); // in case it's hidden
            } else {
            }
            if (itemlist.OpenInplace) itemlist.OpenInplace(itemElement,detailsElement);
            itemElement.jbDetailsOpen = true;
        }
        if (aa_bool(data,profile,'CloseOtherInplaceDetails',context) && itemElement) {
            var elems = $(itemElement).siblings();
            for(var i=0;i<elems.length;i++)
                if (elems[i].jbDetailsOpen) {
                    itemlist.CloseInplace(elems[i]);
                    elems[i].jbDetailsOpen = false;
                }
        }
    }
});

function aa_itemlistContainer(items,id,field) {
    var cntr = {
        Id: id,
        Items: items,
        OriginalItems: items,
        ItemLists: []
    };
    items.cntr = cntr;
    // .bind ,.trigger are here to make the using code look a bit nicer
    cntr.bind = function(evt,callback,id) { aa_bind(cntr,evt,callback,id); }
    cntr.trigger = function(evt,obj) { aa_trigger(cntr,evt,obj); }

    if (ajaxart.xtmls_to_trace && ajaxart.xtmls_to_trace.length && field) {     // Tracing container 
        for (i in ajaxart.xtmls_to_trace) {  
            if (field.XtmlSource[0].script == ajaxart.xtmls_to_trace[i].xtml) 
                ajaxart.xtmls_to_trace[i].itemlistCntr = cntr;
        }
    }

    return cntr;
}

function aa_create_itemList(field,context,inputData) {
    var itemlist = {
        Id: field.Id, id: field.Id,
        Fields: [],
        InputData: inputData
    };
    itemlist.context= itemlist.Context = aa_ctx(context,{ItemList: [itemlist], _Field: [field] });
    itemlist.cntr = itemlist.itemlistCntr = context.vars.ItemListCntr ? context.vars.ItemListCntr[0] : aa_itemlistContainer([],'cntr',field);
    itemlist.cntr.ItemLists.push(itemlist);
    itemlist.classForItem = 'aa_item_' + itemlist.Id;

    itemlist.RenderItem = function (item, elem,itemindex) { // the view should override this method
        itemlist.CreateFieldControls(item,elem,itemindex);
    }
    itemlist.ClearItems = function () {
        aa_empty(this.ParentOfItems, true);
    }
    itemlist.AppendItemElement = function (elem,addSettings) {
        addSettings = addSettings || { location: 'last' };

        if (addSettings.location == 'last') {
            this.ParentOfItems.appendChild(elem);
            return;
        }
        if (addSettings.location == 'first') {
            if (this.ParentOfItems.firstChild) 
                return this.ParentOfItems.insertBefore(elem,this.ParentOfItems.firstChild);
        }
        if (addSettings.location == 'afterItem') {
            for(var iter=this.ParentOfItems.firstChild;iter;iter=iter.nextSibling) {
                if (iter.jbItem[0] == addSettings.item) {
                    this.ParentOfItems.insertBefore(elem, iter.nextSibling);
                    return;
                }
            }
            // not implemented yet
        }

        // default begavior
        this.ParentOfItems.appendChild(elem);
    }
    itemlist.ElementOfItem = function(item,itemindex) {
        var elem = this.ItemTemplate.cloneNode(true);
        $(elem).addClass('aa_item').addClass(this.classForItem);
        elem.jbItem = item;
        this.RenderItem(item, elem,itemindex);
        this.trigger('itemElement',elem);
        this.cntr.trigger('renderItem',elem);
        return elem;
    }
    itemlist.ShowItems = function () {
        itemlist.trigger('beforeItemsShown');
        var items = this.itemlistCntr.Items;
        // Incremental build is done by an aspect - this code is simple rendering
        for (var i = 0; i < items.length; i++) {
            var item = [items[i]];
            var elem = itemlist.ElementOfItem(item,i+1);
            this.AppendItemElement(elem);
        }
        aa_element_attached(this.el);
        itemlist.trigger('afterItemsShown');
    }
    itemlist.Refresh = function () {
        itemlist.trigger('beforeRefresh');
        itemlist.ClearItems();
        itemlist.ShowItems();
        itemlist.trigger('refresh');
    }
    itemlist.SetHtmlTemplate = function (html) {
        this.Ctrl = this.el;
        this.el.jbItemList = itemlist;
        this.ParentOfItems = this.el;
    }
    itemlist.CreateFieldControls = function (item, elem,itemindex) {
        var item = elem.jbItem;
        for (var i = 0; i < this.VisibleFields.length; i++) {
            var field = this.VisibleFields[i];

            var wrapper = $('<div/>')[0];
            itemlist.CreateFieldControl(item, wrapper,field,itemindex);
            elem.appendChild(wrapper);
        }
    }
    itemlist.RefreshItemElement = function(elem) {
        var newElem = this.ElementOfItem(elem.jbItem);
        aa_replaceElement(elem,newElem,true);
        itemlist.trigger('refreshItemElement',{ NewElement: newElem, PreviousElement: elem } );
        return newElem;
    }
    itemlist.CreateFieldControl = function (item, wrapper,field,itemindex) {
        var ctx = aa_ctx(this.Context,{ _Field: [field], _Item: item , _ClassForItem: itemlist.classForItem, _ItemIndex: [itemindex || 0]});
        var fieldData = field.FieldData ? field.FieldData(item, ctx) : item;
        if (field.IsCellHidden && field.IsCellHidden(item,ctx,fieldData)) return;
        aa_fieldControl({ Field: field, Item: item, Wrapper: wrapper, Context: ctx });
    }
    itemlist.GetElements = function() {
        var out=[]; // An aspect can change this logic
        for(var elem=this.ParentOfItems.firstChild;elem;elem=elem.nextSibling)
            if (elem.jbItem) out.push(elem);
        return out;
    }
    // itemlist.bind ,itemlist.trigger are here to make the using code look a bit nicer
    itemlist.bind = function(evt,callback,id) { jBart.bind(itemlist,evt,callback,id); }
    itemlist.trigger = function(evt,obj) { jBart.trigger(itemlist,evt,obj); }
    
    itemlist.itemlistCntr.bind('itemsChanged',function(args) {
        if (!args.uiUpdated) {
            itemlist.Refresh();
            aa_element_attached(itemlist.el);
        }
    });


    if (ajaxart.xtmls_to_trace && ajaxart.xtmls_to_trace.length && field) {     // Tracing container 
        for (i in ajaxart.xtmls_to_trace) {  
            if (field.XtmlSource[0].script == ajaxart.xtmls_to_trace[i].xtml) 
                ajaxart.xtmls_to_trace[i].itemlistCntr = itemlist.cntr;
        }
    }

    return itemlist;
}

function aa_itemlist(itemlist,settings) {
    settings = aa_defaults(settings,{
        templateElem: itemlist.$el.find('.aa_item')
    });
    itemlist.$el.addClass('aa_itemlist');
    itemlist.SetHtmlTemplate('<div><div class="aa_item"/></div>'); // default
    itemlist.ItemTemplate = $(settings.templateElem)[0];
    itemlist.ParentOfItems = itemlist.ItemTemplate.parentNode;
    $(itemlist.ItemTemplate).remove();
}

function aa_horizontal_scroll_itemlist(itemlist,settings) {
    settings.itemTemplate = settings.itemTemplate || itemlist.$el.firstOfClass('aa_item');

    itemlist.ItemTemplate = $(settings.itemTemplate)[0];
    itemlist.ParentOfItems = itemlist.ItemTemplate.parentNode;
    aa_remove(itemlist.ItemTemplate);

    var itemWidth = parseInt(settings.itemWidth.split('px')[0]);
    var itemHeight = parseInt(settings.itemHeight.split('px')[0]);
    var itemsToShow = parseInt(settings.itemsToShow);
    var arrowWidth = parseInt(settings.arrowWidth.split('px')[0]);
    var arrowHeight = parseInt(settings.arrowHeight.split('px')[0]);
    var arrowMargin = parseInt(settings.arrowMargin.split('px')[0]);

    var arrowTop = itemHeight/2 - arrowHeight;
    var arrowLeft = (arrowMargin - arrowWidth)/2;

    var rightMargin = settings.rightMargin || 0;

    itemlist.$el.css('width',itemWidth*itemsToShow + rightMargin + arrowMargin*2).css('height',itemHeight);
    itemlist.$el.find('.body').css('width',itemWidth*itemsToShow+rightMargin).css('height',itemHeight);
    itemlist.$el.find('.left').css('width',arrowMargin);
    itemlist.$el.find('.right').css('width',arrowMargin);
    itemlist.$el.find('.left_arrow').css('width',arrowWidth).css('height',arrowHeight).css('top',arrowTop+'px').css('left',arrowLeft);
    itemlist.$el.find('.right_arrow').css('width',arrowWidth).css('height',arrowHeight).css('top',arrowTop+'px').css('right',arrowLeft);

    itemlist.ItemTemplate.style.width = itemWidth + 'px';
    itemlist.ItemTemplate.style.height = itemHeight + 'px';

    var sliderWidth = itemWidth*itemsToShow;
    var innerBody = itemlist.$el.find('.body_inner');
    var currLeft = 0;

    var leftArrow = itemlist.$el.find('.left_arrow');
    var rightArrow = itemlist.$el.find('.right_arrow');

    leftArrow.click(function() {
        if ($(this).hasClass('disabled')) return;
        if (currLeft > -sliderWidth) return;
        innerBody.animate( { left: '+='+sliderWidth },'slow');
        currLeft += sliderWidth;
        checkDisabled();
    });

    rightArrow.click(function() {
        if ($(this).hasClass('disabled')) return;

        innerBody.animate( { left: '-='+sliderWidth },'slow');
        currLeft -= sliderWidth;
        checkDisabled();
    });

    itemlist.bind('afterItemsShown', function() { setTimeout(checkDisabled,1); }) ;
    aa_bind(itemlist,'refresh',function() { checkDisabled(); },'Horizontal Scroll');

    if (settings.onSelection)
        notifyWithSelectionIndex();

    function checkDisabled() {
        if (currLeft == 0) 
            leftArrow.addClass('disabled');
        else 
            leftArrow.removeClass('disabled');

        var lastItem = innerBody.find('>div:last');
        if (lastItem[0] && lastItem[0].offsetLeft) {
            var lastLeft = lastItem[0].offsetLeft + currLeft;
            if (lastLeft + lastItem.outerWidth(true) <= sliderWidth ) 
                rightArrow.addClass('disabled');
            else 
                rightArrow.removeClass('disabled');
        }
    }

    function notifyWithSelectionIndex() {
        aa_bind(itemlist.itemlistCntr,'selectionChanged',function(args) {
            var elem = args.SelectedElem;
            var isFirst = (elem.offsetLeft == currLeft);
            try {
                if (ajaxart.isattached(elem))
                    settings.onSelection(isFirst);
                else {
                    aa_addOnAttach(elem,function() {
                      settings.onSelection(isFirst);  
                    });
                }
            } catch(ex) {
                ajaxart.logException('error calling horiz list onSelect',ex);
            }
        },'horizontal_scroll_itemlist' + itemlist.Id);
    }
}

function aa_findItemList(element,context) {
    if (context && aa_var_first(context,'ItemList')) return aa_var_first(context,'ItemList');
    if (!element && context) element = aa_var_first(context,'ControlElement');
    if (!element) return null;

    for(var iter = element;iter && iter.nodeType == 1;iter=iter.parentNode) {
        if (iter.jbItemList) return iter.jbItemList;
    }
    return null;
}

function aa_find_itemlist_container(context,fieldID) {
    if (!fieldID) return aa_var_first(context,'ItemListCntr');

    // TODO: find it by fieldID
    return null;
}
function aa_initContainerFilters(itemlistCntr)
{
    if (itemlistCntr.RunQuery) return; // already initialized
    
    aa_bind(itemlistCntr,'originalItemsChanged',function() {
        itemlistCntr.AllItems = itemlistCntr.OriginalItems;
        if (itemlistCntr.lastXmlQuery)
            itemlistCntr.RunQuery(itemlistCntr.lastXmlQuery);
        else {
            itemlistCntr.Items = itemlistCntr.AllItems;
        }
    });

    itemlistCntr.Filters = itemlistCntr.Filters || {};
    itemlistCntr.AllItems = itemlistCntr.Items;
    itemlistCntr.DataColumns = {};
    
    itemlistCntr.RefreshDataColumns = function() {
        itemlistCntr.DataColumns = {};
        for(var i in this.Filters) 
            if (this.Filters.hasOwnProperty(i))
                this.RefreshDataColumn(this.Filters[i]);
    }
    itemlistCntr.RefreshDataColumn = function(filter) {
        var column = this.DataColumns[filter.Id] = [];
        for(var j=0;j<this.AllItems.length;j++) {
            var item = this.AllItems[j];
            var fieldData = filter.FieldData(item);
            column.push( filter.FilterType.FieldDataToColumnData(fieldData) );
        }
    }
    itemlistCntr.AddFilter = function(filter) {
        this.Filters[filter.Id] = filter;        
//        this.RefreshDataColumn(filter);
    }

    itemlistCntr.RunQuery = function(xmlQuery) {
        this.DataColumns = this.DataColumns || {};

        var logQueryTime = false;
        var startTime = logQueryTime ? new Date().getTime() : 0;
        
        this.lastXmlQuery = xmlQuery;
        this.ItemsVersion = this.ItemsVersion ? this.ItemsVersion+1 : 1; // can be used for caches (e.g. filters/group by/occurrences)
        
        this.FilterData = {};
        
        for (var i=0; i<xmlQuery.attributes.length; i++) {
            var id = xmlQuery.attributes.item(i).name;
            if (!xmlQuery.getAttribute(id)) continue; // empty attribute is no filter
            var filter = this.Filters[id]; 
            if (!filter) continue;
            var filterType = filter.FilterType;
            this.FilterData[id] = filterType.PrepareQueryData ? filterType.PrepareQueryData(xmlQuery.getAttribute(id)) : xmlQuery.getAttribute(id);

            if (!this.DataColumns[id]) this.RefreshDataColumn(filter);  // lazy creation of filter
        }
        
        // now we should run the filters and intersect the results
        var cols = {};
        var prevCol = null,lastCol=null;
        for(var filterId in this.FilterData) {
            if (!this.FilterData.hasOwnProperty(filterId)) continue;
            var col = [];
            var filter = this.Filters[filterId];
            var filterType = filter.FilterType;
            var filterData = this.FilterData[filterId];
            var dataColumn= this.DataColumns[filterId];
            for(var j=0;j<dataColumn.length;j++) {
                if (prevCol && !prevCol[j]) {
                    col[j] = false; // no need to check this value. it has not passed previous filters
                } else {
                    col[j] = filterType.Match(filterData,dataColumn[j]);
                }
            }
            lastCol = prevCol = col;
        }
        // here we need to check only lastCol (because it integrated previous columns)
        if (lastCol) {
            var items = [];
            for(var j=0;j<this.AllItems.length;j++) {
                if (lastCol[j]) { // passed the filter
                    items.push( this.AllItems[j] );
                }
            }
            this.Items = items;
        } else {
            this.Items = this.AllItems;
        }
        this.FilteredDataColumn = lastCol;
        
//        this.trigger('sortItems',{});
        this.trigger('itemsChanged',{});
        this.trigger('runQuery',{});
        
        if (logQueryTime) {
            var time = new Date().getTime() - startTime;
            ajaxart.log('RunQuery Time - ' + time,'timing');
        }
    }
    
    itemlistCntr.GetFilterOfSpecificResult = function(item,field_data) {
        for(var i in this.Filters) {
            if (!this.Filters.hasOwnProperty(i)) continue;
            var filter = this.Filters[i];
            if (filter.FieldData) {
                var filterFieldData = filter.FieldData(item);
                if (filterFieldData && filterFieldData[0] && field_data[0] && filterFieldData[0] == field_data[0])
                    return filter;
            }
        }
        return null;
    }
    itemlistCntr.GetFilterQueryData = function(filter) {
        return this.FilterData && this.FilterData[filter.Id];
    }    
}
function aa_calculateFilterOccurrences(itemlistCntr,filterId,filteredOccurrences)
{
    itemlistCntr.DataColumns = itemlistCntr.DataColumns || {};
    itemlistCntr.ItemsVersion = itemlistCntr.ItemsVersion || 1;
    
    itemlistCntr.Occurrences = itemlistCntr.Occurrences || {};
    itemlistCntr.FilteredOccurrences = itemlistCntr.FilteredOccurrences || {}; 
    itemlistCntr.OccurrencesVersions = itemlistCntr.OccurrencesVersions || {};
    if (itemlistCntr.OccurrencesVersions[filterId] == itemlistCntr.ItemsVersion) return; // already calculated
    if (filteredOccurrences && !itemlistCntr.FilteredDataColumn) filteredOccurrences= false;
    
    var occ = {},filteredOcc = {};
    if (!itemlistCntr.DataColumns[filterId]) {
        itemlistCntr.RefreshDataColumn(itemlistCntr.Filters[filterId]);
    }

    var dataCol = itemlistCntr.DataColumns[filterId];
    for(var i=0;i<dataCol.length;i++) {
        var val = dataCol[i];
        occ[val] = occ[val] ? occ[val]+1 : 1; 
        if (filteredOccurrences && itemlistCntr.FilteredDataColumn[i] ) {
            filteredOcc[val] = filteredOcc[val] ? filteredOcc[val]+1 : 1; 
        }
    }
    itemlistCntr.Occurrences[filterId] = occ;
    if (filteredOccurrences) {
        itemlistCntr.FilteredOccurrences[filterId] = filteredOcc; 
    }
    itemlistCntr.OccurrencesVersions[filterId] = itemlistCntr.ItemsVersion;
}

// aa_register_init_itemlistCntr allows a field aspect to init an itemlistCntr (e.g. set default sort or filter)
function aa_register_init_itemlistCntr(field,callback,identifier)
{
    if (field.hasItemlistContainer) {
        // the field itself has ItemListCntr aspect
        jBart.bind(field,'initItemlistCntr',callback,identifier);
    } else {
        // the field in inside the itemlist container
        aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
            if (!ctx.vars.ItemListCntr) return;
            callback(ctx.vars.ItemListCntr[0]);
        },identifier);
    }
}
function aa_unsort_items(itemlistCntr)
{
    if (itemlistCntr.ItemsBeforeSort)
        itemlistCntr.Items = itemlistCntr.ItemsBeforeSort;
}

// settings include: direction, sortType, itemValue (function), context
function aa_sort_items(itemlistCntr,settings)
{
    var context = settings.context;
    var sortType = settings.sortType;
    if (!sortType) return;
    
    itemlistCntr.ItemsVersion = itemlistCntr.ItemsVersion || 1;
    if (itemlistCntr.ItemsBeforeSortVersion != itemlistCntr.ItemsVersion) {
        itemlistCntr.ItemsBeforeSort = itemlistCntr.Items;
        itemlistCntr.ItemsBeforeSortVersion = itemlistCntr.ItemsVersion;
    }
    
    var arr = [];
    
    for(var i=0;i<itemlistCntr.Items.length;i++) {
        var item = [itemlistCntr.Items[i]];
        var val = settings.itemValue(item);
        arr[i] = { index: i, value: sortType.compileValue(val) };
    }
    arr.sort(sortType.sort);
    
    // now create the new array
    var newArr = [];
    for(var i=0;i<arr.length;i++) {
        newArr.push( itemlistCntr.Items[arr[i].index] );
    }

    if (settings.direction == 'ascending') newArr = newArr.reverse();
    itemlistCntr.Items = newArr;

    aa_bind(itemlistCntr,'appendItemElementLocation',function(args) {
        var valForNewItem = sortType.compileValue( settings.itemValue([args.item]) );
        for(var i=0;i<itemlistCntr.Items.length;i++) {
            var val = sortType.compileValue( settings.itemValue([itemlistCntr.Items[i]]) );
            if ((settings.direction == 'ascending' && valForNewItem < val) || (settings.direction == 'descending' && valForNewItem > val)) {
              if (i==0)
                return $.extend(args.addSettings,{location: 'first'});
              else
                return $.extend(args.addSettings,{location: 'afterItem', item: itemlistCntr.Items[i-1] })
            }
        }
        $.extend(args.addSettings,{location: 'last'});
    },'sort');
}

//aa_itemlist_as_table is used in table styles
function aa_itemlist_as_table(itemlist,settings) 
{
      settings = aa_defaults(settings, { showHeaders: true, titleClass: 'title' });
      
      aa_itemlist(itemlist);
      itemlist.ParentOfItems = itemlist.$el.find('tbody')[0]; 
      itemlist.RenderItem = function (item, elem,itemindex) {
        var fields = itemlist.VisibleFields;
        var cellTemplate = $(elem).find('.aa_cell').remove()[0];
        for(var i=0;i<fields.length;i++) {
          var cell = cellTemplate.cloneNode(true);
          itemlist.CreateFieldControl(item,cell,fields[i],itemindex);
          elem.appendChild(cell);
        }
      }
      var headerTemplate = itemlist.$el.find('.aa_header_field')[0];
      if (headerTemplate) {
          var headerParent = headerTemplate.parentNode;
          $(headerTemplate).remove();
          
          if (settings.showHeaders) {
              var fields = itemlist.VisibleFields;
              for(var i=0;i<fields.length;i++) {
                  var headerCell = headerTemplate.cloneNode(true);
                  headerCell.jbField = fields[i]; // needed for sort and group by
                  var title = aa_fieldTitle(fields[i],itemlist.InputData,itemlist.Context);
                  $(headerCell).find('.' + settings.titleClass).html( title );
                  jBart.trigger(fields[i],'ModifyTableHeader',{th: headerCell, itemlist: itemlist});
                  headerParent.appendChild(headerCell);
              }
          }
      }
      
      itemlist.OpenInplace = function(itemElement,inplaceControl) {
        var inplaceTR = $('<tr class="aa_details_inplace"><td/></tr>');
        inplaceTR.find('td').attr('colspan',$(itemElement).find('>td').length).append(inplaceControl);
        inplaceTR.insertAfter(itemElement);
        itemElement.jbDetailsElement = inplaceTR[0];
        inplaceTR[0].jbIsDetailsOpen = true;
      }
      itemlist.CloseInplace = function(itemElement,inplaceControl) {
        itemElement.jbDetailsElement = itemElement.jbDetailsElement || itemElement.nextSibling;
        if (itemElement.jbDetailsElement) {
          jBart.remove(itemElement.jbDetailsElement);
          itemElement.jbDetailsElement = null;
        }
      }
}

function aa_notEmptyQuery(xmlQuery) 
{
    for (var i=0; i<xmlQuery.attributes.length; i++) {
        var name = xmlQuery.attributes.item(i).name;
        if (xmlQuery.getAttribute(name)) return true;
    }
    return false;
}

function aa_deleteItemFromItemList(itemlist,itemElement)
{
    var ItemListCntr = itemlist.itemlistCntr;
    var items = ItemListCntr.Items,item = itemElement.jbItem[0],found=false;
    for(var i=0;i<items.length;i++) {
      if (items[i] == item) {
          items.splice(i,1);
          found = true;
          if (item.nodeType == 1 && item.parentNode) item.parentNode.removeChild( item );  
          if (items.doDeleteItem) items.doDeleteItem(item);
          break;
      }
    }   
    if ( found ) {
        ItemListCntr.trigger('itemDeleted',{ Item: itemElement.jbItem, ItemElement: itemElement });
        ItemListCntr.trigger('afterItemDeleted',{ Item: itemElement.jbItem, ItemElement: itemElement });
        ItemListCntr.trigger('itemsChanged',{});
        //aa_remove(itemElement);
    }
}

function aa_item_data(obj)
{
    if (!obj) return;
    var context = obj.jbContext || obj.context || obj.Context;
    if (context && context.vars.Item)
        return context.vars.Item[0];
}
function aa_find_itemElement(itemlist,item) {
    var elems = itemlist.GetElements();
    for(var i=0;i<elems.length;i++) {
        if (elems[i].jbItem[0]==item) 
            return elems[i];
    }
    return null;
}
function aa_cntr_getPrevItem(cntr,item) {
    var items = cntr.Items,prev=null;
    for(var i=0;i<items.length;i++) {
        if (items[i] == item) return prev;
        prev = items[i];
    }
    return null;
}

function aa_cntr_getNextItem(cntr,item) {
    var items = cntr.Items;
    for(var i=0;i<items.length;i++) {
        if (items[i] == item) 
            return items[i+1];
    }
    return null;
}

function aa_openDetailsReplacingAll(settings) 
{
    var itemElement = settings.itemElement;
    var itemlistContainer = settings.itemlist.itemlistCntr;
    var context = settings.context;
    var topControl = settings.topControl;

    if (topControl.jbDetailsReplacingAll) {
        aa_remove(topControl.jbDetailsReplacingAll,true);
    }
    var detailsElement = document.createElement('div');
    detailsElement.jbItem = itemElement.jbItem;
    detailsElement.jbItemElement = itemElement;
    detailsElement.jbItemlistCntr = itemlistContainer;

    var detailsReplacingAllObject = {
        cntr: itemlistContainer,
        itemlistContainer: itemlistContainer,
        item: itemElement.jbItem,
        PrevItem: aa_cntr_getPrevItem(itemlistContainer,itemElement.jbItem[0]),
        NextItem: aa_cntr_getNextItem(itemlistContainer,itemElement.jbItem[0]),
        context: context,
        topControl: topControl,
        itemlist: settings.itemlist,
        itemElement: itemElement,
        detailsPage: settings.detailsPage
    };
    detailsElement.jbDetailsReplacingAllObject = detailsReplacingAllObject;

    var ctx2 = aa_ctx(context,{ _DetailsReplacingAll: [detailsReplacingAllObject] });

    aa_fieldControl({ Field: settings.detailsPage, Item: itemElement.jbItem, Wrapper: detailsElement, Context: ctx2,
        DoAfterShow: function() {
            detailsElement.style.display = 'block';  // for async usages
        }
    });

    topControl.jbDetailsReplacingAll = detailsElement;

    if (!settings.transition || window.aa_intest || ajaxart.isIE78) {
        topControl.jbOriginalCtrl.style.display = 'none';
        topControl.appendChild(detailsElement);
        aa_element_attached(topControl);
        aa_scrollToShowElement(detailsElement,'up');
    } else {
        aa_replace_transition({
            transition: settings.transition,
            elOriginal: topControl.jbOriginalCtrl, 
            elNew: detailsElement,
            removeOriginal: function() { $(topControl.jbOriginalCtrl).css({display: 'none'}); },
            onTransitionEnd: function() {
                aa_scrollToShowElement(detailsElement,'up');
                aa_trigger(settings.itemlist,'showDetailsTransitionEnd',{ Item: itemElement.jbItem, itemElement: itemElement, context: settings.context });
            }
          },context);
    }

    aa_trigger(settings.itemlist,'showDetails',{ Item: itemElement.jbItem, itemElement: itemElement, context: settings.context });
}

function aa_text_as_item(showMoreObject) {
    showMoreObject.$el.html( showMoreObject.text );
    showMoreObject.$el.click(function() { 
        showMoreObject.showMore() 
    });
    // Table fix
    var parent = showMoreObject.itemlist.ParentOfItems;
    if (!parent) return;
    var isTable = parent.tagName.toLowerCase() == 'tbody';
    if (isTable) {
        var cols = showMoreObject.itemlist.VisibleFields.length;
        var wrapper = $('<tr class="aa_noitems"><td colspan="' + cols + '" class="td_nocontent"/></tr>')[0];
        $(wrapper).find('>td').append( showMoreObject.$el );
        showMoreObject.$el.addClass("in_table");
        showMoreObject.control = showMoreObject.el = $(wrapper)[0];
        showMoreObject.$el = $(showMoreObject.el);
    }
}

function aa_itemlistcntr_findItemElement(cntr,item) {
    var itemlists = cntr.ItemLists || [];
    for(var i=0;i<itemlists.length;i++) {
        var itemlist = itemlists[i];
        var elems = itemlist.GetElements();
        for(var j=0;j<elems.length;j++)
            if (elems[j].jbItem[0] == item)
                return elems[j];
    }
}

function aa_itemlist_deleteItem(settings) {
    var itemElement = settings.itemElement;
    var cntr = settings.cntr;
    if (!itemElement && settings.item && cntr) {
        itemElement = aa_itemlistcntr_findItemElement(cntr,settings.item);
    }
    if (!cntr || !itemElement || !itemElement.jbItem || !itemElement.jbItem[0]) return;

    var items = cntr.Items,item = itemElement.jbItem[0],found=false;
    for(var i=0;i<items.length;i++) {
      if (items[i] == item) {
          items.splice(i,1);
          found = true;
          if (items.doDeleteItem) 
            items.doDeleteItem(item);
          else if (item.nodeType == 1 && item.parentNode) {
            var parent = item.parentNode;
            if (parent) {
                parent.removeChild(item);
                aa_triggerXmlChange(parent,{ type: 'delete', deletedElem: item });
            }
          }              
          break;
      }
    }   
    if (found) {
        aa_trigger(cntr,'itemDeleted',{ Item: itemElement.jbItem, ItemElement: itemElement });
        aa_trigger(cntr,'afterItemDeleted',{ Item: itemElement.jbItem, ItemElement: itemElement });
        aa_trigger(cntr,'itemsChanged',{ uiUpdated: true });
    }
}

function aa_itemlist_addItem(settings) {
  var item = settings.item, context = settings.context;
  var itemlistID = settings.itemlistID;
  var cntr = settings.cntr || aa_var_first(context,'ItemListCntr');
  if (itemlistID) {
    var control = aa_find_field_controls({ fieldID: itemlistID, context: context })[0];
    if (!control || !control.jbContext) return;
    cntr = control.jbContext.vars.ItemListCntr[0];
    if (!cntr) return;
  }
  var items = cntr.OriginalItems;        
  var addObject = { Item: [item], items: items, addSettings: { location: 'last' } };
  if (settings.updateAddObject) settings.updateAddObject(addObject);
  aa_trigger(cntr,'appendItemElementLocation', { item: settings.item, addSettings: addObject.addSettings});

  if (items.addItem) items.addItem(item,addObject.addSettings);
  if (cntr.Items != cntr.OriginalItems)
    aa_trigger(cntr,'originalItemsChanged');

  cntr.trigger('itemAdded',addObject);
  cntr.trigger('afterItemAdded',addObject);
  cntr.trigger('itemsChanged',{ uiUpdated: true });

  return addObject;
}

function aa_field_aspect_RefreshOnSelectionChange(data,profile,context,cntrVarName) {
    var field = context.vars._Field[0];
    var animation = aa_first(data,profile,'Animation',context);
    var hideWhenNoSelection = aa_bool(data,profile,'HideWhenNoSelection',context);

    if (aa_bool(data,profile,'SelectedItemAsData',context)) {
        field.FieldData = function(data1,ctx) {
            return ctx.vars.SelectedItem || [];
        }
    }

    aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
        var cntr = aa_var_first(ctx,cntrVarName);
        if (!cntr) return;
        
        function refresh(firstTime) {
            var selElement = cntr.SelectedElement ? [cntr.SelectedElement] : [];
            var selItem = cntr.SelectedElement ? cntr.SelectedElement.jbItem : [];
            
            var ctx2 = aa_ctx(field.XtmlSource[0].context,{ SelectedElement: selElement, SelectedItem: selItem, cntrVarName: [cntr] });
            var newField = aa_first(field.XtmlSource[0].input,field.XtmlSource[0].script,'',ctx2);
            cell.Field = newField; 
            var transition = firstTime ? null : animation;
            aa_refresh_cell(cell,ctx2,transition,{
                SelectedElement: selElement, SelectedItem: selItem
            });
            
            if (hideWhenNoSelection && !selElement && cell.firstChild) $(cell.firstChild).css('display','none');
        }
        
        aa_bind(cntr,'selectionChanged',function() {
            refresh();
        },'SelectionContext_'+field.Id);
        
        if (cntr.SelectedElement) {
            if (!context.vars.SelectedElement || context.vars.SelectedElement[0] != cntr.SelectedElement ) 
                refresh(true);
        } else {
            if (hideWhenNoSelection && cell.firstChild) $(cell.firstChild).css('display','none');
        }        
    },'RefreshOnSelectionChange');
}


aa_gcs("itemlist_aspect", {
    GroupItems: function(profile,data,context)
    {
		// Groups are added between item elements, so the html keeps its structure
	
    	var field = context.vars._Field[0];
    	var style = aa_first(data,profile,'Style',context);
    	
    	jBart.bind(field,'initItemList',function(itemlist) {
    		var itemListCntr = itemlist.itemlistCntr;
        	jBart.bind(itemListCntr,'afterItemDeleted',function() { itemlist.Refresh(); },'GroupItems'+field.Id);
        	jBart.bind(itemListCntr,'afterItemAdded',function() { itemlist.Refresh(); },'GroupItems'+field.Id);
        	itemlist.GroupSorter = aa_first(data,profile,'SortGroups',context);
        	
    		itemlist.RefreshGroups = function() {
    	        var items = this.itemlistCntr.Items;
    			itemlist.Groups = {};
    			itemlist.SortedGroups = [];
    			
    			for(var i=0;i<items.length;i++) {
    				var item = [items[i]];
    				var groupName = aa_text(item,profile,'GroupOfItem',context);
    				if (!itemlist.Groups[groupName]) {
    					var group = { Name: groupName, Items: [] };
    					group.DisplayName = aa_text(ajaxart.run(item,profile,'GroupOfItem',context),profile,'GroupDisplayName',context);
    					itemlist.SortedGroups.push(group);
    					itemlist.Groups[groupName] = group;
    				}
    				itemlist.Groups[groupName].Items.push(items[i]);
    			}
    			
    			itemlist.SortGroups();
    		}
    		itemlist.SortGroups = function() {
    			if (!itemlist.GroupSorter) return;
    			
    			var arr = [];
    			for(var i=0;i<itemlist.SortedGroups.length;i++) {
    				var group = itemlist.SortedGroups[i];
    				arr[i] = { index: i, value: itemlist.GroupSorter.compileValue([group.Name]) };
    			}
    			arr.sort(itemlist.GroupSorter.sort);
    			
    			var newArr = [];
    			for(var i=0;i<arr.length;i++) {
    				newArr.push( itemlist.SortedGroups[arr[i].index] );
    			}
    			
    			itemlist.SortedGroups = newArr;
    		}
    	    itemlist.ShowItems = function () {
    	        var items = this.itemlistCntr.Items;
    	        // Incremental build is done by an aspect - this code is simple rendering
    	        for (var i = 0; i < items.length; i++) {
    	            var item = [items[i]];
    	            var elem = itemlist.ElementOfItem(item);
    	            this.AppendItemElement(elem);
    	        }
    	    }
    		
    	    itemlist.ShowItems = function () {
    	    	itemlist.RefreshGroups();
    	        var groups = this.SortedGroups;
    	        
    	        // Incremental build is done by an aspect - this code is simple rendering
    	        for (var i = 0;i<groups.length;i++) {
    	        	var group = groups[i];
    	        	var elemsOfGroup = [];
    	        	for(var j=0;j<group.Items.length;j++) {
    	        		var item = [ group.Items[j] ];
    	        		var elem = itemlist.ElementOfItem(item);
    	        		elemsOfGroup.push(elem);
                        if (j == 0)
                            $(elem).addClass('aa_first_in_group');
                        if (j == group.Items.length-1)
                            $(elem).addClass('aa_last_in_group');
    	        	}
    	        	var groupElem = aa_renderStyleObject(style,{ 
    	        		text: group.DisplayName, group: group,
    	        		Items: group.Items,
    	        		ItemElements: elemsOfGroup
    	        	},context);
    	        	
    	        	this.ParentOfItems.appendChild(groupElem); 
    	        	
    	        	for(var j=0;j<elemsOfGroup.length;j++)
    	        		this.AppendItemElement(elemsOfGroup[j]);
    	        }
    	    }
    	});    	
    }
});


// tree html structure:
// --------------------
// <div class="aa_tree_node">   
//   <div class="aa_tree_node_line">
//     <div class="aa_tree_node_expandbox" />
//     <div class="aa_tree_node_text" />
//   </div>
//   <div class="aa_tree_node_subnodes">
//     <div class="aa_tree_node leaf" />
//		 ...
//   </div>
// </div>
// <div class="aa_tree_node collapsed">

function aa_dragDropTreeItems(settings) 
{
	var rootElem = settings.rootElem;

	var draggedElem = null;
	var DAndDOwner = "";
	var SuspectItemDrag = null;
	var isFixedPosition = false;
	var SpaceElem = null;
	var OriginalElem;

	rootElem.onmousedown = treeSuspectDrag;
	rootElem.onmouseup = treeUnSuspectDrag;

	function treeSuspectDrag(e) {
		var $elem = $((typeof(event)== 'undefined') ? e.target : event.srcElement);
		if ($elem.hasClass('aa_tree_node_expandbox')) return true;
		if (DAndDOwner) return true;
		SuspectItemDrag = { elem: $elem, mousePos : aa_mousePos(e)};
		rootElem.jonmousemoveOrig = rootElem.onmousemove;
		rootElem.jonmouseupOrig = rootElem.onmouseup;
		rootElem.jonmousedownOrig = rootElem.onmousedown;
		rootElem.onmousemove = treeDrag;
		return false;
	}

	function treeFixNodeLine(node)
	{
		// var elem = $(list).parents('.aa_tree_node')[0];
		
		// if ($(list).children('.aa_item').length > 0 && $(elem).children('.hitarea').length == 0 )
		// {
		// 	$(elem).addClass('non_leaf');
		// 	elem.collapsed = false;
			
		// 	var hitarea = document.createElement('div');
		// 	hitarea.className = "hitarea collapsable " + cntr.hitAreaCssClass;
		// 	elem.insertBefore(hitarea,elem.firstChild);
		// }
		// if (originalList && $(originalList).children('.aa_item').length == 0)
		// 	$(originalList).parent().children('.hitarea').remove();
	}

	function treeAddPlaceHolders(parent,at_elem,last_element)
	{
		var place_holder = document.createElement('div');
		place_holder.className = 'aa_move_place_holder';

		if (last_element)
			parent.appendChild(place_holder);
		else
			$(place_holder).insertBefore(at_elem);

		place_holder.dragEnd = function(original)
		{
			var item_data = draggedElem.ItemData;
			var parentElem = $(this).parents('.aa_tree_node')[0];
			if (last_element) {
				settings.moveAtEnd(item_data,parentElem.ItemData);
			} else {
				settings.moveBefore(item_data,at_elem.ItemData);
			}
			$(this).replaceWith(original);
			original.style.display = '';
			original.display = '';
			
			treeFixNodeLine(parentElem);
		};
	}


	function treeDragBegin(e,simulate) {
		isFixedPosition = aa_hasPositionFixedParent(rootElem);
		var elem = SuspectItemDrag.elem;
		var item_elem = elem;
		if (!elem.hasClass("aa_tree_node"))
			item_elem = elem.parents('.aa_tree_node').slice(0,1);

		if (!item_elem[0]) return aa_stop_prop(e);
		var posx = aa_absLeft(item_elem[0],false) - aa_absLeft(rootElem,false);
		var posy = aa_absTop(item_elem[0],false) - aa_absTop(rootElem,false);
		// do not drag root item, if there is one root
		var isRoot = !item_elem.parent().hasClass('aa_tree_node');
		if (isRoot && item_elem.parent().children().length == 1)
			return aa_stop_prop(e);

		DAndDOwner = "TreeDragAndDrop";
		ajaxart_disableSelection(document.body);
		
		var oElem = draggedElem = item_elem[0].cloneNode(true);
		SpaceElem = item_elem[0].cloneNode(true);
		OriginalElem = item_elem[0];
		draggedElem.ItemData = SpaceElem.ItemData = item_elem[0].ItemData;
	    
	  OriginalElem.style.display = 'none';
	  OriginalElem.display = 'none';

		$(draggedElem).addClass('aa_dragged_elem');
		$(SpaceElem).addClass('aa_dragged_space_elem');
		ajaxart_disableSelection(SpaceElem);
		ajaxart_disableSelection(draggedElem);

	  rootElem.appendChild(draggedElem);
	  rootElem.jbPrevPosition = rootElem.style.position;
	  rootElem.style.position = 'relative';	// locating relative to tree top to solve scrolling issues
		
		var all_parents = $.merge( [rootElem] , $(rootElem).find('.aa_tree_node_subnodes') );
		for(var i=0;i<all_parents.length;i++)
		{
			var $parent = $(all_parents[i]);
			var children = $parent.find('>.aa_tree_node');
			for (var j=0;j<children.length;j++) {
				var $node = $(children[j]);
				if ($node.hasClass('aa_dragged_elem') || $node.parents('.aa_dragged_elem').length > 0) continue;
				treeAddPlaceHolders($parent[0],$node[0],false);				
			}
			treeAddPlaceHolders($parent[0],null,true);
		}
		
		// link place holders
		var holders = $(rootElem).find('.aa_move_place_holder');
		for(var i=0;i<holders.length;i++)
		{
			holders[i].jbPreHolder = i > 0 ? holders[i-1] : null;
			holders[i].jbNextHolder = i < holders.length-1 ? holders[i+1] : null;
		}
		var mousepos = SuspectItemDrag.mousePos;		
		
		draggedElem.style.position = 'absolute';
		draggedElem.style.left = posx + 'px';
		draggedElem.style.top = posy + 'px';

		if (!simulate) 
		{
			document.onmouseup = treeDragEnd;
			rootElem.jb_onkeydownOrig = document.onkeydown; 
			document.onkeydown = function(e){
				if (e.keyCode == 27) treeDragEnd(e,true);	// esc
				return true;
			};
		}
		
		return aa_stop_prop(e);
	};

	function treeDrag(e) {
		var mousepos = aa_mousePos(e);
		if (SuspectItemDrag) {
			var distance = Math.abs(mousepos.y - SuspectItemDrag.mousePos.y);
			if (distance < 5) return aa_stop_prop(e);
			var elem = SuspectItemDrag.elem;
			if (! elem.hasClass('aa_tree_node'))
				elem = elem.parents('.aa_tree_node').slice(0,1);

				treeDragBegin(e);
				SuspectItemDrag = null;
			}
	
			if (!draggedElem) return true;
			var actualY = mousepos.y;
			if (isFixedPosition) actualY -= window.pageYOffset;
			
			// keep drag in container boundaries			
			var nearest = { distance: 1000 };
			if (!SpaceElem.jbPositioned) // first time only. look for nearest place holder
			{
				// look for place holder near
				var holders = $(rootElem).find('.aa_move_place_holder').filter(function() {return $(this).parents(':hidden').length == 0} );
				for(var i=0;i<holders.length;i++) {
					var distance = Math.abs(aa_absTop(holders[i]) - actualY);
					if (nearest.distance > distance) nearest = { distance: distance, holder: holders[i]};
				}
				if (nearest.holder) {
					nearest.holder.appendChild(SpaceElem);
					SpaceElem.jbPositioned = true;
				}
				else {
					ajaxart.log('Can not find nearest place holder');
					treeDragEnd({},true);
					return;
				}
			}

			var holder = SpaceElem.parentNode;
			if (!holder) return;
			// calc next up & down
			var pre_holder = holder.PreHolder;
			while ($(pre_holder).parents(':hidden').length > 0)
				pre_holder = pre_holder.PreHolder;
			var next_holder = holder.NextHolder;
			while ($(next_holder).parents(':hidden').length > 0)
				next_holder = next_holder.NextHolder;

			// go up or down or stay in place
			var draggedElemTop = aa_absTop(draggedElem,false); 
			var draggedElemBottom = aa_absTop(draggedElem,false) + $(draggedElem).height();
			
			if (pre_holder && aa_absTop(pre_holder,false) > draggedElemTop )
				pre_holder.appendChild(SpaceElem);
			if (next_holder && aa_absTop(next_holder,false) < draggedElemBottom )
				next_holder.appendChild(SpaceElem);
			
			draggedElem.style.top = actualY - aa_absTop(top,false) + 'px';
			var left = aa_absLeft(SpaceElem,false);
			if ( aa_is_rtl(top_cntr.Ctrl) )
				left = left + $(SpaceElem).width() - $(draggedElem).width();  
			draggedElem.style.left = left - aa_absLeft(top,false) + 'px';
			return aa_stop_prop(e);
		};
			 
		function treeDragEnd(e, cancel) {
			if (cancel) {
	  		OriginalElem.show();
	  	} else {
				if (SpaceElem.parentNode)
					SpaceElem.parentNode.dragEnd(top_cntr.OriginalElem);
				top_cntr.OriginalElem = null;
			}

			top.onmousemove = top_cntr.onmousemoveOrig;
			top.onmousedown = top_cntr.onmousedownOrig;
			top.onmouseup = top_cntr.onmouseupOrig;
			top.style.position = top.jbPrevPosition;

			document.onmouseup = null;
			document.onkeydown = null;
			draggedElem = null;

			$(document).find('.aa_move_place_holder').remove();
			$(document).find('.aa_dragged_elem').remove();

			ajaxart_restoreSelection(document.body);
			DAndDOwner = "";
			return aa_stop_prop(e);
		};

		function treeUnSuspectDrag(e) {
			if (DAndDOwner != "") return true;
			if (SuspectItemDrag) {
				SuspectItemDrag = null;
				top.onmousemove = top_cntr.onmousemoveOrig;
				top.onmouseup = top_cntr.onmouseupOrig;
			}
			return true;
		}

}



// white-space: nowrap;
// http://wwwendt.de/tech/dynatree/doc/samples.html

aa_gcs("itemtree_aspect", {
  ItemTreeContainer: function(profile, data, context) {
    var field = context.vars._Field[0];
    aa_bind(field,'ModifyInstanceContext',function(args) {
        var items = aa_run(args.FieldData, profile, 'Items', aa_merge_ctx(context,args.Context));
        args.Context.vars.ItemTreeCntr = [aa_itemtreeContainer(items,field.Id,field)];
        
        aa_trigger(field,'initItemtreeCntr',args.Context.vars.ItemTreeCntr[0]);
    });
    field.hasItemtreeContainer = true;
  },
  RefreshOnTreeSelectionChange: function(profile, data, context) {
    aa_field_aspect_RefreshOnSelectionChange(data,profile,context,'ItemTreeCntr');    
  },
  TreeProperties: function(profile, data, context) {
    aa_bind(context.vars._Field[0],'initApiObject',function(args) {
      args.apiObject.lazy = aa_bool(data,profile,'LazyCreation',context);
      if (aa_hasParam(profile,'ControlForItem')) {
        args.apiObject.controlForItem = function(item,wrapper) {
          aa_fieldControl({
            Field: aa_first([item],profile,'ControlForItem',context),
            Item: [item],
            Wrapper: wrapper,
            Context: context
          });
        }
      }
    })
  },
  TreeLongList: function(profile, data, context) {
    aa_bind(context.vars._Field[0],'initApiObject',function(args) {
      args.apiObject.MaxItemsPerPage = aa_int(data,profile,'MaxItemsPerPage',context);
      var style = aa_first(data,profile,'Style',context);
      var text = aa_first(data,profile,'TextForShowMore',context);
      args.apiObject.longListMaxItems = aa_int(data,profile,'MaxItemsPerPage',context);
      args.apiObject.longListShowMoreButton = function() {
        return aa_renderStyleObject(style, { text: text }, context);
      };
    });
  }
});

aa_gcs("itemtree", {
  TreeItems: function(profile, data, context) {
    var items = ajaxart.run(data, profile, 'Items', context);
    items.SubItems = function(item) {
      return subitemsFunc(item, items);
    };
    return items;

    function subitemsFunc(item, list) {
      // make sure the item is in the list
      var found = false;
      for (var i = 0; i < list.length; i++) {
        if (list[i] == item) {
          found = true;
          break;
        }
      }

      if (!found) return null;

      var subitems = ajaxart.run([item], profile, 'SubItems', context);
      subitems.SubItems = function(item) {
        return subitemsFunc(item, this);
      };
      return subitems;
    }
  },
  Tree: function(profile, data, context) {
    var field = aa_create_base_field(data, profile, context);
    aa_init_class_Tree();
    if (aa_xpath(profile,'Items').length > 0) // defines its own items (acts as a container)
      ajaxart.runNativeHelper(data,profile,'ContainerAspect',aa_ctx(context,{ _Field: [field] }));

    field.Control = function(field_data, ctx) {
      var ctx2 = aa_merge_ctx(context,ctx);
      jBart.trigger(field,'ModifyInstanceContext',{ Context: ctx2, FieldData: field_data });

      var cntr = aa_var_first(ctx2,'ItemTreeCntr');
      if (!cntr) return $('<div/>').get();
      var items = cntr.Items;

      var treeObject = new ajaxart.classes.Tree({
        items: items,
        _fieldData: field_data,
        _profile: profile,
        context: ctx2,
        cntr: cntr,
        lazy: true,
        itemSelection: aa_bool(data,profile,'ItemSelection',context)
      });
      var out = aa_renderStyleObject2(field.Style, treeObject, field_data,field,ctx2);
      return [out];
    };

    return [field];
  }
});

aa_gcs("itemtree_event", {
  BeforeTreeSelectAsync: function(profile, data, context) {
    var field = context.vars._Field[0];
    field.BeforeTreeSelectAsync = function(item,ctx,treeSelectObject) {
      var ctx2 = aa_merge_ctx(context,ctx,{_TreeSelect: [treeSelectObject]});
      context.vars.EventAction[0].run(item,ctx2);
    };
  }
});


function aa_init_class_Tree() {
  if (ajaxart.classes.Tree) return;

  ajaxart.classes.Tree = function(settings) {
    aa_extend(this, settings);
  };
  ajaxart.classes.Tree.prototype.itemText = function(item) {
    return aa_text([item], this._profile, 'ItemText', this.context);
  };
  ajaxart.classes.Tree.prototype.itemImage = function(item) {
    return aa_first([item], this._profile, 'ItemImage', this.context);
  };
}

function aa_item_tree(tree, settings) {
  settings = aa_defaults(settings, {
    nodeElement: tree.$el.firstOfClass('aa_tree_node')[0],
    nodeSettings: function(node) {
      return {
        toggleElement: node.$el.find('.aa_tree_node_expandbox'),
        imageElement: node.$el.find('.aa_tree_node_image'),
        textElement: node.$el.find('.aa_tree_node_text'),
        subnodesElement: node.$el.find('.aa_tree_node_subnodes'),
        subnodeElement: node.$el.find('.aa_tree_node')
      };
    }
  });

  var allItems = [];
  var baseNodeTemplate = settings.nodeElement;
  renderNodes(tree.items, settings.nodeElement,0);
  if (tree.itemSelection)
    supportSelected();

  function renderNodes(subitems, nodeTemplate, depth) {
    var nodeParent = $(nodeTemplate).parent()[0] || nodeTemplate.nodeParent;
    nodeTemplate.nodeParent = nodeParent;	// Keep node parent for next render
    $(nodeTemplate).remove();

    nodeTemplate.jbIsRendered = false;
    nodeTemplate.jbRender = function() {
      nodeTemplate.jbIsRendered = true;

      for (var i = 0; i < subitems.length; i++) {
        var item = subitems[i];
        if (isItemInTree(item)) continue;
        var nodeElement = $(baseNodeTemplate).clone().appendTo(nodeParent);
        nodeElement[0].jbItem = [item];

        renderNode({
          item: item,
          items: subitems,
          el: nodeElement[0],
          $el: nodeElement
        },depth);
      }
    }

    if (depth<2 || !tree.lazy)
      nodeTemplate.jbRender();
    else
      if (depth > 1) 
        $(nodeParent).closest('.aa_tree_node').addClass('collapsed');
  }

  function renderNode(node,depth) {
    var nodeSettings = settings.nodeSettings(node);
    var nodeText = tree.itemText(node.item);
    var nodeImage = tree.itemImage(node.item);
    if (nodeImage && nodeImage.Url) {
      nodeImage.StaticUrl = aa_totext(nodeImage.Url([node.item], tree.context));
      nodeImage = aa_create_static_image_object(nodeImage);
    }

    if (tree.controlForItem) {
      tree.controlForItem(node.item,$(nodeSettings.textElement)[0]);
    } else {
      $(nodeSettings.textElement).text(nodeText);
    }
    aa_setImage(nodeSettings.imageElement, nodeImage, {
      removeIfNoImage: true
    });

    var subitems = (node.items.SubItems && node.items.SubItems(node.item)) || [];
    if (!subitems.length) {
      node.$el.addClass('leaf');
      $(nodeSettings.subnodesElement).hide();
      node.$el.firstOfClass('aa_tree_node_subnodes').remove();
    } else {
      if (tree.longListMaxItems && subitems.length > tree.longListMaxItems) {
        var nodeParent = $(nodeSettings.subnodeElement).parent();
        renderNodesWithLongList(0);
        function renderNodesWithLongList(renderedSoFar) {
          var items = subitems.slice(renderedSoFar,renderedSoFar + tree.longListMaxItems);
          renderNodes(items, nodeSettings.subnodeElement,depth+1);
          if (subitems.length > renderedSoFar + tree.longListMaxItems) {
            var showMoreButton = tree.longListShowMoreButton();
            $(showMoreButton).click( function() { 
                $(this).hide();
                renderNodesWithLongList(renderedSoFar + tree.longListMaxItems);
              });
            nodeParent.append(showMoreButton);
          }
        }
      } else
        renderNodes(subitems, nodeSettings.subnodeElement,depth+1);
      $(nodeSettings.toggleElement).click(function() {
        node.$el.toggleClass('collapsed');
        if (!nodeSettings.subnodeElement.jbIsRendered)
          nodeSettings.subnodeElement.jbRender();
      });
    }
  }

  function supportSelected() {
    aa_bind(tree, 'selectionChanged', function(args) {
      tree.cntr.SelectedElement = args.el;
      aa_trigger(tree.cntr,'selectionChanged');
    });

    var firstEl = tree.$el.firstOfClass('aa_tree_node_line')[0];
    setSelectedElement(firstEl);

    tree.$el.click(function(event) {
      var line = $(event.target).has('.aa_tree_node_line').length ? $(event.target) : $(event.target).closest('.aa_tree_node_line');
      if (line[0] && tree.field.BeforeTreeSelectAsync && !line.hasClass('selected')) {
        var selectObject = {
          Cancel: function() {},
          Approve: function() {
            setSelectedElement(line[0]);
          }
        }
        tree.field.BeforeTreeSelectAsync(line[0].parentNode.jbItem || [],tree.context,selectObject);
        return;
      }
      setSelectedElement(line[0]);
    });

    tree.$el.keydown(function(event) {
      if (event.keyCode == 40) { moveSelectionDown(); aa_stop_prop(event); }
      if (event.keyCode == 38) { moveSelectionUp(); aa_stop_prop(event); }
      if (event.keyCode == 37) { collapseSelected(); aa_stop_prop(event); }
      if (event.keyCode == 39) { expandSelected(); aa_stop_prop(event); }
    });

    if (tree.el.tabIndex == -1) tree.el.tabIndex = 0;
    tree.$el.focus();
  }

  function setSelectedElement(newSelected) {    
    if ($(newSelected).hasClass('selected')) return;
    tree.$el.find('.selected').removeClass('selected');
    if (!newSelected) return;
    $(newSelected).addClass('selected');

    aa_trigger(tree, 'selectionChanged', {
      el: newSelected.parentNode
    });
  }

  function moveSelectionDown() {
    var selected = tree.$el.find('.selected');
    var node = selected.closest('.aa_tree_node');
    var nextNode = (!node.hasClass('collapsed') && node.find('.aa_tree_node_subnodes .aa_tree_node')[0]);
    if (!nextNode) {
      var iter = node[0];
      // try the next sibling, or the next sibling of the parent
      while (iter && !nextNode) {
        nextNode = iter.nextSibling;
        iter=$(iter.parentNode).closest('.aa_tree_node')[0];
      }      
    }
    if (!nextNode) {
      nextNode = tree.$el.firstOfClass('aa_tree_node')[0];
    }
    var newSelected = $(nextNode).find('.aa_tree_node_line')[0];

    setSelectedElement(newSelected);
  }

  function moveSelectionUp() {
    var selected = tree.$el.find('.selected');
    var node = selected.closest('.aa_tree_node');
    var prevNode = node[0].previousSibling;

    while(prevNode) {
      if ($(prevNode).hasClass('collapsed') || $(prevNode).hasClass('leaf')) break;
      var subnodes = $(prevNode).find('.aa_tree_node_subnodes>.aa_tree_node');
      prevNode = subnodes[subnodes.length-1];
    }

    if (!prevNode) {
      prevNode = node.parent().closest('.aa_tree_node')[0];
    }

    if (prevNode) {
      var newSelected = $(prevNode).find('.aa_tree_node_line')[0];
      setSelectedElement(newSelected);
    }
  }

  function collapseSelected() {
    var selected = tree.$el.find('.selected');
    var node = selected.closest('.aa_tree_node');
    node.addClass('collapsed');
  }

  function expandSelected() {
    var selected = tree.$el.find('.selected');
    var node = selected.closest('.aa_tree_node');
    node.removeClass('collapsed');
  }

  function isItemInTree(anitem) {
    for(var i=0;i<allItems.length;i++)
      if (allItems[i] == anitem) return true;

    allItems.push(anitem);
    return false;
  }

}

function aa_itemtreeContainer(items,id,field) {
  var cntr = {
    Id: id,
    Items: items,
    Field: field,
    ItemTrees: []
  };
  items.cntr = cntr;
  return cntr;
}




aa_gcs("xmltree",{
	XmlElementTreeItem: function(profile,data,context) {
    var field = aa_create_base_field(data, profile, context);

    field.Control = function(field_data, ctx) {
      var ctx2 = aa_merge_ctx(context,ctx);

      var treeNode = { 
      	xml: field_data[0], 
      	clickable: aa_hasParam(profile,'OnClick'),
      	nodeClick: function(xml,htmlElem) {
      		aa_run([xml],profile,'OnClick',aa_ctx(ctx2,{ControlElement: [htmlElem]}));
      	}
      };
      var out = aa_renderStyleObject2(field.Style, treeNode, field_data,field,ctx2);
      return [out];
    };
    return [field];
	}
});

function aa_xml_tree_node(treeNode,settings) {
	var xml = treeNode.xml;
//	if (xml.nodeType != 1) return;

	var $line = treeNode.$el;
	var $tag = treeNode.$el.firstOfClass('aa_xml_tag');
	$tag.text(xml.tagName);

	for (var i=0; i<xml.attributes.length; i++) {
		var name = xml.attributes.item(i).name;
		var $attr = $('<div class="aa_xml_attribute" />').appendTo($line);
		var $attrName = $('<div class="aa_xml_attribute_name" />').text(name+'=').appendTo($attr);
		var $attrValue = $('<div class="aa_xml_attribute_value" />').text(xml.getAttribute(name)).attr('title',xml.getAttribute(name)).appendTo($attr);

		if (treeNode.clickable) {
			$attr[0].jbXml = aa_xpath(xml,'@'+name)[0];
			$attr.click(function() {
				treeNode.nodeClick(this.jbXml,treeNode.el);
			});
		}
	}

	if (treeNode.clickable) {
		treeNode.$el.addClass('clickable');
		$tag.click(function() {
			treeNode.nodeClick(treeNode.xml,treeNode.el);
		});
	}
}

aa_gcs("action", {
AddToCommas: function (profile,data,context)
{
	var to = aa_first(data,profile,'To',context);
	var value = ajaxart.run(data,profile,'Value',context);
	var valueText = ajaxart.totext_array(value);
	
	var curr = ajaxart.totext(to);
	if (curr != "") curr = curr + ",";
	curr = curr + valueText;
	
	ajaxart.writevalue([to],[curr]);
	
	return ["true"];
},
Switch: function (profile,data,context)
{
	  return aa_switch(profile,data,context);
},
IfThenElse : function (profile,data,params)
{
	  return aa_ifThenElse(profile,data,params);
},
RunDelayedAction: function (profile,data,context) {
	aa_run_delayed_action(
		aa_text(data,profile,'ID',context),
		function() { aa_run(data,profile,'Action',context); },
		aa_int(data,profile,'Milliseconds',context),
		true
	);
},
WriteToLog : function (profile,data,context)
{
	var message = aa_text(data,profile,'Message',context);
	var title = aa_text(data,profile,'Title',context);
	var level = aa_text(data,profile,'Level',context);
	var title_prefix = "";
	if (title != "")
		title_prefix = title + ":"; 
	ajaxart.log(title_prefix + message,level);
	return data;
},
DelayedRun: function (profile,data,context)
{
	var delay = aa_int(data,profile,'DelayInMilli',context);
	var id = aa_text(data,profile,'UniqueActionID',context);

	if ( id == "" ) // just run it delayed
	    setTimeout(function() { ajaxart.run(data,profile,'Action',context); },delay);
	else
	{
		if (ajaxart.runDelayed == null) ajaxart.runDelayed = [];
		// look for the id in the table
		var newRecord = { id: id , handle: null }
		var getTimerFunc = function(record)
		{
			return function() {
				record.handle = 0;
				ajaxart.run(data,profile,'Action',context);
			}
		}

		for(var i=0;i<ajaxart.runDelayed.length;i++)
		{
			var record = ajaxart.runDelayed[i];
			if (record.id == id) {
				if (record.handle != 0)
				  clearTimeout(record.handle);
				ajaxart.runDelayed[i] = newRecord;
				newRecord.handle = setTimeout(getTimerFunc(newRecord),delay);
				return ["true"];
			}
		}
		ajaxart.runDelayed.push(newRecord);
		newRecord.handle = setTimeout(getTimerFunc(newRecord),delay);
	}
    return ["true"];
},
	WriteToCookie: function (profile,data,context)
	{
		var cookie = aa_text(data,profile,'Cookie',context);
		var val = aa_text(data,profile,'Value',context);
		
		aa_writeCookie(cookie,val);
		return ["true"];
	},
	ActionReturningResult: function (profile,data,context)
	{
		ajaxart.run(data,profile,'Action',context);
		return ajaxart.run(data,profile,'Result',context);
	},
	ReRunOnInterval:function (profile,data,context)
	{
		var id = aa_text(data,profile,'ID',context);
		var interval = aa_int(data,profile,'IntervalInMSec',context);
		ajaxart.timers = ajaxart.timers || {};
		function activate() {
			if (ajaxart.timers[id])
				window.clearTimeout(ajaxart.timers[id]);
			ajaxart.timers[id] = setTimeout(function() { 
				if (!aa_bool(data,profile,'ContinueCondition',context))
					return;
				ajaxart.run(data,profile,'Action',context);
				activate();
			}, interval)
		}
		activate();
	},
	RunOnNextTimer: function (profile,data,context)
	{
		var runNow = aa_bool(data,profile,'RunNow',context);
		var wait = aa_int(data,profile,'WaitInMSec',context);
		if (wait == 0)
			wait = 1;
		var func = function() { 
			ajaxart.run(data,profile,'Action',context) 
		};
		if (runNow)
			func();
		else
			setTimeout(func,wait);
		
		return ["true"];
	},
	LoadCssFiles: function(profile, data, context)
	{
		if (typeof(aa_loaded_css_files) == "undefined") aa_loaded_css_files = ",";

		var filesStr = aa_text(data,profile,'CssFiles',context).replace(/_jbartLib_/g,aa_base_lib());
		var files = aa_split(filesStr,',',true);

		for(var i=0;i<files.length;i++) {
				if (aa_loaded_css_files.indexOf(","+files[i]+",") > -1) continue;
		    var fileref=document.createElement("link");
		    fileref.setAttribute("rel", "stylesheet");
		    fileref.setAttribute("type", "text/css");
		    fileref.setAttribute("href", files[i]);
		    document.getElementsByTagName("head")[0].appendChild(fileref);
		    aa_loaded_css_files += files[i]+",";
		}
	},
	PreloadImages: function(profile, data, context)
	{
		var images = ajaxart.run(data,profile,'Images',context);
		for(var i=0;i<images.length;i++) {
			var url = aa_totext([images[i]]);
			if (url) {
				var img=new Image();
				img.src=url;
			}
		}
	},
	WriteNodeJSResult: function(profile, data, context) {
		var result = aa_text(data,profile,'Result',context);
		if (window.jBartNodeJS) 
			jBartNodeJS.writeResult(result);
		// else
		// 	aa_alert(result);
	}
});




aa_gcs("appfeature", {
	Responsive: function(profile, data, context) { 
		var cssClasses = '';
		var ctx2 = context;

		return [{
			Load: function(data1,ctx) {
				ctx2 = aa_merge_ctx(context,ctx);
				calculateCssClasses();

				if (ajaxart.jbart_studio) {
					aa_bind(context.vars._AppContext[0],'showPageInStudio',function(args) {
						studioRefresh(args);
					});
				} else 
					$(aa_body()).addClass(cssClasses);
			}
		}];

		function calculateCssClasses() {
			cssClasses = '';
			if (ajaxart.jbart_studio) {
				var width = aa_toint( ajaxart.runNativeHelper(data,profile,'WidthForStudio',ctx2) );
			} else
				var width = $(aa_body()).width();

			if (width >= 800 && width <= 1024) cssClasses += ' width_1024';
			if (width <= 600) cssClasses += ' width_mobile_phone';

			if (ajaxart.isIE78) cssClasses += ' nocss3';
		}

		function studioRefresh(args) {
			calculateCssClasses();

			var classes = (args.Wrapper.classNames || '').split(' ');
			for(var i=0;i<classes.length;i++)
				if (classes[i].indexOf('width_') == 0)
					$(args.Wrapper).removeClass(cssClasses);		

			$(args.Wrapper).addClass(cssClasses);
		}
	},
	ConfirmationOnCloseBrowserPage: function(profile, data, context) { 
		if (ajaxart.jbart_studio) {
			return;
		}
		window.onbeforeunload = function() {
			if (window.jbIgnoreWindowUnload) return;
			if (aa_bool([],profile,'ConditionForConfirmation',context)) 
				return aa_text(data,profile,'ConfirmationText',context);
		}
	},
	CssForHtmlHead: function(profile, data, context) { 
		var headCss = aa_text(data,profile,'Css',context);
		if (!headCss) return;

		jBart.headStyles = jBart.headStyles || {};
		if (jBart.headStyles[headCss]) return;
		jBart.headStyles[headCss] = true;

		var styleElem = $("<style></style>")[0];
		styleElem.innerHTML = headCss;
		var head = document.getElementsByTagName("head")[0];
		head.appendChild(styleElem);		
	},
	RunAction: function(profile, data, context) { 
		return [{
			Load: function(data1,ctx) {
				ajaxart.run(data1,profile,'Action',aa_ctx(context,ctx));
			}
		}];
	}
});





aa_gcs("fld", {
	Field: function(profile, data, context) {
		var field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			FieldData: function(data1, ctx) {
				var out = ajaxart.run(data1, profile, 'FieldData', aa_ctx(context, ctx));
				if (this.ForceCData && out[0] && out[0].nodeType == 1) {
					var currentValue = aa_totext(out);
					for (var iter = out[0].firstChild; iter; iter = iter.nextSibling) {
						if (iter.nodeType == 4) return out; // we already have cdata. nothing to change
					}

					while (out[0].firstChild) out[0].removeChild(out[0].firstChild); // empty
					out[0].appendChild(out[0].ownerDocument.createCDATASection(currentValue)); // add cdata
				}

				if (field.HasDefaultValue)
					aa_trigger(field, 'FieldData', { Item: data1,	FieldData: out,	Context: ctx });

				return out;
			},
			Control: function() {
				return [document.createElement('div')];
			}
		};
		field.ID = [field.Id]; // backward compatibility

		var ctx2 = aa_ctx(context, {
			_Field: [field]
		});
		ajaxart.run(data, profile, 'FieldType', ctx2);
		ajaxart.runsubprofiles(data, profile, 'FieldAspect', ctx2);

		return [field];
	},
	CalculatedField: function(profile, data, context) {
		var hidden = !aa_bool(data, profile, 'Visible', context);

		var field = {
			Id: aa_text(data, profile, 'ID', context),
			Title: aa_multilang_text(data, profile, 'Title', context),
			FieldData: function(data1, ctx) {
				return ajaxart.run(data1, profile, 'FieldData', aa_ctx(context, ctx));
			},
			WorkOn: aa_text(data, profile, 'WorkOn', context),
			Calculate: function(parentData, ctx) {
				if (this.WorkOn == 'items in itemlist') {
					var itemlistCntr = ctx.vars.ItemListCntr && ctx.vars.ItemListCntr[0];
					var items = itemlistCntr && itemlistCntr.Items;
					if (items) {
						for (var i = 0; i < items.length; i++) {
							var item = [items[i]];
							var to = this.FieldData(item, ctx);
							var value = ajaxart.run(item, profile, 'Value', aa_ctx(context, ctx));
							ajaxart.writevalue(to, value);
						}
					}
				} else {
					// single data
					var to = this.FieldData(parentData, ctx);
					var value = ajaxart.run(parentData, profile, 'Value', aa_ctx(context, ctx));
					ajaxart.writevalue(to, value);
				}
			},
			Control: function(field_data, ctx) {
				var text = aa_totext(field_data);
				return $('<div/>').text(text).attr('title', text).get();
			},
			CalculatedOnly: true,
			IsFieldHidden: function() {
				return hidden;
			},
			IsHidden: hidden
		};
		field.ID = [field.Id]; // backward compatability

		var ctx2 = aa_ctx(context, {
			_Field: [field]
		});
		ajaxart.runsubprofiles(data, profile, 'FieldAspect', ctx2);

		return [field];
	}
});

aa_gcs("fld_type", {
	Text: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		field.Control = function(field_data, ctx) {
			var text = aa_totext(field_data);
			if (field.Text) text = aa_totext(field.Text(field_data,ctx));
			var out = aa_renderStyleObject(field.Style, {
				text: text,
				data: field_data[0]
			}, ctx);
			$(out).addClass('aa_field_text');
			return [out];
		};
	},
	EditableText: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);
		field.HandleDescriptionForEmptyText = function(desctiptionForEmptyText) {
			field.DescriptionForEmptyText = desctiptionForEmptyText;
		};

		aa_init_class_EditableText();

		field.Control = function(field_data, ctx) {
			var placeholder = field.DescriptionForEmptyText || '';

			var textApiObject = new ajaxart.classes.EditableText({
				placeholder: placeholder,
				field: field,
				data: field_data,
				profile: profile,
				context: ctx,
				field_data: field_data
			});
			textApiObject.value = textApiObject.totext();
			return [aa_renderStyleObject(field.Style, textApiObject, ctx, true)];
		}
	},
	EditableColor: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);
		field.HandleDescriptionForEmptyText = function(desctiptionForEmptyText) {
			field.DescriptionForEmptyText = desctiptionForEmptyText;
		}
		aa_init_class_EditableText();

		field.Control = function(field_data, ctx) {
			var placeholder = field.DescriptionForEmptyText || '';

			var textApiObject = new ajaxart.classes.EditableText({
				placeholder: placeholder,
				field: field,
				data: field_data,
				profile: profile,
				context: ctx
			});
			textApiObject.value = textApiObject.totext();
			return [aa_renderStyleObject(field.Style, textApiObject, ctx, true)];
		};
	},
	EditableDate: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);
		field.HandleDescriptionForEmptyText = function(desctiptionForEmptyText) {
			field.DescriptionForEmptyText = desctiptionForEmptyText;
		};
		aa_init_class_EditableText();

		field.Control = function(field_data, ctx) {
			ctx = aa_merge_ctx(context,ctx);
			var placeholder = field.DescriptionForEmptyText || '';

			var apiObject = new ajaxart.classes.EditableText({
				placeholder: placeholder,
				field: field,
				data: field_data,
				profile: profile,
				context: ctx,
				storageFormat: aa_text(data,profile,'StorageFormat',ctx),
				displayFormat: aa_text(data,profile,'DisplayFormat',ctx),
				minDate: aa_text(data,profile,'Min',ctx),
				maxDate: aa_text(data,profile,'Max',ctx)
			});
			textApiObject.value = textApiObject.totext();
			return [aa_renderStyleObject2(field.Style, apiObject, field_data,field,ctx)];
		};
	},
	Image: function(profile, data, context) // GC of fld_type.Image
	{
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);
		field.Control = function(field_data, ctx) {
			var image = aa_first(field_data, profile, 'Image', context);
			if (image && image.Url) {
				image.StaticUrl = aa_totext(image.Url(field_data, context));
			}
			image.StaticUrl = image.StaticUrl || aa_text(data, profile, 'DefaultImage', context);

			var image2 = aa_create_static_image_object(image);

			var out = aa_renderStyleObject(field.Style, {
				Field: field,
				image: image2,
				data: field_data[0]
			}, ctx, true);
			return [out];
		}
	},
	EditableImage: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		aa_init_class_EditableImage();
		
		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context, ctx);
			var image = aa_first(field_data, profile, 'Image', ctx2);
			if (image && image.Url) image.StaticUrl = aa_totext(image.Url(field_data, ctx2));

			var staticImage = aa_create_static_image_object(image);

			var imageWidth = aa_first(field_data, profile, 'OriginalWidth', ctx2);
			var imageHeight = aa_first(field_data, profile, 'OriginalHeight', ctx2);
			var imageWidthInt = parseInt(aa_totext([imageWidth]));
			var imageHeightInt = parseInt(aa_totext([imageWidth]));

			var editableImage = new ajaxart.classes.EditableImage({
				field: field,
				image: staticImage,
				field_data: field_data,
				Field: field,
				data: field_data[0],
				value: staticImage.url,
				placeholder: field.DescriptionForEmptyText || '',
				imageWidthData: imageWidth ? [imageWidth] : [],
				imageHeightData: imageHeight ? [imageHeight] : [],
				imageWidth: imageWidthInt,
				imageHeight: imageHeightInt
			});
			return [aa_renderStyleObject(field.Style, editableImage, ctx2, true)];
		};
	},
	Boolean: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		if (aa_bool(data, profile, 'HidePropertySheetTitle', context)) field.HidePropertyTitle = field.HideTitle = true;

		field.Control = function(field_data, ctx) {
			ctx = aa_merge_ctx(context, ctx);
			var boolObj = {
				textForTrue: aa_multilang_text(data, profile, 'TextForTrue', context),
				textForFalse: aa_multilang_text(data, profile, 'TextForFalse', context),
				isTrue: aa_totext(field_data) == aa_text(data, profile, 'CodeForTrue', context)
			};

			return [aa_renderStyleObject2(field.Style,boolObj,field_data,field,ctx,{})];
		}
	},
	EditableBoolean: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		if (aa_bool(data, profile, 'HidePropertySheetTitle', context)) field.HidePropertyTitle = field.HideTitle = true;

		field.Control = function(field_data, ctx) {
			var picklist = {};
			aa_initPicklistObject(picklist, field, field_data, ctx);
			var image = aa_first(field_data, profile, 'Image', context);
			if (image && image.Url) image.StaticUrl = aa_totext(image.Url(field_data, context));

			return [aa_renderStyleObject(field.Style, {
				Field: field,
				field: field,
				textForTrue: aa_multilang_text(data, profile, 'TextForTrue', context),
				textForFalse: aa_multilang_text(data, profile, 'TextForFalse', context),
				codeForTrue: aa_text(data, profile, 'CodeForTrue', context),
				codeForFalse: aa_text(data, profile, 'CodeForFalse', context),
				getTextValue: function() {
					var text = aa_totext(field_data);
					return this.isChecked() ? this.textForTrue : this.textForFalse;
				},
				image: image,
				data: field_data[0],
				field_data: field_data,
				isChecked: function() {
					var text = aa_totext(field_data);
					return text == this.codeForTrue;
				},
				setValue: function(newval) {
					var newcode = newval ? this.codeForTrue : this.codeForFalse;

					ajaxart.writevalue(field_data, newcode);
					var content = this.control;
					aa_invoke_field_handlers(field.OnUpdate, content, null, field, field_data, {});
					jBart.trigger(field, 'update', {
						FieldData: field_data,
						wrapper: content.parentNode
					});
				}
			}, ctx, true)];
		}

	},
	Lookup: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.Options = ajaxart.run(data, profile, 'Options', context);
		field.Style = aa_first(data, profile, 'Style', context);
		field.Control = function(field_data, ctx) {
			var code = aa_totext(field_data);
			var option = aa_picklist_optionByCode(field.Options, code) || {
				code: code,
				text: code
			};

			return [aa_renderStyleObject(field.Style, {
				Field: field,
				image: option.image || '',
				data: field_data[0],
				text: option.text || '',
				isEmpty: option != null
			}, context)];
		};
	}
});

function aa_native_checkbox(checkbox, settings) {
	if (settings.TextElement) {
		settings.TextElement.innerHTML = checkbox.Field.Title;
		settings.TextElement.onclick = function() {
			if (window.aa_incapture) return;
			settings.InputElement.checked = !settings.InputElement.checked;
			checkbox.setValue(settings.InputElement.checked);
			refresh();
		}
	}
	settings.InputElement.onchange = function() {
		checkbox.setValue(settings.InputElement.checked);
		refresh();
	};
	refresh();

	function refresh() {
		settings.InputElement.checked = checkbox.isChecked();
	}

	aa_bind(checkbox, 'refreshUI', refresh);
}

function aa_div_checkbox(checkbox, settings) {
	settings = aa_defaults(settings,{
		textElement: checkbox.$el.firstOfClass('aa_checkbox_text'),
		clickableElement: checkbox.$el
	});
	$(settings.textElement).html( checkbox.Field.Title );
	$(settings.clickableElement).click(function() {
		$(settings.divCheckboxElement).toggleClass('checked');
		checkbox.setValue(checkbox.isChecked() ? false : true);
		refresh();
	});
	refresh();

	function refresh() {
		if (checkbox.isChecked()) 
			$(settings.clickableElement).addClass('checked');
		else
			$(settings.clickableElement).removeClass('checked');
	}

	aa_bind(checkbox, 'refreshUI', refresh);
}

function aa_native_boolean_radios(checkbox, settings) {
	settings = aa_defaults(settings, {
		TrueInputElement: checkbox.$el.find('.radio_true>input'),
		TrueTextElement: checkbox.$el.find('>.radio_true>div')[0],
		FalseInputElement: checkbox.$el.find('>.radio_false>input')[0],
		FalseTextElement: checkbox.$el.find('>.radio_false>div')[0]
	});

	aa_global_vars().uniqueRadioCounter = aa_global_vars().uniqueRadioCounter || 0;
	var radioGroup = 'aaradio' + ++aa_global_vars().uniqueRadioCounter;
	$(settings.TrueInputElement).attr("name", radioGroup);
	$(settings.FalseInputElement).attr("name", radioGroup);

	$(settings.TrueTextElement).text(checkbox.textForTrue).click(function() {
		$(settings.TrueInputElement).click();
	});

	$(settings.FalseTextElement).text(checkbox.textForFalse).click(function() {
		$(settings.FalseInputElement).click();
	});

	$(settings.TrueInputElement).click(function() {
		checkbox.setValue(true);
	});
	$(settings.FalseInputElement).click(function() {
		checkbox.setValue(false);
	});
	if (settings.PutFalseValueBeforeTrue) checkbox.$el.find('>.radio_true').before(checkbox.$el.find('>.radio_false'));

	var radioToCheck = checkbox.isChecked() ? settings.TrueInputElement : settings.FalseInputElement;
	$(radioToCheck).attr('checked', 'checked');

	function radioClicked() {
		var val = $(settings.TrueInputElement)[0].checked ? true : false;

	}
}

function aa_init_class_EditableText() {
	aa_init_class('EditableText', {
		_ctor: function() {
			this.InputValueMask = this.field && this.field.InputValueMask;
		},
		totext: function() {
			if (this.field.TextDataToInputValue)
				return aa_totext(this.field.TextDataToInputValue(this.data,this.context));

			return aa_totext(this.data);
		},
		setValue: function(newvalue, settings) {
			settings = settings || {};
			if (this.totext() == newvalue && !settings.forceUpdate) return;
			if (this.field.TextInputValueToData)
				newvalue = aa_totext(this.field.TextInputValueToData([newvalue],this.context));

			ajaxart.writevalue(this.data, [newvalue]);
			var field = this.field;
			aa_invoke_field_handlers(field.OnUpdate, this.el, null, field, this.data, {});
		},
		initInputElement: function(textbox, input) {
			var field = this.field,
				field_data = this.data,
				context = this.context,
				that = this;
			input.jbApiObject = textbox;

			$(input).focus(function(e) {
				e = e || event;
				// select all on next timer
				ajaxart.controlOfFocus = this;
				aa_invoke_field_handlers(field.OnFocus, input, e, field, field_data);
				for (var parent = input.parentNode; parent; parent = parent.parentNode) if (parent.onfocus) parent.onfocus(e); // for HoverOnPopup 
				return true;
			}).blur(function(e) {
				e = e || event;
				for (var parent = input.parentNode; parent; parent = parent.parentNode) if (parent.onblur) parent.onblur(e); // for HoverOnPopup 
//				ajaxart_field_RefreshDependentFields(field, input, context);
				aa_invoke_field_handlers(field.OnBlur, input, e, field, field_data);
				if (field.Validations) aa_handleValidations(field, input, field_data, context, "on blur");
				return true;
			}).keydown(function(e) {
				e = e || event;

				if (field.KeyPressValidator && e.keyCode != 8) // backspace is fine 
				{
					var ch = String.fromCharCode(e.keyCode);
					if (!field.KeyPressValidator.test(ch)) return aa_stop_prop(e);
				}
				aa_invoke_field_handlers(field.OnKeydown, this, e, field, field_data);

				if (window.aa_intest && e.CharByChar) input.value += String.fromCharCode(e.keyCode);

				return true;
			}).mousedown(function(e) {
				e = e || event;
				aa_invoke_field_handlers(field.OnMouseDown, this, e, field, field_data);
				return true;
			}).mouseup(function(e) {
				e = e || event;
				aa_invoke_field_handlers(field.OnMouseUp, this, e, field, field_data);
				return true;
			});
			input.Blur = function() {
				$(this).blur();
			}
			input.Refresh = function() {
				if (input.RefreshDescriptionForEmptyText) input.RefreshDescriptionForEmptyText();
				if (input.jbApiObject) aa_trigger(input.jbApiObject, 'refresh');
			}
			input.setAttribute('value', textbox.value); /* for automatic tests on all browsers */
		},
		onkeyup: function(e, input) {
			var field = this.field;
			var keyCode = e.keyCode;
			if (keyCode == undefined && !aa_intest && !aa_inuiaction) return; // a mouse click !!!
			aa_invoke_field_handlers(field.OnKeyup, input, e, field, this.data, {
				KeyCode: ['' + keyCode],
				CtrlKey: aa_frombool(e.ctrlKey)
			});
			var codes = [9, 13, 16, 17, 18, 27, 63277, 63276]; // controls and navigation are masked
			for (var i = 0; i < codes.length; i++)
			if (keyCode == codes[i]) return true;

			if (field.KeyPressValidator && keyCode != 8) // backspace is masked 
			{
				var ch = String.fromCharCode(keyCode);
				if (!field.KeyPressValidator.test(ch)) return aa_stop_prop(e);
			}
		}
	});
}

function aa_init_class_EditableNumber() {
	if (!ajaxart.classes.EditableNumber) {
		aa_init_class('EditableNumber', {});
		if (!ajaxart.classes.EditableText) aa_init_class_EditableText();
		ajaxart.classes.EditableNumber.prototype = new ajaxart.classes.EditableText; // inheritance
	}
}

function aa_jbart_clickable_text(textbox, settings) {
	var input = $(settings.InputElement), text = $(settings.TextElement);

	text.click(function() {
		textbox.el.jbIsInput = true;
		refresh();
	});
    input.keyup(function(ev) {
      if (ev.keyCode == 13)  return updateInputAndRefresh(); 
    });
	input.blur(updateInputAndRefresh);
	
	refresh();
  
	function refresh() {
		if (!textbox.el.jbIsInput) {
			input.hide();
			text.show().text(textbox.value || textbox.placeholder);
		} else {
			if (input[0].jbOnBeforeShow) input[0].jbOnBeforeShow();
			text.hide();
			input.show().val(textbox.value).focus();
		}
	}
	function updateInputAndRefresh() {
		if (textbox.value != input.val()) {
			textbox.value = input.val();
			textbox.setValue(input.val());
		}
		textbox.el.jbIsInput = false;
		refresh();
    }
}

function aa_jbart_textbox(textbox, settings) {
	settings = aa_defaults(settings,{
		inputElement: textbox.el,
		autoRTLForHebrewContent: false
	});

	/* 	
	Initializes a textbox (input/textarea) to support change events etc. 
	A textarea can also be passed as inputElement.
*/
	var userAgent = navigator.userAgent.toLowerCase();
	var placeholderNativeSupport = (/chrome/.test(userAgent) || /firefox/.test(userAgent) || /safari/.test(userAgent));
	placeholderNativeSupport = false; // always disable it
	var isIE7orIE8 = /msie 7/.test(userAgent) || /msie 8/.test(userAgent);
	var updateOn = textbox.field.UpdateOn || 'EveryClick';

	var input = $(settings.inputElement)[0];
	var inputValueMask = textbox.InputValueMask || settings.InputValueMask;	

	if (textbox.initInputElement) textbox.initInputElement(textbox, input); /* Allows custom initialization of the input element (e.g. adding placeholders) */

	function getInputValue() {
		var val = input.value;
		if (textbox.placeholder && $(input).hasClass('placeholder')) return '';
		if (inputValueMask) {
			var newval = inputValueMask(val);
			if (newval != val) {
				input.value = newval;
				val = newval;
			}
		}
		var args = { val: val };
		aa_trigger(textbox.field,'inputMask',args);

		if (args.val != val) {
			input.value = args.val;
			val = args.val;
		}
		
		return val;
	}

	function valueChanged() {
		var inputValue = getInputValue();
		if (textbox.value != inputValue) {
			textbox.value = inputValue;
			if (textbox.setValue) textbox.setValue(textbox.value);
		}
	}
	// oninput is for mouse context menu of cut,paste
	input.oninput = function(e) {
		if (updateOn == 'EveryClick') valueChanged();
	};
	// support paste,cut for IE8,IE7
	if (isIE7orIE8 && updateOn == 'EveryClick') {
		$(input).bind('cut paste', null, function(e) {
			setTimeout(function() {
				valueChanged();
			}, 50);
		});
	}
	input.onkeyup = function(e) {
		$(input).removeClass('placeholder');
		if (textbox.onkeyup) textbox.onkeyup(e || event, input);
		if (updateOn == 'EveryClick') valueChanged();
		return true;
	};
	if (textbox.placeholder && placeholderNativeSupport) $(input).attr('placeholder', textbox.placeholder);

	input.value = textbox.value;

	if (!placeholderNativeSupport) {
		input.onfocus = function(e) {
			if ($(input).hasClass('placeholder')) {
				$(input).removeClass('placeholder');
				input.value = '';
			}
		};
		input.onblur = function() {
			if (textbox.placeholder && input.value == '') {
				input.value = textbox.placeholder;
				$(input).addClass('placeholder');
			}
		};
		input.onblur();
	}

	if (updateOn == 'Blur') {
		$(input).blur(valueChanged);
	}

	if (settings.autoRTLForHebrewContent && textbox.value) {
		var firstCharCode = textbox.value.trim().charCodeAt(0);
		if (firstCharCode >= 1488 && firstCharCode <= 1514)	// hebrew text (between  to )
			$(input).css("direction","rtl");
	}
}

function aa_init_jscolor(textbox, settings) {
	/* uses jscolor for editable color (http://jscolor.com) */
	var input = settings.InputElement;
	// var baseUrl = settings.BaseUrl || aa_base_lib() + '/jscolor/';
	if (!window.jscolor)
		console.error('jscolor lib is not loaded: http://jscolor.com/');

	var jsColorSettings = {
		styleElement: settings.StyleElement || settings.InputElement,
		pickerClosable: settings.PickerClosable ? true : false,
		required: false,
		hash: true,
		onImmediateChange: function() { onChange(this.toString(),true);	}
	};
	var myPicker = new jscolor.color(input, jsColorSettings);
	$(settings.ClickElement).click(function() {
		myPicker.showPicker();
	});
	$(settings.InputElement).keyup(function(event) {
	  	if ( event.which == 13 ) {
		  	myPicker.hidePicker();
		  	if (!this.value) {
			  	this.style.backgroundColor = '';
			  	setTimeout(function() { settings.InputElement.focus(); }, 1);
		  	}
		 	onChange(this.value,false);
		}
	}).click(function() {
		myPicker.showPicker();
	} );
	function onChange(value,fromColorPicker) {
		var color = value || '';
		if (fromColorPicker && value && value.charAt(0) != '#') color = '#' + value;

		if (textbox.value != color) {
			textbox.value = color;
			if (textbox.setValue) textbox.setValue(textbox.value);
		}
	}
}

function aa_jquery_date_picker(dateObj, settings) {
	settings = aa_defaults(settings, {
		InputElement: dateObj.el
	});
	var input = $(settings.InputElement)[0];
	var baseUrl = settings.BaseUrl || aa_base_lib() + '/datepicker-1.11/';

	var cssList = [ baseUrl + 'jquery-ui.css' ];
	var jsList = [ baseUrl + 'jquery-ui.js' ];
	if ($.datepicker) return init();

	aa_loadLib("jquerydatepicker", cssList , jsList).done(init);

	function init() {
		if (!ajaxart.isattached(dateObj.el))
			return aa_addOnAttach(dateObj.el,init);

		var params = {
			dateFormat: dateObj.displayFormat,
			onSelect: function(value) {
				var storageVal = displayToStorage(value);
				if (dateObj.setValue) dateObj.setValue(storageVal);
				dateObj.value = storageVal;
//				$(input)[0].value = 'abc';
			},
			beforeShow: function(value) {
//				$(input).datepicker("setDate",storageToDisplay(dateObj.value));
			}
		};
		try {
			if (dateObj.minDate) params.minDate = $.datepicker.parseDate(dateObj.storageFormat, dateObj.minDate);
			if (dateObj.maxDate) params.maxDate = $.datepicker.parseDate(dateObj.storageFormat, dateObj.maxDate);
		} catch(e) { ajaxart.logException('error in date picker',e);}

		$(input).datepicker(params);
		try {
			if (dateObj.value) $(input).datepicker("setDate",storageToDisplay(dateObj.value));
		} catch(e) { ajaxart.logException('error in date picker',e);}

		if ($(settings.OpenByClickElement)[0]) {
			$(settings.OpenByClickElement).click(function() {
				$(input).datepicker( "show" );
			});
		}

		aa_addOnDetach(input,function() {
			$(input).datepicker("destroy");
		});
	}

	function displayToStorage(displayVal) {
		var date = $.datepicker.parseDate(dateObj.displayFormat, displayVal );
		return $.datepicker.formatDate(dateObj.storageFormat, date );
	}
	function storageToDisplay(storageVal) {
		var date = $.datepicker.parseDate(dateObj.storageFormat, storageVal);
		return $.datepicker.formatDate(dateObj.displayFormat, date );
	}
}

function aa_init_jscolor_with_transparent_checkbox(textbox, settings) {
	if (settings.CheckboxElement) {
		textbox.setValueoriginal = textbox.setValue;
		if (!textbox.value) settings.CheckboxElement.checked = true;
		textbox.setValue = function(value) {
			textbox.setValueoriginal(value);
			settings.CheckboxElement.checked = false;
		}
		settings.CheckboxElement.onchange = function() {
			textbox.setValueoriginal("");
			$(settings.StyleElement || settings.InputElement).css("background", "white");
		}
	}
	aa_init_jscolor(textbox, settings);
}



//******************* Star Rating ************************/

aa_gcs("rating",{
	Rating: function(profile,data,context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data, profile, 'Style', context);

		field.Control = function(field_data, ctx) {
			ctx = aa_merge_ctx(context,ctx);
			var rating = {
				value: aa_totext(field_data),
				setValue: function(newval) {
					this.value = newval;
					ajaxart.writevalue(field_data, newval);
					aa_invoke_field_handlers(field.OnUpdate, this.el, null, field, field_data, {});
				}
			};
			return [aa_renderStyleObject2(field.Style,rating,field_data,field,ctx,{})];
		};		
	}
});

function aa_rating_stars(rating,settings) {
	settings = aa_defaults(settings,{
		starElement: rating.$el.firstOfClass('star')
	});

	var stars = [];
	for(var i=0;i<5;i++) {
		var starElem = $(settings.starElement).clone().insertAfter(stars[stars.length-1] || settings.starElement);
		stars.push(starElem[0]);
		starElem[0].jbRatingIndex = i;
	}
	$(settings.starElement).remove();

	$(stars).hover(function() {
		var index = this.jbRatingIndex;
		$(stars).removeClass('full').removeClass('hover');
		$(stars.slice(0,index+1)).addClass('hover');
	});
	$(stars).click(function() {
		var index = this.jbRatingIndex+1;
		rating.setValue(''+index);
		refresh();
	});
	rating.$el.mouseout(refresh);

	refresh();

	function refresh() {
		$(stars).removeClass('full').removeClass('hover');
		var val = parseInt(rating.value || 0);
		$(stars.slice(0,val)).addClass('full');
	}
}

/************** boolean *******************/
function aa_booleanStyle(boolObj) {
	var text = boolObj.isTrue ? boolObj.textForTrue : boolObj.textForFalse;
	boolObj.$el.text(text);
}


aa_noOfOpenDialogs = 0;
aa_dialogCounter = 0;
openDialogs = [];
aa_openDialogs = [];

aa_gcs("dlg", {
  OpenDialog: function (profile,data,context) 
  {
	var dlg = { isObject: true }
	dlg.Title = aa_multilang_text(data,profile,'Title',context);
	dlg.Data = ajaxart.run(data,profile,'DialogData',context);
	dlg.Contents = aa_first(dlg.Data,profile,'Contents',context);
	dlg.noOfOpenDialogs = window.aa_noOfOpenDialogs;
	dlg.Style = aa_first(data,profile,'Style',context);
	dlg.Mode = dlg.Style.Mode;
	dlg.Context = context;
	
	dlg.onElem = aa_first(data,profile,'LauncherElement',context);
	dlg.JBStudio = (dlg.onElem && jQuery(dlg.onElem).parents('.jbstudio_dlg').length > 0);
	
	function init(dlg) {
	    dlg.createFrame = function() {
	    	if (!dlg.ShowFocusUnderline) {
	    		dlg.Style.Css += ' #this *:focus { outline:none; }';
	    	}
	    	this.StyleClass = aa_attach_global_css(this.Style.Css);
	    	var jElem = jQuery(this.Style.Html);
	    	jElem.addClass(this.StyleClass);
	    	jElem.addClass(ajaxart.deviceCssClass || '');
	    	if (dlg.JBStudio) jElem.addClass('jbstudio_dlg');
	    	
	    	var dialogObject = aa_api_object(jElem);
	    	aa_apply_style_js(dialogObject,this.Style);
	    	return jElem[0];
	    }
		
		dlg.ContentsPlaceholder = function() {
			var out = this.Frame;
			if (jQuery(out).hasClass('aa_dialogcontents')) return out;
			return jQuery(out).find('.aa_dialogcontents')[0];
		}
		dlg.RunOnOK = function() { ajaxart.run(this.Data,profile,'RunOnOK',context); }
		
		dlg.OK = function(data1,ctx) {
			if (!dlg.Frame) return;
			var contents = dlg.ContentsPlaceholder();
			if (! aa_passing_validations(contents) ) return;
			aad_runMethodAsync(this,this.RunBeforeOK,this.Data,dlg.Context,function() {		// allow asyc call before ok (e.g. trying to save on the server)
				if ( jQuery(contents).find('.aa_noclose_message').length > 0 ) return;
				dlg.Close(data1,ctx);
				var ctx2 = aa_ctx(context,{ DialogOriginalData: dlg.Data });
				if (dlg.onElem) ctx2.ControlElement = [dlg.onElem];
				ajaxart.run(dlg.Data,profile,'RunOnOK',ctx2);
			});
		}
		dlg.Apply = function(data1,ctx) {
			var ctx2 = aa_ctx(context,{ DialogOriginalData: dlg.Data});
			ajaxart.run(this.Data,profile,'RunOnOK',ctx2);
		}
		dlg.Cancel = function(data1,ctx) {
//			if (dlg.NoCancel) return this.OK(data1,ctx);
			this.Close(data1,ctx);
			if (this.RunOnCancel) this.RunOnCancel(data,context);
			jBart.trigger(dlg,'cancel');
		}
		dlg.Open = function(data1,ctx) {
			var dlg = this;

			aa_invoke_dialog_handlers(dlg.BeforeOpenFunc,dlg,context);  // dialog size etc.
			if (dlg._cancelOpen) return;

			// first close all popups
			if (! ajaxart.inPreviewMode) {
				if (!this.DontCloseOtherPopupsOnOpen) {
					if (! dlg.JBStudio) {
						var stop = false;
						while (ajaxart.dialog.openPopups.length > 0 && !stop) {
							var dialogCount = ajaxart.dialog.openPopups.length;
						    aa_closePopup(ajaxart.dialog.openPopups[ajaxart.dialog.openPopups.length-1]);
						    if (ajaxart.dialog.openPopups.length == dialogCount)	// the popup is not closed
						    	stop = true;
						}
					} else {
						// a studio dialog...do not close runtime popups
						var openPopups= [];
						for(var i=0;i<ajaxart.dialog.openPopups.length;i++) {
							var popup = ajaxart.dialog.openPopups[i];
							if (!popup.Dlg || !popup.Dlg.JBStudio) {
								openPopups.push(popup);
							} else {
								// a design time popup - closing it
								aa_uncapture_for_popup(popup);
								if (!popup.Dlg) {	
									aa_remove(popup.contents.parentNode,true);
								}
								if (popup.Dlg) popup.Dlg.Close([],ajaxart.newContext(),true);
							}
						}
						ajaxart.dialog.openPopups = openPopups;
					} 
				}
			}
			
			if (this.Mode == 'dialog') aa_noOfOpenDialogs++;
			
			//var cls = dlg.DialogClass;
			dlg.Frame = dlg.createFrame();
			aa_invoke_dialog_handlers(dlg.BeforeOpen,dlg,context);  // screen cover etc.
			
			aa_openDialogs.push(dlg);
			
			if (this.Mode == 'popup') {
			  dlg.Popup = {Dlg: dlg, contents: dlg.Frame, onElem: dlg.onElem };
			  ajaxart.dialog.openPopups.push(dlg.Popup);
			  setTimeout( function() { 
//				  aa_capture_for_popup(dlg.Popup); 
				  dlg.Popup.initialized = true; 
			  }, 1 );
			}
			
			dlg.Frame.Dialog = dlg;
			var jFrame = jQuery(dlg.Frame);
			aa_defineElemProperties(dlg.Frame,'counter');

			dlg.Rtl = aa_is_rtl(dlg.onElem) && ! dlg.AlwaysLTR;
			if (jQuery(dlg.onElem).parents('.jbstudio').length > 0) jFrame.addClass('jbstudio');
			
			dlg.Frame.counter = ++aa_dialogCounter;		// used to determine who is the current dialog, in case of more than one dialog
			if (dlg.ZIndex) {
				jFrame.css('zIndex',dlg.ZIndex);
			}	else { 
				jFrame.css('zIndex',aad_dialog_zindex(2001 + aa_dialogCounter,jFrame[0]));
			}
			jFrame.addClass('aa_dlg').addClass(dlg.DialogClass || '');
			
			
			if (dlg.Rtl) jFrame.addClass('right2left');
			
			if (! ajaxart.inPreviewMode) jFrame.addClass('aa_dlg').css('position','absolute');
			if (dlg.Title && jFrame.find('.aa_dialog_title').length >0) {
				var titleDiv = jQuery('<div class="aa_dialog_title_text"/>')[0];
				titleDiv.innerHTML = dlg.Title;
				jFrame.find('.aa_dialog_title')[0].appendChild(titleDiv);
			}
			if (dlg.Contents) {
				dlg.ContentsPlaceholder().appendChild(dlg.Contents);
			  dlg.Contents.tabIndex = 0;
			}
			if (dlg.Buttons && dlg.Buttons.length > 0 && dlg.ButtonsControl) {
				jQuery(dlg.Frame).find('.aa_dialogbuttons')[0].appendChild(dlg.ButtonsControl(data1,ctx));
			}
			dlg._FixDialogPosition = function() {
				var oldIsReady = dlg.isReady; 
				if (!dlg.isReady && jFrame.find('.aa_dialog_not_ready').length > 0) {
					dlg.isReady = false;
					return;
				}
				dlg.isReady = true;
				if (dlg.FixDialogPosition) dlg.FixDialogPosition(oldIsReady ? false : true);
			    jFrame.show();
			}
			if (! ajaxart.inPreviewMode) {
				document.body.appendChild(dlg.Frame);
			    jFrame.hide();
		    	dlg._FixDialogPosition(true); 
		    	aa_element_attached(dlg.Frame); 
			}
//			setTimeout(function() {
//				if (dlg.Disabled) return;
//				else if (dlg.Contents) dlg.Contents.focus();
//			},1);

		    jQuery(dlg.Frame).keydown( function(e){
				aa_invoke_dialog_handlers(dlg.KeyDown,e||event,context);
			});
			
			if (dlg.onElem) dlg.onElem.jbDialog = dlg;
		    
			aa_invoke_dialog_handlers(dlg.AfterOpen,dlg,context);  // dialog size etc.
		}
		dlg.Close = function(data1,ctx,fromClosePopup) {
			var ctx = this.Context || ctx;
			aa_invoke_dialog_handlers(this.BeforeClose,this);  
			if (this.RunBeforeClose) this.RunBeforeClose(data1,aa_ctx(ctx,{ControlElement: [this.Frame]}));
			var frame = this.Frame;
			if (!this.Frame) return;
			aa_remove(this.Frame,true);
			this.Frame = null;
			if (this.Mode == 'dialog') aa_noOfOpenDialogs--;
			else if (!fromClosePopup) aa_closePopup(this.Popup); 
			
			aa_invoke_dialog_handlers(this.AfterClose,this);  // screen cover etc.
			if (this.RunOnClose) this.RunOnClose(data1,ctx);
			
			jBart.utils.removeFromArray(aa_openDialogs,this);
			if (dlg.onElem) dlg.onElem.jbDialog = null;
		}
		var newContext = aa_ctx(context,{_Dialog: [dlg]} );
	
		dlg.Style.Features(data,newContext);
		ajaxart.runNativeHelper(data,profile,'MoreFeatures',newContext);
		ajaxart.runsubprofiles(data,profile,'Feature',newContext);
		
		dlg.Open(data,newContext);
	}
	init(dlg);
  },
  AboveLauncher: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.FixDialogPosition = function(firstTime) 
	  {
		  var control = this.onElem;
		  if (!firstTime || !control || !this.Frame) return;
		  var jPopup = jQuery(this.Frame);
		  
		  var mode = aa_text(data,profile,'Location',context);
		  var d;
		  if( window.innerHeight ) 
			  d = { pageYOffset: window.pageYOffset,pageXOffset:window.pageXOffset, innerHeight: window.innerHeight ,innerWidth: window.innerWidth }
		  else if( document.documentElement &&document.documentElement.clientHeight )
			  d = { pageYOffset: document.documentElement.scrollTop , pageXOffset : document.documentElement.scrollLeft, innerHeight : document.documentElement.clientHeight, innerWidth : document.documentElement.clientWidth}
		  else if( document.body )
			  d = { pageYOffset :document.body.scrollTop, pageXOffset :document.body.scrollLeft,innerHeight: document.body.clientHeight,innerWidth :document.body.clientWidth};
		  d.innerWidth -= 18;	//dirty, considering vertical scroll's width
		  var fixed_location = false;
		  jQuery(control).parents().each(function() { if (jQuery(this).css("position") == 'fixed') fixed_location=true; } );
		  if (fixed_location) { d.pageYOffset = d.pageXOffset = 0; jPopup[0].style.position = 'fixed'; }
			  
		  jPopup.show();		// shows before moving so offsetHeight,offsetWidth are correct
		  var p_height = this.Frame.offsetHeight;
		  var p_width = this.Frame.offsetWidth;
		  var l_ctrl_height = control.offsetHeight;
		  var l_ctrl_width = control.offsetWidth;
		  
		  var pageX = aa_absLeft(control) + l_ctrl_width/2 - p_width/2;
		  var pageY = aa_absTop(control) + l_ctrl_height/2 - p_height/2;
		  
		  var padding = 4;
		  if (pageX < d.pageXOffset + padding) pageX = d.pageXOffset + padding;
		  if (pageY < d.pageYOffset + padding) pageY = d.pageYOffset + padding;
		  if (pageX + p_width + padding> d.pageXOffset + d.innerWidth)
			  pageX = d.pageXOffset + d.innerWidth - p_width - padding;
		  if (pageY + p_height + padding> d.pageYOffset + d.innerHeight)
			  pageY = d.pageYOffset + d.innerHeight - p_height - padding;
		  jPopup.css("top",pageY).show();
		  jPopup.css("left",pageX);
	  }
  },
  CenteringLauncher: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.FixDialogPosition = function(firstTime,forceFixLocation) 
	  {
		  var control = this.onElem;
		  if (!control || !this.Frame) return;

		  var jPopup = jQuery(this.Frame);

		  var centerX = aa_absLeft(control) + (jQuery(control).width()/2);
		  var centerY = aa_absTop(control) + (jQuery(control).height()/2);
			  
		  var width = jPopup.outerWidth();
		  var height = jPopup.outerHeight();
		  
		  var dlgLeft = centerX - (width/2);
		  var dlgTop = centerY - (height/2);;
		  
		  if (dlgLeft<0) dlgLeft=0;
		  if (dlgTop<0) dlgTop=0;

		  jPopup.css("left",dlgLeft).css('top',dlgTop).show();
		  
		  aa_invoke_dialog_handlers(dlg.PositionChanged,dlg,context);
	  };
  },
  NearLauncher: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.FixDialogPosition = function(firstTime,forceFixLocation) 
	  {
		  var control = this.onElem;
		  if (!control || !this.Frame) return;
		  if (!firstTime && this.Frame.offsetHeight == this.lastHeight) return;
		  var jPopup = $(this.Frame);
		  
		  var mode = aa_text(data,profile,'Location',context);
		  var d;
		  if( window.innerHeight ) 
			  d = { pageYOffset: window.pageYOffset,pageXOffset:window.pageXOffset, innerHeight: window.innerHeight ,innerWidth: window.innerWidth }
		  else if( document.documentElement &&document.documentElement.clientHeight )
			  d = { pageYOffset: document.documentElement.scrollTop , pageXOffset : document.documentElement.scrollLeft, innerHeight : document.documentElement.clientHeight, innerWidth : document.documentElement.clientWidth}
		  else if( document.body )
			  d = { pageYOffset :document.body.scrollTop, pageXOffset :document.body.scrollLeft,innerHeight: document.body.clientHeight,innerWidth :document.body.clientWidth};
		  var launcher_fixed_location = false;
		  $(control).parents().each(function() { if ($(this).css("position") == 'fixed') launcher_fixed_location=true; } );
		  if (launcher_fixed_location) { d.pageYOffset = d.pageXOffset = 0; jPopup[0].style.position = 'fixed'; }
			  
		  jPopup.show();		// shows before moving so offsetHeight,offsetWidth are correct
		  var p_height = this.Frame.offsetHeight;
		  var p_width = this.Frame.offsetWidth;
		  var l_ctrl_height = control.offsetHeight;
		  var l_ctrl_width = control.offsetWidth;
		  var goLeft = aa_bool(data,profile,'PopupLeftOfLauncher',context);
		  this.lastHeight = p_height;
		  
		  // makes sure it doesn't goes more than screen size
			if (p_width > d.innerWidth) { jPopup.css("max-width", d.innerWidth + "px"); p_width = this.Frame.offsetWidth; }
			if (p_height > d.innerHeight) { jPopup.css("max-height", d.innerHeight + "px"); p_height = this.Frame.offsetHeight;}
  		  
		  var pageX = aa_absLeft(control), pageY = aa_absTop(control);
		  if (!aa_bool(data,profile,'HidingLauncher',context))
			  pageY += l_ctrl_height +2;
		  
		  var padding = 2;
		  if (this.popupLocation == 'up' || (mode != 'below launcher' && d.innerHeight + d.pageYOffset < pageY + p_height && d.pageYOffset <= pageY - p_height - l_ctrl_height - padding)) {	// jPopup going up
			this.popupLocation = 'up';
			pageY  -= p_height + l_ctrl_height + padding +2;
		  }
  		  else if (mode == 'below,above or aside of launcher' && d.innerHeight + d.pageYOffset < pageY + p_height && 
  				d.pageYOffset > pageY - p_height - l_ctrl_height - padding*2) {	// cannot go not up and not down
  			pageY = d.innerHeight/2 - p_height/2 + d.pageYOffset;	// put at center vertically
  			
			if (!goLeft && pageX + l_ctrl_width + p_width +padding <= d.pageXOffset + d.innerWidth) // go right 
				pageX = pageX + l_ctrl_width + padding;
			else if (pageX - p_width >= d.pageXOffset || goLeft) {	// go left
				pageX = pageX - p_width - padding;
				goLeft = false;  // no need to calc the go left again...
			}
			else // go center
				pageX = d.innerWidth/2 - p_width/2+ d.pageXOffset;
		  }
  		  if (d.innerHeight + d.pageYOffset < pageY + p_height)	{ // overflows downwards
  			  var height_diff = p_height - jPopup.height();
  			  jPopup.css("max-height", d.innerHeight + d.pageYOffset - pageY - height_diff - padding + "px");
  			  if (d.innerHeight + d.pageYOffset - pageY - height_diff - padding <= 0)	// dialog too small
  				dlg.Close();
  		  }
		  if (d.pageXOffset + d.innerWidth < pageX + p_width ) {	// overflows rightwards
			  // if (pageX - p_width + l_ctrl_width >= d.pageXOffset) {	// go left
			  pageX = pageX + l_ctrl_width - p_width;
			  goLeft = false; // no need to calc the go left again...
			  // }
			  // else {	// attach center to launching element
//				  pageX = pageX + l_ctrl_width/2 - p_width/2;
//				  if (d.pageXOffset + d.innerWidth < pageX + p_width + padding)	// overflows rightwards
//					 pageX = d.pageXOffset + d.innerWidth - p_width - padding;
//				  else if (d.pageXOffset > pageX )	// overflows leftwards
//						 pageX = d.pageXOffset + padding;
			  // }
		  }
		  if (aa_bool(data,profile,'UseFixedPosition',context) && !launcher_fixed_location) {
			  jPopup[0].style.position = 'fixed';
			  pageX -= d.pageXOffset;
			  pageY -= d.pageYOffset;
		  }
		  if (firstTime || forceFixLocation) {
			  var left = goLeft ? pageX - jPopup.width() : pageX, top = pageY;
			  left += aa_int(data,profile,'DeltaX',context);
			  top += aa_int(data,profile,'DeltaY',context);
			  if (left + jPopup.width() > d.innerWidth) 
				  left = d.innerWidth - jPopup.width();
			  if (left < 0 ) left = 0;
			  if (window.fb_params) left += 9;	// TODO: fix this !!!  
			  jPopup.css("left",left).css('top',top).show();
			  
			  aa_invoke_dialog_handlers(dlg.PositionChanged,dlg,context);
		  }
		  
		  if (aa_bool(data,profile,'PopupAtLeastWideAsLauncher',context))
			  jPopup.css('min-width',l_ctrl_width+'px');
	  }
  },
  StudioStyleDialogOf: function (profile,data,context)
  {
  	var dlg = aa_var_first(context,'_Dialog');
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
	  	jQuery(dlg.Frame).addClass('jbstudio_style_dialog');
	  	dlg.Frame.jbStyleXtml = aa_first(data,profile,'Xtml',context);
	  });

  },
  TopZIndexWhenTouching: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		  jQuery(dlg.Frame).find(".aa_dialog_title").mousedown(function() {
//		  jQuery(dlg.Frame).mousedown(function() {
			  dlg.setAsTop();
  		   });
		  dlg.setAsTop();
	  });
	  dlg.setAsTop = function() {
		var other_dialogs = jQuery(".aa_dlg");
		var topZIndex = 0;
		for(var i=0;i<other_dialogs.length;i++) {
			if (other_dialogs[i].Dialog == dlg) continue;
			var zindex = parseInt( jQuery(other_dialogs[i]).css('z-index') || '0') || 0;
			if (zindex > topZIndex) topZIndex = zindex;
		}
		var myzindex = parseInt(jQuery(dlg.Frame).css('z-index') || '0') || 0;
		if (myzindex <= topZIndex) 
			jQuery(dlg.Frame).css('z-index',topZIndex+1);
	  }
  },
  InScreenCenter: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.FixDialogPosition = function(firstTime) 
	  {
		if (!dlg.alreadyShown && !firstTime) return;
		if (firstTime) dlg.firstTimeShow = new Date().getTime();
		
		var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
		var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);

		var scrollOffsetX = document.body.scrollLeft || document.documentElement.scrollLeft;
		var scrollOffsetY = document.body.scrollTop || document.documentElement.scrollTop;
		if (!this.Frame) return;
		var jFrame = jQuery(this.Frame);
	  	
	  	var jDlgBody = jQuery(this.ContentsPlaceholder());
	  	if (jDlgBody.height() > jDlgBody[0].scrollHeight) jDlgBody.height(jDlgBody[0].scrollHeight);
	  	if (jDlgBody.width() > jDlgBody[0].scrollWidth) jDlgBody.width(jDlgBody[0].scrollWidth);

	  	var yCaption = jFrame.height() - jDlgBody.height();
	  	var xCaption = jFrame.width() - jDlgBody.width();
	  	if (jFrame.height() > screenHeight) jDlgBody.height(screenHeight-yCaption-50);
	  	if (jFrame.width() > screenWidth) jDlgBody.width(screenWidth-xCaption-50);

	  	// Handle out of screen
	  	var fixPos = false;
	  	if (aa_absLeft(jFrame[0]) < 0 || screenWidth - jFrame.width() - aa_absLeft(jFrame[0]) < 0) fixPos = true;
	  	if (aa_absTop(jFrame[0]) < 0 || screenHeight - jFrame.height() - aa_absTop(jFrame[0]) < 0) fixPos = true; 
	  	
	  	if (firstTime || aa_bool(data,profile,'AlwaysInScreenCenter',context) || fixPos) {
		  jFrame.css('left',Math.max(5,(screenWidth - jFrame.width())/2) + "px");
		  jFrame.css('top',Math.max(5,(screenHeight - jFrame.height())/2) + "px");
		  jFrame[0].style.position = 'fixed';
	  	}
	  	dlg.alreadyShown = true;
	  }
  },
  UniquePopup: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
  	  var id = aa_text(data,profile,'Identifier',context);
  	  
//	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		if (aa_bool(data,profile,'AutoClose',context)) {
			var popups = jQuery('body').find('.aa_dlg');
			for(var i=0;i<popups.length;i++)
			  if (popups[i].Dialog.Identifier == id) popups[i].Dialog.Close([],context);
		}
		dlg.Identifier = id;
//	  });
	  if (aa_bool(data,profile,'KeepPopupLocation',context)) 
	  {
		  jBart.vars.dialogLocations = jBart.vars.dialogLocations || {};
		  aa_register_handler(dlg,'BeforeClose', function(dlg,ctx) {
			  jBart.vars.dialogLocations[id] = { left: dlg.Frame.style.left , top: dlg.Frame.style.top, position: dlg.Frame.style.position, right:dlg.Frame.style.right }; 
		  });
		  aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) {
			  if (!jBart.vars.dialogLocations[id]) return;
			  dlg.OrigFixDialogPosition = dlg.FixDialogPosition;
			  dlg.FixDialogPosition = function(firstTime) {
				  if (!firstTime) {
					  if (! dlg.OrigFixDialogPosition) return;
					  return dlg.OrigFixDialogPosition(firstTime);
				  }
				  dlg.Frame.style.left = jBart.vars.dialogLocations[id].left;
				  dlg.Frame.style.top = jBart.vars.dialogLocations[id].top;
				  dlg.Frame.style.position = jBart.vars.dialogLocations[id].position;
				  dlg.Frame.style.right = jBart.vars.dialogLocations[id].right;
				  dlg.OrigFixDialogPosition(false);
			  }
		  });
	  }
  },
  DragDialog: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		  var titleElem = jQuery(dlg.Frame).find(".aa_dialog_title")[0] || (jQuery(dlg.Frame).hasClass('aa_dialog_title') && dlg.Frame);
		  aa_enable_move_by_dragging(dlg.Frame,titleElem,function() { /*ajaxart_dialog_close_all_popups();*/ });
	  });	  
  },
  DialogFrame: function (profile,data,context) 
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.createFrame = function() {
		  var dlg = this;
		  var allText = '<table cellpadding="0" cellspacing="0"><tbody class="aa_dlg_tbody">'
			  +  '<tr><td class="aa_dialog_title"/></tr>'
			  +  '<tr><td style="vertical-align:top"><div class="aa_dialogcontents"/></td></tr>'
		      +  '<tr><td class="aa_dialogbuttons"/></tr></tbody></table>';
		  var jFrame = jQuery(allText);
		  aa_enable_move_by_dragging(jFrame[0],jFrame.find(".aa_dialog_title")[0],function() { ajaxart_dialog_close_all_popups(); });
		  return jFrame[0];
	  }
  },
  ToggleDialog: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];

	  aa_register_handler(dlg,'BeforeOpenFunc', function(dlg,ctx) {
		 if (dlg.onElem && dlg.onElem.jbDialog && ajaxart.isattached(dlg.onElem.jbDialog.Frame)) {
			 dlg.onElem.jbDialog.Close();
			 dlg.onElem.jbDialog = null;
			 dlg._cancelOpen = true;
		 } 
	  });
  },
  PopupFrame: function (profile,data,context) 
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.PopupStyle = aa_text(data,profile,'Style',context); 
	  dlg.createFrame = function() {
		  var allText = '<div class="aa_popup aa_dialogcontents" style="'+this.PopupStyle+'"/>';
		  return jQuery(allText)[0];
	  }
  },
  Css: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		var cls = aa_attach_global_css(aa_text(data,profile,'Css',context));
		jQuery(dlg.Frame).addClass(cls);
	  }); 
  },
  HoverPopup: function (profile,data,context)
  {
	var dlg = context.vars._Dialog[0];

	aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) 
	{
		// close all other hover-popus
		var new_popups = [];
		for (var i in ajaxart.dialog.openPopups) {
			var popup = ajaxart.dialog.openPopups[i];
			if (popup.Dlg && popup.Dlg.HoverPopup && popup.Dlg != dlg)
				popup.Dlg.Close();
			else
				new_popups.push(popup)
		}
		ajaxart.dialog.openPopups = new_popups;
	});
	aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		dlg.HoverPopup = true;
		dlg.OrigMouseOut = dlg.onElem.onmouseout;
		dlg.OrigMouseOver = dlg.onElem.onmouseover;
		dlg.StartClosingPopup = function()	{
    		setTimeout(function() { 
    			if (dlg.Frame && ! dlg.Frame.isInside) { dlg.OK(data,context); }
    		},200);
		}
		dlg.onElem.onmouseout = function() {
			if (dlg.Frame) dlg.Frame.isInside = false;
			if (!dlg.Frame.hasFocus) dlg.StartClosingPopup();
			if (dlg.OrigMouseOut) dlg.OrigMouseOut();
		}
		dlg.onElem.onmouseover = function() {
			if (dlg.Frame) dlg.Frame.isInside = true;
		}
    	dlg.Frame.onmouseover = function() { dlg.Frame.isInside = true; }
    	dlg.Frame.onmouseout = function() { 
    		dlg.Frame.isInside = false;
    		if (!dlg.Frame.hasFocus) dlg.StartClosingPopup();
    	}
    	dlg.Frame.onfocus = function() { dlg.Frame.hasFocus = true; }
    	dlg.Frame.onblur = function() { dlg.Frame.hasFocus = false; }
    });
    aa_register_handler(dlg,'AfterClose', function(dlg,ctx) {
    	dlg.onElem.onmouseout = dlg.OrigMouseOut;
    	dlg.onElem.onmouseover = dlg.OrigMouseOver;
    });
  },
  CloseWhenClickingOutside: function (profile,data,context)
  {
		var dlg = context.vars._Dialog[0];
		dlg.Orig_mousedown = (window.captureEvents) ? window.onmousedown : document.onmousedown;
		var ignoreLaunchingElement = aa_bool(data,profile,'IgnoreLaunchingElement',context);
		
		function isChild(child,parent) {
			if (!child) return false;
			if (child == parent) return true;
			return isChild(child.parentNode,parent);  
		}
		function captureClick(e) {
			var dlg = context.vars._Dialog[0];
		    var elem = jQuery( (typeof(event)== 'undefined')? e.target : (event.tDebug || event.srcElement)  );

		    if (elem.parents('html').length == 0) return; // detached - should not close..?
		    if (dlg.Frame == elem.parents('.aa_dlg')[0] || elem.hasClass('aa_dlg')) return;  // clicking inside us should not close
		    if (ignoreLaunchingElement && isChild(elem[0],dlg.onElem)) return;
		    
		    dlg.OK(data,context);
		}
		
		setTimeout( function() { 	
			if (window.captureEvents) window.onmousedown=captureClick;
			else document.onmousedown=captureClick;
		},1);
		
	  aa_register_handler(dlg,'AfterClose', function(dlg,ctx) 
		{
	    	if (window.captureEvents) 
	    	  window.onmousedown = dlg.Orig_mousedown;
	    	else 
	    	  document.onmouseclick = dlg.Orig_mousedown;
		});	
  },
  OKOnEnter: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.OKOnEnter = aa_bool(data,profile,'Enabled',context);
	  aa_register_handler(dlg,'KeyDown', function(e,ctx) 
	  {
		 if(e.keyCode != 13 || !dlg.OKOnEnter) return;
		 
		 var elem = (typeof(event)== 'undefined')? e.target : event.srcElement;
	     if (!elem || elem.tagName.toLowerCase() != 'textarea') 
	       dlg.OK(data,context);
	  });
  },
  CloseOnEsc: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.CloseOnEsc = aa_bool(data,profile,'Enabled',context);
	  aa_register_handler(dlg,'KeyDown', function(e,ctx) 
	  {
		 if(e.keyCode == 27) dlg.Cancel();
	  });
  },
  ButtonsHorizontal: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.ButtonsControl = function(data1,ctx) {
		var out = jQuery('<table cellpadding="4"><tr/></table>')[0];
		var align_param = aa_text(data,profile,'Align',context);
		var align = align_param;
		if (align_param == "auto")
			align = dlg.Rtl ? 'left' : 'right';
		jQuery(out).css('float',align);
		var tr = jQuery(out).find('tr')[0];
		for(var i=0;i<this.Buttons.length;i++) {
			var btn = this.Buttons[i].Control(data1,ctx)[0];
			var td = jQuery('<td/>')[0];
			td.appendChild(btn);
			tr.appendChild(td);
		}
		return out;
	  }
  },
  DialogShadow: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) 
	  {
		var shade1 = jQuery('<tr class="dialog_right_shadow_tr"><th class="dialog_shadow_extra_th"/>'
					      + '<th rowspan="6" class="dialog_right_shadow_th"><div class="dialog_right_shadow" /></th></tr>');
	
		var shade2 = jQuery('<tr class="dialog_bottom_shadow" ><td><span class="dialog_bottom_outer" ><span class="dialog_bottom_inner" ></span>'
				          + '</span></td></tr>');
		
		if (ajaxart.isIE) { // causes the title to be two lines (we should refactor the dialog not to use table)
			shade1.find('.dialog_right_shadow_th').css('display','none');
			shade2.css('display','none');
		}
		
		var tbody = jQuery(dlg.Frame).find('tbody')[0];
		tbody.insertBefore(shade1[0],tbody.firstChild);
		tbody.appendChild(shade2[0]);
		jQuery(dlg.Frame).css('border','none');
	  });
  },
  Size: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) 
	  { 
		  var top = dlg.ContentsPlaceholder();
		  aa_set_element_size(top,aa_text_with_percent(data,profile,'Size',context));
		  aa_set_element_size(top,aa_text_with_percent(data,profile,'MaxSize',context),"max-");
	  });
  },
  Resizer: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) 
	  { 
		  var top = dlg.ContentsPlaceholder();
		  
		  aa_addResizer(top,{
		  	onResize: function(width,height) {
			    jQuery(top).width(width).height(height).css('max-width',width+'px').css('max-height',height+'px');

			    var right = jQuery(dlg.Frame).css('right');
			    if (right && right != 'auto') {
				    var dlgLeft = aa_absLeft(dlg.Frame);
				    jQuery(dlg.Frame).css('left',dlgLeft + 'px').css('right','');
			    }
			},
		    insertResizer1: function(element,resizer) {
			  element.appendChild(resizer);
			}
  		  });
	  });
  },
  CloseDialogFrame: function (profile,data,context)
  {
	  var topDialog = aa_top_dialog();
	  if (!topDialog) return;
	  if (topDialog.OldDialog) aad_close_dialog_old('Cancel',true);
	  else topDialog.Dialog.Close([],context);
  },
  CloseContainingDialog: function (profile,data,context)
  {
	  var ctrl = context.vars.ControlElement[0];
	  while (ctrl) {
		  var dialog = ctrl.Dialog;
		  if (dialog) 
			return dialog.Cancel(dialog.Data,dialog.Context);
		  ctrl = ctrl.parentNode;
	  }
  },
  InplaceDialog: function (profile,data,context)
  {
	var previewValue =  ajaxart.inPreviewMode;
	ajaxart.inPreviewMode = true;
    ajaxart.runNativeHelper(data,profile,'OpenDialog',context);
    ajaxart.inPreviewMode = previewValue;
    
    var dialog = aa_openDialogs[aa_openDialogs.length-1];
    if (!dialog || dialog.Title != aa_text(data,profile,'Title',context)) return;
    jQuery(dialog.Frame).addClass('aa_inplace_dialog');
    var out = dialog.Frame;
    dialog.Cancel(dialog.Data,dialog.Context);
    var field = context.vars._Field[0];
    field.Control = function() { 
    	return [out]; 
    }
  },
  CloseDialog: function (profile,data,context)
  {
	  var topDialog = aa_top_dialog();
	  if (!topDialog) return;
	  if (topDialog.OldDialog) {
		  // close by clicking on the OK button (because of async checks etc.)
		  var okButton = jQuery(topDialog.dialogContent).find('.OKButton')[0];
		  if (okButton) {
		    aa_fire_event(okButton,'mousedown',context,{});
		    aa_fire_event(okButton,'mouseup',context,{});
		  }
	  }
	  else {
		  if (aa_text(data,profile,'CloseType',context) == "OK")
			  topDialog.Dialog.OK(topDialog.Dialog.Data,topDialog.Dialog.Context);
		  else
			  topDialog.Dialog.Cancel(topDialog.Dialog.Data,topDialog.Dialog.Context);
	  }
  },
  CloseIconOld: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) 
	  {
		var jTitle = jQuery(dlg.Frame).find('.aa_dialog_title');
		if (jTitle.length == 0)
			jTitle = jQuery(dlg.Frame);
		if (aa_bool(data,profile,'UseXCharacter',context)) {
			var img = jQuery('<div class="aa_dialog_caption_close xchar"><div></div>');
			img.find('>div').text(aa_text(data,profile,'XCharacter',context));
			img = img[0];
		} else {
			var src = aa_text(data,profile,'Image',context);
			var img = jQuery('<img class="aa_dialog_caption_close" src="'+src+'"/>')[0];
		}
		jQuery(img).addClass( aa_attach_global_css(aa_text(data,profile,'Css',context),null,'close_dialog_old') );
		img.onclick = function() { dlg.Cancel(dlg.Data,ctx); }
		
		jTitle[0].insertBefore(img,jTitle[0].firstChild);
	  });
  },
  CloseIcon: function (profile,data,context)
  {
	  var style = aa_first(data,profile,'Style',context);

	  aa_register_handler(context.vars._Dialog[0],'AfterOpen', function(dlg,ctx) {
		  aa_renderStyleObject(style,{
			 dialog: dlg.Frame,
			 CloseDialog: function() { dlg.Cancel(dlg.Data,ctx); }
		  },ctx)
	  },'CloseIcon');
  },
  AutomaticFocus: function (profile,data,context)
  {
	  if (ajaxart.inPreviewMode) return;
	  var dlg = context.vars._Dialog[0];
	  var focus_on = aa_text(data,profile,'FocusOn',context);
	  aa_register_handler(dlg,'AfterOpen', function(dlg,ctx) {
		  if (focus_on == "first input") {
				setTimeout(function() {
					if (dlg.Disabled) return;
					if (ajaxart.controlOfFocus)
	    	  	  		ajaxart.controlOfFocus.IgnoreBlur = true;
					
					var inp = jQuery(dlg.Contents).find('input');
					if (inp.length > 0) inp[0].focus();
				},1);
		  }
	  },"AutomaticFocus");
  },
  NoCancel: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.NoCancel = true;
	  if (!dlg.Buttons) return;
	  for(var i=0;i<dlg.Buttons.length;i++) {
		  if (dlg.Buttons[i].ID == 'OK') {
			  var okbtn = ajaxart.runNativeHelper(data,profile,'OKButton',context)[0];
			  if (okbtn) dlg.Buttons[i] = okbtn;
		  }
		  if (dlg.Buttons[i].ID == 'Cancel') {
			  dlg.Buttons.splice(i,1);
		  }
	  }
  },
  DisableBodyScroll: function (profile,data,context)
  {
	  var dlg = context.vars._Dialog[0];
	  dlg.DisableBodyScroll = aa_bool(data,profile,'Enabled',context);
	  aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) 
	  {
		  if (!dlg.DisableBodyScroll) return;
		  if (!jBart.dialogs.DisableBodyScroll_counter) jBart.dialogs.DisableBodyScroll_counter =0;
		  jBart.dialogs.DisableBodyScroll_counter++;
		  
		  jQuery('body').css('overflow','hidden');
	  });
	  aa_register_handler(dlg,'AfterClose', function(dlg,ctx) 
	  {
		  if (!dlg.DisableBodyScroll) return;
		  if (--jBart.dialogs.DisableBodyScroll_counter == 0)
			jQuery('body').css('overflow','auto');
	  });
  },
  ScreenCover: function (profile,data,context) 
  {
	  var dlg = context.vars._Dialog[0];
	  var alreadyExists = dlg.CoverColor != null;
	  dlg.CoverColor = aa_text(data,profile,'Color',context);
	  dlg.CoverOpacity = aa_text(data,profile,'Opacity',context);
	  if (alreadyExists) return;
	  aa_register_handler(dlg,'BeforeOpen', function(dlg,ctx) 
	  {
		//var wrappingDiv = jQuery('<div class="dialog_cover" style="position:absolute;top:0px;left:0px;" />')[0];
		var wrappingDiv = jQuery('<div class="dialog_cover" style="position:fixed;top:0px;left:0px;" />')[0];
		
		wrappingDiv.style.backgroundColor = dlg.CoverColor;
		wrappingDiv.onmousedown = function(e) {
			e = e || event;
			if (e == null) return;
		    if (typeof(Event) != 'undefined' && Event.resolve) Event.cancelBubble(Event.resolve(e)); 
		}
		wrappingDiv.Dialog = dlg;
		var scree_size = aa_screen_size();
		//wrappingDiv.style.width = Math.max(document.documentElement.scrollWidth,scree_size.width) -18 + "px";
		//wrappingDiv.style.height = Math.max(document.documentElement.scrollHeight,scree_size.height) -18 + "px";
		wrappingDiv.style.width = '100%';
		wrappingDiv.style.height = '100%';
		wrappingDiv.style.zIndex = aa_int(data,profile,'MinZIndex',context) + aa_noOfOpenDialogs;
		wrappingDiv.style.opacity = dlg.CoverOpacity;
		wrappingDiv.style.filter = "alpha(opacity=" + dlg.CoverOpacity *100 + ")";	// IE	
		wrappingDiv.tabIndex = 0;
		
	    jQuery(wrappingDiv).keydown( function(event){
	    	if(event.keyCode == 27)	wrappingDiv.Dialog.Cancel();
	    } );
		if (!ajaxart.inPreviewMode) document.body.appendChild(wrappingDiv);
	  });
	  aa_register_handler(dlg,'AfterClose', function(dlg,ctx) 
	  {
		  var covers = jQuery('body').find('.dialog_cover');
		  for(var i=0;i<covers.length;i++)
			  if (covers[i].Dialog == dlg) {
				  aa_remove(covers[i],true);
				  return;
			  }
	  });
  },
  TopDialog: function (profile,data,context)
  {
	  var topDialog = aa_top_dialog();
	  if (!topDialog) return [];
	  if (aa_bool(data,profile,'ReturnContent',context))
		  return [topDialog.Dialog.Contents];
	  else
		  return [topDialog.Dialog];
  },
  CloseAllDialogs: function (profile,data,context)
  {
	  for (var i=0; i<aa_openDialogs.length; i++)
		  aa_openDialogs[i].Close();
	  aa_openDialogs = [];
	  return [];
  },
  CloseDialogByID: function (profile,data,context)
  {
	  var id = aa_text(data,profile,'Identifier',context);
 	  var popups = jQuery('body').find('.aa_dlg');
	  for(var i=0;i<popups.length;i++) {
		  if (id != '' && popups[i].Dialog.Identifier == id) { 
			  popups[i].Dialog.Close();
			  return;
		  }
	  }
  }
});


function aa_invoke_dialog_handlers(eventFuncs,dlg,context)
{
	if (eventFuncs)
		for(var i=0;i<eventFuncs.length;i++)
			eventFuncs[i](dlg,context);
}

function aa_top_dialog()
{
  var dialogs = jQuery('body').find('.aa_dlg');
  var maxCounter = 0,topDialog=null;
  for(var i=0;i<dialogs.length;i++) {
	  if (dialogs[i].counter > maxCounter) { topDialog = dialogs[i]; maxCounter = topDialog.counter; }
  }
  if (openDialogs.length == 0) return topDialog;
  
  var topOldDialog = openDialogs[openDialogs.length-1];
  if (!topDialog || topDialog.noOfOpenDialogs < topOldDialog.noOfOpenDialogs) return topOldDialog;
  
  return topDialog;
}

function aa_enable_move_by_dragging(draggable_frame,draggable_area,onstartdrag,onenddrag)
{
	if (!draggable_area) return;
	jQuery(draggable_area).mousedown(function(e) {
		  e = e || event;
		  if (! draggable_frame.Moving) {
			  	var right_pos = (draggable_frame.style.right.split("px").length > 1) ? draggable_frame.style.right.split("px")[0] : null;
			  	draggable_frame.Moving = { mouse_x: (e.clientX || e.pageX), mouse_y: (e.clientY || e.pageY), 
				  	frame_x: draggable_frame.offsetLeft, frame_y: draggable_frame.offsetTop, frame_right: right_pos };
			  	onstartdrag();
			  	ajaxart_disableSelection(document.body);
			  	ajaxart_disableSelection(jQuery(draggable_area).parents(".aa_dlg")[0]);
		  }
		  var mouse_move = function(e) {
			  e = e || event;
			  var top = Math.max( (e.clientY || e.pageY) - draggable_frame.Moving.mouse_y + draggable_frame.Moving.frame_y, 0);
			  draggable_frame.style.top = top + "px";
			  draggable_frame.style.bottom = 'inherit';
			  if (draggable_frame.Moving.frame_right) {	//	anchoring to the right side
				  draggable_frame.style.right = draggable_frame.Moving.frame_right - ((e.clientX || e.pageX) - draggable_frame.Moving.mouse_x) + "px";
			  } else {
				  draggable_frame.style.left = (e.clientX || e.pageX) - draggable_frame.Moving.mouse_x + draggable_frame.Moving.frame_x + "px";
				  draggable_frame.style.right = 'inherit';
			  }
		  }
		  var mouse_up = function(e) {
			  e = e || event;
			  draggable_frame.Moving = null;
			  window.onmousemove = null; window.onmouseup =null;  document.onmouseup=null; document.onmousemove=null; 
			  ajaxart_restoreSelection(document.body);
			  ajaxart_restoreSelection(jQuery(draggable_area).parents(".aa_dlg")[0]);
			  if (onenddrag) onenddrag();
		  }
		  if (window.captureEvents){ window.onmousemove = mouse_move;window.onmouseup = mouse_up; }
		  else { document.onmouseup=mouse_up;	document.onmousemove=mouse_move;  }
	  });
}

aa_gcs("dialog", {
	  TogglePopup: function (profile,data,context)
	  {
		var onElem = aa_first(data,profile,'OnElement',context);
		var widthOption = aa_text(data,profile,'WidthOption',context);
		if (widthOption == '') widthOption = 'launcher width';
		var width = aa_text(data,profile,'Width',context);
		var height = aa_text(data,profile,'Height',context);
	    var popupdata = ajaxart.run(data,profile,'PopupData',context);
	    var closeOnEnter = aa_bool(data,profile,'CloseOnEnter',context);
	    var closeOnDoubleClick = aa_bool(data,profile,'CloseOnDoubleClick',context);
	    var popupCssClass = aa_text(data,profile,'PopupCssClass',context);
	    var returnFocusTo = aa_first(data,profile,'ReturnFocusTo',context);
	    var style = aa_text(data,profile,'Style',context);
		for(i=0; i<ajaxart.dialog.openPopups.length; i++)
		{
			if (ajaxart.dialog.openPopups[i].onElem == onElem)
			{
				var popupContents = ajaxart.dialog.openPopups[i].contents;
			    var popup = jQuery(popupContents).parents('.aapopup');
			    if (popup.length > 0 && popup[0].parentNode != null) {
			    	aa_remove(popup[0],true);
			    }
				
			    var newArr= [];
			    for(var j in ajaxart.dialog.openPopups)
			    {
			    	if (i != j)
			    		newArr.push( ajaxart.dialog.openPopups[j] );
			    }
			    aa_uncapture_for_popup(ajaxart.dialog.openPopups[i]);
			    ajaxart.dialog.openPopups = newArr;
			    
				return ["true"];
			}
		}
		ajaxart.setVariable(context,"_LaunchingElement",[onElem]);
		var contents = aa_first(popupdata,profile,'Contents',context);
		if (!contents) return;
		var popupObj = {contents: contents , onElem: onElem, profile: profile, returnFocusTo: returnFocusTo };
		contents.PopupObj = popupObj;
		// console.log("TogglePopup " + popupObj.onElem.parentNode.Field.Id);
		if (contents != null)
			ajaxart.dialog.openPopups.push(popupObj);
		if (onElem == null || contents == null ) { ajaxart.log("toggle popup - empty contents or no launching element","warning"); return []; }
		contents.LaunchingElement = onElem;
		if (onElem.offsetParent == null) { ajaxart.log("toggle popup - launching element has no offsetParent","warning");  }
		var jOnElem = jQuery(onElem);
		var popup = jQuery(document.createElement("div")).addClass("aapopup " + popupCssClass);
		popup[0].profile = profile;
		popup[0].context = context;
		popup[0].data = data;
		if (style != "") {
			if (style.indexOf(":") > 0)
				aa_setCssText(popup[0],style);
			else
				popup[0].className = popup[0].className + style;
		}
		if (! aa_intest)
		{
			popup[0].style.display = 'none';
			popup[0].display = 'none';
		}
		jQuery(contents).appendTo(popup);
		if (aa_bool(data,profile,'ShowCloseButton',context))
		{
			var deleteDiv = jQuery('<div style="padding: 0 0 16px 16px; position:absolute; top: 7px; right:4px; cursor:pointer;" />')[0];
			deleteDiv.style.background = "url(" + aa_text(data,profile,'CloseImage',context) + ') no-repeat';
			deleteDiv.popup = popupObj;
			deleteDiv.onmousedown = function() {
				aa_closePopup(this.popup);
			}
			popup[0].insertBefore(deleteDiv,popup[0].firstChild);
		}

		var registerFunc = function(popup,popupdata,popupObj,closeOnEnter) {
			popup[0].onkeyup = function(e) { 
				e = e || event;
				if (typeof(e) == "undefined") e = event;
				if (closeOnEnter && e.keyCode == 13 && this.parentNode != null) // ENTER
				{
			    	var elem = jQuery( (typeof(event)== 'undefined')? e.target : event.srcElement  );
			    	if (elem[0] && elem[0].tagName.toLowerCase() == 'textarea') return;
					
//					this.parentNode.removeChild(this);
//					aa_element_detached( this );
					aa_closePopup(popupObj);
					ajaxart.run(popupdata,profile,'OnSuccess',context);
					ajaxart_stop_event_propogation(e);
				}
				if (e.keyCode == 27) {
					if (ajaxart.currentContextMenu == null || $(ajaxart.currentContextMenu).css("display") != 'block' ) {// ESC
//						this.parentNode.removeChild(this);
//						aa_element_detached(this);
						ajaxart.run(data,profile,"OnCancel",context);
						ajaxart_stop_event_propogation(e);
						aa_closePopup(popupObj);
					}
				}
			};
			if (closeOnDoubleClick)
			  popup[0].ondblclick = function() {
				this.parentNode.removeChild(this);
				aa_element_detached( this );
				ajaxart.run(popupdata,profile,'OnSuccess',context);
			  }
		}
		registerFunc(popup,popupdata,popupObj,closeOnEnter);
		
		window.aa_noOfOpenDialogs = window.aa_noOfOpenDialogs || 0;

		var xydelta = aa_text(data,profile,'XYCorrections',context).split(',');
		
		if (jOnElem.parents('.jbstudio').length > 0) popup.addClass('jbstudio');
		
		if (jOnElem.parents('.right2left').length > 0)
		{
			popup.addClass('right2left');
		}
		else
		{
			popup.css('left',aa_absLeft(onElem)+parseInt(xydelta[0]));
			if (width == "" && widthOption == 'launcher width') 
				jQuery(popup).css('min-width',jOnElem.width() + 100); //width = jOnElem.width()+"px";
			else
				popup[0].style.minWidth = width;
			//popup[0].style.minWidth = width;
		}
		++aa_dialogCounter;
		var zindex = aad_dialog_zindex(2000 + aa_dialogCounter+1,popup[0]);
		popup.css('z-index',zindex);
		//popup.css('top',aa_absTop(onElem) + jOnElem[0].clientHeight + 50); // + parseInt(xydelta[1]));
		
		if (height != "") popup.height(height);
		//popup.height('100px');
		//popup.width('60px');
		
		popup.appendTo("body");
		aa_element_attached(popup);

		var newcontext = ajaxart.clone_context(context);
		ajaxart.setVariable(newcontext,"ControlElement",[contents]);
		if (ajaxart.fieldscript(profile,'AutoFocusOn',true) != null && !ajaxart.inPreviewMode)
		{
			var autoFocusParams = ajaxart.calcParamsForRunOn(newcontext,ajaxart.run(data,profile,'AutoFocusOn',newcontext));
			var autoFocusOn = ajaxart.getControlElement(autoFocusParams);
			if (autoFocusOn.length > 0 && 'focus' in autoFocusOn[0])
			{
			    var timeout = 1;
			    if (ajaxart.isSafari || ajaxart.isFireFox) timeout = 100;
		    	var set_focus = function(e) {  setTimeout(function() 
		    	{
		    		e = e || event;
	    	  	  	if (ajaxart.controlOfFocus != null)
	    	  	  		ajaxart.controlOfFocus.IgnoreBlur = true;
		    		if (jQuery(e).parents("body").length > 0) e.focus();  
		    	},timeout) }
		    	set_focus(autoFocusOn[0]);
			}
		}

		var init_popup = function(popup,width,widthOption,popupObj) { return function() {
			ajaxart.dialog.positionPopup(popup[0], onElem, null, false);
			if (width == '' && widthOption == 'launcher width' && jOnElem[0].offsetWidth > 2)
				popup.css('min-width',jOnElem[0].offsetWidth - 2); // potential bug - 2 for the border
			if (popup.hasClass('right2left'))
			{
				var lanchingElementRight = aa_absLeft(onElem) + jOnElem[0].offsetWidth;
				var popupLeft = lanchingElementRight - popup[0].offsetWidth;
				popup.css('left',popupLeft + 'px');
				popup.css('right','');
			}
			aa_capture_for_popup(popupObj);
			popupObj.initialized = true;
			if (aa_bool(data,profile,'AutoCloseOnMouseOut',context)) 
			{
				popup[0].onmouseover = function() { popup[0].isInside = true; }
				popup[0].onmouseout = function() { popup[0].isInside = false; setTimeout(function() {
					if (! popup[0].isInside)
						aa_closePopup(popup[0]);
				},500)}
			}
			if (ajaxart.isIE) // avoid scroll - IE bug?
				popup.height((popup.height() +2) + 'px');
			popup[0].style.display = '';
			popup[0].display = '';
			ajaxart.run(data,profile,'OnPopupOpen',aa_ctx(context, {ControlElement: [popup[0]]}) );
		}}
		setTimeout(init_popup(popup,width,widthOption,popupObj),1);
			
	  },
	  ClosePopup: function (profile,data,context)
	  {
		  var counter = 10;
		  if (aa_bool(data,profile,'AllPopups',context))
			  while (ajaxart.dialog.openPopups.length > 0 && counter > 0)
			  {
				  aa_closePopup(ajaxart.dialog.openPopups[ajaxart.dialog.openPopups.length-1]);
				  counter--;
			  }
		  if (ajaxart.dialog.openPopups.length > 0)
			  return aa_closePopup(ajaxart.dialog.openPopups[ajaxart.dialog.openPopups.length-1]);
	  }
});

jBart.disableSelections = function() {
  	ajaxart_disableSelection(document.body);
  	var frames = document.frames;
}
jBart.restoreSelections = function() {
	ajaxart_restoreSelection(document.body);
  	var frames = document.frames;
}

// jBart.addResizer assumes element has a div parent, and that it has no visible siblings 
function aa_addResizer(element,resizeProperties)
{
	var defaultProperties = { image: aa_base_images() + '/resizer.gif', width: '16px', height: '16px', minWidth: 20, minHeight: 20,
		zIndex: 10,
	  onResize: function(width,height) {},
	  onResizeEnd: function(width,height) {},
	  insertResizer: function(element,resizer) {
		  element.parentNode.appendChild(resizer);
	  }
	};
	
	resizeProperties = $.extend(defaultProperties,resizeProperties);
	
	if (!element || !element.parentNode) return;
	jQuery(element.parentNode).css('position','relative');
	var jResizer = jQuery('<div style="position:absolute;bottom:0;right:0;background-repeat:no-repeat;" />');
	jResizer.css('background','url('+resizeProperties.image+')').css('width',resizeProperties.width).css('height',resizeProperties.height).css('cursor','se-resize').
		css("z-index",resizeProperties.zIndex);
	resizeProperties.insertResizer(element,jResizer[0]);

	jResizer.mousedown(function(e) {
		  if (! jResizer[0].jbResizingProps) {
		  	var width = jQuery(element).width();
		  	var height = jQuery(element).height();
		  	jResizer[0].jbResizingProps = { mouse_x: (e.clientX || e.pageX), mouse_y: (e.clientY || e.pageY), width: width, height: height };
		  	jBart.disableSelections();

		  	var resizeCover = jQuery('<div id="aa_resize_cover" style="height:100%; width: 100%; background:pink;z-index:10000; opacity:0; filter: alpha(opacity=0);position:fixed;top:0;left:0;top:0;bottom:0"/>');
			jQuery('body').append(resizeCover);
		  }
		  var mouse_move = function(e) {
			  e = e || event;
			  var props = jResizer[0].jbResizingProps;
			  var mouse_x = (e.clientX || e.pageX), mouse_y = (e.clientY || e.pageY);
			  var newWidth = props.width + (mouse_x - props.mouse_x);
			  var newHeight = props.height + (mouse_y - props.mouse_y);
			  if (newWidth > resizeProperties.minWidth) jQuery(element).width(newWidth); 
			  if (newHeight > resizeProperties.minHeight) jQuery(element).height(newHeight);
			  
			  resizeProperties.onResize(newWidth,newHeight);
		  }
		  var mouse_up = function(e) {
			  e = e || event;
			  jResizer[0].jbResizingProps = null;
			  window.onmousemove = null; window.onmouseup =null;  document.onmouseup=null; document.onmousemove=null; 
		  	  jBart.restoreSelections();
		  	  resizeProperties.onResizeEnd(jQuery(element).width(),jQuery(element).height());
		  	  jQuery('#aa_resize_cover').remove();

		  }
		  if (window.captureEvents){ window.onmousemove = mouse_move;window.onmouseup = mouse_up; }
		  else { document.onmouseup=mouse_up; document.onmousemove=mouse_move; }
    });
}

function aad_dialog_zindex(proposedZIndex,popupElement,isStudio) {
//	return proposedZIndex;

	if (typeof(isStudio) === 'undefined')
		isStudio = $(popupElement).hasClass('jbstudio') || $(popupElement).hasClass('jbstudio_dlg') || $(popupElement).hasClass('xtml_dt_popup');

	var max = proposedZIndex-1,zindex;

	if (isStudio) {
		// we should also be jbstudio_dlg
		var otherStudioPopups = $('.jbstudio_dlg, .aaeditor');
		for(var i=0;i<otherStudioPopups.length;i++) {
			try {
				zindex = parseInt(otherStudioPopups[i].style.zIndex || '0') || 0;
			} catch(e) {
				zindex = 0;
			}
			max = Math.max(max,zindex+2);
		}
	} else {
		var openPopus = aa_open_popups();
		for(var i=0;i<openPopus.length;i++) {
			max = Math.max(max,openPopus[i].zindex+2);
		}
	}

	return max+1;
}













aa_gcs("field", {
	DynamicFields: function (profile,data,context)
	{
		var fieldItems = ajaxart.run(data,profile,'FieldItems',context);
		var out = [];

		for(var i=0;i<fieldItems.length;i++) {
			var field = aa_first([fieldItems[i]],profile,'Field', aa_ctx(context,{_FieldItem: [fieldItems[i]] })); 
			fixField(field,fieldItems[i]);
			out.push(field);
		}
		return out;

		function fixField(field,fieldItem) {
			field.FieldItem = fieldItems[i];
			aa_bind(field,'ModifyInstanceContext',function(args) {
				var ctx2 = aa_merge_ctx(context,args.Context);
				args.Context.vars._FieldItem = [field.FieldItem];
			},'DynamicFields',null,true);	// add as first listener, so other handlers can use _FieldItem
		}
	},
	Text: function (profile,data,context)   // gc of field.Text
	{
		var field = { isObject : true};
		var ctx2 = aa_ctx(context,{_Field: [field]} );

		field.Id = aa_text(data,profile,'ID',ctx2);
		field.ID = [field.Id];
		field.Title = aa_multilang_text(data,profile,'Title',ctx2);
		field.HideTitle = aa_bool(data,profile,'HideTitle',ctx2);
		field.CellPresentation = 'control';
		field.Style = aa_first(data,profile,'Style',context);
		
		field.TitleAsText = ! aa_paramExists(profile,'Text',true);
		
		field.Control = function(field_data,ctx) {
			var text = aa_multilang_text(field_data,profile,'Text',aa_merge_ctx(ctx2,ctx));
			if (!text && field.TitleAsText) text = field.Title;
			text = text.replace(/\n/g,"<br/>");
		
			return [ aa_renderStyleObject(field.Style,{ text: text, data: field_data[0] },ctx) ];
		}
		field.Text = function(field_data,ctx) {
			var text = aa_multilang_text(field_data,profile,'Text',aa_merge_ctx(ctx2,ctx));
			if (!text && field.TitleAsText) text = field.Title;
			text = text.replace(/\n/g,"<br/>");

			return [text];
		}
		ajaxart.runsubprofiles(data,profile,'FieldAspect',ctx2);
		return [field];
	},
	XtmlControl: function (profile,data,context)
	{
		var field = { isObject : true };
		field.Title = aa_multilang_text(data,profile,'Title',context);
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		
		aa_setMethod(field,'Control',profile,'Control',context);
		ajaxart.runsubprofiles(data,profile,'FieldAspect',aa_ctx(context,{_Field: [field]} ));
		
		return [field];
	},
	JavaScriptControl: function(profile,data,context)
	{
		var field = { isObject : true };
		field.Title = aa_multilang_text(data,profile,'Title',context);
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		
		var html_compiled = ajaxart.compile(profile,'Html',context);
		var js_func = aa_get_func(aa_text(data,profile,'JavaScript',context));
			
		var get_ctrl = function(data1,ctx) {
			var html = ajaxart_runcompiled_text(html_compiled, data1, profile, "Html" ,context);
			var control = $(html);
			if (control.length > 1) {
				var control2 = $('<div/>').append(control);
				control = control2;
			}
			if (html == "") control = [];
			var ctrl = (control.length > 0) ? control[0] : null;
			var ctrl_after_js;
			if (js_func) {
				var data_item = (data1.length > 0) ? data1[0] : null;
				ctrl_after_js = js_func(data_item,ctrl,ctx);
			}
			var out = (ctrl_after_js) ? ctrl_after_js : ctrl;
			if (!out) return [];
			$(out).addClass(aa_attach_global_css(aa_text(data,profile,'Css',context)));
			return [out];
		}
		var register = function(get_ctrl) {
			ajaxart_addScriptParam_js(field,'Control',get_ctrl,context);
		}
		register(get_ctrl);
		ajaxart.runsubprofiles(data,profile,'FieldAspect',aa_ctx(context,{_Field: [field]} ));
		
		return [field];
	},
	IsGroup: function (profile,data,context)
	{
		if (data.length == 0) return [];
		if (data[0].Fields != null) return ["true"];
		return [];
	},
	Fields: function (profile,data,context)
	{
		return ajaxart.runsubprofiles(data,profile,'Field',context);
	},
	InnerReferenceFields: function (profile,data,context)
	{
		var refFields = context.vars._ReferenceFields;
		if (refFields == null || refFields.length ==0) return [];
		var path = aa_text(data,profile,'Path',context);
		var out = refFields[0].FieldById[path.split('@').pop()];
		if (out != null && out.Fields != null) return out.Fields;
		return [];
	},
	SubFields: function (profile,data,context)
	{
		var parent = aa_first(data,profile,'Parent',context);
		var fields = [];
		var fillFields = function(parent) {
			var inner_fields = parent.Fields;
			for(var i=0;i<inner_fields.length;i++) {
				if (! inner_fields[i].IsGroup) fields.push(inner_fields[i]);
				else if (inner_fields[i].IsVirtualGroup ) fillFields(inner_fields[i]);
			}
		}
		if (parent != null)	fillFields(parent);
		return fields;
	},
	RefreshField: function(profile,data,context)
	{
		var fieldID = aa_text(data,profile,'FieldID',context);
		if (!fieldID) return;
		var field_ids = fieldID.split(',');
		var scope = aa_text(data,profile,'Scope',context);
		aa_refresh_field(field_ids,scope,aa_bool(data,profile,'FireOnUpdate',context),aa_first(data,profile,'Transition',context),context);
	},
	ToggleFieldClass: function(profile,data,context) {
		var ctrl = aa_find_field_controls({
			scope: aa_text(data,profile,'Scope',context),
			fieldID: aa_text(data,profile,'FieldID',context)
		})[0];
		var className = aa_text(data,profile,'ClassName',context);
		var show = aa_bool(data,profile,'ConditionForClass',context);
		if (ctrl) {
			if (show) $(ctrl).addClass(className);
			else $(ctrl).removeClass(className);
		}
	},
	RefreshFieldByElement: function(profile,data,context)
	{
		var element = aa_first(data,profile,'Element',context);
		var transition = aa_first(data,profile,'Transition',context);
		if (!element) return;
		
		aa_refresh_cell(element,context,transition,null,true);
	},
	FieldWithAspects: function (profile,data,context) {
		var field = aa_first(data,profile,'Field',context);
		if (!field) return [];
		ajaxart.runsubprofiles(data,profile,'FieldAspect',aa_ctx(context,{_Field:[field]}));

		return [field];
	},
	RefreshCurrentField: function (profile,data,context) {
		var element = context.vars.ControlElement[0];
		aa_refresh_cell(element,context,null,null,true);
	},
	FieldTitle: function (profile,data,context)
	{
		var field = ajaxart.run(data,profile,'Field',context);
		if (field.length == 0 || field[0].Title == null) return [];
		return [field[0].Title];
	},
	IsTabSelected: function(profile,data,context)
	{
		var tab_ctrl_id = aa_text(data,profile,'TabControl',context);
		var tab_id = aa_text(data,profile,'Tab',context);
		var out = [];

		$(aad_find_field(tab_ctrl_id,'aa_tabcontrol')).each(function(index,tab) {
			if ($(tab).find('.tab_' + tab_id).hasClass('aa_selected_tab')) out = ["true"];
		});
		return out;
	},
	RefreshTabsHead: function(profile,data,context)
	{
		var tabs = context.vars.ControlElement[0];
		if (tabs.RefreshTabsHead)
			tabs.RefreshTabsHead();
	}
});

aa_gcs('field_feature',{
	Hidden: function (profile,data,context) {
		var field = aa_var_first(context,'_Field');
		var use_field_data = aa_text(data,profile,'DataForCondition',context) == 'Field data';
		field.IsCellHidden = function(item_data,ctx,field_data) {	// field_data param is optional. If not passes, we calculate it
			var input_data = item_data;
			if (use_field_data && field_data)
				input_data = field_data;
			else if (use_field_data && field.FieldData)
				input_data = field.FieldData(item_data,aa_merge_ctx(context,ctx));

			return !aa_bool(input_data,profile,'ShowCondition',aa_merge_ctx(context,ctx));
		};
		field.RenderHiddenCell = aa_text(data,profile,'WhenHidden',context) != 'Do not render';

		aa_bind(field,'ModifyControl',function(args) {
			if (field.IsCellHidden(args.Item,args.Context,args.FieldData))
				aa_hide(args.Wrapper);
		});		
	},
	HiddenTableColumn: function (profile,data,context) {
		var field = aa_var_first(context,'_Field');
		field.IsFieldHidden = function(data2,ctx) {
			return !aa_bool(data2,profile,'ShowCondition',aa_merge_ctx(context,ctx));	
		};		
	}
});

aa_gcs('field_aspect',
{
	Description: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field)
			field.Description = aa_multilang_text(data,profile,'Description',context);
	},
	JavaScript: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var runWhen = aa_text(data,profile,'RunWhen',context);
    	var js = profile.getAttribute('Code');
    	if (!js) js = aa_text(data,profile,'Code',context);
		var func = aa_get_func(js);
		if (runWhen == 'init') func(data[0],null,field,context);
		if (runWhen == 'control' ||  runWhen == 'control attached' ) {
			aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
				if (runWhen == 'control') func(field_data[0],cell,field,ctx);
				if (runWhen == 'control attached') aa_addOnAttach(cell,function() { func(field_data[0],cell,field,ctx); });
			});
		}
	},
	PopupOnHover: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var delay = aa_int(data,profile,'Delay',context);

		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
			cell.onmouseover = function() {
				if (cell.isInside) return;
				if (cell.jbTimer) clearTimeout(cell.jbTimer);
				cell.jbTimer = setTimeout(function() {
					if (cell.isInside)
					  ajaxart.runNativeHelper(field_data,profile,'Open',aa_merge_ctx(context,ctx,{ControlElement: [cell], Item:item}));
					cell.jbTimer = null;
				},delay);
				cell.isInside = true;
			};
			cell.onmouseout = function() { 
				cell.isInside = false;
			};
			cell.onclick = function() {
				if (cell.jbTimer) { clearTimeout(cell.jbTimer); cell.jbTimer=null; }
				ajaxart.runNativeHelper(field_data,profile,'Open',aa_merge_ctx(context,ctx,{ControlElement: [cell], Item:item}));
			}
		},'PopupOnHover');
	},
	TextSummary: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		if (aa_bool(data,profile,'IgnoreEmptyValues',context)) {
			var compiled = ajaxart.compile_text(profile, "Text",context);
			field.Text = function(data1,ctx) {
				if (aa_totext(data1) == "") return [];
				return [compiled(data1,ctx)];
			}
		}
		else
			aa_addMethod(field,'Text',profile,'Text',context);
		return [];
	},
	NumberFormat: function (profile,data,context)
	{
		var field = context.vars._Field && context.vars._Field[0];
		if (field == null) return [];
		var compiled_format = ajaxart.compile(profile,'Format',context);

		if (compiled_format != 'same')
			aa_addMethod(field,'Text',profile,'Format',context);
		return [];
	},
	Tooltip: function(profile,data,context)
	{
		var field = context.vars._Field[0];
		field.Tooltip = aa_multilang_text(data,profile,'Tooltip',context); 
//		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
//			cell.title = aa_multilang_text(field_data,profile,'Tooltip',context);
//		});
		aa_field_handler(field,'ModifyCell', function(cell,field_data) {
			cell.title = aa_multilang_text(field_data,profile,'Tooltip',context);
		});
	},
	RunAction: function(profile,data,context)
	{
		var field = context.vars._Field[0];
		ajaxart.runNativeHelper(data,profile,'SetupAction',context);
		jBart.bind(field,'ModifyControl',function(args) {
			var content = args.Wrapper.jbContent || args.Wrapper.firstChild || args.Wrapper; 
			ajaxart.run(args.FieldData,profile,'AfterControlCreated',aa_ctx(context,{ControlElement: [content]}));
		});
	},
	AsynchAction: function(profile,data,context)
	{
		var field = context.vars._Field[0];
		field.AsyncActionRunner = function(settings) {
			var result = settings.Wrapper || settings.wrapper;
			var style = aa_first(data,profile,'LoadingStyle',context);
			var loading = aa_renderStyleObject(style,{
				text: aa_text(data,profile,'LoadingText',context)
			},context);
			result.appendChild(loading);

		    var newContext = aa_ctx(context,{ });
			ajaxart_RunAsync(data,ajaxart.fieldscript(profile,'Action'),newContext,function(data1,ctx,success) {
				aa_empty(result);
				// there are 2 ways for field control: createCellControl and aa_fieldControl
				if (settings.CreateCellControl) {
					var ctx = settings.context;
					var inner = settings.wrapper;
					var cell_data = ajaxart_field_calc_field_data(field,settings.field_data,ctx);
					var cntr = ctx.vars._Cntr && ctx.vars._Cntr[0];
					
					if (field.AsSection && !field.HideTitle) {
						var sectionCtrl = aa_buildSectionControl(cntr,field,settings.field_data,cell_data,ctx);
						inner.appendChild(sectionCtrl);
					} else {
						ajaxart_field_createCellControl(settings.field_data,cntr,inner,"control",field,cell_data,ctx);
					}
				} else {
					settings.Wrapper = result;
					aa_fieldControl(settings,true);
				}
				aa_element_attached(result.firstChild);
			});
		};
	},
	RefreshDependentFields: function(profile,data,context)
	{
		var field = context.vars._Field[0];
		field.DependentFields = aa_text(data,profile,'FieldsIds',context);
		field.RefreshOn = aa_text(data,profile,'RefreshOn',context);
		field.RefreshScope = aa_text(data,profile,'RefreshScope',context);
		
		aa_field_handler(field,'OnUpdate', function(field,field_data,input) {
			if (field.RefreshOn == 'every click with delay')
				aa_run_delayed_action('RefreshDependentFields_'+field.Id,function() { doUpdate(input); } ,600,true);
			else
				doUpdate(input);
		});		

		function doUpdate(input) {
			// using container context, if exists
			var ctx = context;
			var cntr = $(input).parents('.aa_container')[0];
			if (cntr) ctx = cntr.Cntr.Context;
			ajaxart_field_RefreshDependentFields(field,input,ctx);	
		}
	},
	SortMethodOld: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		if (!field) return [];
		var method = aa_text(data,profile,'Method',context);
		if (method == "numeric")
			field.SortValFunc = function(x) { return parseFloat(x); }
		if (method == "date")
			field.SortValFunc = function(x) { return aadate_date2int(x); }
	},
	Title: function (profile,data,context)  // gc of field_aspect.Title
	{
		var field = context.vars._Field[0];
		field.Title = aa_multilang_text(data,profile,'Title',context);
		
		field.DynamicTitle = function(data1,ctx) {
			return aa_multilang_text(data1,profile,'Title',aa_ctx(context,ctx));
		}
	},
	ChangeFieldID: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var id = aa_text(data,profile,'ID',context);
		field.Id = id;
		field.ID = [id];
	},
	ShowErrorOnCondition: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.OriginalControl = field.Control;
		field.Control = function(field_data,ctx) {
			var ctx2 = aa_merge_ctx(ctx,context);
			if (aa_bool(field_data,profile,'ConditionToShowError',ctx2)) {
				var errorText = aa_text(field_data,profile,'ErrorText',ctx2);
				var errorStyle = aa_first(field_data,profile,'ErrorStyle',ctx2);

				return [aa_renderStyleObject(errorStyle, {
					text: errorText,
					field_data: field_data, field: field
				}, ctx2,true)];
			} else {
				return this.OriginalControl(field_data,ctx);
			}
		}
	}, 
	FeatureForChildren: function (profile,data,context) {
		var field = context.vars._Field[0];
		aa_bind(field,'innerFields',function(args) {
			for(var i=0;i<args.Fields.length;i++) {
				aa_run(data,profile,'Feature',aa_ctx(context,{ _Field: [args.Fields[i]] }));
			}
		});
	},
	ShowFirstSucceedingChild: function (profile,data,context) {
		var field = context.vars._Field[0];
		aa_bind(field,'innerFields',function(args) {
			if (args.Fields.length > 1) 
				args.Fields.splice(1,args.Fields.length);
		});
	},
	Variable: function (profile,data,context) {
		var field = context.vars._Field[0];
		var varName = aa_text(data,profile,'VarName',context);

		aa_bind(field,'ModifyInstanceContext',function(args) {
			var ctx2 = aa_merge_ctx(context,args.Context);
			args.Context.vars[varName] = ajaxart.run(args.FieldData,profile,'Value',ctx2);
		});
	},
	GlobalVariable: function (profile,data,context) {
		var field = context.vars._Field[0];
		var varName = aa_text(data,profile,'ResourceName',context);

		aa_bind(field,'ModifyInstanceContext',function(args) {
			var ctx2 = aa_merge_ctx(context,args.Context);
			aa_setDataResource(context,varName,aa_run(args.FieldData,profile,'Value',ctx2));
		});
	},
	VariableForCellElement: function (profile,data,context) {		
		var field = context.vars._Field[0];
		var varName = aa_text(data,profile,'VarName',context);

		aa_bind(field,'ModifyInstanceContext',function(args) {
			var wrapper = aa_var_first(args.Context,'Wrapper');
			if (wrapper)
				args.Context.vars[varName] = [wrapper];
		});
	},
	TransitionForRefresh: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.TransitionForRefresh = aa_first(data,profile,'Transition',context);
	},
	AddControl: function (profile,data,context) {
		var field = context.vars._Field[0];
		var wrapperCss = aa_cssClass(data,profile,'CssForWrapper',context,'add_control_wrapper');
		aa_bind(field,'ModifyControl',function(args) {
			$(args.Wrapper).addClass(wrapperCss);
			var ctx = aa_merge_ctx(context,args.Context);
			var innerPage = aa_first(data,profile,'Contents',ctx);

			var div = $('<div style="display:inline-block" />')[0];
			aa_fieldControl({Field: innerPage, FieldData: args.FieldData, Item: args.FieldData, Wrapper: div, Context: ctx});

			args.Wrapper.appendChild(div);
		});
	},
	ColumnWidth: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.Width = ajaxart.run(data,profile,'Width',context);
	},
	HighlightSubTextOnFilter: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var idForFilteredResults = 0;
		var highlight_class = aa_attach_global_css( aa_text(data,profile,'HighlightCss',context) , null, 'highlight' );
		
		if (context.vars.ItemListCntr) { // new itemlist
			var itemlistCntr = context.vars.ItemListCntr[0];
			aa_bind(field,'ModifyCell',function(args) {
				var filter = itemlistCntr.GetFilterOfSpecificResult && itemlistCntr.GetFilterOfSpecificResult(args.Item[0],args.FieldData);
				if (filter && filter.FilterType && filter.FilterType.HighlightSelectedText) {
					  var content = $(args.Wrapper).find(">.aa_text,>span>.aa_text")[0];
					  if (!content && args.Wrapper.firstChild && args.Wrapper.firstChild.nodeType == 1) content = args.Wrapper.firstChild;
					  content = content || args.Wrapper; 
					
					  filter.FilterType.HighlightSelectedText(content,highlight_class + ' aa_highlight',itemlistCntr.GetFilterQueryData(filter));
				}
			});
			return;
		}
		aa_field_handler(field,'ModifyCell', function(cell,field_data,cell_presentation,ctx,item) {
			  var cntr = ctx.vars.DataHolderCntr && ctx.vars.DataHolderCntr[0];
			  var filterObject = null;
			  if (cntr && cntr.IDForFilteredResults && cntr.IDForFilteredResults > 1) {
				  if (cntr.IDForFilteredResults != idForFilteredResults) {
					  idForFilteredResults = cntr.IDForFilteredResults;
					  if (cntr.Filters) {
						  for(var j=0;j<cntr.Filters.length;j++) {
							  if (cntr.Filters[j].field == field) {
								  filterObject = cntr.Filters[j];
							  }
						  }
					  }
					  cntr.FieldsCache = cntr.FieldsCache || {};
					  cntr.FieldsCache[field.Id] = filterObject;
				  } else {
					  filterObject = cntr.FieldsCache[field.Id];
				  }
				  if (!filterObject || !filterObject.HighlightSelectedText) return;
				  				  
				  var content = $(cell).find(">.aa_text,>span>.aa_text")[0];
				  if (!content && cell.firstChild && cell.firstChild.nodeType == 1) content = cell.firstChild;
				  content = content || cell; 
				  
				  filterObject.HighlightSelectedText(content,highlight_class + ' aa_highlight');
			  }
		},'HighlightSubTextOnFilter');
		
	},
	Password: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.ManualWriteValue = true;
		field.HashPassword = aa_bool(data,profile,'HashPassword',context);
		
		field.Control = function(field_data,ctx)
		{
			var field = context.vars._Field[0];
			return [ajaxart_field_createSimpleInput(field_data,context,false,'PASSWORD')];
		}
		field.ReadOnlyControl = function(field_data,ctx)
		{
			return $('<div>*****</div>').get(); 
		}
		
		aa_field_handler(field,'OnKeyup',function(field,field_data,input,e) {
			var field = context.vars._Field[0];
			var hash = (field.HashPassword) ? ajaxart_hashPassword(input.value) : input.value;
			ajaxart.writevalue(field_data,hash);
		},'password');
		
		return ["true"];
	},
	DisableCharacters: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.KeyPressValidator = new RegExp(aa_text(data,profile,'CharacterPattern',context));
	},
	DefaultValue: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		// old field
		field.DefaultValue = function(data1,ctx) {
			return ajaxart.run(data1,profile,'Value',aa_merge_ctx(context,ctx));
		}
		// new field
		field.HasDefaultValue = true;
		aa_bind(field,'FieldData',function(args) {
			if (aa_totext(args.FieldData) == '')
				ajaxart.writevalue(args.FieldData,field.DefaultValue(args.Item,aa_merge_ctx(context,args.Context)),true);
		},'DefaultValue');
	},
	DisableByCondition: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var cssClass = aa_cssClass(data,profile,'CssForDisabled',context);

		field.Disabled = function(data1,ctx)
		{
			var item = ctx.vars._Item ? ctx.vars._Item : data1;
			return aa_bool(item,profile,'EnableCondition',context) ? [] : ['true'];
		}
		field.IsDisabled = function()
		{
			return !aa_bool(data,profile,'EnableCondition',context);
		}
		field.DisableText = function()
		{
			return aa_text(data,profile,'DisableText',context);
		}
		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
				$(cell).find('.field_control').each(
				function() { 
					input = this;
					var enable = aa_bool(item,profile,'EnableCondition',context);
					if (enable)
					{
						$(this).find("input").removeAttr("disabled").removeClass('aa_disabled');
						$(this).removeAttr("disabled");
						$(input).removeClass('aa_disabled');
						$(this).removeClass('aa_disabled ' + cssClass);
					}
					else
					{
						$(this).find("input").attr("disabled","disabled");
						$(this).attr("disabled","disabled");
						$(input).addClass('aa_disabled ' + cssClass);
					}
				});
		},'DisableByCondition');
	},
	HideByCondition: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		if (!aa_bool(data,profile,'CheckConditionForEveryItem',context)) {
			field.Hidden = function(data1,ctx)
			{
				var item = ctx.vars._Item ? ctx.vars._Item : data1;
				return aa_bool(item,profile,'ShowCondition',context) ? [] : ['true'];
			}
		}
		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
			    var cellParent = $(cell).parent();
				var parent_line = $(cell).parent()[0];
			    var elem_to_hide = parent_line;
				if (! (cellParent.hasClass('field_row') || cellParent.hasClass('aa_section') ) )
					elem_to_hide = cell;
			    if (aa_bool(field_data,profile,'ShowCondition',aa_merge_ctx(context,ctx)))
			    {
			    	$(cell).removeClass('aa_hidden_field');
			    	elem_to_hide.style.display = '';
			    	elem_to_hide.display = '';
			    }
			    else
			    {
			    	$(cell).addClass('aa_hidden_field');
			    	elem_to_hide.style.display = 'none';
			    	elem_to_hide.display = 'none';
			    }
		},'HideByCondition');
	},
	CheckConditionForEveryItem: function(profile,data,context) {
		return [{
			apply: function(field,context) {
				var use_field_data = aa_text(data,profile,'DataForCondition',context) == 'Field data';
				field.IsCellHidden = function(item_data,ctx,field_data) {	// field_data param is optional. If not passes, we calculate it
					var input_data = item_data;
					if (use_field_data && field_data)
						input_data = field_data;
					else if (use_field_data && field.FieldData)
						input_data = field.FieldData(item_data,aa_merge_ctx(context,ctx));

					return !aa_bool(input_data,profile,'ShowCondition',aa_merge_ctx(context,ctx));	// todo: compile
				};
				field.RenderHiddenCell = aa_text(data,profile,'WhenHidden',context) != 'Do not render';

				aa_bind(field,'ModifyControl',function(args) {
					if (field.IsCellHidden(args.Item,args.Context,args.FieldData))
						aa_hide(args.Wrapper);
				});

			}
		}];
	},
	CheckConditionOnce: function(profile,data,context) {
		return [{
			apply: function(field,context) {
				field.IsFieldHidden = function(data2,ctx) {
					return !aa_bool(data2,profile,'ShowCondition',aa_merge_ctx(context,ctx));	// todo: compile
				};
			}
		}];
	},
	Hidden: function(profile,data,context) {
		var field = context.vars._Field[0];
		var on_condition = aa_first(data,profile,'OnCondition',context);
		if (!on_condition) {
			field.IsHidden = true;
			field.IsFieldHidden = function() { return true; }

			// backward compatability
			aa_bind(field,'ModifyControl',function(args) {
				aa_hide(args.Wrapper);
			});
		}
		else
			if (on_condition.apply) on_condition.apply(field,context);
	},
	CustomSuggestionBox: function(profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		ajaxart.customsuggestbox.init(field,data,profile,context);
		return [];
	},
  AddTextToSuggestionBox: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.addTextToSuggestionBox(profile, data,context);  
	  return [];
  },
  CloseSuggestionBox: function (profile, data,context)
  {
	  ajaxart.suggestbox.closePopup();
	  return [];
  },
  OpenSuggestionBoxPopup: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.openSuggestionBoxPopup(profile, data,context);
	  return [];
  },
  OpenSuggestionBoxList: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.openSuggestionBoxList(profile, data,context);
	  return [];
  },
  TriggerSuggestionBoxPopup: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.triggerSuggestionBoxPopup(profile, data,context);
	  return [];
  },
  Hyperlink: function(profile,data,context)
  {
	var field = context.vars._Field[0];
	var cssClass = aa_attach_global_css( aa_text(data,profile,'Css',context) , null, 'hyperlink' );
	
	aa_field_handler(field,'ModifyCell', function(td,field_data,cell_presentation,ctx,item) {
		$(td).addClass("aa_hyperlink").addClass(cssClass);
		td.onclick = function() {
			if (window.aa_incapture) return;
			ajaxart.run(item,profile,'Action',aa_ctx(aa_merge_ctx(context,ctx), {_ItemsOfOperation:item, Item:item, _ElemsOfOperation:[this.parentNode] , ControlElement: [td]}));
		}
	});
  },
  ImageInTextbox: function(profile,data,context)
  {
	var field = context.vars._Field[0];
	aa_field_handler(field,'ModifyCell', function(td,field_data,cell_presentation,ctx,item) {
		var input = $(td).find('.aatextbox')[0];
		var img = $('<img src="'+aa_text(data,profile,'Image',context)+'" />');
		img[0].style.cssText = aa_text(data,profile,'CssForImage',context);
		img.insertAfter(input);
	});
  },
  RunningInputFieldData: function(profile,data,context)
  {
	  if (context.vars._Field && context.vars._Cntr && context.vars._Cntr[0].Items[0])
		  return context.vars._Field[0].FieldData(context.vars._Cntr[0].Items[0].Items);
	  return [];
  }
});

aa_gcs("search_algorithm", {
	SimpleSearch: function (profile,data,context) 
	{
		var matchOnlyTextBeginning = aa_bool(data,profile,'MatchOnlyTextBeginning',context);
		return [ {
			newFilter: aa_create_text_filter(matchOnlyTextBeginning) 
		}];
	},
	SearchWords: function (profile,data,context)
	{
		return [ {
			newFilter: aa_create_search_words_text_filter() 
		}];
	}
});



ajaxart.gcs.datefilter =
{
	ExpressionToFromTo: function (profile,data,context)
	{
		if (! ajaxart.isxml(data)) return [];
		var exp = data[0].getAttribute('Expression') || "";
		var vals = exp.split('-');
		if (vals.length != 2) return [];
		data[0].setAttribute('From',vals[0]);
		data[0].setAttribute('To',vals[1]);
	}
}


ajaxart.gcs.validation =
{
	ContainsText: function (profile,data,context) 
	{
	  var text = aa_totext(data);
	  if (text == "") return [];
	  var lookFor = aa_text(data,profile,'Text',context);
	  return aa_frombool( text.indexOf(lookFor) == -1 );
	},
	IsNumber: function (profile,data,context) {
		var value = aa_totext(data);
		if (isNaN(Number(value))) return ["true"];
		if (value.charAt(0) == '0' && value.length > 1 && value.charAt(1) != '.') return ["true"];
		return [];
	},
	MatchesRegularExpression: function (profile,data,context) 
	{
		var text = aa_totext(data);
		if (text == "") return [];
		
		var lookFor = aa_text(data,profile,'Expression',context);
		return aa_frombool(!text.match('^' + lookFor + '$'));
	},
	Unique: function (profile,data,context)
	{
		var text = aa_totext(data); 
		if (text == "") return [];
		var options = ajaxart.run(data,profile,'OtherValues',context);
		for(var i=0;i<options.length;i++) {
			if (text == aa_totext([options[i]]) && options[i] != data[0]) return ["true"]; 
		}
	},
	PassingValidations: function (profile,data,context) 
	{
		var ctrl = aa_first(data,profile,'TopControl',context);
		return aa_frombool( aa_passing_validations(ctrl) );
	},
	ShowValidationError: function (profile,data,context) 
	{
		var ctrl = aa_first(data,profile,'TopControl',context);
		var error = aa_multilang_text(data,profile,'Error',context);
		aa_validation_showerror(ctrl,error,null,context);
		return [];
	}
}


aa_gcs("notification_box", {
	NotificationBox: function (profile,data,context) 
	{
	  var field = aa_create_base_field(data, profile, context);
	  field.Control = function(data1,ctx) {
		  var out = aa_renderStyleObject(field.Style,{
			  notification_id: aa_text(data,profile,'ID',context),
			  setStatusClass: function(status) {
			    var classes = this.className.split(' ');
			    var found = false;
			    for(var i=0;i<classes.length;i++) {
			    	if (classes[i].indexOf('aanotif_status_') == 0) {
			    		classes[i] = 'aanotif_status_' + status;
			    		found = true;
			    	}
			    }
			    if (!found) classes.push('aanotif_status_' + status);
			    this.className = classes.join(' ');
		  	  }
		  },context);
		  $(out).addClass('aa_notification_box_'+out.notification_id);

		  if (aa_text(data,profile,'TextToShowOnPreview',context)) {
			var evt = { text: aa_text(data,profile,'TextToShowOnPreview',context) , status: 'info' };
			out.trigger('notification',evt);	  	
		  }

		  return [out];
	  }
	  return [field];
	},
	ShowNotification: function (profile,data,context)
	{
		aa_showNotification(context,
			aa_text(data,profile,'NotificationBox',context),
			aa_int(data,profile,'Duration',context),
			aa_text(data,profile,'Text',context),
			aa_text(data,profile,'Status',context)
		);
	}
});

function aa_showNotification(context,id,duration,text,status) {		
		var top = aa_intest ? aa_intest_topControl : document;
		var notificationBoxes = $(top).find('.aa_notification_box_'+id);
		for (var i=0;i<notificationBoxes.length;i++) {
			var evt = { text: text , status: status, duration:duration };
			notificationBoxes[i].trigger('notification',evt);
		}
}
function aa_notification_box(notificationBox,settings) {
	settings = aa_defaults(settings,{
		DurationTime: 2000
	});
  
  var jBox = notificationBox.$el;
  notificationBox.bind('notification',function(evt) {
     notificationBox.setStatusClass( evt.status );
     jBox.html(evt.text);
     jBox.css('opacity','0');
     jBox.addClass('shown');
     if (evt.status == 'clear') jBox.removeClass('shown');
     jBox.animate({opacity: 1},'slow');
     if (evt.status == 'saving') return;
     
     setTimeout(function() {
       jBox.animate({opacity: 0},'slow', function() { jBox.html(''); jBox.removeClass('shown');}); 
     },evt.duration || settings.DurationTime);
  });          

}

ajaxart.gcs.transition =
{
	RightSlide: function (profile,data,context)
	{
	  var obj = { isObject:true }
	  obj.replace = function(oldElem,newElem)
	  {
		  aa_left_right_slide(oldElem,newElem,'RightSlide',aa_int(data,profile,'Duration',context),aa_text(data,profile,'Background',context), aa_bool(data,profile,"CoverLeftMargin",context));
	  }
	  return [obj];
	},
	LeftSlide: function (profile,data,context) 
	{
	  var obj = { isObject:true }
	  obj.replace = function(oldElem,newElem)
	  {
		  aa_left_right_slide(oldElem,newElem,'LeftSlide',aa_int(data,profile,'Duration',context),aa_text(data,profile,'Background',context));
	  }
	  return [obj];
	},
	Fade: function (profile,data,context) 
	{
	  var obj = { isObject:true }
	  obj.replace = function(oldElem,newElem)
	  {
		  aa_refresh_fade_transition(oldElem,newElem,'LeftSlide',aa_int(data,profile,'Duration',context));
	  }
	  return [obj];
	}
};
function aa_refresh_fade_transition(oldElem,newElem,type,duration) {
	  var old_parent_position = newElem.parentNode.style.position;
	  if (!old_parent_position) newElem.parentNode.style.position = 'relative';
	  var new_zindex = (oldElem.style.zIndex) ? newElem.style.zIndex+1 : 1;
	  var css = "#this.newtrans { transition: opacity " + duration + "ms ease-out; opacity:1; }" + 
	  	"#this { position:absolute; top:0px; z-index:" + new_zindex + "; opacity:0; }";
	  var cssForOld = "#this.newtrans { transition1: opacity " + duration + "ms ease-out;  opacity: 0; }" + 
	  	"#this { opacity:1; }";
	  var cls = aa_attach_global_css(css);
	  var clsOld = aa_attach_global_css(cssForOld);
	  $(newElem).addClass(cls);
	  $(oldElem).addClass(clsOld);
	  setTimeout(function() { $(oldElem).addClass('newtrans'); $(newElem).addClass('newtrans'); });
	  
	  setTimeout(function() {
		  if (!newElem || !newElem.parentNode) return;
		  newElem.parentNode.style.position = old_parent_position;
		  $(newElem).removeClass(cls).removeClass('newtrans');
		  aa_remove(oldElem,true);
	  },duration);	
}
function aa_left_right_slide(oldElem,newElem,type,duration,background,use_cover)
{
	  var old_parent_position = newElem.parentNode.style.position;
	  if (!old_parent_position) newElem.parentNode.style.position = 'relative';
	  var new_width = Math.max(oldElem.clientWidth,newElem.clientWidth);
	  var new_height = Math.max(oldElem.clientHeight,newElem.clientHeight);
	  var left_start = (type == 'LeftSlide') ? new_width : -new_width;
	  var width_start = (type == 'LeftSlide') ? 0 : new_width;
	  var new_zindex = (oldElem.style.zIndex) ? newElem.style.zIndex+1 : 1;
	  var background_css = ";background:" + background;
	  if (background == "") background_css = "";
	  var cover;
	  if (type == 'RightSlide' && use_cover) {
		  cover = document.createElement('div');
		  cover.style.cssText = "position:absolute; height: " + new_height + "px; top:0px; left: -"+ new_width + "px; width:" + new_width + "px;" + background_css + ";z-index:" + new_zindex+1;
		  newElem.parentNode.appendChild(cover);
	  }
	  var css = "#this.newpos { left: 0px; width: " + new_width + "px; } " + 
	  			"#this.newpos { -webkit-transition: width " + duration + "ms ease-out, left " + duration + "ms ease-out }" + 
	  			"#this { position:absolute; top:0px; overflow-x:hidden; width:" + width_start + "px; z-index:" + new_zindex + "; left: " + left_start + "px" +
	  			background_css + ";height:" + new_height + "px" +
	  			"} ";
	  var cls = aa_attach_global_css(css);
	  $(newElem).addClass(cls);
	  setTimeout(function() { $(newElem).addClass('newpos'); });
	  
	  setTimeout(function() {
		  if (!newElem || !newElem.parentNode) return;
		  newElem.parentNode.style.position = old_parent_position;
		  $(newElem).removeClass(cls).removeClass('newpos');
		  if (cover) newElem.parentNode.removeChild(cover);
		  aa_remove(oldElem,true);
	  },duration);
}

function aa_showblock(block,data,context) 
{
	var ctrl = block.Control(data,context);
	if (ctrl.length == 0) return null;
	
	if (block.ModifyControl)
		for(var i=0;i<block.ModifyControl.length;i++)
			block.ModifyControl[i](ctrl[0],[],'control',context,[]);
	
	return ctrl[0];
}
function ajaxart_fieldaspect_getField(context) {
  var field = context.vars['_Field'];
  if (field == null || field.length == 0) return null;
  return field[0];
}

function ajaxart_field_getFields(cntr,mode,item_data)
{
	if (typeof(item_data) == "undefined") item_data = [];
	
	var fields = cntr.Fields;
	var out = [];
	var isNew = cntr.IsNewItem;
	var isReadOnly = ( cntr.Items[0].ReadOnly != null && ajaxart.tobool_array(cntr.Items[0].ReadOnly) );
	var isEdit = ! (isNew || isReadOnly); 
	for(var i=0;i<fields.length;i++) {
		var field = fields[i];
		
		if (field.IsHidden) continue;
		if (isNew && field.HiddenForNew) continue;
	    if (isReadOnly && field.HiddenForReadOnly) continue;
	    if (isEdit && field.HiddenForEdit) continue;
	    if (mode == "table" && field.HiddenForTable) continue;
	    if (mode == "property sheet" && field.HiddenForProperties) continue;
	    if (mode != "property sheet" && field.Hidden && aa_tobool(field.Hidden(item_data,cntr.Context)) ) continue;	    
		out.push(fields[i]);
	}
	
	return out;
}

function ajaxart_field_fix_title(field,path,context)
{
	if (field.Title == null || field.Title.length == 0)
	{
		var title = path.split('/').pop().split('@').pop();
		title = title.substr(0,1).toUpperCase() + title.substr(1,title.length);
		title = aa_text_capitalizeToSeperateWords(title);
		
		field.Title = ajaxart_multilang_text(title,context);
	} 
}

function ajaxart_field_text(field,field_data,item,context)
{
	if (field.Text)
		var result = ajaxart.totext_array(aa_runMethod(field_data,field,'Text',context));
	else if (item[0].__item) // is wrapper
		var result = item[0][field.Id];
	else
		var result = ajaxart.totext_array(field_data);
	if (field.Highlight)
		result = ajaxart_field_highlight_text(result,field.Highlight);
	return result;
}

function ajaxart_field_is_readOnly(cntr,field,context)
{
	if (field.Writable) return false;
	if (field.ReadOnly == true) return true;
	if (aad_object_run_boolean_method(field,'ReadOnly',[],context)) return true;
	if (!cntr) return false;
	if (cntr.Items == null) return true;
	if (cntr.Items[0].ReadOnly == true) return true;
	if (cntr.ReadOnly) return true;
	return ( cntr.Items[0].ReadOnly != null && ajaxart.tobool_array(cntr.Items[0].ReadOnly) );
}

function aa_fieldById(id, fields)
{
	if (fields)
		for(var i=0;i<fields.length;i++) {
			if (fields[i].Id == id) return fields[i];
			if (fields[i].IsGroupOnlyForLayout) {	// getting inside groups
				var result = aa_fieldById(id,fields[i].Fields);
				if (result) return result;
			}
		}
	
}

function ajaxart_field_calc_field_data(field,item_data,context)
{
	if (field.Multiple && field.MultipleItems) // multiple with items - field data is not relevant
		return item_data;
	if (field.FieldData)
	{
		var results = aa_runMethod(item_data,field,'FieldData',context);
		// fielddata must not return more than one element
		if (results.length < 2) 
			return results;
		else
			return [results[0]];
	}
	else 
		return item_data;
}

function ajaxart_field_RefreshDependentFields(field,srcElement,context)
{
	if (!field|| !field.DependentFields) return;
	
	var parent = $(document);
	if (field.RefreshScope == 'container' || field.RefreshScope == 'screen')
		parent = $(srcElement).parents('.aa_container,.aa_widget').slice(-1);
	else if (field.RefreshScope == 'group')
		parent = $(srcElement).parents('.aa_container,.aa_widget').slice(0,1);
	else if (field.RefreshScope == 'item' ) // depricated
		parent = $(srcElement).parents('.aa_item').slice(0,1);
	else if (field.RefreshScope == 'table line' )
	{
		var listIndex = $(srcElement).parents().index($(srcElement).parents('.aa_list'));
		var parents_up_to_list = $(srcElement).parents().slice(0,listIndex);
		parent = parents_up_to_list.filter('.aa_item').slice(-1);
	}
	if (field.RefreshScope == 'screen' && !parent[0]) parent = $(document);

	var dependent = field.DependentFields.split(',');
	for(var f=0;f<dependent.length;f++)
	{
		var fieldID = dependent[f];
		if (field.RefreshScope == 'sibling') { 
			aa_refresh_sibling_field(srcElement,fieldID,context);
		} else {
			var ctrls = parent.find(".fld_" + fieldID);
			for(var i=0;i<ctrls.length;i++)
				aa_refresh_cell(ctrls[i],context);
		}
	}
}
function aa_build_th(cntr,field,ctx)
{
	var th = $('<th class="fieldtitle th_' + field.Id + '"><span class="aa_field_menu">&nbsp;</span><span class="fieldtitle_title"/><span class="fieldtitle_sort">&nbsp;</span></th>');
	th[0].Field = field;
	th.find('>.fieldtitle_title').text(field.Title);
	var width = ajaxart_getUiPref(cntr.ID[0],field.Id+'_ColumnWidth',ctx) || ajaxart.totext_array(field.Width);
	if (width != null)
	  $(th).width(width);

	if (field.AddInfoIcon) 
		field.AddInfoIcon(th.get(),ctx);
	var field_menu_elem = $(th).find('>.aa_field_menu')[0];
	if (field_menu_elem && cntr.EnableFieldMenu)
	{
		field_menu_elem.onmousedown = function(e) 
		{ 
	    	var newContext = aa_ctx( ctx, {
	    			MousePos: [ { isObject: true, pageX: e.pageX || e.clientX, pageY: e.pageY || e.clientY} ]
	    	});
	    	if (th.OpenFieldMenu)
	    		th.OpenFieldMenu(newContext);
			return aa_stop_prop(e);
		}
	}
	return th[0];
}

function ajaxart_field_fix_th(cntr,th,field,ctx)
{
	var width = ajaxart_getUiPref(cntr.ID[0],field.Id+'_ColumnWidth',ctx) || ajaxart.totext_array(field.Width);
	if (width != null)
	  $(th).width(width);
}

function ajaxart_subfield_bypath(field,path) {
	if (path == "") return field;
	if (field.Fields == null) return null;
	var path1 = path,rest = "";
	if (path.indexOf('/') > -1) { 
		path1 = path.substring(0,path.indexOf('/')-1); 
		rest = path.substring(path.indexOf('/')+1);
	}
	for(var i=0;i<field.Fields.length;i++) {
		var subfield = field.Fields[i];
		if (subfield.Path != null) {
			if (subfield.Path == path1) return ajaxart_subfield_bypath(subfield,rest);
		} else {  // no path. maybe virtual group
			var result = ajaxart_subfield_bypath(subfield,path);
			if (result != null) return result;
		}
	}
	return null;
}
function aa_field_handler(field,event,handler,id,phase)
{
	aa_register_handler(field,event,handler,id,phase);
}

function aa_invoke_field_handlers(eventFuncs,input,e,field,field_data,extra)
{
	if (aa_incapture) return;
	if (eventFuncs)
		for(var i=0;i<eventFuncs.length;i++)
			eventFuncs[i](field,field_data,input,e,extra);
}

function ajaxart_fields_aftersave(item,data,originalData,fields,context)
{
  if (fields == null) return;
  for(var i=0;i<fields.length;i++) {
	  var field = fields[i];
	  var data1 = data; odata1 = originalData;
	  var path = field.Path;
	  if (path == null) path = "";
	  
	  if (path != "" && data1.length >0) data1 = aa_xpath(data1[0],path);
	  if (path != "" && odata1.length >0) odata1 = aa_xpath(odata1[0],path);
	  
	  if (field.Fields != null) {
		  ajaxart_fields_aftersave(item,data,originalData,field.Fields,context);
	  }
	  if (field.AfterSave) {
		  var newContext = aa_ctx(context,{OriginalValue: odata1, Item: item});
		  aa_runMethod(data1,field,'AfterSave',newContext);
	  }
  }
}
function aa_set_fielddata_method(field,path)
{
	field.FieldData = function(data,ctx) 
	{
		if (data.length == 0) return [];
		if (!data[0].nodeType) 
			var out = [data[0][path.split('@').pop()]];
		else
			var out = aa_xpath(data[0],path,false);
		if (out.length > 0) 
			return out;
		if (!ctx || aa_tobool(ctx.vars._NoDefaultValue)) return out;
		
		var out = aa_xpath(data[0],path,true);
		var defaultValue = aa_runMethod(data,field,'DefaultValue',ctx);
		ajaxart.writevalue(out,defaultValue,true);
		return out;
	};
}

function aa_fieldTitle(field ,item_data, context,ignoreHideTitle)
{
	if (field.HideTitle && !ignoreHideTitle) return ''; 
	if (field.DynamicTitle) return field.DynamicTitle(item_data,context);
	return field.Title;
}

function aa_section(section,settings) {
  section.$el.firstOfClass('section_title').text(section.Title);  
  section.addSectionBody(section.$el.firstOfClass('section_body')[0]);
}
function aa_wrapWithSection(ctrl,field,sectionStyle,item_data,ctx,field_data)
{
	var jElem = $(sectionStyle.Html);
	var title = aa_fieldTitle(field ,item_data, ctx,true);
	var section = {
		Title: title,
		Image: field.SectionImage,
		field: field,
		field_data: field_data || [],
		context: ctx,
		collapsed: !!field.SectionCollapsedByDefault,
		setImageSource: function(classOrElement,imageObject,deleteIfNoImage)	{
			var inner = this.getInnerElement(classOrElement);
			if (inner) aa_set_image(inner,imageObject,deleteIfNoImage);
		},
		setInnerHTML: function(classOrElement,text)	{
			var inner = this.getInnerElement(classOrElement);
			if (inner) inner.innerHTML = text;
		},
		getInnerElement: function(classOrElement)
		{
			if (typeof(classOrElement) == 'string') {  // it is a class
				if (classOrElement == '') return this.el;
				if (classOrElement.indexOf('.') == 0)
				  return aa_find_class(this.$el,classOrElement.substring(1))[0];
				return null;
			}
			return classOrElement || this.el;
		},		
		addSectionBody: function(classOrElement) {
			var inner = this.getInnerElement(classOrElement);
			if (inner) inner.appendChild(ctrl); 
			if (this.collapsed) $(inner).css('display','none');
		},
		updateCollapsed: function(collapsed) {
			this.collapsed = collapsed;
		},
		$el: jElem,
		el: jElem[0],
		jElem: jElem,
		control: jElem[0]
	};
	section.setImage = section.setImageSource;

	aa_trigger(field,'beforeWrapWithSection',{ context: ctx, sectionObject: section });
	
	section.$el.addClass(aa_attach_style_css(sectionStyle));
	aa_apply_style_js(section,sectionStyle);
	return section.el;
}

function aa_refresh_sibling_field(srcElement,fieldID,context)
{
	var parent = srcElement.parentNode;
	if (!parent || parent.tagName == 'body') return;
	var ctrls = $(parent).find('.fld_'+fieldID);
	if (ctrls.length > 0) {
		for(var i=0;i<ctrls.length;i++)
			aa_refresh_cell(ctrls[i],context);
	} else {
		aa_refresh_sibling_field(parent,fieldID,context);
	}
}

function aa_alert(message) {
	if (window.jBartNodeJS) return jBartNodeJS.alert(message);
	
	if ($("#aa_immediate_log").length == 0) {
		var log = $('<div id="aa_immediate_log" style="position:absolute; top:0px; background:white; z-index:3000"></div>');
		log[0].Counter = 0;
		$("body").append(log);	
		$('<span class="close">close</span>').click(function() { $("#aa_immediate_log").remove() }).appendTo(log);
	}
	if ($("#aa_immediate_log")[0]) {
		var counter = $("#aa_immediate_log")[0].Counter++;
		$("#aa_immediate_log").prepend("#" + counter + ": " + message + "<br/>");
	}
}

function aa_audioPlayer(audioplayer) {
    if (!audioplayer.audioUrl) { 
      audioplayer.$el.find(".button").hide();
      audioplayer.$el.find(".no_audio").show();
      return; 
    }
    var ext = audioplayer.audioUrl.split("\.").pop();
    var mime = (ext == 'mp3') ? 'mpeg' : ext;
    var source = $("<source/>").attr('src',audioplayer.audioUrl).attr('type','audio/'+mime);
    audioplayer.$el.find("audio").append(source);
    var playing = false;
    audioplayer.$el.find(".button").click(function(e) {
      if (playing) {  // pause
        audioplayer.$el.find("audio")[0].pause();
        playing = false;
        $(this).removeClass('playing');
      } else { // play
        audioplayer.$el.find("audio")[0].play();
        playing = true;
        $(this).addClass('playing');
      }
    });
    audioplayer.$el.find("audio").bind("ended",null,function() {
        playing = false;
        $(this).removeClass('playing');          
    });
}






aa_gcs("field_aspect", {	
	CellPresentation: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		field.CellPresentation = aa_text(data,profile,'Content',context);
		
		return [];
	},
	PagePreviewDevice: function (profile,data,context)
	{
		if (!ajaxart.jbart_studio) return;

		aa_bind(context.vars._Field[0],'ModifyInstanceContext',function(args) {
			var device = aa_first(data,profile,'Device',context);
			var width = device ? parseInt(device.Width) : 0;
			var height = device ? parseInt(device.Height) : 0;

	    args.Context.vars._PagePreview = [{ Width: width, Height: height, TightPreview: aa_bool(data,profile,'TightPreview',context) }];
	  });		
	},
	DisplayUnits: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var cssClass = aa_cssClass(data,profile,'Css',context,'units');
		var display_location = aa_first(data,profile,'Location',context);
		var unit = aa_text(data,profile,'Unit',context);
		
		jBart.bind(field,'ModifyControl',function(args) {
			var content = args.Wrapper.firstChild || args.Wrapper; 
			aa_renderStyleObject(display_location,{fieldContent: content, unitString: unit },context,true);
		},'DisplayUnits');
	},
	TransformTextToInputValue: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.TextDataToInputValue = function(data1,ctx) {
			return aa_run(data1,profile,'DataToInputValue',aa_merge_ctx(context,ctx))
		}
		field.TextInputValueToData = function(data1,ctx) {
			return aa_run(data1,profile,'InputValueToData',aa_merge_ctx(context,ctx))
		}
	},
	TextboxCharacterMask: function (profile,data,context) {
		var field = context.vars._Field[0];
		var charsRegex = aa_text(data,profile,'AllowedCharsRegex',context); // e.g. regex = [0-9]
		if (!charsRegex) return;
		field.InputValueMask = aa_input_value_mask(charsRegex);
	},
	TextboxCharacterLength: function (profile,data,context) {
		var field = context.vars._Field[0];
		var length = aa_int(data,profile,'Length',context);
		aa_bind(field,'inputMask',function(args) {
			if (args.val.length > length) args.val = args.val.substring(0,length);
		});		
	},
	ClearValueButton: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.ClearValueStyle = aa_first(data,profile,'Style',context);
		
		function refresh(wrapper,field_data) {
			var apiObject = {
				ClearValue: function(e) {
				  var input = jQuery(wrapper).find('input')[0];
				  if (input) {
					  input.value = '';
					  field.ManualWriteValue = false; // Yaniv: I do not understand this line...
					  if (input.updateValue) input.updateValue();
					  if (input.Refresh) input.Refresh();
					  if (input.jbApiObject && input.jbApiObject.setValue) input.jbApiObject.setValue('');
					  refresh(wrapper,field_data);
				  } else {
					  ajaxart.writevalue(field_data,'');
					  aa_refresh_cell(wrapper,context);
				  }
				  aa_stop_prop(e);
				  return false;
				},
				FieldControlWrapper: wrapper,
				IsValueEmpty: aa_totext(field_data) == "",
				Title: aa_multilang_text(data,profile,'Title',context)
			}
			var clearBtn = aa_renderStyleObject(field.ClearValueStyle,apiObject,context);
			jQuery(clearBtn).addClass('aa_clear_button');
		}
		
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			refresh(cell,field_data);
		});
		aa_field_handler(field,'OnUpdate',function(field,field_data,input){
			var cell = input.parentNode;
			refresh(cell,field_data);
		});
	},
	Control: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		aa_addControlMethod(field,'WritableControl',data,profile,'Control',context);
	},
	GlobalCss: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var css = aa_text(data,profile,'GlobalCss',context);
		var cls = aa_attach_global_css(css,null,field.Id);
		aa_field_handler(field,'ModifyCell',function(cell,field_data,cell_presentation,ctx,item)
		{
			if (aa_paramExists(profile,'OnCondition') && ! aa_bool(field_data,profile,'OnCondition',context)) return;
			jQuery(cell).addClass(cls);
		});	
	},
	CssOnCondition: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var css = aa_text(data,profile,'Css',context);
		var cls = aa_attach_global_css(css,null,field.Id,true);
		var conditionOnItem = aa_text(data,profile,'ConditionInput',context) == 'item';
		var cssClass = aa_text(data,profile,'CssClass',context);
		if (cssClass) cls += ' ' + cssClass;
		
		aa_field_handler(field,'ModifyCell',function(cell,field_data,cell_presentation,ctx,item)
		{
			var content = cell.firstChild || cell;

			if (aa_paramExists(profile,'OnCondition')) {
				var condData = conditionOnItem ? item : field_data;
				if (! aa_bool(condData,profile,'OnCondition',context)) {
					jQuery(content).removeClass(cls);
					jQuery(cell).removeClass(cls+'_wrapper');
					return;
				}
			}
			jQuery(content).addClass(cls);
			jQuery(cell).addClass(cls+'_wrapper');
		},null,200);	
	},
	Css: function (profile,data,context)
	{
		var css_for = aa_text(data,profile,'OnElement',context);
		var class_compiled = ajaxart.compile(profile,'Class',context);
		var inline_compiled = ajaxart.compile(profile,'Inline',context);
		var condition_compiled = ajaxart.compile(profile,'OnCondition',context, null, false, true);
		var apply_css = function(elems,data2) {
			for (var i=0; i<elems.length; i++) {
				if (! ajaxart_runcompiled_bool(condition_compiled, data2, profile, "OnCondition", context, true )) return;
				var cls = ajaxart_runcompiled_text(class_compiled, data2, profile, "Class" ,context);
				var inline = ajaxart_runcompiled_text(inline_compiled, data2, profile, "Inline" ,context);
				if (inline != "") aa_setCssText(elems[i],elems[i].style.cssText + ";" + inline);
				if (cls != "") elems[i].className = elems[i].className + " " + cls;
			}
		};
		var register = function(apply_css,css_for) {
			var css = function(cell,field_data,cell_presentation,ctx) {
				if (css_for == "cell")
					var work_on = cell;
				else if (css_for == "content") 
					var work_on = jQuery(cell).find('.field_control')[0];
				else if (css_for == "title")	
					var work_on = jQuery(cell.parentNode).find('>.propertysheet_title_td')[0];
				else
					var work_on = cell;
				if (!work_on) 
					work_on = cell;
				apply_css([work_on],field_data);
			}
			var field = ajaxart_fieldaspect_getField(context);
			aa_field_handler(field,'ModifyCell',css);
		}
		register(apply_css,css_for);
		return [];
	},
	RefreshOnBrowserUrlChange: function (profile,data,context) {
		var field = context.vars._Field[0];
		var to = aa_text(data,profile,'AddClassTo',context);
		aa_bind(field,'ModifyCell',function(args) {
			$(args.Wrapper).addClass('jb_refreshOnUrlChange');
		},'RefreshOnBrowserUrlChange');		

		if (!jBart.hashValueChangedRefreshField) {
			jBart.hashValueChangedRefreshField = function() {
				if (window.jbHashChangeFromJS) return;
				var fieldCells = $('.jb_refreshOnUrlChange');
				for(var i=0;i<fieldCells.length;i++) 
					aa_refresh_cell(fieldCells[i],context,null,null,true);
			};
			$(window).bind('hashchange',jBart.hashValueChangedRefreshField);
		}

	},
	DescriptionForEmptyText: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.DescriptionForEmptyText = ajaxart.totext_array(ajaxart_multilang_run(data,profile,'Description',context));
		field.DescriptionForEmptyTextCss = aa_text(data,profile,'Css',context);
		field.EmptyTextCssClass = aa_attach_global_css(field.DescriptionForEmptyTextCss ,null,'empty_text_description');

		if (field.HandleDescriptionForEmptyText) {
			return field.HandleDescriptionForEmptyText(field.DescriptionForEmptyText);
		}
		
		if (!field.DescriptionForEmptyText) return; // removing DescriptionForEmptyText

		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx,item)
		{
//			if (ajaxart_field_is_readOnly(ctx.vars._Cntr && ctx.vars._Cntr[0],cell.Field,ctx)) return;
			aa_addDescriptionForEmptyText(cell,field.DescriptionForEmptyText,field.EmptyTextCssClass);
		},'DescriptionForEmptyText',10);

		if (ajaxart.isChrome || ajaxart.isFireFox || ajaxart.isSafari) return; // we use placeholder

		aa_field_handler(field,'OnFocus',function(field,field_data,input)
		{
			if (jQuery(input).hasClass('empty_text_description'))
			{
				if (input.value == field.DescriptionForEmptyText)
					input.value = ""; 
				jQuery(input).removeClass('empty_text_description').removeClass(field.EmptyTextCssClass);
			}
		},'DescriptionForEmptyText',10);
		aa_field_handler(field,'OnBlur',function(field,field_data,input)
		{
			if (input.value == '' && document.activeElement != input)
			{
				jQuery(input).addClass('empty_text_description').addClass(field.EmptyTextCssClass);
				input.value = field.DescriptionForEmptyText;
			}
		},'DescriptieonForEmptyText',10);
		return [];
	},
	FieldData: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		var moreVars = null;
		if (context.vars._FieldItem) // dynamic fields
			moreVars = {_FieldItem : context.vars._FieldItem};
		aa_addMethod(field,'FieldData',profile,'FieldData',context,moreVars);
		return [];
	},
	MobileScroll: function(profile,data,context)
	{
		if (!window.iScroll && !window.aa_loading_iscroll) {  // for design time only. the runtime should include iscroll.js statically
			window.aa_loading_iscroll = true;
			jQuery.getScript('lib/iscroll.js',function() {aa_loading_iscroll=false;} );
		}
			
		var field = context.vars._Field[0];
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			cell.style.overflow = 'auto'; 

			aa_addOnAttach(cell,function() {
				var paramsToEval = "var params = " + aa_text(data,profile,'ScrollParams',context) + ';';
				eval(paramsToEval);
				var element = cell;
				if (aa_text(data,profile,'OnElement',context) == 'content') {
					element = cell.firstChild;
					if (!element) return;
				}
				
				ajaxart.run(data,profile,'Height',aa_ctx(context,{ControlElement: [element]}));  // set the height
				ajaxart.run(data,profile,'Width',aa_ctx(context,{ControlElement: [element]})); // set the width
				
				if (window.iScroll && aa_bool(data,profile,'EnableScroll',context)) {
				  cell.IScroll = new iScroll(element,params);
				  setTimeout(function() {cell.IScroll.refresh()},200);
				}
			});
		});
	},
	HoverCssClass: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			cell.onmouseover = function() { jQuery(cell).addClass('aa_hover'); }
			cell.onmouseout = function() { jQuery(cell).removeClass('aa_hover'); }
		});
		return [];
	},
	ImageReadOnlyImp: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		field.ImageHeight = aa_text(data,profile,'Height',context);
		field.ImageWidth = aa_text(data,profile,'Width',context);
		field.KeepImageProportions = aa_bool(data,profile,'KeepImageProportions',context) && field.ImageHeight != "" && field.ImageWidth != "";
		field.HideEmptyImage = aa_bool(data,profile,'HideEmptyImage',context) ;

		// the px does problems with dynamically changing image size
		field.ImageWidth = field.ImageWidth.split('px')[0];	
		field.ImageHeight = field.ImageHeight.split('px')[0];
		if (!field.KeepImageProportions) {
			if (field.ImageWidth!="") field.ImageWidth += 'px';
			if (field.ImageHeight!="") field.ImageHeight += 'px';
		}
		
		var urlForMissingImage = aa_text(data,profile,'UrlForMissingImage',context);
		var textForMissingImage = aa_text(data,profile,'TextForMissingImage',context);
		var src_compiled = ajaxart.compile(profile,'Src',context);
		field.Text = function(data1,ctx)
		{
			var field = this;
			var src = ajaxart_runcompiled_text(src_compiled, data1, profile, "Src", ctx );
			if (field.HideEmptyImage && ajaxart.totext_array(data1) == "")
				src = "";
			if (src == "") {
				if (textForMissingImage != "")
					return [jQuery("<span class='aa_missing_image'></span>").text(textForMissingImage)[0]];
				else if (urlForMissingImage != "")
					src = urlForMissingImage;
				else return ["<span/>"];
			}
			var out = "<img src='" + src + "'";
			var style = " style='";
			if (field.ImageHeight != "") { 
				style = style + "height:" + field.ImageHeight + "; "; 
				out += ' height="' + field.ImageHeight + '"'; 
			} 
			if (field.ImageWidth != "") { 
				style = style + "width:" + field.ImageWidth + "; "; 
				out += ' width="'+field.ImageWidth+'"'; 
			}
			out = out + style + "' ";
			out += "/>";
			return [out]
		}
		field.ReadOnlyControl = function(data1,ctx) {
			var field = this;
			var image = jQuery(this.Text(data1,ctx)[0])[0];
			
			if (aa_paramExists(profile,'OnClick'))
			{
				image.onclick = function() { 
					if (window.aa_incapture) return;
					ajaxart.run(data1,profile,'OnClick',aa_merge_ctx(context,ctx)); 
				}
				jQuery(image).css('cursor','pointer');
			}
			if (field.KeepImageProportions)	{
				aa_keepimageprops(image,field.ImageWidth,field.ImageHeight);
				var wrapper = jQuery('<div style="overflow:hidden; width:'+field.ImageWidth+"px; height:"+field.ImageHeight+'px"/>')[0];  // for alignment
				wrapper.appendChild(image);
				return [wrapper];
			}
			return [image];
		}
		if (field.ReadOnly)
			field.Control = field.ReadOnlyControl;
		
		if (field.KeepImageProportions)
			field.CellPresentation = 'control';
		
		return [];
	},
	ModifyControl: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
			var input = jQuery(cell).find('.field_control') || cell.firstChild;
			ajaxart.run(item,profile,'Action',aa_merge_ctx(context,ctx,{ Cell: [cell], FieldData: field_data, Input: input.get() }));
		});
		return [];
	},
	OnUpdate: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		var onUpdate = function(field,field_data,input,e,extra)
		{
			var ctx1 = input.ajaxart ? aa_merge_ctx(context,input.ajaxart.params) : context;
			var parent_elem = jQuery(input).parents('.aa_item')[0]; 
			var item = parent_elem && parent_elem.ItemData;
			var newContext = aa_ctx(ctx1,{ _Field: [field], _FieldData: field_data
				, _Input: [input], ControlElement: [input], _Item: item || [] } );
			if (extra) newContext = aa_ctx(newContext,extra);
			if (jQuery(input).parents('.aa_container').length > 0) { 
				newContext.vars._Cntr = [ jQuery(input).parents('.aa_container')[0].Cntr ];
				newContext.vars.HeaderFooterCntr = newContext.vars._Cntr[0].Context.vars.HeaderFooterCntr;
			}
			
			ajaxart.run(field_data,profile,'Action',newContext);
		}
		aa_field_handler(field,'OnUpdate',onUpdate,aa_text(data,profile,'ID',context),aa_int(data,profile,'Phase',context));
		
		if (aa_bool(data,profile,'FireOnUpdateWhenLoaded',context)) {
			jBart.bind(field,'ModifyControl',function(args) {
				aa_invoke_field_handlers(field.OnUpdate,args.Wrapper,null,field,args.FieldData);
			});
		}
		return [];
	},
	PopupImage: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var id = aa_text(data,profile,'ID',context);
		if (id == '') id = null;
		field.PupupImageCss = aa_attach_global_css( aa_text(data,profile,'Css',context) , null, 'popupimage' );
		
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			if (ajaxart_field_is_readOnly(ctx.vars._Cntr && ctx.vars._Cntr[0],cell.Field,ctx)) return;

			var input = aa_find_field_input(cell);
			if (!input) return;
			var img = document.createElement("span");
			img.className = 'aa_field_image image_fld_' + field.Id + ' '+ field.PupupImageCss;
			img.innerHTML = '&nbsp;';
			//var css = 'background-image:url(' + aa_text(data,profile,'Image',context) + ')';
			//img.style.cssText = css;
			jQuery(img).insertAfter(input);
			img.onmousedown = function(e)
			{
				if (input && input.TogglePopup && !jQuery(input).hasClass('aa_disabled') ) 
					input.TogglePopup();
			}
			img.onmousemove= function(e) 
			{ 
				var input = aa_find_field_input(cell);
				if (input && input.DetectResize) input.DetectResize(e); 
			};
		},id);

		return [];
	},
	Resizer: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.RememberResizerWidth = aa_bool(data,profile,'RememberLastWidth',context);
		
		if (aa_bool(data,profile,'Disable',context))
		{
			aa_field_handler(field,'ModifyControl',function() {},'resizer');
			return [];
		}
		var resizer = function(cell,field_data,cell_presentation,ctx) {
			function init(input,field) {
				aa_defineElemProperties(input,'DetectResize');  // for memory leaks
				
				function cellResizeStart(e) {
					document.onmouseup = cellResizeStop;
					input.onmousemove= null;
					document.onmousemove= cellResizeMove;
					return aa_stop_prop(e);
				}
				function cellResizeMove(e) {
					var mousepos = aa_mousePos(e);
	
					var new_size = mousepos.x - aa_absLeft(input);
					if (jQuery(input).parents('.right2left').length > 0)
						new_size = aa_absLeft(input) + input.offsetWidth - mousepos.x;
					
					jQuery(input).width(new_size);
	
					if (field.RememberResizerWidth && ctx.vars._Cntr) {
						ajaxart_setUiPref(aa_totext(ctx.vars._Cntr[0].ID),field.Id+'_Width','' + new_size + 'px',ctx);
					}
					return aa_stop_prop(e);
				}
				function cellResizeStop(e) {
					jQuery(input).removeClass('col_resize');
					document.onmouseup = null;
					document.onmousemove= null;
					input.onmousemove= input.DetectResize;
					input.onmousedown = input.onmousedownOrig;
					return aa_stop_prop(e);
				}

				input.onmousemove = input.DetectResize = function(e) {
					var mousepos = aa_mousePos(e);
					
					var in_resize_place = aa_absLeft(input) + input.offsetWidth - mousepos.x < 3;
					if (jQuery(input).parents('.right2left').length > 0)
						in_resize_place = mousepos.x - aa_absLeft(input) < 3;
					if (in_resize_place)
					{
						jQuery(input).addClass('col_resize');
						input.onmousedown= cellResizeStart;
					}
					else
					{
						jQuery(input).removeClass('col_resize');
						input.onmousedown= input.onmousedownOrig;
					}
				}
			}
			if (cell.ReadOnly) return;
			var input = jQuery(cell).find('>.field_control')[0];
			if (input != null) 
			{
				input.onmousedownOrig = input.onmousedown;
				init(input,field);
				if (field.RememberResizerWidth && ctx.vars._Cntr)
				{
					var cntr = ctx.vars._Cntr[0];
					var field_width = ajaxart_getUiPref(aa_totext(cntr.ID),field.Id+'_Width',ctx);
					if (field_width != null)
					 jQuery(input).css('width',field_width);
				}
			}
		}
		aa_field_handler(field,'ModifyControl',resizer,'resizer');

		return [];
	},
	DefineAction: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.Actions = field.Actions || {};
		var actionName = aa_text(data,profile,'ActionName',context);

		field.Actions[actionName] = function(field_data,ctx) {
			ajaxart.run(field_data,profile,'Action',aa_merge_ctx(context,ctx));
		}
	},
	SimpleInput: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		field.Control = function(field_data,ctx)
		{
			var field = this;
			ctx = aa_ctx(ctx,{_Field: [field]});
			
			var cntr = ctx.vars._Cntr && ctx.vars._Cntr[0];
			if (ajaxart_field_is_readOnly(cntr,field,ctx)) {
		    	var text = (field.Text) ? aa_totext(field.Text(field_data,context)) : aa_totext(field_data);
		    	text = text.replace(/\n/g,"<br/>");
				var out = jQuery("<div class='aa_text'/>").html(text)[0];
				return [out];
			}
			return [ajaxart_field_createSimpleInput(field_data,ctx,ajaxart_field_is_readOnly(cntr,field,ctx))];
		}
 	    //aa_addControlMethod_js(field,'Control',simple,context);
		
		return [];
	},
	Toolbar: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var cssClass = aa_attach_global_css(aa_text(data,profile,'Css',context),null,'field_toolbar');
		aa_addMethod(field,'Operations',profile,'Operations',context);
		field.RefreshToolbar = function(field,cell,field_data,ctx) {
			jQuery(cell).addClass(cssClass);
			if (ctx.vars._Cntr && ajaxart_field_is_readOnly(ctx.vars._Cntr[0],field,ctx)) return;

			var toolbar = jQuery('<span class="aa_field_toolbar" />')[0];
			var minWidth = aa_text(data,profile,'MinWidth',context);
			if (minWidth != '') 
			  jQuery(toolbar).css('min-width',minWidth).css('display','inline-block');
			
			var ops = aa_runMethod(field_data,field,'Operations',ctx);
			for(var i=0;i<ops.length;i++)
			{
				var op = ops[i];
				var img = document.createElement("span");
				aa_defineElemProperties(img,'Action,Operation');
				//img.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;";
				img.Operation = op;
				var opCssClass = ajaxart.totext_array(aa_runMethod(field_data,op,'CssClass',ctx));
				img.className = 'aa_field_toolbar_image ' + opCssClass;
				img.title = ajaxart.totext_array(aa_runMethod(field_data,op,'Title',ctx));
				var image = aa_totext(aa_runMethod(field_data,op,'Icon',ctx));
				if (image != "")
					img.style.background = "url("+image+") no-repeat";
				
			    toolbar.appendChild(img);
				
				img.Action = img.onmousedown = function(e)
				{
					var img = (typeof(event)== 'undefined')? e.target : event.srcElement;					
					var op = img.Operation;
					var input = jQuery(cell).find('.field_control')[0];
					if (op != null)
						aa_runMethod(field_data,op,'Action',aa_ctx(ctx,{ _Field: [field], _FieldData: field_data, ControlElement: [input], _Input: [input], _OperationElement: [img]}));
				}
			};
			var oldToolbar = jQuery(cell).find('>.aa_field_toolbar')[0];
			aa_remove(oldToolbar,true);
			if (jQuery(cell).find('>.aa_option_page').length>0)
			  jQuery(toolbar).insertBefore( jQuery(cell).find('>.aa_option_page') );
			else
			  cell.appendChild(toolbar);
		}
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			field.RefreshToolbar(field,cell,field_data,ctx);
		});
		if (aa_bool(data,profile,'RefreshOnUpdate',context)) 
		{
			aa_field_handler(field,'OnUpdate',function(field,field_data,input){
				// recreate the toolbar
				var cell = input.parentNode;
				field.RefreshToolbar(field,cell,field_data,context);
			});
		}
	},
	WritableControl: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		if (field == null) return [];
		aa_setMethod(field,'WritableControl',profile,'Control',context);
		
		return [];
	},
	LimitTextLength: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var maxLength = aa_int(data,profile,'MaxLength',context);
		if (maxLength <=0) return;
		var cuttingMark = aa_text(data,profile,'CuttingMark',context);
		var fullTextAsTooltip = aa_bool(data,profile,'FullTextAsTooltip',context);
		var fullTextOnClick = aa_bool(data,profile,'FullTextOnClick',context);

		aa_bind(field,'ModifyControl',function(args) {
			var content = args.Wrapper.firstChild || args.Wrapper;
			var text = $(content).html();
			if (text && text.length > maxLength) {
				var newtext = text.substring(0,maxLength - cuttingMark.length) + cuttingMark;
				if (fullTextAsTooltip) content.setAttribute('title' ,text);
				$(content).addClass('limit_text_length');
				if (fullTextOnClick) $(content).click(function() {
					if ($(content).hasClass('limit_text_length')) {
						$(content).html(text);
						$(content).removeClass('limit_text_length');
					} else {
						$(content).html(newtext);
						$(content).addClass('limit_text_length');						
					}
				});
				$(content).html(newtext);
			}
		});
	},
	OnKeyUp: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		aa_field_handler(field,'OnKeyup',function(field,field_data,input,e,extra)
		{
			var newContext = aa_ctx(context,{ _Field: [field], _FieldData: field_data
				, _Input: [input], ControlElement: [input] } );
			if (jQuery(input).parents('.aa_container').length > 0)
				newContext.vars._Cntr = [ jQuery(input).parents('.aa_container')[0].Cntr ];
			if (extra && extra.KeyCode)
				newContext.vars.KeyCode = extra.KeyCode;
			if (extra && extra.CtrlKey)
				newContext.vars.CtrlKey = extra.CtrlKey;
			
			ajaxart.run(field_data,profile,'Action',newContext);
		});
		return [];
	},
	OnClick: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		var func = function(cell,field_data,cell_presentation,ctx) {
			var input = jQuery(cell).find('.field_control')[0];
			var click = function(e) {
				if (window.aa_incapture) return;
				ajaxart.run(field_data,profile,'Action',aa_ctx(ctx,{_Field: [field], _FieldData: field_data, ControlElement: [this] } ));
			}
			if (input)
				input.onclick = click;
			else
				cell.onclick = click;
		}
		aa_field_handler(field,'ModifyCell',func);
		return [];
	},
	OnHover: function (profile,data,context)
	{
		var field = ajaxart_fieldaspect_getField(context);
		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
			cell.onmouseover = function() {
				if (!cell.isInside)
					ajaxart.run(field_data,profile,'Action',ctx);
				cell.isInside = true;
			};
			cell.onmouseout = function() { cell.isInside = false; };
		},'OnHover');
		return [];
	},
	CleanGlobalCss: function (profile,data,context) {
		return [aa_clean_global_css(aa_text(data,profile,'Css',context))];
	},
	AdaptCssForBrowser: function (profile,data,context) {
		var css = aa_text(data,profile,'Css',context);
		var forAllBrowsers = aa_bool(data,profile,'GenerateCssForAllBrowsers',context)
		return [aa_adapt_css_for_browser(css, forAllBrowsers)];
	},
	IsCssWellFormed: function (profile,data,context) {
		var css = aa_text(data,profile,'Css',context);
		if (aa_is_css_well_formed(css)) 	return ["true"];
		else								return [];
	},
	Animation: function (profile, data, context) {
		var field = ajaxart_fieldaspect_getField(context);
		var type = aa_first(data,profile,'Type',context);
		if (!type) return [];
		aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
			var elem = cell.firstChild; // scrolling is done on 'content', and can use parentNode for the cell
			if (!elem) return;
			type.animate(elem, function() {
				ajaxart.run(data,profile,'OnDone',context);
			});
		});
		return [];		
	},
	DynamicSize: function (profile, data, context) {
		var field = ajaxart_fieldaspect_getField(context);
		var width = aa_first(data,profile,'Width',context);
		var height = aa_first(data,profile,'Height',context);
		aa_bind(field,'ModifyControl',function(args) {
			var elem = args.Wrapper.firstChild;
			if (!elem) return;
			if (width) width.apply(elem);
			if (height) height.apply(elem);
		});
	}
});


function aa_runFieldAction(object,actionName,moreParams)
{
	/* aa_runFieldAction runs an action of a field defined in field_aspect.DefineAction.
	   object is an api object (e.g. button)
	   moreParams defines variables to be available in the action. e.g. { Location: 'left' }
	*/
	actinName = actionName || 'action';
	moreParams = moreParams || {};
	var field = object.field || object.Field;
	var fieldData = object.FieldData;
	if (!fieldData && object.data) fieldData = [object.data];
	fieldData = fieldData || [];
	var ctx = object.context || object.Context;

	if (!field || !ctx) return;
	if (!field.Actions || !field.Actions[actionName]) {
		return ajaxart.log('calling a non existing field Action ' + actionName,'error');
	}
	var vars = { ControlElement: [object.el] };
	for(var i in moreParams) {		
		if (!moreParams.hasOwnProperty(i)) continue;
		var val = moreParams[i];
		if (!aa_isArray(val)) val = [val];
		vars[i] = val;
	}
	field.Actions[actionName](fieldData,aa_ctx(ctx,vars));
}

function aa_input_value_mask(charsRegex) {
	var totalRegex = new RegExp('^'+charsRegex+'+$');

	return function(val) {
		if (val.match(totalRegex)) return val;
		var out = '';
		for(var i=0;i<val.length;i++) {
			var innerChar = val.charAt(i);
			if (innerChar.match(totalRegex)) out += innerChar;
		}
		return out;
	};
}











aa_gcs("action", {
	WriteValue: function (profile,data,context)
	{
		var into = ajaxart.run(data,profile,'To',context);
		var value = ajaxart.run(data,profile,'Value',context);
		if (ajaxart.isObject_array(into) && into[0].WriteValue) { // value by ref
			if (typeof into[0].WriteValue == "function") // js
				into[0].WriteValue(value,context);
			else
				ajaxart.runScriptParam(value,into[0].WriteValue,context); // xtml
	  } else {
		  ajaxart.writevalue(into,value);
		}
		return ["true"];
	},
	WriteValueWithoutAutoSave: function (profile,data,context)
	{
		var to = ajaxart.run(data,profile,'To',context);
		var value = ajaxart.run(data,profile,'Value',context);
		ajaxart.writevalue(to,value,true);
	},
	RunActionOnItems: function (profile,data,context)
	{
		var items = ajaxart.run(data,profile,'Items',context);
		
		var indicateLast = aa_bool(data,profile,'IndicateLastItem',context);
		var indicateIndex = aa_bool(data,profile,'IndicateItemIndex',context);
		
		for (var i=0;i<items.length;i++)
		{
			var ctx = context;
			if (indicateIndex) ctx = aa_ctx(ctx,{_ItemIndex: [''+i]});
			if (i == items.length-1 && indicateLast) ctx = aa_ctx(ctx,{_IsLastItem: ["true"]}); 
			ajaxart.run([items[i]],profile,'Action',ctx);
		}
	},
	RunActions : function (profile,data,context)
	{
		ajaxart.runsubprofiles(data,profile,'Action',context);
	},
	SetWindowTitle: function (profile,data,context) {
		document.title = aa_text(data,profile,'Title',context);
	},
	JBartDebugAlert: function (profile,data,context) {
		aa_alert( aa_text(data,profile,'Message',context) );
		return data;
	}
});

aa_gcs("bart_url", {
	NewUrlFragment: function (profile,data,context)
	{
		var current = aa_text(data,profile,'Current',context);
		var proposed = aa_text(data,profile,'Proposed',context);

		var curr = current.split('?');
		var prop = proposed.split('?');
		
		var prop_index = "";
		for(var i=1;i<prop.length;i++) {
			if ( prop[i].length > 0 && prop[i].charAt(prop[i].length-1) == ';') prop[i] = prop[i].substring(0,prop[i].length-1);
			
			var item = prop[i].substring(0,prop[i].indexOf('='));
			if (item == '') continue;
			if (i==1) prop_index += ",";
			prop_index = prop_index + item + ",";
		}
		
		var out = "";
		for(var i=1;i<prop.length;i++) {
			var pos = prop[i].indexOf('=');
			if (pos == -1 || pos == prop[i].length-1) continue;
			out += "?" + prop[i];
		}
	
		for(var i=1;i<curr.length;i++) {
			var attr = curr[i].substring(0,curr[i].indexOf('='));
			if (attr.length == 0) continue;
			if (prop_index.indexOf(',' + attr + ',') > -1 ) continue;
//			var _pos = attr.indexOf('_');
//			if (_pos == 0) continue;
//			if (_pos > -1) {
//				var tempPrefix = attr.substring(0,_pos);
//				if (prop_index.indexOf(',' + tempPrefix + ',') > -1 ) continue;
//			}
			out += "?" + curr[i];
		}
		return [out];
	}
});

aa_gcs("ui", {
	CustomCss: function (profile,data,context) {
		var style = aa_first(data,profile,'Style',context);
		if (!style) return [];
		style.Css = aa_text(data,profile,'Css',context);
		return [style];
	},
	CustomStyleByField: function (profile,data,context)
	{
	  return [{
		  Field: function(data1,ctx) { 
		  	return aa_first(data1,profile,'Field',aa_merge_ctx(context,ctx));
	  	  }
	  }];
	},
	CustomStyle: function(profile,data,context)
	{
		var style = {
			Html: aa_text(data,profile,'Html',context),
			Css: aa_text(data,profile,'Css',context),
			Javascript: aa_text(data,profile,'Javascript',context),
			IsTriplet: true,
			params: {}
		};
		var atts = profile.attributes;			// adding attributes as params
		for (var i=0; i < atts.length; i++) {
			var att_name = atts.item(i).nodeName;
			if (att_name != "t" && att_name != "value" && att_name != 'Data' && att_name != "name" && att_name != "Trace")
				style.params[att_name] = ajaxart.totext_array(ajaxart.dynamicText(data,atts.item(i).nodeValue,context));
		}
		return [style];
	}
});

aa_gcs("jbart_jsloader", {
    LoadJavascriptFile: function (profile,data,ctx)
    {
		return [{
			Load:function(data1,context) {
		    	if (! ajaxart.jbart_studio && aa_bool(data,profile,'LoadInDesignTimeOnly',context)) return;
		    	var url = aa_text(data,profile,'Url',context);
		    	jBart.vars.loaded_scripts = jBart.vars.loaded_scripts || {};
		    	if ( jBart.vars.loaded_scripts[url] ) return; // already loaded
	
			    ajaxart_async_Mark(context);
			    jBart.vars.loaded_scripts[url] = true;
			    
		    	ajaxart_RunAsync(data,ajaxart.fieldscript(profile,'EnsureLoaded'),aa_ctx(context,{JsFileUrl: [url]}),function() {
		    		ajaxart_async_CallBack(data,context);
		    	});
			}
		}]
    },
    LoadCssFiles: function (profile,data,ctx)
    {
		return [{
			Load: function(data1,context) {
		    	if (! ajaxart.jbart_studio && aa_bool(data,profile,'LoadInDesignTimeOnly',context)) return;
		    	ajaxart.runNativeHelper(data,profile,'Load',ctx);
			}
		}]
    },
    AutoUsing$: function (profile,data,context)
    {
	    ajaxart_async_Mark(context);
	    $.ajax({ url: aa_totext(context.vars.JsFileUrl), dataType: 'script',
	    	success: function() {
	    		ajaxart_async_CallBack(data,context);
	    	},
	    	error: function() {
	    		ajaxart_async_CallBack(data,context);
	    	}
	    });
    },
    PollingOfJsExpression: function (profile,data,context)
    {
	    var jsExpressionFunc = aa_get_func(aa_text(data,profile,'Expression',context));
	    var pollingTime = aa_int(data,profile,'PollingTime',context);

	    if (jsExpressionFunc()) return; // no need to load anything
	    
	    ajaxart_async_Mark(context);
	    var scriptElement = document.createElement('script');
	    scriptElement.setAttribute('src',aa_totext(context.vars.JsFileUrl));
	    document.body.appendChild(scriptElement);
	    
	    ajaxart_async_Mark(context);

	    function checkIfLoaded() {
	    	if (jsExpressionFunc()) {
	    		ajaxart_async_CallBack(data,context);
	    	} else {
	    		setTimeout(checkIfLoaded,pollingTime);
	    	}
	    }
	    checkIfLoaded();
    },
    CallbackFunction: function (profile,data,context)
    {
    	alert('EnsureLoaded of CallbackFunction is not implemented yet');
    }
});
aa_gcs("bart", {
    PageByID: function (profile,data,context)
    {
		if (!context.vars._AppContext) return [];
    	var pages = context.vars._AppContext[0].Pages;
    	if (!pages) return [];
    	var pageID = aa_text(data,profile,'PageID',context);
		var page = aad_object_byid(pages,pageID);
		if (page) return [page];
		return ajaxart.runNativeHelper(data,profile,'NewPage',context);
		return [];
    },
    HtmlPageTitle: function (profile,data,context)
    {
    	return [{
    		Load: function(data1,ctx) {
    			document.title = aa_text(data,profile,'Title',aa_merge_ctx(context,ctx));
    		}
    	}];
    },
    Javascript: function (profile,data,context1)
    {
    	return [{
   		 Load: function(data1,context) {
	    	if (aa_tobool(context.vars.JBart_OnlyShowPage)) return;
	    	
	    	var js = profile.getAttribute('ScriptOnLoad');
	    	if (!js || js == '') return;
			try {
		    	var func = aa_get_func(js,true);
		    	func(context);
			} catch (e) { 
				ajaxart.log("JavaScript: " + e.message, "error"); 
			}
    	}
    	}];
//    	var elem=document.createElement("script");
//    	elem.setAttribute("type", "text/javascript");
//    	elem.innerHTML = js;
//		document.getElementsByTagName("head")[0].appendChild(elem);
    },
    Page: function (profile,data,context) 
    {
	  var obj = { isObject: true };
	  obj.ID = ajaxart.run(data,profile,'ID',context);
	  obj.ResourceIDs = ajaxart.run(data,profile,'ResourceIDs',context);
	  obj.ResourceID = ajaxart.run(data,profile,'ResourceID',context);
	  obj.Type = ajaxart.run(data,profile,'Type',context);
	  var init = function(page) { 
	    page.Control = function(data1,ctx) {
	      var ctx2 = aa_merge_ctx(context,ctx);
	      ajaxart.runNativeHelper(data,profile,'OverrideUiPrefs',ctx2);
	      var out = [];
	      ajaxart.trycatch( function()  {
		    out = ajaxart.run(data1,profile,'Control',aa_ctx(ctx2, {PageID: page.ID}));
	      }, function (e) {	// catch
	    	  out = $('<div>error showing page</div>').get();
	      });
		  return out;
	    }
	  }
	  init(obj);
	  return [obj];
    }
});

aa_gcs("jbart_resource", {
	Data: function (profile,data,context)   // gc of jbart_reource.Data
	{
		var obj = { Type: "query" };
		obj.Id = aa_text(data,profile,'ResourceID',context);
		obj.ID = [obj.Id];
		obj.CacheIn = aa_first(data,profile,'CacheIn',context);
		obj.FullID = aa_getWidgetIDFromContext(context) + '_' + obj.Id;
		obj.AutoSaveSampleData = aa_bool(data,profile,'AutoSaveSampleData',context); // for the usage of the dt
		var type = obj.Type = aa_text(data,profile,'ValueType',context);
		
		// setting obj.Items
		obj.Items = [];
		
		obj.LoadFromValue = function(value) {
			if (type == 'calculated') return;
			if (type == 'xml clean ns') value = aa_xml_cloneNodeCleanNS(value);
			if (type == 'xml' || type == 'xml clean ns') {
				if (obj.Xml) {
					// already exists (when loading from data source)
					var val = jbart_data(value,'single');
					if (val && val[0]) {
						ajaxart.xml.copyElementContents(obj.Xml,val[0]);
						aa_triggerXmlChange(obj.Xml);
					}
				} else {	// first time					
					obj.Items = jbart_data(value,'single');
					obj.Xml = obj.Items[0];
				}
			}
			if (type == 'text') obj.Items = [ aa_totext([value]) ];
			if (type == 'xml multiple') obj.Items = jbart_data(value,'multiple');
			
			if (typeof(value) != 'string') value = aa_totext([value]);
			
			if (type == 'json to xml') obj.Items = jbart_data(value,'single');
			if (type == 'json') {
				var val = {};
				try {
					val = JSON.parse(value);
				}
				catch(e) { val.error = 'JSON: ' + (e.getMessage ? e.getMessage() : '') + ', parsing value ' } 
				obj.Items = (aa_isArray(val)) ? val : [val];
			}
			if (obj.Type == 'javascript') {
				var val = aa_run_js_code(value,data,context);
				if (val)
				  obj.Items = (aa_isArray(val)) ? val : [val];
			}
		}
		
		if (type == 'calculated') {
			obj.Items = aa_run(data,profile,'Value',context);
		} else {
			if (obj.CacheIn) 
				var value = aa_totext(obj.CacheIn.GetValue(data,aa_ctx(context,{ DataResource: [obj] })));
			else if (type == 'xml' || type == 'xml clean ns') {
				var value = aa_first(data,profile,'Value',context);
			} else {
				var value = aa_cdata_value(aa_xpath(profile,'Value')[0]);
			}
			obj.LoadFromValue(value);
		}
		
		if ((type == 'xml' || type == 'xml clean ns') && obj.CacheIn) {
			obj.XmlChanged = function() {
				if (obj.Saving) return;
				obj.Saving = true;
				setTimeout(obj.SaveXml,200);
			};
			obj.SaveXml = function() {
				obj.CacheIn.Save(data,aa_ctx(context,{ DataResource: [obj]}))
				obj.Saving = false;
			};
			aa_bindXmlChange(obj.Xml,obj.XmlChanged);
		}
		
		obj.DataSource = aa_first(data,profile,'DataSource',context);
		if (obj.DataSource && obj.Xml) {
			var info = aa_getXmlInfo(obj.Xml,context,false);
			info.Save = function(data2,ctx) {
			  obj.DataSource.Save(obj.Items,aa_ctx(context,ctx));
			}
			obj.Load = function(data1,ctx) {
				if (this.DataLoaded) return;
				ajaxart_async_Mark(ctx);
				aad_runMethodAsyncQuery(obj,obj.DataSource.Retrieve,data,aa_merge_ctx(context,ctx),function(result,ctx2){
					obj.DataLoaded = true;
					obj.LoadFromValue(result[0]);
					ajaxart_async_CallBack(data1,ctx);
				});
			}
		}

		return [obj];
	},
	CacheInCookies: function (profile,data,context)
	{
		return [{
			GetValue: function(data1,ctx) {
				var resource = ctx.vars.DataResource[0];
				var out = aa_valueFromCookie(resource.FullID);
				return out ? [out] : [];
			},
			Save: function(data1,ctx) {
				var resource = ctx.vars.DataResource[0];
				if (resource.Items[0]) {
				  aa_writeCookie(resource.FullID,ajaxart.xml2text(resource.Items[0]));
				}
			}
		}];
	},
	CacheInLocalStorage: function (profile,data,context)
	{
		return [{
			GetValue: function(data1,ctx) {
				var resource = ctx.vars.DataResource[0];
				var out = window.localStorage[resource.FullID];
				return out ? [out] : [];
			},
			Save: function(data1,ctx) {
				var resource = ctx.vars.DataResource[0];
				if (resource.Items[0]) {
					window.localStorage[resource.FullID] = ajaxart.xml2text(resource.Items[0]);
				}
			}
		}];
	}
});
aa_gcs("bart_resource", {
	ResourcesToGlobalVars: function (profile,data,context)
	{
		if (! context.vars._GlobalVars) return;
		var globals = context.vars._GlobalVars[0];
		var bc = context.vars._AppContext[0];
		var resources = bc.Resources;
		for(var i=0;i<resources.length;i++) {
			init(globals,resources[i]);
		}
		
		function init(globals,resource) {
			var id = aa_totext(resource.ID);
			globals[id] = function() { return resource.Items; };			
		}
	},
	Value: function (profile,data,context)
	{
		var obj = { isObject:true , Type: "value" }
		obj.Id = aa_text(data,profile,'ResourceID',context);
		obj.ID = [obj.Id];
		obj.FullID = aa_getWidgetIDFromContext(context) + '_' + obj.Id;		
		obj.Items = ajaxart.run(data,profile,'Value',context);
		
		return [obj];
	},
	Xml: function (profile,data,context)
	{
		var obj = { isObject:true , Type: "query" }
		obj.Id = aa_text(data,profile,'ResourceID',context);
		obj.ID = [obj.Id];
		obj.Mode = aa_text(data,profile,'Mode',context);
		obj.Storage = aa_text(data,profile,'Storage',context);
		obj.FullID = aa_getWidgetIDFromContext(context) + '_' + obj.Id;
		obj.AutoSaveSampleData = aa_bool(data,profile,'AutoSaveSampleData',context); // for the usage of the dt
		
		var nameOfGlobalVar = 'jBartWidget_' + ajaxart.totext(context.vars.WidgetId) + '_' + obj.Id; 
		if ( window[nameOfGlobalVar] )
			obj.Xml = window[nameOfGlobalVar][0] || aa_parsexml('<xml/>');
		else if (obj.Storage == '' || obj.Storage == 'in memory')
		  obj.Xml = aa_first(data,profile,'Xml',context);
		else {
			var textval = '';
			if (obj.Storage == 'cookie') 
			  textval = aa_valueFromCookie(obj.FullID);
			if (obj.Storage == 'local storage' && window.localStorage) 
				textval = window.localStorage[obj.FullID];
			
			if (textval == null || textval == '') 
				obj.Xml = aa_first(data,profile,'Xml',context);
			else
				obj.Xml = aa_parsexml(textval);
			
			if (!obj.Xml) obj.Xml = aa_parsexml('<xml/>');
			function init(obj) {
				obj.XmlChanged = function() {
					if (obj.Saving) return;
					obj.Saving = true;
					setTimeout(obj.SaveXml,200);
				}
				obj.SaveXml = function() {
					if (obj.Storage == 'cookie')
					  aa_writeCookie(obj.FullID,ajaxart.xml2text(obj.Xml));
					if (obj.Storage == 'local storage' && window.localStorage) {
						window.localStorage[obj.FullID] = ajaxart.xml2text(obj.Xml);
					}
					obj.Saving = false;
				}
				aa_bindXmlChange(obj.Xml,obj.XmlChanged);
			}
			init(obj);
		}
		if (!obj.Xml) return [obj];
		obj.Items = ( obj.Mode == 'single' ? [obj.Xml] : aa_xpath(obj.Xml,'*') ); 
		
		obj.DataSource = aa_first(data,profile,'DataSource',context);
		if (obj.DataSource) {
			var info = aa_getXmlInfo(obj.Xml,context,false);
			info.Save = function(data2,ctx) {
				obj.DataSource.Save([obj.Xml],aa_ctx(context,ctx));
			}
			obj.Load = function(data1,ctx) {
				if (this.DataLoaded) return;
				ajaxart_async_Mark(ctx);
				aad_runMethodAsyncQuery(obj,obj.DataSource.Retrieve,data,aa_ctx(context,ctx),function(result,ctx2){
					obj.DataLoaded = true;
					if (result.length > 0) ajaxart.xml.copyElementContents(obj.Xml,result[0]);
					ajaxart_async_CallBack(data1,ctx);
				});
			}
		}
		return [obj];
	},
	Javascript: function (profile,data,context)
	{
		try {
	    	var func = aa_get_func(profile.getAttribute('Code'));
	    	var out = func(context);
	    	return [out];
		} catch (e) { 
			ajaxart.log("JavaScript: " + e.message, "error"); 
		}
	}
});


aa_gcs("data_items", {
	Items: function (profile,data,context)
	{
		var out = {};

		out.ItemTypeName = ajaxart.run(data,profile,'ItemTypeName',context);
		out.Items = ajaxart.run(data,profile,'Items',context);

		var refreshFunc = function(out) { this.run = function() { out.Items = ajaxart.run(data,profile,'Items',context); return ["true"];} };
		ajaxart_addScriptParam_js(out,'Refresh',new refreshFunc(out).run,context);

		var newContext = aa_ctx(context,{_Items: [out]} );
		ajaxart.runsubprofiles(data,profile,'Aspect',newContext);
		
		if (! out.Subset) {
			out.Subset = function(data1,ctx) { 
				var subset = { isObject: true, Items: ctx.vars._InnerItem };
				return [subset];
			}
		}
		return [out];
	},
	AddXmlItem: function (profile,data,context)
	{
		var dataitems = context.vars._Items[0];
		var parent = aa_first(data,profile,'Parent',context);
		dataitems.SubsetForNewItem = function(data1,ctx) {
			var newXml = aa_parsexml( aa_text(data,profile,'NewItem',context) ,'', '', false,parent);
			if (!newXml) return;
			var innerItems = { isObject: true, Items: [newXml]};
			if (parent && newXml && parent.appendChild) {
				parent.appendChild(newXml);
			}
			innerItems.Cancel = function() {
				parent.removeChild(newXml);
			}
			return [innerItems];
		}
	}
});
aa_gcs("uiaction",{
	AddCssClass: function(profile, data, context) {
	  	var field_id = aa_text(data,profile,'AddTo',context);
		var elem = aad_find_field(field_id,null);
		$(elem).addClass( aa_text(data,profile,'Class',context) );
	}
});
aa_gcs("operation", {
	ClickOnButton: function(profile, data, context) {
	  	var field_id = aa_text(data,profile,'Button',context);
	  	if (!field_id) return;
	  	var btn = null,controlElement = aa_var_first(context,'ControlElement');
	  	if (controlElement) btn = $(controlElement).find('.fld_'+field_id)[0];
	  	if (!btn) {
				var top = aa_intest ? aa_intest_topControl : document;
		  	var btn = $(top).find('.fld_'+field_id)[0];
		  }
	  	if (!btn) return;
	  	
	  	if (btn.jbButtonElement)
	  		$(btn.jbButtonElement).trigger("click");
	  	else
	  		if (btn.jbApiObject && btn.jbApiObject.action) btn.jbApiObject.action();
	},
	SelectTextInTextBox: function(profile, data, context) {
	  	var field_id = aa_text(data,profile,'Textbox',context);
	  	var input = aa_find_field_input(aa_find_field(context,field_id)[0]);
	  	if (input) input.select();
	},
	SelectFromPicklist: function(profile, data, context) {
	  	var field_id = aa_text(data,profile,'FieldID',context);
	  	var optionCode = aa_text(data,profile,'OptionCode',context);

	  	var top = aa_var_first(context,'ControlElement') || 'body';
	  	var picklist_ctrl = $(top).find('.fld_'+field_id)[0];
	  	if (picklist_ctrl && picklist_ctrl.jbApiObject && picklist_ctrl.jbApiObject.setValue)
	  		picklist_ctrl.jbApiObject.setValue(optionCode);
	}

});

aa_gcs("text",{
});

aa_gcs("xml",{
	AttributeName: function(profile,data,context)
	{
		if (ajaxart.isxml(data) && data[0].nodeType == 2) 
			return [ data[0].nodeName ];
		return [];
	},
	AddChildren: function(profile, data, context) {
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var children = ajaxart.run(inputForChanges,profile, 'Children', context);
		var clone = aa_bool(inputForChanges,profile,'CloneChildren',context);
		
		if (data.length == 0) return [];
		var imported_items = [];
		for(var i=0;i<children.length;i++) {
			var item = aa_importNode(children[i],data[0]);
			imported_items.push(item);
			if (!clone)
				aa_xml_appendChild(data[0],item);
			else
				aa_xml_appendChild(data[0],ajaxart.xml.clone([item]));
		}
		if (children.length > 0) aa_triggerXmlChange(data[0]);
		ajaxart.run(imported_items,profile, 'RunOnChildren', context)
		return data;
	},
	Attributes: function(profile,data,context)
	{
		var alsoEmpty = aa_bool(data,profile,'AlsoEmpty',context);
		
		if (ajaxart.isxml(data) && data[0].nodeType == 1)
		{
			var out = [];
			var atts = data[0].attributes;
			if (atts != null)
				for (var i = 0; i < atts.length; i++) {
					if (alsoEmpty) out.push(atts.item(i));
					else if (atts.item(i).nodeValue != "") out.push(atts.item(i));
				}
			
			return out;
		}
		return [];
	},
	Duplicate : function(profile, data, context) {
		var element = ajaxart.run(data,profile, 'Element', context);
		var inputforChanges = ajaxart.getVariable(context,"InputForChanges");
		var items = ajaxart.run(inputforChanges,profile, 'Items', context);
		var Separator = ajaxart.run(data,profile, 'Separator', context);
		var SeparatorAround = aa_bool(data,profile,'SeparatorAround',context);
		var bindToSeparator = ajaxart.run(data,profile,'BindToSeparator',context);
		
		if (element.length == 0 || element[0].nodeType != 1) return []; 
		var parent = element[0].parentNode;
		if (Separator[0] != null && SeparatorAround)
			{
				var toAdd = ajaxart.xml.clone(Separator);
				if (Separator[0].ajaxart != null) toAdd.ajaxart = Separator[0].ajaxart;
				parent.appendChild(toAdd);
			}
		var local_context = ajaxart.clone_context(context); 
		for (var i=0; i<items.length; i++) {
			var item = items[i];
			var new_item = ajaxart.xml.clone(element);
			ajaxart.setVariable(local_context,"InputForChanges",[item]);
			ajaxart.setVariable(local_context,"DuplicateIndex",[ "" + (i+1)]);
			var changes = ajaxart.subprofiles(profile,'ChangeOnElement');
			ajaxart.each(changes,function(changeProfile) {
				ajaxart.run([new_item],changeProfile, "", local_context);
			});
			if (i==0) {
				var changes = ajaxart.subprofiles(profile,'ChangeOnFirstElement');
				ajaxart.each(changes,function(changeProfile) {
					ajaxart.run([new_item],changeProfile, "", local_context);
				});
			}
			parent.appendChild(new_item);
			if (Separator[0] != null)
				if (i+1 < items.length || SeparatorAround)
				{
					var toAdd = ajaxart.xml.clone(Separator);
					if (Separator[0].ajaxart != null) toAdd.ajaxart = Separator[0].ajaxart;
					parent.appendChild(toAdd);
				}
		}
		parent.removeChild(element[0]);
		return ["true"];
	},
	Parent: function(profile, data, context) {
		if (! ajaxart.isxml(data)) return [];
		if (data[0].nodeType == 1 && data[0].parentNode != null) 
			return [ data[0].parentNode ];
		return [];
	},
	SetAttribute: function(profile, data, context) 
	{
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var newValue = aa_text(inputForChanges,profile, 'Value', aa_ctx(context,{ _XmlNode: data }));
		var attrName = aa_text(inputForChanges,profile, 'AttributeName', context);
		if (attrName == "") { return; }
		var removeEmptyAttribute = aa_bool(data,profile, 'RemoveEmptyAttribute', context);
		var changed = false;
		
		for(var i=0;i<data.length;i++) {
			var xml = data[i];
			if (!ajaxart.isxml(xml) || xml.nodeType != 1)
				return;
			if (newValue != "" && xml.getAttribute(attrName) == newValue) continue;
			
			if (newValue != "")
				xml.setAttribute(attrName,newValue);
			else { // empty
				if (aa_bool(data,profile, 'RemoveEmptyAttribute', context))
					xml.removeAttribute(attrName);
				else
					xml.setAttribute(attrName,"");
			}
			changed = true;
		}
		if (changed) aa_triggerXmlChange(data[0]);
		
		return [newValue];
	},
	Tag: function(profile, data, context) {
		var removeNamespace = aa_bool(data,profile, 'RemoveNamespace', context);
		if ( !ajaxart.isxml(data) ) return [];
		
		var xml = data[0];
		if (xml.nodeType == 2 ) {// attribute
			xml = aa_xpath(xml,'..')[0];
			if (!xml) return [];
		}
		
		var tag = aa_tag(xml);
		if ( removeNamespace )
			return [tag.replace(/.*:/,"")];
		else
			return [tag];
		
		return [];
	},
	WithChanges: function(profile, data, context) {
		//$("#ajaxart_trace_control").append(ajaxart.xml.xpath_of_node(profile,"id",true) + '<br/>');
		var xml_src = ajaxart.run(data,profile,'Xml',context);
		var newContext = ajaxart.clone_context(context);
		ajaxart.setVariable(newContext,"InputForChanges",data);
		var out = [];
		ajaxart.each(xml_src, function(item) {
			var xml = item;
			if ( ! ajaxart.ishtml(item) && aa_bool(data,profile,'CloneXml',context))
			  xml = ajaxart.xml.clone([item]);
				
			var changes = ajaxart.subprofiles(profile,'Change');
			ajaxart.each(changes,function(changeProfile) {
				ajaxart.run([xml],changeProfile, "", newContext);
			});
			out.push(xml);
		});
		return out;
	},
	Wrap: function(profile, data, context) {
		if ((!ajaxart.isxml(data)) || data[0].nodeType == 9) { return []; } // Document 

		var headtag = aa_text(data,profile,'HeadTag',context);
		var head = aa_first(data,profile, 'Head', context);
		if (head == null) {
			if (headtag == "") return [];
			head = aa_createElement(data[0],headtag);
		}
				
		if (! ajaxart.ishtml(data))
		{
			for(var i=0;i<data.length;i++)
				aa_xml_appendChild(head,data[i].cloneNode(true));
		}
		else
		{
			for(var i=0; i<data.length; i++)
				aa_xml_appendChild(head,data[i]);
		}
		
		return [head];
	},
	Xml: function(profile, data, context) {
		var dynamicContent = profile.getAttribute('DynamicContent') == 'true';
		var xmlescape = profile.getAttribute('EncodeDynamicContent') != 'false';

		var child = ajaxart.childElem(profile,"*");
		if (child == null) 
			return [ aa_createElement(data[0],'xml') ];

	  if (!dynamicContent)
		{
			return [ ajaxart.xml.clone([child]) ];
		} else {  // dynamic content
	    	var text = ajaxart.xml2text(child);
	    	var newxml_text = ajaxart.dynamicText(data,text,context,data,false,xmlescape)[0];
	    	var out = aa_parsexml(newxml_text);
	    	if (out != null) return [out];
	    	return [];
	    }
	},
	XmlItems: function (profile,data,context)
	{
		var dataitems = { isObject: true }
		dataitems.ParentXml = aa_first(data,profile,'Parent',context);
		var tag = aa_text(data,profile,'Tag',context);
		dataitems.Tag = tag;
		if (tag.indexOf(',') > -1) {  // more than one tag
			var tags = tag.split(',');
			dataitems.Tag = tags[0];
			dataitems.AllTags = tags;
		}
		dataitems.ItemTypeName = aa_text(data,profile,'ItemTypeName',context);
		if (dataitems.ItemTypeName == "")
			dataitems.ItemTypeName = aa_text_capitalizeToSeperateWords( ajaxart_multilang_text(tag,context) );
		
		var init = function(dataitems) 
		{
			dataitems.InitXmlItem = function(xml) 
			{
				var info = aa_getXmlInfo(xml,context);
				info.DataItems = dataitems;
				info.PrepareForEdit = function() {
					this.OriginalCopy = this.Xml.cloneNode(true);
				}
				info.Cancel = function(data1,ctx2) {
					if (aa_tobool(ctx2.vars.IsNewItem))
						this.Delete(data1,ctx2);
					else if (this.OriginalCopy)
					  ajaxart.xml.copyElementContents(this.Xml,this.OriginalCopy);
				}
				info.Delete = function() {
					xml.parentNode.removeChild(xml);
					aa_removeXmlInfo(xml);
					aa_triggerXmlChange(this.DataItems.ParentXml);
					for(var i=0;i<dataitems.Items.length;i++) {
						if (dataitems.Items[i] == xml) { dataitems.Items.splice(i,1); break;} 
					}
					aa_triggerXmlChange(dataitems.ParentXml);				
				}
			}
			dataitems.Refresh = function(data1,ctx) {
				if (!dataitems.AllTags)
				  dataitems.Items = (dataitems.Tag != "") ? aa_xpath(dataitems.ParentXml,dataitems.Tag) : [];
				else {
					dataitems.Items = [];
					for(var i in dataitems.AllTags)
						if (dataitems.AllTags.hasOwnProperty(i))
							ajaxart.concat(dataitems.Items,aa_xpath(dataitems.ParentXml,dataitems.AllTags[i]));
				} 
				if (aa_paramExists(profile,'ElementCondition')) {
					var newItems = [];
					for(var i=0;i<dataitems.Items.length;i++)
						if (aa_bool([dataitems.Items[i]],profile,'ElementCondition',context))
							newItems.push(dataitems.Items[i]);
					
					dataitems.Items = newItems;
				}
				for(var i=0;i<dataitems.Items.length;i++)
					dataitems.InitXmlItem(dataitems.Items[i]);
			}
			dataitems.DeleteItem = function(data1,ctx) {
				var info = aa_getXmlInfo(data1[0],context);
				if (info.Delete) return info.Delete(data1,ctx);
			}
			dataitems.SubsetForNewItem = function(data1,ctx) {
				var tag = dataitems.Tag;
				if ( dataitems.AllTags && aa_totext(ctx.vars._NewItemTag) != "" ) {
					tag = aa_totext(ctx.vars._NewItemTag);
					if ( dataitems.AllTags.join(',').indexOf(tag) == -1) tag = dataitems.Tag; 
				}
				var item = aa_createElement(dataitems.ParentXml,tag);
				ajaxart.run([item],profile,'DoOnNewItem',context);
				var info = aa_getXmlInfo(item,context);
				info.DataItems = dataitems;
				info.Save = function(data2,ctx2) {
					var dataitems = this.DataItems;
					if (!dataitems.ParentXml) return [];
					dataitems.ParentXml.appendChild(this.Xml);
					aa_triggerXmlChange(dataitems.ParentXml);
					dataitems.Items.push(item);
					dataitems.InitXmlItem(item);
				}
				var subset = { isObject: true , Items: [item]};
				subset.Save = function(data2,ctx2) {
					var info = aa_getXmlInfo(this.Items[0],context);
					info.Save([info.Xml],ctx);
				}
				if (aa_tobool(ctx.vars._DataItemsImmediateAdd)) {
					subset.Save([],ctx);
					subset.Save = function(data1,ctx2) {
						if (subset.Items.length == 0) return [];
						var info = aa_getXmlInfo(subset.Items[0],ctx2);
						info.Save(data1,ctx2);
					}
				}
				
				return [subset];
			}
			dataitems.Subset = function(data1,ctx) 
			{
				var item = ctx.vars._InnerItem[0];
				var subset = { isObject: true, ItemTypeName: dataitems.ItemTypeName , Items: [item]}
				var info = aa_getXmlInfo(item,context);
				subset.DeleteItem = info.Delete;
				subset.Cancel = info.Cancel;
				subset.Save = function() {}
				if (info.PrepareForEdit) info.PrepareForEdit();
				return [subset];
			}
			dataitems.CanPasteFromDataItems = function(draggedDataItems,ctx) {
				if (aa_paramExists(profile,'CanPasteItem')) {
			      return aa_frombool( aa_bool([draggedDataItems],profile,'CanPasteItem',aa_ctx(context,{_Items: [this]})) );
				}
				if (draggedDataItems[0].Tag && dataitems.Tag && draggedDataItems[0].Tag == dataitems.Tag)
					return ['true'];
				return [];
			}
			dataitems.MoveBefore = function(data1,ctx) {
				if (data1.length == 0) return [];
			    var item = data1[0].Item[0];
			    var to = data1[0].BeforeItem[0];
				if (ajaxart.isxml(to) && ajaxart.isxml(item) )
					if (to.ownerDocument == item.ownerDocument && item.ownerDocument != null)
						to.parentNode.insertBefore(item,to);

				aa_triggerXmlChange(dataitems.ParentXml);				
				dataitems.Items = aa_xpath(dataitems.ParentXml,dataitems.Tag);
				return ["true"];
			}
			dataitems.MoveToEnd = function(data1,ctx) {
				if (data1.length == 0) return [];
			    var item = data1[0];
				if (dataitems.ParentXml == null)
					return [];
				dataitems.ParentXml.appendChild(item);
				dataitems.Items = aa_xpath(dataitems.ParentXml,dataitems.Tag);
				aa_triggerXmlChange(dataitems.ParentXml);				
				
			    return ["true"];
			}
			dataitems.SetNewOrder = function(items,ctx) {
				if (items.length == 0) return [];
				if (!dataitems.ParentXml) return [];
				if ($(dataitems.ParentXml).find('>*').length != items.length) return [];
				$(dataitems.ParentXml).empty().append(items);
				dataitems.Items = aa_xpath(dataitems.ParentXml,dataitems.Tag);
				aa_triggerXmlChange(dataitems.ParentXml);				
				
			    return ["true"];
			}

		}
		init(dataitems);
		dataitems.Refresh(data,context);
		ajaxart.runsubprofiles(data,profile,'Aspect',aa_ctx(context, {_Items: [dataitems]}));
		
		return [dataitems];
	}
});

aa_gcs("xtml", {
	  UseAndTranslateParam: function (profile,data,context)
	  {
		  var param = aa_text(data,profile,'Param',context); 
		  var input = ajaxart.run(data,profile,'Input',context);
		  
		  var paramScript = context.params[param];
		  if (aa_isArray(paramScript)) // script='false'
			  return paramScript;
		  
		  if (paramScript == null || paramScript.script == null) return [];
		  if (paramScript.compiled == "same") return input;
		  
		  // if we're here we are in script=true
		  
		  var newContext = {};
		  newContext.vars = context.vars;
		  newContext.params = context.componentContext.params;
		  newContext.componentContext = context.componentContext.componentContext;
		  
		  if (paramScript.script.nodeType == 2) // attribute, we can translate it
			  return ajaxart_multilang_run(input,paramScript.script,'',newContext);
		  
		  if (paramScript.compiled == null)
			  return ajaxart.run(input,paramScript.script,"",newContext);
		  else  
			  return paramScript.compiled(input,newContext);
	  },
	  ComponentDefinition: function (profile,data,context)
	  {
		return ajaxart.make_array(data,function(item) {
		   var id = aa_text(item,profile,'ID',context);
		   if (id == "")
			   return null;
		   var toXtml = aa_bool(item,profile,'ToXtml',context);
		   try {
			 var middlePos = id.indexOf('.');
			 var ns = id.substring(0,middlePos);
			 var compName = id.substr(middlePos+1);

			 if (ajaxart.components[ns] == null) return [];
			 var global = ajaxart.components[ns][compName];
		   } catch(e) { ajaxart.log("ComponentDefinition: cannot find component " + id); return [];}
		   
		   if (toXtml)
			   return ajaxart.childElem(global,"xtml");
		   else
			   return global;
		   
		},true);
	  },
	  ComponentsOfType: function (profile,data,context)
	  {
		  if ( ! window.ajaxart_comp_of_type_cache ) {
			  ajaxart_comp_of_type_cache = {};
			  ajaxart_comp_of_type_advanced_cache = {};
			  for (var i in ajaxart.components) {
				  var advanced = false;
				  if (i.lastIndexOf("_dt") == i.length-3 && i.length > 3 || i == "aaeditor") advanced = true;
				  for(var j in ajaxart.components[i]) {
					  var comp = ajaxart.components[i][j];
					  if (comp.getAttribute('hidden') == 'true' || comp.getAttribute('deprecated') == 'true') continue;
//					  if (! advanced && comp.getAttribute('advanced') == "true") advanced = true;
					  var types = (comp.getAttribute('type') || '').split(',');
					  for(var k=0;k<types.length;k++) {
						  if (types[k].split('.').length > 2) // e.g. data_items.Items.PageData
							  types.push(types[k].substring(0,types[k].lastIndexOf('.')));
					  }
					  var category = comp.getAttribute('category');
					  if (category) types.push(types[0]+'.'+category);
					  
					  for(var t in types)
					  {
						  var type = types[t];
						  if (!advanced) {
							if (ajaxart_comp_of_type_cache[type] == null) ajaxart_comp_of_type_cache[type] = [];
							ajaxart_comp_of_type_cache[type].push("" + i + "." + j);
						  }
						  else {
						    if (ajaxart_comp_of_type_advanced_cache[type] == null) ajaxart_comp_of_type_advanced_cache[type] = [];
						    ajaxart_comp_of_type_advanced_cache[type].push("" + i + "." + j);
						  }
					  }
				  }
			  }
		  }
		  
		  var type = aa_text(data,profile,'Type',context);
		  var out = ajaxart_comp_of_type_cache[type];

		  if (aa_bool(data,profile,'ForAllTypes',context)) {
			  ajaxart.concat(out,ajaxart_comp_of_type_advanced_cache[type]);
			  ajaxart.concat(out,ajaxart_comp_of_type_cache["*"]);
		  }
		  
		  if (out == null) out = [];
		  return out;
	  },
	  Params: function (profile,data,context)
	  {
		  var out = { isObject: true };
		  var elem = profile.firstChild;
		  while (elem != null)
		  {
			  if (elem.nodeType == 1) 
			  {
				  var tag = elem.tagName;
				  var name = elem.getAttribute('name');
				  if (name == null || name == "") { elem = elem.nextSibling;  continue; }
				  
				  if (tag == 'Param') {
					  out[name] = ajaxart.run(data,elem,'',context);
				  } else if (tag == 'ScriptParam') {
					  out[name] = { script: elem , context: context, compiled: ajaxart.compile(elem,'',context,elem.getAttribute("paramVars")) };
				  } else if (tag == 'Method') {
					  out[name] = { script: elem , context: context, objectForMethod: [out], compiled: ajaxart.compile(elem,'',context,elem.getAttribute("paramVars")) };
				  } else if (tag == 'ScriptParamArray') {
					  var scriptArr = ajaxart.run(data,elem,'',context);
				      var value = [];
					  for(var j=0;j<scriptArr.length;j++)
						value.push( { script: scriptArr[j] , context: context.componentContext } );
					  
					  out[name] = value;
				  }
			  }
		    elem = elem.nextSibling;
		  }
				
		  return [out];
	  },
	  UseParam: function (profile,data,context)
	  {
		  var param = aa_text(data,profile,'Param',context); 
		  var input = ajaxart.run(data,profile,'Input',context);

		  var paramScript = context.params[param];
		  if (aa_isArray(paramScript)) // script='false'
			  return paramScript;

		  if (typeof(paramScript) == 'function') return paramScript(input,context);
		  
		  if (paramScript == null || paramScript.script == null) 
			  return [];
		  if (paramScript.compiled == "same") return input;
		  
		  // if we're here we are in script=true
		  
	  	  var newContext = { params: []};
	  	  newContext.vars = context.vars;
	  	  if (context.componentContext) {
	  	    newContext.params = context.componentContext.params;
	  	    newContext.componentContext = context.componentContext.componentContext;
	  	  }
			
		  if (paramScript.compiled == null)
			  return ajaxart.run(input,paramScript.script,"",newContext);
		  else  
			  return paramScript.compiled(input,newContext);
	  },
	  UseParamArray: function (profile,data,context)
	  {
		  var param = aa_text(data,profile,'Param',context); 
		  var paramScript = context.params[param];
		  if (!paramScript) {
		  	ajaxart.log('UseParamArray: Can not find param ' + param);
		  	return [];
		  }
		  if (aa_isArray(paramScript)) // script='false'
			  return paramScript;

	  	  var newContext = {};
	  	  newContext.vars = context.vars;
	  	  if (context.componentContext) {
		  	  newContext.params = context.componentContext.params;
		  	  newContext.componentContext = context.componentContext.componentContext;
		  	}

	  	  return ajaxart.runsubprofiles(data,paramScript.script,paramScript.field,newContext);
	  },
	  UseParamArrayAsync: function (profile,data,context)
	  {
		  var param = aa_text(data,profile,'Param',context); 
		  var paramScript = context.params[param];
		  if (aa_isArray(paramScript)) // script='false'
			  return paramScript;
		  
		  var actionProfs = ajaxart.subprofiles(paramScript.script,paramScript.field);
		  if (actionProfs.length == 0) return;
		  
		  var newContext = {};
		  newContext.vars = context.vars;
		  newContext.params = context.componentContext.params;
		  newContext.componentContext = context.componentContext.componentContext;
		  
		  var cbObj = ajaxart_async_GetCallbackObj(newContext);
	      cbObj.marked = true;
		  cbObj.index = 0;
		  cbObj.actionProfs = actionProfs;
			
		  var callBack = function(data1,context1) {
			var cbObj = ajaxart_async_GetCallbackObj(newContext);
			if (cbObj.index >= cbObj.actionProfs.length) {
				ajaxart_async_CallBack(data,newContext); return;
			}
			var actionProf = cbObj.actionProfs[cbObj.index];
			cbObj.index++;
			ajaxart_RunAsync(data,actionProf,newContext,cbObj.seqCallBack);
		  }
		  cbObj.seqCallBack = callBack;
		  callBack(data,newContext);
	  }
});

aa_gcs("yesno", {
	  Expression: function (profile,data,context)
	  {
		return ajaxart.run(data,profile,'Expression',context,'',true);
	  },
	  IsEmpty: function (profile,data,context)
	  {
		  var val = ajaxart.run(data,profile,'Value',context);
		  var checkInner = aa_bool(data,profile,'CheckInnerText',context);
		  return aa_isEmpty(val,checkInner);
	  },
	  PassesFilter: function (profile,data,context)
	  {
	  	return ajaxart.make_array(data,function(item) {
	  		if (! aa_bool(item,profile,'Filter',context))
	  			return null;
			return item;
	  	});
	  },
	  ItemsEqual: function (profile,data,context)
	  {
	    var item1 = ajaxart.run(data,profile,'Item1',context);
	    var item2 = ajaxart.run(data,profile,'Item2',context);
	    
	    if (item1.length == 0 && item2.length == 0) return ["true"];
	    if (item1.length == 0 || item2.length == 0) {
	    	var item = (item1.length > 0) ? item1 : item2;
	    	if ( aa_itemsEqual(item[0],"") ) return ["true"]; else return [];
	    }
	    
	    if ( aa_itemsEqual(item1[0],item2[0]) ) return ["true"];
	    return [];
	  },
	  Not: function (profile,data,context)
	  {
		  var result = aa_bool(data,profile,'Of',context);
		  if (result == false)
			  return ["true"];
		  else
			  return [];
	  },
	  OR: function (profile,data,context)
	  {
	    var subprofiles = ajaxart.subprofiles(profile,'Item');
	    
		for(var i=0;i<subprofiles.length;i++)
		{
	  		if ( aa_bool(data,subprofiles[i],"",context) )
	  			return ["true"];
	  	};
	  	return [];
	  },  
	  And: function (profile,data,context)
	  {
	    var subprofiles = ajaxart.subprofiles(profile,'Item');
	    
		for(var i=0;i<subprofiles.length;i++)
		{
	  		if ( ! aa_bool(data,subprofiles[i],"",context) )
	  			return [];
	  	};
	  	return ["true"];
	  },
	  Empty: function (profile,data,context)
	  {
	  	return aa_isEmpty(data,aa_bool(data,profile,'CheckInnerText',context));
	  },	
	  NotEmpty: function (profile,data,context)
	  {
		  var value = ajaxart.run(data,profile,'Value',context);
		  var check = aa_bool(data,profile,'CheckInnerText',context);
		  var result = aa_isEmpty(value,check);
		  if (result == true || result[0] == 'true') return [];
		  return ['true'];
	  }	
});

aa_gcs("data_items", {
	InnerDataItems: function (profile,data,context)
	{
		var dataitems = context.vars._Items[0];
		dataitems.Parent = aa_first(data,profile,'ParentDataItems',context);
		if (dataitems.Parent == dataitems) { dataitems.Parent = null; return []; }
		var init = function(dataitems) {
			dataitems.SaveParent = function(data1,ctx) {
				if (dataitems.Parent.SaveParent)
				  return dataitems.Parent.SaveParent(data1,ctx);
				else if (dataitems.Parent.Save)
					return dataitems.Parent.Save(data1,ctx);
			}
		}
		init(dataitems);
	}
});

aa_gcs("field", {
	XmlMultipleGroup: function (profile,data,context)
	{
		var field = { isObject : true, Title: aa_multilang_text(data,profile,'Title',context), IsGroup: true, IsMultipleGroup: true }
		var path = aa_text(data,profile,'Path',context);
		var middleElement = path.indexOf('/') != -1;
		
		field.Id = aa_text(data,profile,'ID',context);
		if (field.Id == "") field.Id = path.split('/').reverse().pop();
		
		field.ID = [ field.Id ]; 
		field.Fields = ajaxart.runsubprofiles(data,profile,'Field',context);
		
		field.FieldData = function(data) { return data; }
		
		var itemsProvider = aa_first(data,profile,'Items',context);
		if (itemsProvider && itemsProvider.ContainerData) field.FieldData = itemsProvider.ContainerData;
		else {
			if (path.indexOf('/') != -1) {
				var lastpos = path.lastIndexOf('/');
				var subPath = (lastpos==-1) ? path : path.substring(0,lastpos);
				aa_set_fielddata_method(field,subPath);
			}
		}

		field.InnerItems = function(data1,ctx) {
			var ctx = aa_merge_ctx(context,ctx);
			var out = ajaxart.runNativeHelper(data1,profile,'Items',ctx);
			out[0].MultipleItemsField = this; 
			return out;
		}
		field.Operations = function(data1,ctx) {
			return ajaxart.run(data,profile,'Operations',context);
		}
		field.Control = function(data1,ctx) {
			var ctx2 = aa_ctx(aa_merge_ctx(context,ctx),{_Field: [this]});
			return ajaxart.runNativeHelper(data1,profile,'Control',ctx2);
		}
		field.Aspects = function(data1,ctx) { return ajaxart.runsubprofiles([],profile,'Aspect',context); }
		
		var newContext = aa_ctx(context,{_Field: [field]} );
		ajaxart.runsubprofiles(data,profile,'FieldAspect',newContext);
		
		return [field];
	}
});

aa_gcs("ui_async", {
	  Control: function (profile,data,context)
	  {
		var out = document.createElement('div');
		var loadingControl = aa_first(data,profile,'ControlForLoading',context);
		if ( loadingControl != null ) { out.appendChild(loadingControl); $(out).addClass('aa_loading'); }
		
		var ShowControl1 = function(out) { return function(data1,context1) {
			var ShowControl2 = function(data2,ctx2) {
				var control = aa_first(data1,profile,'Control',context);
				aa_empty(out);
				$(out).removeClass('aa_loading');
				if (control != null) {
					out.appendChild(control);
					aa_element_attached(control);
					aa_fixTopDialogPosition();
				}
				aa_fire_async_finished();
			}
			
			ajaxart_RunAsync(data1,ajaxart.fieldscript(profile,'AsyncAction'),context,ShowControl2); 
		} };
		var async_data = ajaxart.fieldscript(profile,'AsyncData');
		if (async_data)
			aa_RunAsyncQuery(data,async_data,context,ShowControl1(out));
		else
			ShowControl1(out)(data,context);
		//ajaxart_RunAsync(data,async_data,context,ShowControl1(out));
		
		return [out];
	  }
});

aa_gcs("action_async", {
	RunActions: function(profile, data, context)
	{
		return ajaxart.gcs.action_async.SequentialRun(profile,data,context);
	},
	SequentialRun: function(profile, data, context)
	{
		aad_async_XtmlSequentialRun(data,profile,'Action',context);
	}
});
aa_gcs("ui", {
	ButtonAsHyperlink: function (profile,data,context)
	{
		var btnContext = context.vars.ButtonContext[0];
		var out = null;;
		var image = aa_totext(btnContext.Image);
		var text = aa_totext(btnContext.Text);
		var tooltip = aa_totext(btnContext.Tooltip);
		var textInlineCss = aa_text(data,profile,'TextInlineCss',context); 
		var imageInlineCss = aa_text(data,profile,'ImageInlineCss',context); 
			
		if (image == "") { // no image
			out = $('<a class="button_hyperlink" style="'+textInlineCss+'" title="'+tooltip+'" href="#"/>')[0];
			out.innerHTML = text;
		}
		else {
			out = $('<span class="button_hyperlink_image"/>')[0];
			var img = $('<img src="'+image+'" style="'+imageInlineCss+'" />')[0];
			var alink = $('<a href="#" style="'+textInlineCss+'" onclick="return false;" class="button_hyperlink" title="'+tooltip+'"/>')[0];
			alink.innerHTML = text;
			out.appendChild(img);
			out.appendChild(alink);
		}
		var initEvents = function(out) {
			out.onclick = function(e) {
			  if (window.aa_incapture) return;
			  e = e || event;
			  if (aa_incapture) return false;
			  aa_runMethod(data,context.vars.ButtonContext[0],'OnClick',aa_ctx(context,{ControlElement: [out]}));
			  ajaxart_stop_event_propogation(e);
			  return false;
			}
			$(out).hover(function() {
			  aa_runMethod(data,context.vars.ButtonContext[0],'OnHover',context);
			}, function() {} ); 
		}
		initEvents(out);
		return [out];
	},
	InlineCssIntoElements: function(profile,data,context) {
		var html = aa_text(data,profile,'Html',context);
		var css = aa_text(data,profile,'Css',context);
		jHtml = $("<div>" + html + "</div>");
		css_parts = css.split("}");
		for (var i=0; i<css_parts.length; i++) {
			var name_and_style = css_parts[i].split("{");
			if (name_and_style.length != 2) continue;
			var selector = name_and_style[0];
			var style = name_and_style[1].replace(/\n/g,' ');
			jHtml.find(selector).each(function() { this.style.cssText = style; });
		}
		return [ jHtml.html() ];
	}
});

aa_gcs("uiaction", {
DoFind: function (profile,data,context)
{
	  var filter_elems = ajaxart.run(data,profile,'FilterElements',context);
	  var cntr = context.vars._Cntr[0];
	  if (cntr == null) return [];
	  cntr.DoFind(ajaxart.totext_array(data),filter_elems);
	  return ["true"];
}
});

aa_gcs("jbart_api", {
	ShowWidget: function(profile,data,context)
	{
		var controlToShowFunc = null; // for auto-tests
		if (aa_paramExists(profile,'ControlToShowInBartContext')) {
			controlToShowFunc = function(data1,ctx) {
				return aa_first(data1,profile,'ControlToShowInBartContext',aa_merge_ctx(context,ctx));
			}
		}

		var ctx = aa_create_jbart_context({
			WidgetXml: aa_first(data,profile,'WidgetXml',context),
			Language: aa_text(data,profile,'_Language',context),
			Context: context			
		});

		var out = aa_show_jbart_widget_page({
			Context: ctx,
			page: aa_text(data,profile,'Page',context),
			success: function(data,ctx) { 
				ajaxart.run(data,profile,'RunAfter',aa_merge_ctx(context,ctx));		
			},
			ControlToShowInBartContext: controlToShowFunc
		});

		return [out];
	}	
});



/* jBart.exec runs a jBart action component
 * It gets the action name (to be seen under xtml components), the data for the action and a jbart context object 
 *   
 * example usage (in foursquare4Ipad app):
 * jBart.exec('SelectCurrentVenueInList','',context);
 */
jBart.exec = function (action_name,data,context)
{
	var profile = aa_parsexml('<xtml t="sample.'+action_name+'" />');
	ajaxart.run([],profile,[data],context);
};
/* jBart.get evaluates a jbart expression
 * It gets the jbart expression, its data, a context object and result type (text/array/xml) 
 * Note that the expression will contain %. To put % in jbart js you need to write \%, otherwise it will be evaluated before compiling  
 * 
 * example usage (in foursquare4Ipad app):
 * var selected = jBart.get('%$FSState/@item%','',context,'text');
 */
jBart.get = function(expression,data,context,result_type)
{
	data = data || '';
	if (!result_type) result_type = 'text';
	context = context || ajaxart.newContext();
	var value = ajaxart.dynamicText([data],expression,context,null,false);
	if (result_type == 'text') return aa_totext(value);
	if (result_type == 'array')	return value;
	if (result_type == 'xml' || result_type == 'native') return value[0];
	if (result_type == 'int') {
		var text = aa_totext(value)
		return text ? parseInt(text) : Number.NaN;
	}
	if (result_type == 'bool') return aa_totext(value) == 'true';
	
	return value[0];
};
/* jBart.set( is used to write a value using a jbart expression (usually to a resource)
 * It gets a jbart expression for the 'to' , the value to set and a context object
 * 'data' is the input for the 'to expression'. E.g. it can be used to set values inside an item
 *  
 * Note that the expression will contain %. To put % in jbart js you need to write \%, otherwise it will be evaluated before compiling  
 * 
 * example usage (in foursquare4Ipad app):
 * jBart.set('\%$FSState/@lat\%',position.coords.latitude,'',context);
 */
jBart.set = function(to_as_expression,value,data,context)
{
	context = context || ajaxart.newContext();
	var to = ajaxart.dynamicText([data],to_as_expression,context,null,false);
	ajaxart.writevalue(to,[value]);
};

aa_gcs("field", {
	CustomControl: function (profile,data,context)
	{
		var field = { isObject : true };
		field.Title = aa_multilang_text(data,profile,'Title',context);
		field.Image = aa_text(data,profile,'Image',context);
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		field.HideTitle = (!aa_bool(data,profile,'ShowTitle',context));
		
		aa_setMethod(field,'Control',profile,'Control',context);

		var newContext = aa_ctx(context,{_Field: [field]} );
		ajaxart.runsubprofiles(data,profile,'FieldAspect',newContext);
		
		return [field];
	},
	Control: function (profile,data,context)
	{
		var field = { isObject : true };
		field.Title = aa_multilang_text(data,profile,'Title',context);
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		field.ReadOnly = true;
		field.HideTitle = aa_bool(data,profile,'HideTitle',context);
		
		var newContext = aa_ctx(context,{_Field: [field]} );
		ajaxart.run(data,profile,'Control',newContext);
		ajaxart.runsubprofiles(data,profile,'FieldAspect',newContext);
		
	    return [field];
	},
	Button: function (profile,data,context)
	{
		var field = { isObject : true };
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		field.HideTitle = (aa_bool(data,profile,'HideTitle',context));

		field.Refresh = function(data1,ctx) {
			field.Title = aa_multilang_text(data,profile,'Title',context);
			field.Image = aa_first(data,profile,'Image',context);
			if (field.Image && field.Image.Url)
			  field.Image.StaticUrl = aa_totext(field.Image.Url(data,context));
			field.Style = aa_first(data,profile,'Style',aa_ctx(context,{_Field: [field]}));
			if (field.Style)
			  field.StyleClass = aa_attach_global_css(field.Style.Css);
		}

		field.Refresh(data,context);
		if (!field.Style) return;
		
		field.Control = function(field_data,ctx) {
			var field = this;
			var style = field.Style;
			if (style.Html == "") return [];
			var jElem = jQuery(style.Html);
			jElem[0].jbContext = aa_merge_ctx(context,ctx);
			if (field.Image && field.Image.Url)
				  field.Image.StaticUrl = aa_totext(field.Image.Url(field_data,context));
			
			var button = aa_api_object(jElem,{image: field.Image, Field: field, data: field_data});
			button.text = button.tooltip = aa_multilang_text(field_data,profile,'ButtonText',context);
			if (aa_paramExists(profile,'Tooltip')) button.tooltip = aa_multilang_text(field_data,profile,'Tooltip',context);
			
			if (button.text == '') button.text = field.Title;
			var initButtonEvents = function(button) {
			  aa_defineElemProperties(button,'Action');
			  
			  button.Action = function(settings) {
				settings = settings || {};
				var e = settings.event;
				var data = settings.data || field_data;
				if (window.aa_incapture) return;
				var itemElem = [ jQuery(button).parents('.aa_item')[0] ];
				if (itemElem[0] == null) itemElem = [];
				var item = (itemElem[0]) ? itemElem[0].ItemData : []; 
				var ctx2 = aa_ctx(aa_merge_ctx(context,ctx),{ControlElement: button.jElem.get(), _ElemsOfOperation: itemElem, _ItemsOfOperation: item });
				if (settings.vars)
					ctx2 = aa_ctx(ctx2,settings.vars);
				if (e) ctx2.vars._DomEvent = [e];
				if (typeof settings.end == 'function') {
					ajaxart_RunAsync(data,ajaxart.fieldscript(profile,'Action'),ctx2,settings.end);
				} else {
					return ajaxart.run(data,profile,'Action',ctx2);
				}
			  }
			}
			initButtonEvents(button);
			aa_apply_style_js(button,field.Style);
			jElem.addClass(field.StyleClass);
			//ajaxart.databind([jElem[0]],field_data,context,profile,data);	// for runtime inspect
			return jElem.get();
		}

		ajaxart.runsubprofiles(data,profile,'FieldAspect',aa_ctx(context,{_Field: [field]}));
		
	    return [field];
	},
	Field1: function (profile,data,context)
	{
		var field = { isObject : true };
		field.Title = aa_multilang_text(data,profile,'Title',context);
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		
		aa_addMethod(field,'FieldData',profile,'FieldData',context);
		aa_addMethod(field,'Control',profile,'Control',context);

		var newContext = aa_ctx(context,{_Field: [field]} );
		ajaxart.runsubprofiles(data,profile,'FieldAspect',newContext);
		ajaxart.run(data,profile,'Multiple',newContext);
		
	    return [field];
	},
	FireOnUpdate: function(profile,data,context)
	{
		var elem = ajaxart.getControlElement(context)[0];
		var td = jQuery(elem).parents('.aa_cell_element')[0];
		if (td == null) return [];
		aa_invoke_field_handlers(td.Field.OnUpdate,elem,null,td.Field,td.FieldData);
		return [];
	}
}); 

aa_gcs("animation", {
	CssBasedAnimation: function (profile,data,context) {
		return [{
			animate: function(elem,ondone) {
				var screen = aa_screen_size(true);
				var ctx2 = aa_ctx(context, { ScreenWidth: [screen.width + "px"], ScreenHeight: [screen.height +"px"]});
				jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'Css',ctx2)));
				jQuery(elem).addClass('beforeAnimation');
				setTimeout(function() { // use timeout to make sure all other modifiers have finished
					aa_addOnAttach(elem,function() {
						jQuery(elem).removeClass('beforeAnimation');
						var transition_end = function() {
							jQuery(elem).removeClass("afterAnimation"); 
							if (ondone)
								ondone(elem);
							elem.removeEventListener('webkitTransitionEnd', transition_end);
							elem.removeEventListener('transitionend', transition_end);
						};
						elem.addEventListener('webkitTransitionEnd', transition_end);
						elem.addEventListener('transitionend', transition_end);
						jQuery(elem).addClass('afterAnimation');
					});
				},1);
			}
		}];
	},
	JQueryShow: function (profile,data,context) {
		var duration = aa_int(data,profile,'Duration',context);
		return [{
			animate: function(elem,ondone) {
				jQuery(elem).hide();
				if (duration == 0) {
					jQuery(elem).show();
					ondone();
				}
				else {
					jQuery(elem).show(duration, "swing", ondone);
				}				
			}
		}];
	},
	Hide: function (profile,data,context) {
		var field_id = aa_text(data,profile,'FieldId',context);
		var animation = aa_first(data,profile,'AnimationType',context);
		if (!animation || !field_id) return [];
		jQuery(aad_find_field(field_id)).each(function(index,field_control) {
			if (field_control && animation) {
				animation.hide(field_control, function() {
					ajaxart.run(data,profile,'OnDone',context);
				});
			}
		});
		return [];
	},
	CssBasedHideAnimation: function (profile,data,context) {
		return [{
			hide: function(elem,ondone) {
				var screen = aa_screen_size(true);
				var ctx2 = aa_ctx(context, { ScreenWidth: [screen.width + "px"], ScreenHeight: [screen.height +"px"]});
				aa_addOnAttach(elem,function() {
					var transition_end = function() {
						if (ondone)
							ondone(elem);
						elem.removeEventListener('webkitTransitionEnd', transition_end);
						elem.removeEventListener('transitionend', transition_end);
					};
					elem.addEventListener('webkitTransitionEnd', transition_end);
					elem.addEventListener('transitionend', transition_end);
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'Css',ctx2)));
				});
			}
		}];
	},
	JQueryHide:function (profile,data,context) {
		var duration = aa_int(data,profile,'Duration',context);
		return [{
			hide: function(elem,ondone) {
				if (duration == 0) {
					jQuery(elem).hide();
					ondone();
				} else {
					jQuery(elem).hide(duration, "swing", ondone);
				}
			}
		}];
	}
});

aa_gcs("scroll", {
	Scroll: function(profile,data,context)
	{
		var field = context.vars._Field[0];
		field.Scroll = aa_first(data,profile,'Scroll',context);
		if (field.Scroll && field.Scroll.Load) field.Scroll.Load([],context);  // load js files etc.
		var paddingRight = aa_text(data,profile,'PaddingRight',context);
		
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			if (field.Scroll && field.Scroll.OnModifyControl) field.Scroll.OnModifyControl([],aa_ctx(context,{ControlElement: [cell]}));
			aa_addOnAttach(cell,function() {
				var elem = cell.firstChild; // scrolling is done on 'content', and can use parentNode for the cell
				if (!elem) return;
//				if (elem.tagName.toLowerCase() == 'td' && elem.firstChild) // scrolling is done better on 'div' rather on 'td'
//					elem = elem.firstChild;
				var ctx2 = aa_ctx(context,{ControlElement: [elem]});
				elem.jbScroll = field.Scroll;
				if (field.Scroll && field.Scroll.Prepare) field.Scroll.Prepare([],ctx2);
				if (elem.ScrollElement) // allow changing the scroll element
					ctx2 = aa_ctx(context,{ControlElement: [elem.ScrollElement]});  
//				jQuery(ctx2.vars.ControlElement[0]).addClass(aa_attach_global_css(aa_text(data,profile,'Css',context)));

				ajaxart.run(data,profile,'Height',ctx2);  // set the height
				ajaxart.run(data,profile,'Width',ctx2); // set the width
				ctx2.vars.ControlElement[0].jbSizeChanged = function() {	// when device causes size change like resize or orientation change
					if (field.Scroll.SizeChanged)
						field.Scroll.SizeChanged([],ctx2);
				}
				
				if (field.Scroll && field.Scroll.Activate) field.Scroll.Activate([],ctx2);
				if (paddingRight) $(elem).css('padding-right',paddingRight);
			});
		});
	},
	BrowserScrollbar: function (profile,data,context)
	{
		return [{ isObject: true,
			Activate: function(data1,ctx) {
				this.Control = ctx.vars.ControlElement[0];
				if (this.Control.parentNode.tagName.toLowerCase() != 'td') this.Control = this.Control.parentNode;
						
				jQuery(ctx.vars.ControlElement).css('overflow','auto');
			},
			ScrollToBottom: function() {
				this.Control.scrollTop = this.Control.scrollHeight;
			}
		}];
	},
	NoScroll: function (profile,data,context)
	{
		var cls = aa_attach_global_css(aa_text(data,profile,'Css',context));
		return [{ 
			isObject: true,
			OnModifyControl : function(data1,ctx) {
				jQuery(ctx.vars.ControlElement).addClass(cls);
			}
		}];
	},
	Scroll2: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		
		field.ScrollStyle = aa_first(data,profile,'Style',context);
		field.ScrollWidth = aa_first(data,profile,'Width',context);
		field.ScrollHeight = aa_first(data,profile,'Height',context);
		var topClass = aa_attach_global_css(field.ScrollStyle.Css,context);
			
		aa_field_handler(field,'ModifyCell',function(cell,field_data,cell_presentation,ctx,item)
		{
			var content = cell.firstChild || cell;
			var topDiv = content;
			while (topDiv && ",table,tbody,tr,td,".indexOf(topDiv.tagName.toLowerCase()) > -1) {
				topDiv = topDiv.parentNode;
			}
			var scroll = field.ScrollObject = aa_renderStyleObject(field.ScrollStyle,{
				ScrollHeight: field.ScrollHeight,
				ScrollWidth: field.ScrollWidth,
				fixSize: function(element) {
				  if (field.ScrollHeight) field.ScrollHeight.apply(element);
				  if (field.ScrollWidth) field.ScrollWidth.apply(element);
				},
				init: function(settings) {
					this.refresh = settings.refresh;
					this.requiresDivWrapper = settings.requiresDivWrapper;
				},
				body: content,
				topDiv: topDiv
			},ctx);
			
			if (field.ScrollHeight) jBart.bind(field.ScrollHeight,'update',function() { field.ScrollObject.refresh(); });
			if (field.ScrollWidth) jBart.bind(field.ScrollWidth,'update',function() { field.ScrollObject.refresh(); });
			
			if (field.ScrollObject.requiresDivWrapper) {
				aa_addOnAttach(content,function() {
					var parent = topDiv.parentNode;
					scroll.divWrapper = jQuery('<div class="aa_scroll_wrapper"/>').addClass(topClass).append(topDiv)[0];
					parent.appendChild(scroll.divWrapper);
					field.ScrollObject.refresh();	
				});
			} else {
				jQuery(topDiv).addClass(topClass);
				field.ScrollObject.refresh();
			}
		});	
	},
	IScroll: function (profile,data,context)
	{
		var out = { isObject: true }
		out.Load = function() {
			if (window.IScroll || window.loading_iscroll4) return;
			window.loading_iscroll4 = true;
			var path = aa_text(data,profile,'JsLocation',context);
			aa_load_js_css(path, 'js');
		}
		out.OnModifyControl = function(data1,ctx) {
			jQuery(ctx.vars.ControlElement).css('overflow','auto'); 
		}
		out.Prepare = function(data1,ctx) {
			var wrapper = document.createElement('DIV');
			var elem = ctx.vars.ControlElement[0];
			elem.ScrollElement = wrapper;
	        elem.parentNode.appendChild(wrapper);
			wrapper.appendChild(elem);
			wrapper.jbScrolledElem = elem;
		}
		out.Activate = function(data1,ctx) {
			var paramsToEval = "var params = " + aa_text(data,profile,'ScrollParams',context) + ';';
			eval(paramsToEval);

			if (window.iScroll) {
				var elem = ctx.vars.ControlElement[0];
				
				elem.IScroll = new iScroll(elem,params);
				if (elem.jbScrolledElem) elem.jbScrolledElem.IScroll = elem.IScroll;
				setTimeout(function() {elem.IScroll.refresh()},200);
				elem.contentChanged = function() { this.IScroll.refresh(); }
				out.elem = elem;
			} else {
				jQuery(ctx.vars.ControlElement).css('overflow','hidden');
				setTimeout(function() { out.Activate(data1,ctx)} ,500 );
			}
		}
		out.Refresh = function(data1,ctx) {
			this.elem.IScroll.refresh();
		}
		out.ScrollToBottom = function(time, onlyIfNeeded) {
			if (!time) time = 200;
			if (!onlyIfNeeded || this.elem.scrollHeight > this.elem.clientHeight)
				this.elem.IScroll.scrollTo(0, this.elem.clientHeight - this.elem.scrollHeight,time,false);
		}
		return [out];
	},
	TinyScroll: function (profile,data,context)
	{
		var out = { isObject: true }
		out.Load = function() {
			if (window.IScroll || window.loading_tinyscroll) return;
			window.loading_tinyscroll = true;
			var path = aa_text(data,profile,'JsLocation',context);
			jQuery('body').append('<script type="text/javascript" src="'+path+'"></script>');
		}
		out.OnModifyControl = function(data1,ctx) {
			jQuery(ctx.vars.ControlElement).css('overflow','auto'); 
		}
		out.Prepare = function(data1,ctx) {
		    var wrapper = jQuery('<div class="tscrollbar">\
	                <div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>\
	                <div class="viewport"><div class="overview"></div></div></div>');

	        var width = aa_text(data,profile,'Width',context);
	        if (width != '') wrapper.width(width);
	        
        	var cls = aa_attach_global_css(aa_text(data,profile,'Css',context));
        	wrapper.addClass(cls);
        	
	        var elem = ctx.vars.ControlElement[0];
	        
	        var scrollElem = elem.ScrollElement = wrapper.find('.viewport')[0];
	        var top = elem.parentNode;
	        top.appendChild(wrapper[0]);
		    wrapper.find('.overview').append(elem);
		    scrollElem.Scroll = wrapper;
		    scrollElem.contentChanged = function() { 
		    	setTimeout(function() {scrollElem.Scroll.tinyscrollbar_update();},10); 
		    }
		}
		out.Activate = function(data1,ctx) {
	    	setTimeout(function() { 
				var scrollElem = ctx.vars.ControlElement[0];
				out.scrollElem = scrollElem; 
	    		if (scrollElem.Scroll.tinyscrollbar) {
	    			scrollElem.Scroll.tinyscrollbar(); 
	    			scrollElem.Scroll.tinyscrollbar_update();
	    		}
	    	},1);
		}
		out.ScrollToBottom = function() {
			this.scrollElem.Scroll.tinyscrollbar_update('bottom');
		}
		
		return [out];
	},
	DeviceBottom: function (profile,data,context)
	{
		if (ajaxart.inPreviewMode) return;
		
		var elem = context.vars.ControlElement[0];
		elem.HeightDelta = aa_int(data,profile,'Delta',context);
		var cls_for_delta = aa_text(data,profile,'HtmlClassForDelta',context);
		if (cls_for_delta && jQuery("." + cls_for_delta).length > 0)
			elem.HeightDelta = jQuery("." + cls_for_delta)[0].offsetHeight + (elem.HeightDelta ? elem.HeightDelta : 0);

	    elem.StretchHeight = function() {
	    	ajaxart.ui.HeightToWindowBottom(this,this.HeightDelta);
	    }
	    setTimeout(function() { elem.StretchHeight();},100);

	    aa_addWindowResizeListener(elem,function() { elem.StretchHeight(); });
		jQuery(elem).addClass('aa_resize_bind');
		jBart.bind(elem,"WindowResize",elem.StretchHeight);
	},
	DeviceRight: function (profile,data,context)
	{
		if (ajaxart.inPreviewMode) return;

		var elem = context.vars.ControlElement[0];
		elem.WidthDelta = aa_int(data,profile,'Delta',context);
		jQuery(elem).addClass('aa_mobile_stretch');
	    elem.StretchWidth = function() {
	    	aa_widthToWindowRight(this,this.WidthDelta);	
	    }
	    setTimeout(function() { elem.StretchWidth();},100);
	    

	    aa_addWindowResizeListener(elem,function() { elem.StretchWidth(); });
	    
		jQuery(elem).addClass('aa_resize_bind');
		jBart.bind(elem,"WindowResize",elem.StretchWidth);
	},
	FixedHeight: function (profile,data,context)
	{
		if (ajaxart.inPreviewMode) return;
		var height = aa_text(data,profile,'Height',context);
		if (!ajaxart.isIDevice) {
			var height2 = aa_text(data,profile,'HeightForNonMobile',context);
			if (height2 != '') height = height2; 
		}
		var cell = context.vars.ControlElement[0];
		if (height != '') 
			cell.style.height = height;
	},
	FixedWidth: function (profile,data,context)
	{
		if (ajaxart.inPreviewMode) return;
		var width = aa_text(data,profile,'Width',context);
		if (!ajaxart.isIDevice) {
			var width2 = aa_text(data,profile,'WidthForNonMobile',context);
			if (width2 != '') width = width2; 
		}
		if (width != '' && context.vars.ControlElement) context.vars.ControlElement[0].style.width = width;
	}
});

aa_gcs("scroll_size", {
	FixedHeight: function (profile,data,context)
	{
	  var height = aa_int(data,profile,'Height',context);
	  var applyOn = aa_text(data,profile,'ApplyOn',context);
	  return [{
		 apply: function(elem,delta) {
		 	if (!delta) delta = 0;
		 	jQuery(elem).css(applyOn,height-delta + "px");
		  }
	  }];
	},
	FixedWidth: function (profile,data,context)
	{
	  var width = aa_int(data,profile,'Width',context);
	  var applyOn = aa_text(data,profile,'ApplyOn',context);
	  return [{
		 apply: function(elem,delta) {
		 	if (!delta) delta = 0;
		 	jQuery(elem).css(applyOn,width-delta + "px");
		  }
	  }];
	},
	DeviceWidth: function(profile,data,context)
	{
		var field_delta = aa_text(data,profile,'ReduceWidthOfOtherField',context);
		var stretch = aa_bool(data,profile,'StretchFromCurrentLocation',context);
		var pixels_delta = aa_int(data,profile,'ReducePixels',context);
		var applyOn = aa_text(data,profile,'ApplyOn',context);
		var percentages = parseInt(aa_text(data,profile,'Percentages',context).replace("%",""));
		
		aa_init_onresize();
		
		return [{
			apply: function(elem,extra_delta) {
				function fix_size() {
					var delta = extra_delta ? extra_delta : 0;
					var width = aa_screen_size(true).width;
					if (percentages && !isNaN(percentages))
						width *= percentages/100;
					if (field_delta && aad_find_field(field_delta)[0])
					 	delta += aad_find_field(field_delta,'',true)[0].offsetWidth;
					if (pixels_delta)
						delta += pixels_delta;
					if (stretch)
						aa_widthToWindowRight(elem,delta,applyOn);
					else
						jQuery(elem).css(applyOn,width-delta + "px");
				}
				if (field_delta)
					aa_addOnAttachMultiple(elem, function() { setTimeout(fix_size,1); } );	// we use time-out so offsetWidth is valid
				else if (stretch)
					aa_addOnAttachMultiple(elem, fix_size );
				else
					fix_size();

				aa_attach_window_resize(fix_size,elem);
			}
		}]
	},
	DeviceHeight: function(profile,data,context)
	{
		var field_delta = aa_text(data,profile,'ReduceHeightOfOtherField',context);
		var stretch = aa_bool(data,profile,'StretchFromCurrentLocation',context);
		var pixels_delta = aa_int(data,profile,'ReducePixels',context);
		var applyOn = aa_text(data,profile,'ApplyOn',context);
		var percentages = parseInt(aa_text(data,profile,'Percentages',context).replace("%",""));
		
		aa_init_onresize();
		
		return [{
			apply: function(elem,delta) {
				var fix_size = function() {
					var delta = 0;
					var height = aa_screen_size(true).height;
					if (percentages && !isNaN(percentages))
						height *= percentages/100;
					if (field_delta && aad_find_field(field_delta)[0])
					 	delta += aad_find_field(field_delta,'',true)[0].offsetHeight;
					if (pixels_delta)
						delta += pixels_delta;
					if (stretch)
						ajaxart.ui.HeightToWindowBottom(elem,delta,applyOn);
					else
						jQuery(elem).css(applyOn,height-delta + "px");
				}
				if (field_delta)
					aa_addOnAttachMultiple(elem, function() { setTimeout(fix_size,1); } );	// we use time-out so offsetWidth is valid
				else if (stretch)
					aa_addOnAttachMultiple(elem, fix_size );
				else
					fix_size();

				fix_size();
				
				aa_attach_window_resize(fix_size,elem);
			}
		}];
	}
});
aa_gcs("field_control", {
	Image: function (profile,data,context) // GC of field_control.Image
  {
		var field = context.vars._Field[0];
		var defaultImage = aa_text(data,profile,'DefaultImage',context);

		field.Control = function(field_data,ctx) {
			var image = aa_first(field_data,profile,'Image',context);
			if (image && image.Url)
			  image.StaticUrl = aa_totext(image.Url(field_data,context)) || defaultImage;

			var image2 = aa_create_static_image_object(image);			
			var style = aa_first(data,profile,'Style',context);
			
			return [aa_renderStyleObject(style,{ Field: field, image: image2, data: field_data[0] },context,true)];
		};
  },
	CustomXtmlControl: function (profile,data,context)
  {
			var field = aa_create_base_field(data, profile, context);
			field.Control = function(field_data,ctx) {
				return ajaxart.run(field_data,profile,'Control',aa_merge_ctx(context,ctx));
			};
			return [field];
  },
  CustomControlOld: function (profile,data,context)
  {
		var field = context.vars._Field[0];
		field.Control = function(field_data,ctx) {
			var style = ajaxart.runNativeHelper(field_data,profile,'StyleObject',context)[0];
			
			return [aa_renderStyleObject(style,{ Field: field, Data: field_data },context)];
		}
  } 
});
aa_gcs("field_feature", {
	Css: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var css = aa_text(data,profile,'Css',context);
		aa_field_handler(field,'ModifyCell',function(cell,field_data,cell_presentation,ctx,item)
		{
			var cls = aa_attach_global_css(css,null,field.Id,true,false,ctx);
			jQuery(cell).addClass(cls+'_wrapper');
			var content = cell.firstChild || cell;
			jQuery(content).addClass(cls);
		},null,200);	
	},
	CssClass: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		var to = aa_text(data,profile,'AddClassTo',context);
		aa_bind(field,'ModifyCell',function(args) {
			var cssClass = aa_text(args.FieldData,profile,'ClassName',context);
			var passCondition = aa_bool(args.FieldData,profile,'ConditionForClass',context);
			if (passCondition) {
				var elem = args.Wrapper;
				if (to == 'content') elem = args.Wrapper.firstChild || args.Wrapper;

				$(elem).addClass(cssClass);
			}
		});
	}
});

function aa_init_onorientchange_MobileDeviceStretchBottomRight()
{
    if (window.aa_onorientchange_MobileDeviceStretchBottomRight) return;
    
    window.aa_MobileDeviceBottomRight_orientation = function(orient) {
	  var elems = jQuery('.aa_mobile_stretch');
	  for(var i=0;i<elems.length;i++) {
		  if (elems[i].StretchHeight) elems[i].StretchHeight();
		  if (elems[i].StretchWidth) elems[i].StretchWidth();

	      if (elems[i].IScroll) elems[i].IScroll.refresh();
	  }
    }
    aa_addEventListener(window,"resize", aa_MobileDeviceBottomRight_orientation, false);
//    aa_add_onorientationchange(aa_MobileDeviceBottomRight_orientation);
}


function aa_create_text_filter(matchOnlyTextBeginning)
{
	return function(initialFilterData)
	{
		var CompileFilterData = function(filter_data)
		{
			var txt = aa_totext(filter_data);
			if (txt == '') return [];
			return txt.toLowerCase().split(',');
		}
		return	{
			TextFilter: true,
			filterData: CompileFilterData(initialFilterData),
			SetFilterData: function(filterData) { this.filterData = CompileFilterData(filterData); }, 
			ToSQLText: function(rawData) { return ajaxart.totext_array(rawData) },
			Match: function(field,wrapper)
			{
				if (this.filterData.length == 0) return true;
				for(var i in this.filterData)
				{
					var index = ('' + wrapper[field.Id]).toLowerCase().indexOf(this.filterData[i]);
					var result = matchOnlyTextBeginning ? index == 0 : index > -1;
					if (result) return true;
				}
				return false;
			},
			HighlightSelectedText: function(control,selectedClass) {
  				var pattern = this.filterData[0];
  				
				if (control.innerHTML.toLowerCase().indexOf(pattern) != -1)
				   control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,pattern,selectedClass);
			}
		}
	};
}

function aa_create_search_words_text_filter(matchOnlyTextBeginning)
{
	return function(initialFilterData)
	{
		var CompileFilterData = function(filter_data)
		{
			var text = aa_totext(filter_data).toLowerCase();
			
			var pattern = { searchWordsPattern: true };
			pattern.text = text;
			
			var pp = pattern.text.split(' ');
			pattern.p1 = (pp.length > 0 && ' ' + pp[0]);
			pattern.p2 = (pp.length > 1 && ' ' + pp[1]);
			pattern.p3 = (pp.length > 2 && ' ' + pp[2]);
			pattern.p4 = (pp.length > 3 && ' ' + pp[3]);
			pattern.words = pp.length;
			
			return pattern;
		}
		return	{
			TextFilter: true,
			filterData: CompileFilterData(initialFilterData),
			SetFilterData: function(filterData) { this.filterData = CompileFilterData(filterData); }, 
			ToSQLText: function(rawData) { return ajaxart.totext_array(rawData) },
			Match: function(field,wrapper)
			{
				var pattern = this.filterData; 
				if (!pattern) return true;
				
				var val = wrapper[field.Id];
				var s = ' ' + val.toLowerCase().replace(/^\s*|\s*$/g, ' ');
				var words_found = 0,show_first=false;
				
				var p1 = pattern.p1;
				if (pattern.words > 1) {
					if (p1 && s.indexOf(p1) != -1) words_found++;
					if (pattern.p2 && s.indexOf(pattern.p2) != -1) words_found++;
					if (pattern.p3 && s.indexOf(pattern.p3) != -1) words_found++;
					if (pattern.p4 && s.indexOf(pattern.p4) != -1) words_found++;
					if (words_found == pattern.words) {
						show_first = true;
					} 
				} else if (s.indexOf(p1) == 1) {	// starts with pattern
					show_first = true;
				} else if (s.indexOf(p1) > 0) {
					words_found++;
				}

				if (show_first || words_found == pattern.words) return true;
				return false;
			},
			HighlightSelectedText: function(control,selectedClass) {
  				var pattern = this.filterData;
  				var p1,p2,p3,p4;  // TODO: for on pattern.words
  			    if (pattern.p1) p1 = pattern.p1.substring(1); 
  			    if (pattern.p2) p2 = pattern.p2.substring(1); 
  			    if (pattern.p3) p3 = pattern.p3.substring(1);// remove space prefix
  			    if (pattern.p4) p4 = pattern.p4.substring(1);
  				
  	    		if (p1 && control.innerHTML.toLowerCase().indexOf(p1) != -1)
  	    			control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,p1,selectedClass);
  	    		if (p2 && control.innerHTML.toLowerCase().indexOf(p2) != -1)
  	    			control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,p2,selectedClass);
  	    		if (p3 && control.innerHTML.toLowerCase().indexOf(p3) != -1)
  	    			control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,p3,selectedClass);
  	    		if (p4 && control.innerHTML.toLowerCase().indexOf(p4) != -1)
  	    			control.innerHTML = ajaxart_field_highlight_text(control.innerHTML,p4,selectedClass);
			}
		}
	};
}

function aa_addWindowResizeListener(element,callback)
{
	window.aavar_resizeListeners = window.aavar_resizeListeners || [];
	aavar_resizeListeners.push( {element: element, callback: callback } );
	
	if (!window.aavar_resizeCallback) {
		window.aavar_resizeCallback = function() 
		{
			var newListeners = [];
			for(var i=0;i<aavar_resizeListeners.length;i++) {
				try {
					if (ajaxart.isattached(aavar_resizeListeners[i].element)) {
						newListeners.push( aavar_resizeListeners[i] );
						aavar_resizeListeners[i].callback();
					}
				} catch(e) {
					ajaxart.logException('exception in window resize',e);
				}
			}
			aavar_resizeListeners = newListeners;
		}
	  aa_addEventListener(window,"resize", aavar_resizeCallback );
	}
}
function aa_init_class(className, prototypeFunctions) {
  if (!ajaxart.classes[className]) {
    ajaxart.classes[className] = function(settings) {
      aa_extend(this, settings);
      if (this._ctor) this._ctor();
    };
    aa_extend(ajaxart.classes[className].prototype, prototypeFunctions);
  }
}

function aa_find_bart_context(elem) {
  for (; elem && elem.nodeType == 1; elem = elem.parentNode) {
    if (elem.jbContext) {
      var bartcontext = aa_var_first(elem.jbContext, '_AppContext');
      if (bartcontext) return bartcontext;
    }
  }
  return null;
}

function aa_getItemData(object) {
  var context = object.context;
  if (!context && object.vars && object.params) context = object;
  // TODO: handle a case where object is a html element

  return context.vars.Item || [];
}

function aa_scrollToShowElement(elem, direction, margins) {
  // Consider using scrollIntoView (DOM)
  // TODO: handle scrolling down + use the direction parameter

  direction = direction || ''; // direction can be: 'up','down' or ''

  var iter = elem;
  var parent = iter && iter.parentNode;
  margins = margins || {
    top: 0,
    bottom: 0
  };

  while (parent && parent.nodeType == 1 && parent.tagName.toLowerCase() != 'html') {
    var overflowy = $(parent).css('overflow-y');
    if (overflowy == 'scroll' || overflowy == 'auto' || parent == document.body) {

      var newScrollTop = parent.scrollTop + $(iter).position().top - $(parent).position().top - margins.top;
      newScrollTop = Math.max(0,newScrollTop);

      $(parent).scrollTop(newScrollTop);

      // var top = aa_relTop(iter, parent) - margins.top;
      // if (parent == document.body && jBart.headerHeight) {
      //   top -= jBart.headerHeight;
      // }

      // if (top < $(parent).scrollTop()) {
      //   $(parent).scrollTop(top);
      //   iter = parent;
      // }
    }
    parent = parent.parentNode;
  }
}

function aa_isParent(child, parent) {
  for (var iter = child; iter && iter.nodeType == 1; iter = iter.parentNode) {
    if (iter == parent) return true;
  }
  return false;
}

function aa_registerHeaderEvent(thead, eventType, func, ownerId, activation_mode) {
  if (thead.EventHandler == null) {
    aa_defineElemProperties(thead, 'handlers,EventHandler');
    thead.handlers = [];
    thead.EventHandler = function(e) {
      var elem = jQuery((typeof(event) == 'undefined') ? e.target : (event.tDebug || event.srcElement));
      e = e || event; // IE
      if (elem.hasClass('fieldtitle_info')) return false; // a bit ugly. it has its own handler

      if (elem.hasClass('fieldtitle')) var th = elem;
      else var th = elem.parents('th');
      if (th.length == 0) return true;

      if (e.type == 'mousedown') thead.LastMouseDown = {
        th: th[0]
      };
      if (e.type == 'mouseout') thead.LastMouseDown = null;

      for (var i = 0; i < thead.handlers.length; i++) {
        var handler = thead.handlers[i];
        if (handler.eventType != e.type) continue;
        if (e.button == 2) {
          if (handler.activation_mode == 'right mouse') handler.func(e, thead, th[0]);
        } else {
          var activate = (handler.activation_mode == 'no dominant' && thead.Owner == null) || (handler.activation_mode == 'suspect' && thead.Suspect != null && thead.Owner == null) || (handler.activation_mode == 'dominant' && thead.Owner == handler.ownerId);
          if (activate) handler.func(e, thead, th[0]);
        }
      }
    }
    thead.onmousedown = thead.onmouseout = thead.onmouseup = thead.onmousemove = thead.EventHandler;
  }
  thead.handlers.push({
    eventType: eventType,
    func: func,
    ownerId: ownerId,
    activation_mode: activation_mode
  })
}

function aa_empty(elem, clearMemoryLeaks) {
  var children = [];
  while (elem.firstChild) aa_remove(elem.firstChild, clearMemoryLeaks);
  aa_clear_virtual_inner_element(elem);
}

function aa_clear_virtual_inner_element(elem) {
  if (!elem.virtual_inner_elements) return;
  for (var i = 0; i < elem.virtual_inner_elements.length; i++) {
    aa_empty(elem.virtual_inner_elements[i]);
  }
}

function aa_bind_ui_event(elem, event1, func1) {
  if (!elem) return;
  if (event1 == "mouserightclick") {
    // Disable browser context menu (requires both selectors to work in IE/Safari + FF/Chrome)
    jQuery(elem).bind('contextmenu', function() {
      return false;
    });

    jQuery(elem).mousedown(function(e) {
      var evt = e;
      if (evt.button == 2) {
        aa_xFireEvent(this, 'click', null); // right-click is also click (for element selection)
        ajaxart.ui.lastEvent = (e) ? e : window.event;
        func1(e);
        ajaxart.ui.lastEvent = null;
        return false;
      }
      return true;
    });
    return;
  }
  if (elem.addEventListener) elem.addEventListener(event1, func1, false);
  else if (elem.attachEvent) {
    elem.attachEvent("on" + event1, func1);
    elem.jbEvents = elem.jbEvents || [];
    elem.jbEvents.push({
      event: "on" + event1,
      callback: func1
    });
  }
}

function aa_absLeft(elem, ignoreScroll) {
  if (elem == null) return 0;
  var orig = elem,
    left = 0,
    curr = elem;
  // This intentionally excludes body which has a null offsetParent.
  if (!ignoreScroll) {
    while (curr && curr.tagName && curr.tagName.toLowerCase() != 'body') {
      left -= curr.scrollLeft;
      curr = curr.parentNode; // scroll can not be calculated using offsetParent!
    }
  }
  while (elem) {
    left += elem.offsetLeft;
    elem = elem.offsetParent;
  }
  return left;
}

function aa_absTop(elem, ignoreScroll) {
  var top = 0,
    orig = elem,
    curr = elem;
  // This intentionally excludes body which has a null offsetParent.
  if (typeof(ignoreScroll) == "undefined") ignoreScroll = false;
  if (!ignoreScroll) {
    while (curr && curr.tagName && curr.tagName.toLowerCase() != 'body') {
      top -= curr.scrollTop;
      curr = curr.parentNode;
    }
  }
  while (elem) {
    top += elem.offsetTop;
    elem = elem.offsetParent;
  }
  return top;
}

function aa_relTop(elem, parent) {
  var top = 0,
    orig = elem,
    curr = elem;
  // This intentionally excludes body which has a null offsetParent.
  if (typeof(ignoreScroll) == "undefined") ignoreScroll = false;
  if (!ignoreScroll) {
    while (curr && curr.tagName && curr != parent) {
      top -= curr.scrollTop;
      curr = curr.parentNode;
    }
  }
  while (elem && elem != parent) {
    top += elem.offsetTop;
    elem = elem.offsetParent;
  }
  return top;
}

function aa_mousePos(e, removeWindowScroll) {
  var out = {};
  if (typeof(event) != 'undefined') var e = window.event;

  if (e.pageX || e.pageY) {
    out = {
      x: e.pageX,
      y: e.pageY
    };
  } else if (e.clientX || e.clientY) {
    var posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
    var posy = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
    out = {
      x: posx,
      y: posy
    }
  }
  if (removeWindowScroll && out.y) out.y -= (window.pageYOffset || 0);
  if (removeWindowScroll && out.x) out.x -= (window.pageXOffset || 0);

  return out;
}

function aa_addWindowResizeEvent(elem, callback) {
  if (window.removeEventListener) window.removeEventListener('resize', callback);
  else window.detachEvent('resize', callback);

  aa_addEventListener(window,'resize', callback);

  aa_addOnDetach(elem, function() {
    aa_removeEventListener(window,'resize', callback);
  });

}
aa_gcs("ui", 
{
  Image: function (profile,data,context)
  {
	var src = aa_text(data,profile,'Source',context);
	var title = ajaxart_multilang_text(aa_text(data,profile,'Title',context),context);
	var width = aa_text(data,profile,'Width',context);
	var height = aa_text(data,profile,'Height',context);
	var out = jQuery('<img />')[0]; 
	out.setAttribute("src",src);
	out.setAttribute("title",title);
	if (height != "")
	  out.setAttribute('height',height);
	if (width != "") 
		out.setAttribute('width',width);
	if (ajaxart.subprofiles(profile,'OnClick') != null)
		out.className = 'clickable';
	jQuery(out).click(function() {
		if (window.aa_incapture) return;
		ajaxart.run(data,profile,"OnClick",aa_ctx(context,{ControlElement: [this]}));
	});
	return [out];
  },
  HtmlControl: function (profile,data,context)
  {
	  var html = aa_text(data,profile,'Html',context);
	  var css = aa_text(data,profile,'Css',context);
	  var div = document.createElement("DIV");
	  if (aa_bool(data,profile,'WordWrap',context))
		  div.style.whiteSpace = "normal";
	  div.innerHTML = html;
	  if (css != "")
		  div.className = aa_attach_global_css(css);
	  return [div];
  },
  Text: function (profile,data,context)  // GC of ui.Text
  {
	  var text = aa_text(data,profile,'Text',context);
	  var style = aa_text(data,profile,'Style',context);
	  var multiLang = aa_bool(data,profile,'MultiLang',context);
	  
	  if (multiLang)
	  	text = aa_text([text],aa_parsexml('<s t="text.MultiLang" Pattern="%%" Dynamic="true"/>'),'',context);
	  if (! aa_bool(data,profile,'HtmlContents',context))
		text = text.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br/>");
      var span = document.createElement("span");
 	  if (style != "")
 		 aa_setCssText(span,style);
 	  span.className = "ajaxart_text";
 	  span.innerHTML = text;
 	  
 	  var hint = aa_text(data,profile,'Hint',context);
 	  if (hint != "") span.setAttribute('title',hint);
 	  
 	  return [span];
  },
  ControlWithAction: function (profile,data,context)
  {
	  ajaxart.run(data,profile,'RunBeforeControl',context);
	  var out = ajaxart.run(data,profile,'Control',context);
	  var newcontext = aa_ctx(context, { ControlElement: out, _ElemsOfOperation: out});
	  if (aa_bool(data,profile,'RunAfterControlWithTimer',context)) {
	    var timeout = 1;
	    if (ajaxart.isSafari) timeout = 100;
	    setTimeout(function() { ajaxart.run(data,profile,'RunAfterControl',newcontext); }  ,timeout); 
	  }
	  else
		  ajaxart.run(data,profile,'RunAfterControl',newcontext);
	  return out;
  },
  DataBind: function(profile,data,params)
  {
	var newData = ajaxart.getVariable(params,"InputForChanges");
    var script = aa_first(data,profile,'Script',params);
	var element = data;
	
	ajaxart.databind(element,newData,params,script);
	
	return data;
  },
  ElementOfClass : function(profile, data, params) {
	  	var cls = aa_text(data,profile,'Cls',params);
	  	var onlyFirst = aa_bool(data,profile,'OnlyFirst',params);
	  	var down = ( aa_text(data,profile,'Direction',params) == 'down');
	  	
	  	var child;
	  	if (!ajaxart.ishtml(data)) { ajaxart.log("ElementOfClass - input is not html","error"); return []; }
	  	var index = 0;
	  	var elements_queue = [];
	  	if (down)
	  		elements_queue.push(data[0]);
	  	else {
	  		if (data[0].parentNode != null)
	  			elements_queue.push(data[0].parentNode);
	  	}
	  	
	  	var out = [];
	  	while (index < elements_queue.length) {
	  		var element = elements_queue[index];
	  		index++;
	 		
	  		if (jQuery.inArray( cls, element.className.split(/\s+/) ) > -1 )
	  			if (onlyFirst)
	  				return [element];
	  			else
	  				out.push(element);
	  		
	  		if (down)
	  		{
		  		child = element.firstChild;
		  		while (child != null) {
		  			if (child.nodeType == 1)// element
		  				elements_queue.push(child);
		  			child = child.nextSibling;
		  		}
	  		} 
	  		else {
	  			if (element.parentNode != null && element.parentNode.nodeType == 1) 
	  				elements_queue.push(element.parentNode);
	  		}
	  	}
	  	return out;
	  },
	  HasClass: function (profile,data,context)
	  {
		  var cls = aa_text(data,profile,'Cls',context);
		  if ( jQuery(data).hasClass(cls) )
			  return ["true"];
		  return [];
	  },
	  Html: function (profile,data,params)
	  {
	    var html = aa_text(data,profile,'Html',params);
	    var tag = aa_text(data,profile,'Tag',params);
	    var dynamicContent = aa_bool(data,profile,'DynamicContent',params);

	    if (html == "") {
	    	html = aa_xml2htmltext(ajaxart.childElem(profile,"*"));
	    	if (dynamicContent)
	    		html = ajaxart.dynamicText(data,html,params,data,false,true)[0];
	    }
		if (tag != "") {
			var out = document.createElement(tag);
			out.innerHTML = html;
			return [out];
		}
		else {
			if (html == null) return [];
			return [jQuery(html)[0]];
		}
	  },
	  ControlWithCss: function (profile,data,context)
	  {
		var control = ajaxart.run(data,profile,'Control',context);
		var css = aa_text(data,profile,'Css',context);
		jQuery(control).addClass(aa_attach_global_css(css));
		return control;
	  },
	  ItemList: function (profile,data,context,override_items,override_aspects)
	 	{
		    var id = aa_string2id(aa_text(data,profile,'ID',context));
	 		var cntr = { ID: [id] , isObject: true }
	 		
		    var newcontext = aa_ctx(context,{_ParentCntr: context.vars._Cntr, _Cntr : [cntr]} );
	 		if (aa_bool(data,profile,'DataHolderCntr',context))
	 			newcontext = aa_ctx(newcontext,{DataHolderCntr: [cntr]});
	 		
	 		var data_items;
	 		if (aa_paramExists(profile,'DataHolder') && !override_items)
	 		{
	 			cntr.DataHolder = dataholder = aa_first(data,profile,'DataHolder',newcontext);
	 			cntr.Fields = dataholder.Fields;
	 			cntr.Items = data_items = [{isObject: true, Items: dataholder.Wrappers}];
	 			newcontext = aa_ctx(newcontext,{DataHolderCntr: [cntr], _Items: data_items});
	 		}
	 		else
	 		{
	 			data_items = override_items || ajaxart.run(data,profile,'Items',newcontext);
	 			if (!data_items[0]) data_items = [{Items:[]}];
	 			cntr.Items = data_items;
	 			ajaxart.setVariable(newcontext,"_Items",data_items);
	 			var ctx4 = aa_ctx(newcontext,{_FormulaInput: data_items[0].Items});
			    var fields = ajaxart.runsubprofiles(data,profile,'Field',ctx4);
			    ajaxart.concat(fields,ajaxart.run(data,profile,'Fields',ctx4));
	 			
	 			cntr.Fields = fields;
	 		}
			if (override_aspects)
		      var aspects = override_aspects;
			else {
			  var aspects = ajaxart.run(data,profile,'Presentation',newcontext);
			  aspects = aspects.concat(ajaxart.runsubprofiles(data,profile,'Aspect',newcontext));
			}
			for(var i=0;i<cntr.Fields.length;i++)
				if (cntr.Fields[i].CntrAspects)
				{
					var fld_aspects = cntr.Fields[i].CntrAspects;
					for(var j=0;j<fld_aspects.length;j++)
						aspects.push(fld_aspects[j].GetContent(data,newcontext)[0]);
				}

		    // takeover - used by GroupBy aspect to duplicate container in groups
		    var orignalItemListFunc = function(newcontext) { return function(override_items,override_aspects) {
		    	return ajaxart.gcs.ui.ItemList(profile,data,newcontext,override_items,override_aspects);
		    }}
		    for(var i=0;i<aspects.length;i++)
		    	if (aspects[i].takeOver != null)
			    	return aspects[i].takeOver(aspects,data_items,orignalItemListFunc(newcontext),newcontext);
		    
	 		cntr.Ctrl = jQuery('<div class="aa_container aa_inherit_selection"><div class="aa_container_header"/><ul style="list-style: none; padding:0; white-space: normal;" class="aa_list aa_listtop aa_cntr_body"/><div class="aa_container_footer"/></div>')[0];
	 		if (id != '')
	 			jQuery(cntr.Ctrl).addClass('Page_'+id);
		    // use the aspects to create the container - they can replace the default one.
		    for(var i=0;i<aspects.length;i++)
		    	ajaxart.runScriptParam(data,aspects[i].CreateContainer,newcontext);
		    cntr.Ctrl.Cntr = cntr;
		    ajaxart.databind([cntr.Ctrl],data,context,profile);
		    
			cntr.Items = data_items;
		    cntr.PostActors = [];cntr.PreActors = [];
		    cntr.RegisterForPostAction = function(aspect,phase) { cntr.PostActors.push({ phase: phase || 0, aspect: aspect}); }
		    cntr.RegisterForPreAction = function(aspect,phase) { cntr.PreActors.push({ phase: phase || 0, aspect: aspect}); }
		    cntr.Aspects = aspects;
			cntr.XtmlSource = [ {isObject :true, script :profile, input: data, context :context }];
			
			cntr.createNewElement = function(item_data,item_aggregator)
		    {
				var li = document.createElement('li');
				li.className = "aa_item";
				li.ItemData = item_data;
				ajaxart_add_foucs_place(li);
		    	if (item_aggregator)
		    		item_aggregator.push(li);
				return li;
		    };
		    cntr.insertNewElement = function(elem,parent)
		    {
		    	var list = ajaxart_find_list_under_element(parent);
		    	if (list != null)
		    		list.appendChild(elem);
		    };
		    cntr.next = function(elem,cntr) { return ajaxart_tree_next(elem,cntr) };
		    cntr.prev = function(elem,cntr) { return ajaxart_tree_prev(elem,cntr) };
		    cntr.ElemsOfOperation = function() 
		    { 
		    	if (this.GetMultiSelectedItems)
		    		return this.GetMultiSelectedItems();
		    	return jQuery(this.Ctrl).find('.aa_selected_item').slice(0,1).get(); 
		    }
		    cntr.ItemsOfOperation = function() 
		    { 
		    	var elems = this.ElemsOfOperation();
		    	var itemsData = [];
		    	for(var i in elems)
		    		itemsData = itemsData.concat(elems[i].ItemData);

		    	return itemsData;
		    }
		    cntr.Context = newcontext;

		    aa_setMethod(cntr,'Operations',profile,'Operations',context);

		    for(var i=0;i<cntr.Aspects.length;i++) {
		    	try {
		    		aa_runMethod(data,cntr.Aspects[i],'InitializeContainer',newcontext);
		    	} catch(e) { 
		    		ajaxart.log("error in aspect " + cntr.Aspects[i].XtmlSource[0].script.getAttribute('t') + ": " + e.message + (e.stack || ''),"error"); }
		    }

		    cntr.PreActors.sort(function(a,b) { return a.phase > b.phase ? 1 : -1; });
		    cntr.PostActors.sort(function(a,b) { return a.phase > b.phase ? 1 : -1; });

		    for(var i=0;i<cntr.PreActors.length;i++) {
		    	ajaxart.trycatch( function() {
		    		aa_runMethod(data,cntr.PreActors[i].aspect,'PreAction',newcontext);
			    	 //ajaxart.runScriptParam([],cntr.PreActors[i].aspect.PreAction,cntr.Context);
		    	}, function(e) { ajaxart.logException(e); });
		    }

		    if (cntr.DataHolder)
		    	cntr.DataHolder.UserDataView.Sort = cntr.Dataview_PreSort || [];
		    aa_recalc_filters_and_refresh(cntr,data,newcontext,false);
			if (cntr.SoftSelector) // auto select, e.g from url
			{
	  	    	var top_cntr_list = ajaxart_find_aa_list(cntr);
	  	    	var all_elems = jQuery(top_cntr_list).find('.aa_item').get();

				var key_to_select = ajaxart.totext_array(ajaxart.runScriptParam(data,cntr.SoftSelector.GetValue,cntr.Context));
				for(var i=0;i<all_elems.length;i++)
					if (cntr.ItemId && key_to_select != "" && cntr.ItemId(all_elems[i].ItemData,all_elems[i]) == key_to_select) 
						ajaxart_uiaspects_select(jQuery(all_elems[i]),jQuery([]),"auto",cntr.Context);
			}

		    return [cntr.Ctrl];
	 	},
	 	Document: function (profile,data,context)
	 	{
	 		// assumption: ui.Document is not called in batch
		    var id = aa_string2id(aa_text(data,profile,'ID',context));
		    var fields = ajaxart.runsubprofiles(data,profile,'Field',context);
		    ajaxart.concat(fields,ajaxart.run(data,profile,'Fields',context));
		    
			var dataitems = ajaxart.run(data,profile,'Item',context);
			
			var operationsFunc = function(data1,ctx) { return ajaxart.run(data1,profile,'Operations',aa_merge_ctx(context,ctx)); }
			var aspectsFunc = function(data1,ctx) {
				var newContext = aa_merge_ctx(context,ctx);
				var cntr = ctx.vars._Cntr[0];
				var fields = cntr.Fields;
				
			    var aspects = ajaxart.run(data,profile,'Presentation',newContext);
			    ajaxart.concat(aspects,ajaxart.runsubprofiles(data,profile,'Aspect',newContext));
				for(var i=0;i<fields.length;i++)
				  if (fields[i].CntrAspects)
					aspects = aspects.concat(fields[i].CntrAspects);
				return aspects;
			}
			// TODO: change aspectsFunc to be an array and not a function [ make sure all aspects are written correctly ]
	 		var out = aa_uidocument(data,id,dataitems,fields,aspectsFunc,operationsFunc,context);
	 		ajaxart.databind([out],data,context,profile);
	 		out.Cntr.XtmlSource = [ {isObject :true, script :profile, input: data, context :context }];
	 		
	 		return [out];
	 	},
	 	UseGroupAsPage: function (profile,data,context)
	 	{
	 		return [{
	 			ID: 'inner_page',
	 			Fields: [],
	 			Control: function(data1,ctx) {
			 		var groupID = aa_text(data,profile,'Group',context);
			 		var cntr = ctx.vars._Cntr && ctx.vars._Cntr[0];
			 		if (!cntr)  { ajaxart.log('UseGroupAsPage: Can not find cntr','error'); return []; }
			 		var groupField = aa_fieldById(groupID,cntr.Fields);
			 		if (!groupField) ajaxart.log('Can not find group ' + groupID + ' in container ' + cntr.ID[0],'error');
			 		this.Fields = groupField ? [groupField] : [];

	 				var pageParams = ctx.vars._PageParams[0];
	 				var groupData = pageParams ? pageParams.DataItems[0].Items : data1;
//	 				var aspects = ajaxart.runScriptParam([],pageParams.Aspect,ctx); 
	 				if (groupField)
	 				  return groupField.Control(groupData,ctx);
	 				return [];
	 			}
	 		}];
	 	},
	 	ToggleClassByCondition:function (profile,data,context)
	 	{
	 		var elem = aa_first(data,profile,'Element',context);
	 		if (! ajaxart.ishtml_item(elem)) return [];
	 		var condition = aa_bool(data,profile,'ClassCondition',context);
	 		var cls = aa_text(data,profile,'Class',context);
	 		if (condition)
	 			jQuery(elem).addClass(cls);
	 		else
	 			jQuery(elem).removeClass(cls);
	 		return [];
	 	}
});

aa_gcs("uiaction",{
   GoToPage: function(profile, data, context)
   {
  	 var url = aa_text(data,profile,'Url',context);
  	 if (url == "") return;
  	 var type = aa_text(data,profile,'Type',context);
  	 var target = (type == 'navigate current page') ? "_top" : "_new";
     if (ajaxart.inPreviewMode == true) return [];
     
  	 if (target == "_new") {
//		var controls = ajaxart.getControlElement(context);
//		if (controls.length > 0 && !ajaxart.isattached(controls[0])) return data;
		target = "_blank";
  	 }
  	 window.open(url,target);
  	 return data;
   },
	AddClass: function(profile, data, context)
	{
		var classes = aa_text(data,profile,'Cls',context);
		var element = ajaxart.getControlElement(context,true);
		jQuery(element).addClass(classes);
		return data;
	},
   RunUiActions : function(profile, data, context)
   {
	    var actions = ajaxart.subprofiles(profile,'Action');
		var newContext = ajaxart.clone_context(context);
	    ajaxart.setVariable(newContext,"ControlElement",data);
	    var inp = ajaxart.getVariable(context,"InputForChanges");
	    for(var i=0;i<actions.length;i++)
	    	var subresult = ajaxart.run(inp,actions[i],"",newContext);
	    
	    return data;
   },
	SetText: function(profile, data, context)
	{
	    var text = aa_text(data,profile,'Text',context);
	    var mode = aa_text(data,profile,'Mode',context);
		
		var elements = ajaxart.getControlElement(context);
		if (elements.length == 0) return [];
	    var element = elements[0];
	    
	    if (jQuery(element).hasClass('aa_text')) { element.innerHTML = text; return;}
	    if (mode == "CharByChar")
	    {
	    	element.value = '';
	    	element.setAttribute('value','');
	    	for(var i=0;i<text.length;i++)
	    	{
	    		aa_xFireEvent(element, 'keydown', {keyCode: text.charCodeAt(i), CharByChar: true}, context.vars.InTest != null);
	    		aa_xFireEvent(element, 'keyup', {keyCode: text.charCodeAt(i), CharByChar: true}, context.vars.InTest != null);
	    	}
	    	return;
	    }

		var tag = element.tagName.toLowerCase(); 
		
		if (tag == "textarea" )
			element.value = text;
		else if (tag == "input")
		{
			if (mode == "ReplaceAll")
			{
				element.setAttribute("value",text);
				element.value = text;
			}
			else if (mode == "InsertAtCaret")
			{
                if ('selectionStart' in element) // W3C
                    element.value = element.value.substr(0, element.selectionStart) + text + element.value.substr(element.selectionEnd, element.value.length);
                else if (document.selection) { // IE
                    element.focus();
                    document.selection.createRange().text = text;
                }				
			}
			else if (mode == "InsertAtEnd")
			{
				element.value = element.value + text;
				element.setAttribute("value",element.value);
			}
		} else if (jQuery(element).hasClass("button_hyperlink_image"))
			{
				ajaxart.each(jQuery(element).find(">a"), function(a) { 
					jQuery(a).text(text); 
				} );
			}
			else if (tag == "div" || tag=="span" || tag=="button" || tag =="a")
				element.innerHTML = text;
		
		aa_inuiaction = true;
		
		if (! aa_bool(data,profile,'DoNotFireEvents',context))
		{
			aa_xFireEvent(element, 'keydown');
			aa_xFireEvent(element, 'keyup');
		}

		if (! aa_bool(data,profile,'StayInControl',context))
			aa_xFireEvent(element, 'blur', null);

		aa_inuiaction = false;
		return [];
	}
});

aa_gcs("uipref",{
	InCookies: function (profile,data,context)
	{
		var obj = {
		  GetProperty: function(data1,ctx) {
			var prefix = aa_totext(ctx.vars.Prefix);
			var property = aa_totext(ctx.vars.Property);
			var out = aa_valueFromCookie(prefix+property);
			if (out == null) return [];
			return [out];
		  },
		  SetProperty: function(data1,ctx) {
			var prefix = aa_totext(ctx.vars.Prefix);
			var property = aa_totext(ctx.vars.Property);
			var value = aa_totext(ctx.vars.Value);

			aa_writeCookie(prefix+property,value);
		  }
		}
		return [obj];
	},
	PrefValue: function (profile,data,context)
	{
		var prefix = aa_text(data,profile,'Prefix',context);
		var property = aa_text(data,profile,'Property',context);
		var out = ajaxart_getUiPref(prefix,property,context);
		if (out == null)
			return [];
		else
			return [out];
	},
	SetPrefValue: function (profile,data,context)
	{
		var prefix = aa_text(data,profile,'Prefix',context);
		var property = aa_text(data,profile,'Property',context);
		var value = aa_text(data,profile,'Value',context);
		ajaxart_setUiPref(prefix,property,value,context);
		return [];
	}
});


/*** jBart API ***/

// IE8 support
if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, ''); 
  }
}

function aa_convertToXml(item,name, error_control) {
	if (!item) return aa_parsexml('<xml/>');
	if (item.nodeType == 9) return item.documentElement; // xml document
	if (ajaxart.isxml_item(item)) return item;
	if (item.getNumberOfColumns)
		return aa_GoogleDataTableToXml(item);
	if (typeof(item) == 'object') // json
		return aa_JSON2Xml(item,'Top');
	if (typeof(item) == 'string') {
		var json = item.match(/^\s*[{[]+/); // json - starting with { or [
		var xml = item.match(/^\s*[<]+/); // xml - starting with <
		if (json)
			return aa_JSON2Xml(item,'Top');
		else if (xml)
			return aa_parsexml(item, "", error_control);
		else if (item.indexOf(',') != -1) // CSV?
			return aa_CSV2Xml(item);
	}
}
function aa_jbart_init_activator(jBartActivator,settings) {
		var language = '';
		settings.success = settings.success || function() {};
		settings.error = settings.error || function(msg) { if (console) console.log(msg); };

		ajaxart.base_images = settings.base_images_dir || ajaxart.base_images;
		ajaxart.base_lib = settings.base_lib_dir || ajaxart.base_lib;

		var widget_src = jBartActivator._widgetSource;
		var errors = [];
		jBartActivator._widgetXml = aa_convertToXml(jBartActivator._widgetSource,"widget xml", errors);

		settings.data = settings.data || {};
		settings.rawData = settings.rawData || {};
		var widget_id = jBartActivator._widgetXml.getAttribute('id');

		for(var res in settings.data) {
			var varname = 'jBartWidget_' + widget_id + '_' + res; 
			window[varname] = jbart_data(settings.data[res],'single');
		}
		for(res in settings.rawData) {
			var val = aa_isArray(settings.rawData[res]) ? settings.rawData[res] : [settings.rawData[res]];
			window['jBartWidget_' + widget_id + '_' + res] = val;
		}

		jBartActivator.Context = aa_create_jbart_context({
				WidgetXml: jBartActivator._widgetXml,
				Language: language,
				OnError: function(data1) {
					handleError(aa_totext(data1));
				},
				jbartObject: jBartActivator
		});

		function handleError(message) {
			ajaxart.log(message);
			params.error({message: message});
		}		
}

function aa_jbart_activator_showPage(jBartActivator,div,settings) {
  var out = aa_show_jbart_widget_page({
		Context: jBartActivator.Context,
		page: settings.page,
		success: settings.success
	});
	if (out && div) jQuery(div)[0].appendChild(out);
	aa_element_attached(out);
}
/*
 * params:
 * ** The Widget
 * 		widget_src : the xtml source code of the widget (also called widget)
 *  or
 *  	widget_id: the id of the widget. e.g. shai__myWidget
 *  	widget_repository: default it jbartdb. e.g. //jbartdb.appspot.com/
 *  
 *  *** More params
 *  page: the page to show - default is defined in the widget 
 *  language: i18n. e.g. hebrew
 *  spinner: you can define your own url or leave the null value to use the default spinner.
 *  nospinner: if true, no spinner is used
 *  
 *  *** Callbacks
 *  success: function called after the widget is loaded and attached
 *  error(e): function called on error
 */
jBart.appendWidget = function(place_to_add,params,jbartObject)
{
		function handleError(message) {
			ajaxart.log(message);
			params.error({message: message});
		}
		jBart.settings = params;
		params.success = params.success || function() {};
		params.error = params.error || function(msg) { jQuery(place_to_add).append(jQuery('<span/>').text(msg.message)); };
		var widgetID = params.widget_id;
		var loadingTime;

		ajaxart.base_images = params.base_images_dir || ajaxart.base_images;
		ajaxart.base_lib = params.base_lib_dir || ajaxart.base_lib;
		if (!place_to_add) return handleError('can not add to a null element');
		
		jQuery(place_to_add).addClass('jBartWidget');
		if (!params) return handleError('missing params');
		

		function getControl(widget_id) {
			var errors = [];
			if (! params.widget_src) return handleError('widget source for ' + (widget_id || 'unknown') + ' is not available'); 
			var widget_as_xml = aa_convertToXml(params.widget_src,"widget xml", errors);
			if (widget_as_xml.tagName == 'Error') return handleError(widget_as_xml.getAttribute('message'));
			if (errors.length > 0) return handleError(errors[0]);
			
			widget_id = widget_id || widget_as_xml.getAttribute('id');
			if (widget_id.indexOf('/') > -1) widget_id = widget_id.split('/')[1];
			widgetID = widget_id;

			var language = params.language ? params.language : "";
			var page = params.page;
			params.data = params.data || {};
			params.rawData = params.rawData || {};
			
			for(var res in params.data) {
				var varname = 'jBartWidget_' + widget_id + '_' + res; 
				window[varname] = jbart_data(params.data[res],'single');
			}
			for(var res in params.rawData) {
				var val = aa_isArray(params.rawData[res]) ? params.rawData[res] : [params.rawData[res]];
				window['jBartWidget_' + widget_id + '_' + res] = val;
			}

			var xtmlContent = aa_xpath(widget_as_xml,'bart_dev/db/bart_unit/bart_unit')[0];
			xtmlContent = xtmlContent || aa_xpath(widget_as_xml,'xtml')[0];
			ajaxart.load_xtml_content('widget',xtmlContent);  // for specific components
			var out = [aa_show_jbart_widget({
				WidgetXml: widget_as_xml,
				Page: page,
				Language: language,
				OnError: function(data1) {
					handleError(aa_totext(data1));
				},
				Context: aa_ctx( ajaxart.newContext(), {Language:[language]} ),
				jbartObject: jbartObject
			})];			
			if (out.length == 0) return null;
			jQuery(out[0]).addClass('ajaxart' + ajaxart.deviceCssClass);
			if (language == "hebrew")
				jQuery(out[0]).addClass('right2left');
			return out[0];
		}
		if (params.widget_id) { // we need to load the widget first
			var widget_id = params.widget_id;
			params.spinner = params.spinner || '//www.google.com/ig/images/spinner.gif';
			if (! params.nospinner) {
			  place_to_add.appendChild(jQuery('<img class="spinner" src="'+ params.spinner +'" ></img>')[0]);
			}
			window['jBartWidget_' + widget_id + '_loaded'] = function() {
				params.widget_src = window['jBartWidget_' + widget_id];
				jQuery(place_to_add).children(".spinner").remove();
				var ctrl = getControl(widget_id);
				controlCreated(ctrl);
			}
			var widgetUrl = (params.widget_repository || '//jbartdb.appspot.com') + '/widget.js?id=' + widget_id;
			aa_load_js_css(widgetUrl,'js');
		}
		else if (params.widget_src)
		{
			controlCreated(getControl());
		}
		else
			return handleError('missing param widget_id or widget_src');

		function controlCreated(ctrl) {
			if (ctrl) {
				$('#jbart_loading').empty();
				place_to_add.appendChild(ctrl);
				aa_element_attached(place_to_add);
				params.success();

				if (window.jBartLoadingStartTime) {
					loadingTime = new Date().getTime() - window.jBartLoadingStartTime;
				}
				addToGoogleAnalytics();

			} else {
				return handleError('widget returned an empty control');
			}
		}
		function addToGoogleAnalytics() {
			jBart.addedToGoogleAnalytics = jBart.addedToGoogleAnalytics || {};
			if (jBart.addedToGoogleAnalytics[widgetID]) return;
			jBart.addedToGoogleAnalytics[widgetID] = true;

			if (window.location.href.indexOf('localhost') > -1) return;
			if (params.hasOwnProperty('googleAnalytics') && !params.googleAnalytics) return;

			// Yaniv TODO: add it in an iframe
			if (window._gaq) {
			   _gaq.push(['_setAccount', 'UA-37216601-1']);
			   _gaq.push(['_setDomainName', 'none']);//'artwaresoft.appspot.com']);
			   _gaq.push(['_setAllowLinker', true]);
			   _gaq.push(['_trackPageview']);

				_gaq.push(['_trackEvent', 
					'jbart widget',
					widgetID,
					'show'
				]);

				loadingTime = parseInt(loadingTime / 500)*500;
				var loadingStr = loadingTime +  ' - ' + (loadingTime+500);

				if (loadingTime) {
					_gaq.push(['_trackEvent', 
						'jbart widget',
						widgetID,
						'loading_time_ms: ' + loadingStr
					]);
				}
			} else {
			     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			     setTimeout(function() { addToGoogleAnalytics(); },3000);
			}
		}
}
jBart.dialogs = {};
jBart.isReady = false;
jBart.ready = function(func) {
	if (jBart.isReady)
		ajaxart.ready(func,[],[]);
	else
		jBart.bind(jBart,'ready',func);
}

function jbart_init() {
	(function(jQuery) {
		jQuery.fn.jBart = function(params)
		{
			return this.each(function() {
				var elem = this;
				jBart.ready(function() {
					if (!params.widget) { if (window.console) { console.error("jBart: param 'widget' is missing"); } return; };
					if (!jBartWidgets[params.widget]) { if (window.console) { console.error("jBart: '" + params.widget + " is not a valid widget"); } return; };
					jBartWidgets[params.widget].show(elem, params);
					// jBart.appendWidget(elem,params);
				});
			});
		};
	})(jQuery);
	
	var activate = function() {
		// auto inject jBart widget to jBartWidget elems
		jQuery().ready( function() {
			if (!ajaxart.ready) return; // TODO: Fix to support dynamic loading of jbart after jQuery is already loaded 
			ajaxart.ready(function() {
				jBart.ajaxart = ajaxart;
				jBart.isReady = true;
				jBart.trigger(jBart,'ready');
				jQuery().find('.jBartWidget').each(function() {
					var params = {}
					if (this.className == 'jBartWidget') return;
//					if (!(this.className + ' ').split('jBartWidget ')[1].split('jBartWidget_')[1]) return;
					var widgetId= (this.className + ' ').split('jBartWidget ')[1].split('jBartWidget_')[1].split(' ')[0];
					var WidgetVarName = 'jBartWidget_' + widgetId;
				    params.widget = window[WidgetVarName];
					if (this.className.indexOf('jBartWidgetPage_') >-1)
					  params.page= (this.className + ' ').split('jBartWidgetPage_')[1].split(' ')[0];
					
				    if (params.widget)
						jQuery(this).jBart(params);
				    else
				    	ajaxart.log('can not find widget ' + widgetId);
				  	jQuery("#ajaxart_loading").hide();
				});
			},[]);
		})
	}
	if (!window.jBartNodeJS)
		activate();
	window.jbart_data = jbart_data;	// for use in external js
}
jbart_init();
function jbart_data(data,multiplicity)  // multiplicity can be 'multiple' (default) or 'single'
{
	if (data == window) return [];
	var error_control = [];
	var data_as_xml = aa_convertToXml(data,"widget data", error_control);
	if (!data_as_xml && typeof(data) == 'string') return [data];
	if (!data_as_xml) return null;
	// clean atom and rss headers
	var tagName = data_as_xml.tagName.split(':').pop();
	if (tagName == 'feed' || tagName == 'rss')
	{
		// clean NS and change root tag
		var items_path = (tagName == 'feed') ? 'atom:entry' : 'channel/item';
		var items = aa_xpath(data_as_xml, items_path);
		if (items.length > 0) {
			var result = '<top>';
			for(var i in items)
				result += ajaxart.xml.prettyPrint(items[i],'',true);
			result += '</top>';
			data_as_xml = aa_convertToXml(result,"cleaned data", error_control);
		}
	}
	if (!multiplicity || multiplicity == 'multiple')
		return aa_xpath(data_as_xml,'*');
	return [data_as_xml];
}

/******* action async **********/
function aa_RunAsyncQuery(data,fieldscript,context,callBack)
{
	if (fieldscript == null) { callBack([],context,false); return; }
	
	var callBackObj = { callBack: callBack, marked: false , success: true };
	var newContext = aa_ctx(context,{ _AsyncCallback : callBackObj });
	var result = [];
	ajaxart.trycatch( function()  {
		if (typeof(fieldscript) == "function") 
			result = fieldscript(data,newContext); 
		else if (fieldscript.compiled != null)
			result = fieldscript.compiled(data,newContext);
		else
			result = ajaxart.run(data,fieldscript,'',newContext);		// TODO: clean
	}, function (e) {	// catch
	   	   ajaxart.logException(e);
	       return [];
	});
	if (! callBackObj.marked && callBack)	// sync query
		callBack(result,context,true);
}
function ajaxart_RunAsync(data,fieldscript,context,callBack,object_for_method)
{
	if (fieldscript == null) { callBack(data,context,false); return; }
	
	var callBackObj = { callBack: callBack, marked: false , success: true };
	var newContext = aa_ctx(context,{ _AsyncCallback : callBackObj });
	if (ajaxart.debugmode) {
	  if (typeof(fieldscript) == "function") {
		  if (object_for_method) fieldscript.call(object_for_method,data,newContext);
		  else fieldscript(data,newContext);
	  }
	  else if (fieldscript.compiled != null)
			fieldscript.compiled(data,newContext);
		  else
		    ajaxart.run(data,fieldscript,'',newContext);
	} else {
	  try {
		  if (typeof(fieldscript) == "function") {
			  if (object_for_method) fieldscript.call(object_for_method,data,newContext);
			  else fieldscript(data,newContext);
		  }
		  else if (fieldscript.compiled != null)
			fieldscript.compiled(data,newContext);
		  else
		    ajaxart.run(data,fieldscript,'',newContext);		// TODO: clean
	  } catch(e) { ajaxart.logException(e); }
	}
	if (! callBackObj.marked && callBack)	// sync action
  	  callBack(data,context,true);
}
/************* bart **************/
function ajaxart_resourceByID(id,context)
{
	if (!context.vars._AppContext) return null;
	var bc = context.vars._AppContext[0];
	if (!bc.Resources) return null;

	var res = bc.Resources;
	for(var i=0;i<res.length;i++)
		if (aa_totext(res[i].ID) == id)
			return res[i];
	
	return null;
}

function ajaxart_popup_capture_click(e)
{
    var elem = jQuery( (typeof(event)== 'undefined')? e.target : (event.tDebug || event.srcElement)  );

    if (elem.parents('.customsuggestionpopup').length > 0) return; // clicking inside suggestion box
    if (elem.parents('.contextmenu').length > 0) return; // clicking inside context menu
    if (elem.parents('.capturebox').length > 0) return;
    if (elem.parents('html').length == 0 && elem[0].tagName.toLowerCase() != 'html') return; // detached - should not close..?
//    if (elem.parents().length == 0) return;
    
    var popups = ajaxart.dialog.openPopups;
    for(var i=0;i<popups.length;i++)
    {
    	var popup = popups[popups.length-i-1];
	    if (elem.parents('.aa_click_dosent_close_popup').length > 0) {
	    	// usage: click in inspect popup should not close the current editable popup 
	    	// we do close the popup if it is a 'son' of the inspect dialog
	    	var launching_element = (popup.Dlg) ? popup.Dlg.onElem : popup.onElem;
	    	if (jQuery(launching_element).parents('.aa_click_dosent_close_popup').length == 0)
	    		return;
	    }

    	var popup_frame = (popup.Dlg) ? popup.Dlg.Frame : popup.contents.parentNode;
    	
		//if ( !elem.hasClass('aapopup') && elem.parents('.aapopup').length == 0 && elem.parents('.contextmenu').length == 0 )  // outside the popup
    	if (elem[0] != popup_frame && elem.parents().filter(function() { return this == popup_frame } ).length == 0)
		{
    		if (!popup.initialized) continue;
			jQuery("#log").append("click outside popup");
			if (popup.Dlg && !popup.Dlg.JBStudio && elem.parents('.jbstudio_dlg').length > 0) {
				// no not close
			} else {
				aa_closePopup(popup);
				if (popup.Dlg) jBart.trigger(popup.Dlg,'cancel');
			}
			ajaxart_popup_capture_click(e); // try close more popups
			return;
		}
		else
		{
		  	if (ajaxart.controlOfFocus)
		  		ajaxart.controlOfFocus.IgnoreBlur = true;
			return;
		}
    }
}
function ajaxart_scroll_offset() {
	var scrollOffsetX = 0;
	var scrollOffsetY = 0;
	// taken fron http://www.howtocreate.co.uk/tutorials/javascript/browserwindow
	if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {
    //DOM compliant
		scrollOffsetY = document.body.scrollTop;
		scrollOffsetX = document.body.scrollLeft;
  } else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
    //IE standards compliant mode
  	scrollOffsetY = document.documentElement.scrollTop;
    scrollOffsetX = document.documentElement.scrollLeft;
  }	
	return { x:scrollOffsetX, y:scrollOffsetY };
}
function aa_screen_height(context) {
	if (context.vars._PagePreview)
		return context.vars._PagePreview[0].Height;
	else
		return window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
}
function aa_screen_width(context) {
	if (context.vars._PagePreview)
		return context.vars._PagePreview[0].Width;
	else
		return window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
}
function ajaxart_dialog_close_all_popups()
{
   	aa_closePopup(ajaxart.dialog.openPopups[0]);
}

function aa_capture_for_popup(popup)
{
	// console.log("capture_for_popup " + popup.onElem.parentNode.Field.Id);
	if (window.captureEvents)
	{ // FF
		popup.Orig_mousedown = window.onmousedown;  
		window.onmousedown = ajaxart_popup_capture_click;//for compression - ajaxart_popup_capture_click()
	}
	else  // IE
	{
		//alert('capture_for_popup');
		popup.Orig_mousedown = document.onmousedown;  
		document.onmousedown=ajaxart_popup_capture_click;
	}
	popup.capturing = true;
}

function aa_uncapture_for_popup(popup)
{
	// console.log("aa_uncapture_for_popup " + popup.onElem.parentNode.Field.Id);
	if (!popup || !popup.capturing) return;
	var orig_mousedown = popup ? popup.Orig_mousedown : null;
	if (window.captureEvents) // FF
		window.onmousedown = orig_mousedown;
	else  // IE
		document.onmouseclick = orig_mousedown;
}

function aa_closePopup(popup)
{
	if (window.aa_dont_close_popups) return;
	var popups = ajaxart.dialog.openPopups;
	if (popups.length == 0) return;
	if (!popup) popup = popups[popups.length-1];
		
	if (!aa_intest && !popup.initialized) return;

	// console.log("close " + popup.onElem.parentNode.Field.Id);
	var top_popup = popups[popups.length-1];
	var maxCount = 20;
	while(top_popup && top_popup != popup) // close cascading popups
	{
		if (!top_popup.initialized)
		{
			// console.log(top_popup.onElem.parentNode.Field.Id + " not initalized");
			if (popups.length <= 1) return;
			// can not delete un-initialized, so replace it with next top (if it is the one we would like to close)
			var new_top = popups[popups.length-2];
			if (new_top == popup)
			{
				// console.log("replaced with " + new_top.onElem.parentNode.Field.Id);
				var un_initialize = popups.pop();
				new_top = popups.pop();
				popups.push(un_initialize);
				popups.push(new_top);
				top_popup = new_top;
			}
			else
				return;
		}
		aa_closePopup(top_popup);
		popups = ajaxart.dialog.openPopups;
		top_popup = ajaxart.dialog.openPopups[ajaxart.dialog.openPopups.length-1];
		
		if (--maxCount < 0) break;
	}
	// console.log("closing " + top_popup.onElem.parentNode.Field.Id);
	ajaxart.dialog.openPopups.pop();
	aa_uncapture_for_popup(popup);
	if (!popup.Dlg) {	
		aa_remove(popup.contents.parentNode,true);
	}
	if (popup.returnFocusTo != null) popup.returnFocusTo.focus();
	if (ajaxart.suggestbox && ajaxart.ui.suggestBoxPopup)
		ajaxart.suggestbox.closePopup();
	
	if (popup.Dlg) popup.Dlg.Close([],ajaxart.newContext(),true);
	return [];
}

function aa_contentsOfOpenPopup()
{
	var popup = ajaxart.dialog.openPopups[ajaxart.dialog.openPopups.length-1];
	if (popup != null)
		  return [popup.contents];
	return [];
}

function aa_fixTopDialogPosition()
{
	var topDialog = aa_top_dialog();
	if (topDialog && topDialog.Dialog && topDialog.Dialog._FixDialogPosition) { topDialog.Dialog._FixDialogPosition(); return; }
	
	if (openDialogs.length == 0) return [];
	var dlgContent = openDialogs[openDialogs.length-1].dialogContent;
		var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
		var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
		var scrollOffsetX = 0;
		var scrollOffsetY = 0;
		// taken fron http://www.howtocreate.co.uk/tutorials/javascript/browserwindow
		if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {  //DOM compliant
			scrollOffsetY = document.body.scrollTop;
			scrollOffsetX = document.body.scrollLeft;
	} else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
	  //IE standards compliant mode
		scrollOffsetY = document.documentElement.scrollTop;
	    scrollOffsetX = document.documentElement.scrollLeft;
	}
	if (jQuery(dlgContent).width() + aa_absLeft(dlgContent) > screenWidth ||
		jQuery(dlgContent).height() + aa_absTop(dlgContent) > screenHeight )
	{
		dlgContent.style.left = (screenWidth - jQuery(dlgContent).width())/2 + scrollOffsetX + "px";
		dlgContent.style.top = (screenHeight - jQuery(dlgContent).height())/2 + scrollOffsetY + "px";
	}
	return [];
}

/*************** action **************/
aa_delayedRun = function(func,id,delay,milliToForce) 
{
	// look for the id in the table
	var newRecord = { id: id , handle: null}
	var getTimerFunc = function(record)
	{
		return function() {
			record.handle = 0;
			var force = false;
			if (record.startTime == null) record.startTime = new Date().getTime();
			else if (record.startTime + milliToForce > new Date().getTime())
				force = true;
			
			var success = func(force);
			if (success || force) {
				jBart.utils.removeFromArray(ajaxart.runDelayed,newRecord);
			}
			else
				newRecord.handle = setTimeout(getTimerFunc(newRecord),delay); // keep trying till milliToForce
		}
	}

	for(var i=0;i<ajaxart.runDelayed.length;i++)
	{
		var record = ajaxart.runDelayed[i];
		if (typeof(record.id) == typeof(id) && record.id == id) {
			if (record.handle != 0)
			  clearTimeout(record.handle);
			ajaxart.runDelayed[i] = newRecord;
			newRecord.handle = setTimeout(getTimerFunc(newRecord),delay);
			return ["true"];
		}
	}
	ajaxart.runDelayed.push(newRecord);
	newRecord.handle = setTimeout(getTimerFunc(newRecord),delay);
};
/******************* xml *******************/

function aa_bindXmlChange(xml,callback,settings) {
  ajaxart.xmlListeners = ajaxart.xmlListeners || [];
  ajaxart.xmlListenersCounter = ajaxart.xmlListenersCounter ? ajaxart.xmlListenersCounter+1 : 1;

  if (!xml || !xml.tagName) return;
  ajaxart.xmlListeners[xml.tagName] = ajaxart.xmlListeners[xml.tagName] || [];

	ajaxart.xmlListeners[xml.tagName].push({
		xml: xml,
		callback: callback,
		settings: settings,
		id: ajaxart.xmlListenersCounter
	});

  return ajaxart.xmlListenersCounter;
}

function aa_triggerXmlChange(xml,args) {
	if (!xml || !ajaxart.xmlListeners) return;
	var iter = xml.nodeType == 1 ? xml : aa_xpath(xml,'..')[0];

	// find if anyone is listening to a parent
	for(;iter && iter.nodeType == 1;iter=iter.parentNode) {
		var listeners = ajaxart.xmlListeners[iter.tagName];
		if (!listeners) continue;

		for(var i=0;i<listeners.length;i++) {
			if (listeners[i] && listeners[i].xml == iter)
				listeners[i].callback(xml,args);
		}

	}
}

function aa_unbindXmlChange(identifier) {
	if (!ajaxart.xmlListeners || !identifier) return;
	for(var tag in ajaxart.xmlListeners) {
		var listeners = ajaxart.xmlListeners[tag];
		for(var i=0;i<listeners.length;i++) {
			if (listeners[i] && listeners[i].id == identifier) {
				listeners.splice(i,1);
				return;
			}
		}
	}
}

function aa_xml2htmltext(xml) // faster than xml2text and supports mixed html inner text
{
	if (xml == null) return '';
	
	if (xml.nodeType == null) return xml;
	if (xml.nodeType == 2 || xml.nodeType == 3 || xml.nodeType == 4) { // Attribute or inner text
		return aa_xmlescape(xml.nodeValue);
	}
	 var out = xml.xml; //IE xml
	 if (xml.nodeType != null) // outer XML/html
	 {
	  if (!out) out = xml.outerHTML; // IE html
	  if (!out) { // mozilla
			var serializer = new XMLSerializer(); // XMLSerializer() omits newlines & tabs
			out = serializer.serializeToString(xml);
	  }
	 }
	 return out;
}
ajaxart.xml.parentNode = function(node)
{
	if (node.nodeType == 9) 
		return null;
	if (node.parentNode && node.parentNode.nodeType == 1)
		return node.parentNode;
	if (node.parentNode && node.parentNode.nodeType == 9)
		return null;
	if (node.ownerElement != null)
		return node.ownerElement;
	var xpath_result = aa_xpath(node,"..");
	if (xpath_result.length == 1) return xpath_result[0];
	return null;
}
ajaxart.replaceXmlElement = function(old_elem,new_elem,ishtml,cleanMemoryLeaks)
{
	if (old_elem == null || new_elem == null) return;
	if (old_elem.nodeType != 1) return;
	if (old_elem.parentNode == null) return;

	if (ishtml == true || ajaxart.isChrome)
	{
		if (new_elem.ownerDocument != old_elem.ownerDocument)
			new_elem = old_elem.ownerDocument.importNode(new_elem,true);
	}
	if (ishtml && old_elem.ParentObject != null) { 
		old_elem.ParentObject[0].ControlHolder = [new_elem];
		aa_defineElemProperties(old_elem,'ParentObject');
		aa_defineElemProperties(new_elem,'ParentObject');
		new_elem.ParentObject = old_elem.ParentObject; 
	}
	
	old_elem.parentNode.replaceChild(new_elem,old_elem);
	
	if (ishtml) {
		aa_element_attached(new_elem);
		if (cleanMemoryLeaks)
		  aa_remove(old_elem,cleanMemoryLeaks);
		else
		  aa_element_detached(old_elem);
	}
}
/******************* ui ********************/
function aa_element_detached(elem)
{
	if (!elem || ajaxart.isattached(elem)) return;
	
	var items = jQuery(elem).find('.aa_ondetach').get();
	if (jQuery(elem).hasClass('aa_ondetach')) items.push(elem);
	
	for(var i=0;i<items.length;i++) {
		try {
		if (items[i].OnDetach) items[i].OnDetach();
		  jQuery(items[i]).removeClass('aa_onattach_called');
		} catch(e) {ajaxart.logException(e); }
	}
}
function aa_element_attached(elem)
{
  if (! ajaxart.isattached(elem)) return;
  var items = jQuery(elem).find('.aa_onattach').get();
  if (jQuery(elem).hasClass('aa_onattach')) items.push(elem);
  for(var i=0;i<items.length;i++) {
	  if (jQuery(items[i]).hasClass('aa_onattach_called')) continue;
	  if (items[i].jbOnAttach) items[i].jbOnAttach.call(items[i]);
	  jQuery(items[i]).addClass('aa_onattach_called');
  }
}
function aa_addOnDetach(elem,func)
{
	jQuery(elem).addClass('aa_ondetach');
	elem.OnDetach = func;
}
function aa_urlAttribute(context,attr)
{
	var urlProvider = null;
	if (context.vars._AppContext) urlProvider = context.vars._AppContext[0].Url;
		
	if (urlProvider) 
		return aa_totext( aa_runMethod([],urlProvider,'GetValue',aa_ctx(context,{Attribute: [attr]})) );
	
	var url = window.location.href.split('#');
	if (url.length == 1) return "";
	var fragment = url[1];
	if (fragment.indexOf('?'+attr+'=') == -1) return "";
	var out = fragment.split('?'+attr+'=')[1].split('?')[0];
	return out.split(';')[0];
}
function aa_urlChange(context,newurl)
{
	var urlProvider = null;
	if (context.vars._AppContext) urlProvider = context.vars._AppContext[0].Url;
		
	if (urlProvider) 
    	return aa_totext( aa_runMethod([],urlProvider,'Update',aa_ctx(context,{ValuePairs: [newurl]})) );
	
	var url = window.location.href.split('#');
	var frag = url.length == 1 ? "" : url[1];
	var script = aa_parsexml('<xtml t="bart_url.NewUrlFragment" Current="'+frag+'" Proposed="'+newurl+'"/>');
	var newfrag = aa_text([],script,'',context);
	var new_url = url[0] + "#" + newfrag;
	if (window.location.href != new_url)
	{
		  if (window._gaq) // google analytics 
			  _gaq.push(['_trackPageview', '/' + new_url.split('/').pop()]);

		window.location = new_url;
	}
}
/******************* uiaction ********************/
function aa_xFireEvent(element,eventName,properties,inTest){
	window.__DOMEvents = window.__DOMEvents  || {
		  focusin:{eventGroup:"UIEvents",init:function(e,p){e.initUIEvent("focusin",true,false,window,1);}},
		  focusout:{eventGroup:"UIEvents",init:function(e,p){e.initUIEvent("focusout",true,false,window,1);}},
		  activate:{eventGroup:"UIEvents",init:function(e,p){e.initUIEvent("activate",true,true,window,1);}},
		  focus:{eventGroup:"UIEvents",init:function(e,p){e.initUIEvent("focus",false,false,window,1);}},
		  blur:{eventGroup:"UIEvents",init:function(e,p){e.initUIEvent("blur",false,false,window,1);}},
		  click:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("click",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  dblclick:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("click",true,true,window,2,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  mousedown:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("mousedown",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  mouseup:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("mouseup",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  mouseover:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("mouseover",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  mousemove:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("mousemove",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  mouseout:{eventGroup:"MouseEvents",init:function(e,p){e.initMouseEvent("mousemove",true,true,window,1,p.screenX||0,p.screenY||0,p.clientX||0,p.clientY||0,p.ctrlKey||false,p.altKey||false,p.shiftKey||false,p.metaKey||false,p.button||0,p.relatedTarget||null);}},
		  load:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("load",false,false);}},
		  unload:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("unload",false,false);}},
		  select:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("select",true,false);}},
		  change:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("change",true,false);}},
		  submit:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("submit",true,true);}},
		  reset:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("reset",true,false);}},
		  resize:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("resize",true,false);}},
		  keyup:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("keyup",true,false);}},
		  keydown:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("keydown",true,false);}},
		  scroll:{eventGroup:"HTMLEvents",init:function(e,p){e.initEvent("scroll",true,false);}}
	} 
	  // Attempts to fire a DOM event on an element
	  // param name="element" type="Element" The element or its identifier to fire the event
	  // param name="eventName" type="String" The name of the event to fire (without an 'on' prefix)
	  // param name="properties" type="Object" Properties to add to the event
	  //   e.g. {cancelBubble:false, returnValue:true}
	  // returns type="Boolean" True if the event was successfully fired, otherwise false
	  try{
	    properties=properties||{};
	    if(document.createEvent){
	      // DOM compatible browsers
	      if(element==window && !element.dispatchEvent){
	        // Safari3 doesn't have window.dispatchEvent()
	        element=document;
	      }
	      var def=__DOMEvents[eventName];
	      if(def){
	        var event=document.createEvent(def.eventGroup);
 	      	if (inTest) 
 	      		for(var property in properties)
 	      			try { event[property]=properties[property]; } catch(e) {} // button property throws..
	        def.init(event,properties);
	        event.srcElement = null;
	        if (ajaxart.isChrome && inTest)
	        {
	        	try {
	        	  event.tDebug = ajaxart_source_elem_in_test;
	        	} catch(e) {}
	        }
//	        for(var property in properties)
//	        	event[property] = properties[property];
      	element.dispatchEvent(event);
	        return true;
	      }
	    }else if(document.createEventObject){
	      // IE family
	      if(element==document){
	        // IE6,IE7 thinks window==document and doesn't have window.fireEvent()
	        // IE6,IE7 cannot properly call document.fireEvent()
	        element=document.documentElement;
	      }
	      var event=document.createEventObject();
	      //Object.extend(event,properties);
	      element.fireEvent("on"+eventName,event);
	      return true;
	    }
	  }catch (e){
	  }
	  return false;
	}

// asynch
aa_async_finished_listeners = [];
function ajaxart_async_CallBack(data,context)
{
	if ( context.vars._AsyncCallback != null && context.vars._AsyncCallback.callBack != null) {
		var success = context.vars._AsyncCallback.success;
		if (success == null) success = true;
		context.vars._AsyncCallback.callBack(data,context,success);
	}
}
function ajaxart_async_Mark(context,isQuery)
{
	if ( context.vars._AsyncCallback != null ) context.vars._AsyncCallback.marked = true;
	if (isQuery) context.vars._AsyncIsQuery = true;
}
ajaxart_async_GetCallbackObj = function(context)
{
	var out = context.vars._AsyncCallback;
	if (out == null) out = [ { callBack: function() {}, marked: false, success:true } ];
	context.vars._AsyncCallback = out;
	return out;
}
function aa_fire_async_finished()
{
	// let sync actions finish
	setTimeout(function() {
		for(var i=aa_async_finished_listeners.length-1;i>=0;i--)
			aa_async_finished_listeners[i].OnAsyncActionFinished();
	},1);
}
function aa_is_rtl(elem,ctx)
{
	if ( jQuery(elem).parents('.right2left').length > 0 ) return true;
	if (!elem && jQuery("body").find('.right2left').length > 0) return true;
	if (ctx && aa_totext(ctx.vars.Language) == 'hebrew') return true;
	return false;
}

function aa_createElement(elem, tag)
{
	if (elem == null || !ajaxart.isxml(elem))
		return aa_parsexml("<" + tag + "/>");
	return elem.ownerDocument.createElement(tag);
}
function aa_refresh_field(field_ids,scope,fire_on_update,transition,context)
{
	if (scope == 'sibling') { 
		var srcElement = context.vars.ControlElement[0];
		for(var j in field_ids) {
			aa_refresh_sibling_field(srcElement,field_ids[j],context);
		}
		return;
	};

	if (scope == 'parent')
	{
		// look in parents
	}
	var top = window.aa_intest ? aa_intest_topControl : document;
	if (scope == "screen")
	  top = window.aa_intest ? aa_intest_topControl : document;
	else if (scope == "document")
	  { top = context.vars._Cntr[0].Ctrl; }
	else if (scope == "table row")
	  { top = $(context.vars.ControlElement[0]).parents('tr')[0]; }
	for(var j =0;j<field_ids.length;j++)
	{
		var cls = "fld_" + field_ids[j];
		var ctrls = $(top).find('.'+cls).get();
		if ($(top).hasClass(cls)) ctrls.push(top);
		
		for(var i=0;i<ctrls.length;i++)
		{
			aa_refresh_cell(ctrls[i],context,transition,null,true);
//			if (fire_on_update)
//				aa_invoke_field_handlers(td.Field.OnUpdate,td,null,td.Field,td.FieldData);
		}
//		if (!ctrls.length) { ajaxart.log("RefreshField: cannot find field " + field_ids[j],"location"); }
	}
	aa_fixTopDialogPosition();
}
function aa_fixImageSize(img,user_width,user_height) 
{
	var imgObj = new Image(); imgObj.src = img.getAttribute('src');
	var naturalWidth = imgObj.width; var naturalHeight = imgObj.height;
	if (naturalWidth * naturalHeight == 0) {
		img.width = user_width; img.height = user_height; return;
	} 
	if (naturalWidth < img.width) img.width = naturalWidth; 
	if (naturalHeight < img.height) img.height = naturalHeight;
	var width = Math.min(naturalWidth,user_width), height = Math.min(naturalHeight,user_height); // IE hates imgObj.width
	
	var ratio = naturalWidth / naturalHeight;
	var currRatio = width / height;
	if (ratio != currRatio) {
		if (naturalWidth >= naturalHeight * currRatio) {
			img.width = user_width;
			img.height = Math.floor(width / ratio);
		} else {
			img.height = user_height;
			img.width = Math.floor(height * ratio);
		}
	} else {
		img.width = user_width; img.height = user_height;
	}
}
function aa_keepimageprops(img,user_width,user_height)
{
	var imgObj = new Image(); imgObj.src = img.getAttribute('src');
	if (imgObj.complete) aa_fixImageSize(img,user_width,user_height); 
	else {
		img.onload = function() { aa_fixImageSize(img,user_width,user_height); }
	}
}
function aa_uidocument(data,id,dataitems,fields,aspectsFunc,operationsFunc,context,readonly)
{
	var cntr = { ID: [id] , IsSingleItem: true, isObject: true , Fields: fields, Items: dataitems, ReadOnly: readonly==true }
	var newcontext = aa_ctx(context,{_ParentCntr: context.vars._Cntr, _Cntr : [cntr] } );
	cntr.Context = newcontext;
 	cntr.Ctrl = jQuery('<div class="aa_container aa_non_selectable"><div class="aa_container_header"/><div class="aa_list aasection aa_item aa_cntr_body"/><div class="aa_container_footer"/></div>')[0];
	cntr.Ctrl.Cntr = cntr;
 	if (id != '')
 	  jQuery(cntr.Ctrl).addClass('Page_'+id);

 	if (aa_tobool(context.vars.IsNewItem)) cntr.IsNewItem = true;
 		
 	var aspects = cntr.Aspects = aspectsFunc(data,newcontext);
 	
	for(var i=0;i<aspects.length;i++)
      ajaxart.runScriptParam(data,aspects[i].CreateContainer,newcontext);

	var fillContainer = function(cntr,aspects) {
		cntr.PostActors = [];cntr.PreActors = [];
		cntr.RegisterForPostAction = function(aspect,phase) { cntr.PostActors.push({ phase: phase || 0, aspect: aspect}); }
		cntr.RegisterForPreAction = function(aspect,phase) { cntr.PreActors.push({ phase: phase || 0, aspect: aspect}); }

		if (cntr.Items.length == 0) { cntr.Items = [{isObject: true , Items: []}] }
		if (cntr.Items[0].Items.length == 0) { cntr.NoData = true; cntr.Items[0].Items.push(aa_parsexml('<xml/>')) }
			
		var items_data = (cntr.Items == null || cntr.Items.length == 0 || cntr.Items[0].Items.length == 0) ? [] : [cntr.Items[0].Items[0]];

		cntr.ElemsOfOperation = function() { return jQuery(this.Ctrl).find('.aa_item').slice(0,1).get(); }
		cntr.ItemsOfOperation = function() { return [this.Items[0].Items[0]]; }

		cntr.CellPresentation = 'control';
		cntr.Operations = operationsFunc;    
		    
//		var doc_section = jQuery(cntr.Ctrl).find('.aasection')[0];
//		if (doc_section != null) {
//		  ajaxart.setVariable(newcontext,"_Section",[doc_section]);
//		  doc_section.ItemData = items_data;
//		}
		    
	    for(var i=0;i<cntr.Aspects.length;i++) {
	    	ajaxart.trycatch( function() {
	    		aa_runMethod(data,cntr.Aspects[i],'InitializeContainer',newcontext);
	    	}, function(e) { 
	    		var aspect = (cntr.Aspects[i].XtmlSource && cntr.Aspects[i].XtmlSource[0].script.getAttribute('t')) || '';
	    		ajaxart.log("error in aspect " + aspect + ": " + e.message + e.stack || '',"error"); 
	    	});
	    }

		cntr.PreActors.sort(function(a,b) { return a.phase > b.phase ? 1 : -1; });
	    cntr.PostActors.sort(function(a,b) { return a.phase > b.phase ? 1 : -1; });

		for(var i=0;i<cntr.PreActors.length;i++) {
		  	ajaxart.trycatch( function() {
		    	  ajaxart.runScriptParam([],cntr.PreActors[i].aspect.PreAction,cntr.Context);
		   	}, function(e) { ajaxart.logException(e); });
		}
	    aa_refresh_itemlist(cntr,newcontext,true);
	    //ajaxart.runsubprofiles(items_data,profile,'SectionAspect',newcontext);
	    
	    if (cntr.NoData && cntr.ControlForNoData) {
	        var top = ajaxart_find_aa_list(cntr);
	        var ctrl = cntr.ControlForNoData([],context)[0];
	      	jQuery(ctrl).addClass('aa_list');
	      	aa_replaceElement(top,ctrl);
	    }
	}
	
	if (cntr.RunAsyncAction && cntr.ControlForWaiting) {
		var myCallback = function(cntr,aspects) { return function() {
			var loading = cntr.Ctrl;
			cntr.Ctrl = cntr.OriginalCtrl;
			fillContainer(cntr,aspects);
			aa_replaceElement(loading,cntr.Ctrl);
	      	aa_fixTopDialogPosition();
		}}
		cntr.OriginalCtrl = cntr.Ctrl;
		cntr.Ctrl = cntr.ControlForWaiting(data,context)[0];
		cntr.Ctrl.Cntr = cntr;
		aad_runMethodAsync(cntr,cntr.RunAsyncAction,data,aa_ctx(context,{}),myCallback(cntr,aspects));
		return cntr.Ctrl;
	}
	
	fillContainer(cntr,aspects);
    return cntr.Ctrl;
}
function aa_set_initialize_container(aspect,func)
{
	aspect.InitializeContainer = function(data1,ctx) {
		var cntr = ctx.vars._Cntr[0];
		func(aspect,ctx,cntr);
	}
}
function aa_add_to_comma_separated(list,item)
{
	if (list == '') return item;
	if ((list+',').indexOf(','+item+',') > -1) return list;  // already inside. no need to add it again
	return list + ',' + item;
}
function aa_comma_size_to_css(size)
{
  size = size.replace(/px/g,"")
  var parts = size.split(',');
  var out = "";
  var width = parts[0];
  if (width != "") {
	  if (width.indexOf('%') == -1) width += "px";
	  out += "width:"+width+";";
  }
  if (parts.length == 1) return out;
  var height = parts[1];
  if (height != "") {
	  if (height.indexOf('%') == -1) height += "px";
	  out += "height:"+height+";";
  }
  return out;
}
function aa_CSV2Xml(txt)
{
	var result = aa_parsexml('<items/>');
	try {
		// first we pre-process to extract quotes 
		// handle cases like: 1997,"Super, luxurious truck" or 1997,"Super, ""luxurious"" truck" (http://en.wikipedia.org/wiki/Comma-separated_values#Specification)
		var new_text = "";
		var index = 0;
		var in_quote = false;
		var current_item = "";
		var quoted_items = [];
		while (1) {
			var next_index = txt.indexOf('"',index);
			if (next_index == -1) {
				new_text += txt.substring(index);
				break;
			}
			if (in_quote) {	// in quote
				if (txt.length>next_index+1 && txt.charAt(next_index+1) == '"') {	// double quote ""
					current_item += txt.substring(index,next_index) + '"';
					index = next_index + 2;
				}
				else { 	// finish current item
					current_item += txt.substring(index,next_index);
					quoted_items.push(current_item);
					index = next_index+1;
					in_quote = false;
					new_text += "___QUOTED___";
				}
			} else {	// start quote
				new_text += txt.substring(index,next_index);
				index = next_index+1;
				current_item = "";
				in_quote = true;
			}
		}
		txt = new_text;
		var lines = txt.replace('\r\n','\n').split('\n');
		var fields = lines[0].split(',');
		var fieldNames = [];
		var uniqueNamesHash = {};
		for(var i=0;i<fields.length;i++) 
		{
			// normalize field names as valid attribute names
			var name = fields[i].replace(/ ([a-z])/g,function(match) {return ' ' + match.toUpperCase()}).replace(/[^a-zA-Z0-9_]/g,'_');
			if (! name.match(/^[a-zA-Z].*/)) name = 'x' + name; // should start with alpha
			while (uniqueNamesHash[name]) // make name unique
				name += '_';
			fieldNames.push(name);
			uniqueNamesHash[name] = true;
		}
		for (var i=1;i<lines.length;i++) {
			var item = result.ownerDocument.createElement('item');
			var values = lines[i].split(',');
			for (var j=0;j<values.length;j++) {
				var val = values[j];
				if (val == "___QUOTED___")
					val = quoted_items.shift();
				item.setAttribute(fieldNames[j],val);
			}
			result.appendChild(item);
	}
	} catch(e) { 
	}
	return result;
}

function aa_GoogleDataTableToXml(data)
{
  	var fieldNames = [];
	var uniqueNamesHash = {};
	for (var col = 0; col < data.getNumberOfColumns(); col++)
	{
		// normalize field names as valid attribute names
		var name = data.getColumnLabel(col).replace(/ ([a-z])/g,function(match) {return ' ' + match.toUpperCase()}).replace(/[^a-zA-Z0-9_]/g,'');
		if (! name.match(/^[a-zA-Z].*/)) name = 'x' + name; // should start with
															// alpha
		while (uniqueNamesHash[name]) // make name unique
			name += '_';
		fieldNames.push(name);
		uniqueNamesHash[name] = true;
	}
	var xml = aa_parsexml('<items/>');
	for (var row = 0; row < data.getNumberOfRows(); row++) {
		var item = aa_parsexml('<item/>');
		xml.appendChild(item);
	    for (var col = 0; col < data.getNumberOfColumns(); col++) {
	      var formattedValue = data.getFormattedValue(row, col);
		  var col_id = fieldNames[col];
		  item.setAttribute(col_id,formattedValue);
	    }
	} 
	return xml;
}

function aa_attach_style_css(style)
{
	if (!style.CssClass) 
		style.CssClass = aa_attach_global_css(style.Css);
	return style.CssClass;
}
function aa_build_color_lookup(css) {
	colors = [];
	var match,result=css;
	var pattern = /((rgb|rgba|hsl|hsla)\([^\)]*\))/g;
	while (match = pattern.exec(css)) {
		result = result.replace(match[1],'##' + colors.length);
		colors.push(match[1]);
	}
	return { css:result, colors:colors };
}
function aa_color_lookup(colors,colorCode) {
	if (colorCode && colorCode.indexOf('##') == 0)
		return colors[colorCode.match(/([0-9]+)/)[1]];
	return colorCode;
}
function aa_adapt_css_for_browser(css, forAllBrowsers)
{	
	if (ajaxart.isFireFox) {
		css = css.replace(/-webkit-/g,'-moz-');
	}
	if (ajaxart.isIE) {
		css = css.replace(/-webkit-box/g,'-ms-flexbox');
		css = css.replace(/-webkit-/g,'-ms-');
	}
	if (ajaxart.isOpera)
		return css.replace(/-webkit-linear-gradient/g,'-o-linear-gradient');

	if (css.indexOf("input:placeholder") != -1) {
		if (forAllBrowsers) {
			css = css.replace(/input:placeholder([^{]+\{[^}]+})/, 
				"input::-webkit-input-placeholder$1" + "\n" + 
				"input:::-moz-placeholder$1" + "\n" + 
				"input.placeholder$1 /* IE */" + "\n" + 
				"input:::-ms-input-placeholder$1 /* IE10 */");
		} else {
			if (ajaxart.isChrome) 		css = css.replace(/input:placeholder([^{]+\{[^}]+})/, "input::-webkit-input-placeholder$1");
			else if (ajaxart.isFirefox) css = css.replace(/input:placeholder([^{]+\{[^}]+})/, "input:::-moz-placeholder$1");
			else if (ajaxart.isIE10)	css = css.replace(/input:placeholder([^{]+\{[^}]+})/, "input:::-ms-input-placeholder$1");
		}
	}
	if (ajaxart.isFireFox)
		return css.replace(/([^-])box-sizing/g,'$1-moz-box-sizing');
	return css;
}
function aa_cssClass(data,profile,field,context,classSuffixName,moreSettings) {
	moreSettings = moreSettings || {};
	var css = aa_text(data,profile,field,context);
	return aa_attach_global_css(css,null,classSuffixName,moreSettings.supportWrapper,moreSettings.lowPriority,context);
}
function aa_attach_global_css(globalcss,cntr,className,supportWrapper,lowPriority,context,settings)
{
	settings = settings || {};

	if (!window.aa_container_styles) window.aa_container_styles = {};
	if (!globalcss) return '';
	jBartWidgets.vars.uniqueNumber = jBartWidgets.vars.uniqueNumber || 0;
	
	var entry = globalcss;
	var classForItem = context && aa_totext(context.vars._ClassForItem);
	if (classForItem && globalcss.indexOf('#item') > -1) {
		entry = globalcss + '_' + classForItem;
	}

	if (!aa_container_styles[entry] || settings.noCssCache) { 
		var finalClassName = '';
		if (className) {
			finalClassName = 'jb_'+className;
			jBartWidgets.vars.usedJBClasses = jBartWidgets.vars.usedJBClasses || {};
			if (jBartWidgets.vars.usedJBClasses[finalClassName]) {
				finalClassName += (++jBartWidgets.vars.uniqueNumber);
			}
			jBartWidgets.vars.usedJBClasses[finalClassName] = true;
		} else {
			finalClassName = 'jb' + (++jBartWidgets.vars.uniqueNumber);
		}
		var obj = { elem_class : finalClassName , globalcss: globalcss};
		if (globalcss.indexOf('#cntr') >= 0)
			obj.cntr_class = 'jb' + (++jBartWidgets.vars.uniqueNumber);			
		aa_container_styles[entry] = obj;
		
		obj.globalcss = aa_clean_global_css(obj.globalcss);
		obj.globalcss = aa_adapt_css_for_browser(obj.globalcss);
		if (!aa_is_css_well_formed(obj.globalcss)) {
			var error = [];
			aa_is_css_well_formed(obj.globalcss,error);
			ajaxart.log("Css is invalid: " + error[0] + ". Css: " + obj.globalcss,"error");
			return "";
		}
		if (classForItem) {
			obj.globalcss = obj.globalcss.replace(/#item/g,'.'+classForItem);
		}
		obj.globalcss = obj.globalcss.replace(/#popup/g,'.jbart_popups >.'+obj.elem_class+'_popup');
		obj.globalcss = obj.globalcss.replace(/#this/g,'.'+obj.elem_class);
		obj.globalcss = obj.globalcss.replace(/#id/g,obj.elem_class);	// for animation ids: http://www.w3schools.com/css/css3_animations.asp
		if (supportWrapper)
		  obj.globalcss = obj.globalcss.replace(/#wrapper/g,'.'+obj.elem_class+'_wrapper');
		if (obj.cntr_class)
			obj.globalcss = obj.globalcss.replace(/#cntr/g,'.'+obj.cntr_class);
		
//		obj.globalcss = aa_expandCuscoVariablesMustacheStyle(obj.globalcss,context);
		obj.globalcss = obj.globalcss.replace(/_jbartImages_/g,aa_base_images());
		 
		if (settings && settings.fixGlobalCss) obj.globalcss = settings.fixGlobalCss(obj.globalcss);

		if (ajaxart.isIE) {	// IE limitation: does not support many style elems
			if (ajaxart.isIE78) {	// IE8 does not support changing innerHTML of attached style element
				window.jbIE8StyleElemCache = window.jbIE8StyleElemCache || '';
				window.jbIE8StyleElemCache += obj.globalcss + '  ';

				aa_run_delayed_action('IE8_style_elem_fix',function() {
					var styleElem = jQuery("<style>" + window.jbIE8StyleElemCache + "</style>")[0];
					var head = document.getElementsByTagName("head")[0];
					head.appendChild(styleElem);
					window.jbIE8StyleElemCache = '';
				},100,true);

			} else {
				if (!jBart.styleElem) {
					jBart.styleElem = jQuery("<style></style>")[0];
					var head = document.getElementsByTagName("head")[0];
					head.appendChild(jBart.styleElem);
				}
				var currentValue = jBart.styleElem.styleSheet ? jBart.styleElem.styleSheet.cssText : jBart.styleElem.innerHTML;
				var newCss = lowPriority ? obj.globalcss + '\n' + currentValue : currentValue + '\n' + obj.globalcss;
				if (jBart.styleElem.styleSheet)
					jBart.styleElem.styleSheet.cssText = newCss;
				else 
					jBart.styleElem.innerHTML = newCss;
			}
		} else {
			if (!obj.styleElem) {
				obj.styleElem = jQuery("<style></style>")[0];
				var head = document.getElementsByTagName("head")[0];
				head.appendChild(obj.styleElem);
			}
			obj.styleElem.innerHTML = obj.globalcss;
		}
		// obj.styleElem.StyleObject = obj;
	}
	
	if (cntr && aa_container_styles[entry].cntr_class)
		jQuery(cntr).addClass(aa_container_styles[entry].cntr_class);
	return aa_container_styles[entry].elem_class;
}

function aa_is_css_well_formed(css, error)
{
	// TODO: support css remarks
	// counting nesting brackets, ensuring there are no more closing brackets then opening brackets at any point 			
	var selector_count = 0;
	var level = 0;
	for (var j=0; j<css.length; j++) {
		if (css.charAt(j) == '{') { level++; selector_count++; }
		else if (css.charAt(j) == '}') {
			level--;
			if (level<0) {
				return false;
				if (error) error.push('Too many closing brackets in item:' + selector_count);
			}
		}
	}	
	if (level != 0) {
		if (error) error.push('Missing closing bracket');
		return false;
	}
	// Make sure there are only white spaces after the last '}'
	var suffix = css.substring(css.lastIndexOf('}')+1);
	if (suffix && !suffix.match(/\s*/) || suffix.match(/\s*/)[0] != suffix) {
		if (error) error.push('There are characters after the last closing bracket');
		return false;
	}
	return true;
}
function aa_expandCuscoVariablesMustacheStyle(text,context)
{
	if (text.indexOf('{{') == -1 || !context) return text;
	text = text.replace(/{{/g,'%').replace(/}}/g,'%');
	text = ajaxart.dynamicText([],text,context,[],false,false)[0];
	return text;
}
function aa_clean_global_css(css)	// makes sure '#this' is included in all expressions
{
	var index=0;
	while (1) {
		var bracket_index = css.indexOf('{',index);
		if (bracket_index == -1) break;
		var prefix = css.substring(index,bracket_index);
		if (prefix.indexOf("#") == -1) {	// must contain #
			if (prefix.lastIndexOf("*/") > -1)	// handle remarks
				prefix = prefix.substring(prefix.lastIndexOf("*/")+2);
//			prefix = prefix.replace(new RegExp("^[ \t\n\r]*"),"");	// trimming left white spaces
			if (prefix.indexOf("@") != -1) { index = bracket_index+1; continue; }	// don't touch meta classes, like @media print { input { color:green; } }
			if (aa_trim(prefix) == "from" || prefix.trim() == "to") { index = css.indexOf('}',bracket_index)+1; continue; }	// don't touch form and to: http://www.w3schools.com/css/css3_animations.asp
			var new_prefix = "#this " + prefix.split(",").join(",#this ");	// handle multiple selectors, like: input,textarea { color:red; }
			css = css.substring(0,bracket_index-prefix.length) + new_prefix + css.substring(bracket_index);
		}
		index = css.indexOf('}',bracket_index) +1;
		if (index == 0) break;
	}
	if (css.indexOf("{") == -1 && css.indexOf("}") == -1)
		css = "#this {" + css + "}";
	return css;
}
function aa_setCssText(elem,cssText)
{
  if (ajaxart.isFireFox) cssText = cssText.replace(/-webkit-/g,'-moz-');
  elem.style.cssText = cssText;
}
function aa_in_textlist(list,item)
{
  if (list.indexOf(','+item+',') == -1) return false;
  return true;
}
function aa_add_onorientationchange(func)
{
	if (!window.aav_onorientationchange) window.aav_onorientationchange = [];
	aav_onorientationchange.push(func);
}
function aa_init_ipad(options)
{
  if (!options) options = { orientationClasses: true };
  var setOrientationClass = function() {
	  var orientation = (window.orientation == 0 || window.orientation == 180) ? "portrait" : "landscape";
	  document.body.parentNode.setAttribute('class', orientation);  
	  
	  if (ajaxart.jbart_studio) {  // design time mode
		  orientation = aa_url_attribute(window.location.href,"ipad_orient");
		  if (orientation != "portrait") orientation = "landscape";
		  jQuery('body').removeClass('portrait').removeClass('landscape').addClass(orientation);
	  } 
	  if (window.aav_onorientationchange) {
		  for(var i in window.aav_onorientationchange) window.aav_onorientationchange[i](orientation);
	  }
  }
  if (options.orientationClasses) {
	  window.onorientationchange = setOrientationClass;
	  setOrientationClass();
  }
}
function aa_addOnAttachMultiple(elem,func)
{
	jBart.bind(elem,'_OnAttach',func);
	aa_addOnAttach(elem,function() {
		jBart.trigger(elem,'_OnAttach');
	});
}
function aa_addOnAttach(elem,func)
{
	$(elem).addClass('aa_onattach');
	elem.jbOnAttach = func;
	if (ajaxart.isattached(elem)) elem.jbOnAttach();
}
function aa_defineElemProperties(elem,properties)
{
	if (!elem.jBartDomProps) elem.jBartDomProps = properties.split(',');
	else ajaxart.concat(elem.jBartDomProps,properties.split(','));
}
function aa_clear_events(elem)
{
	jQuery(elem).unbind();
	
    if (elem.jbEvents && elem.detachEvent) {
    	for(var i=0;i<elem.jbEvents.length;i++) {
    		elem.detachEvent(elem.jbEvents[i].event,elem.jbEvents[i].callback);
    	}
    }
    for (var i in elem) {
    	if (i.indexOf('on') == 0) elem[i] = null;
    	if (elem['on'+i]) elem['on'+i] = null;
  	}
    
}
function aa_remove(elem,cleanMemoryLeaks)
{
	if (!elem) return;
	if (elem.parentNode) elem.parentNode.removeChild(elem);
	if (window.jBartNodeJS) return;
	aa_element_detached(elem);

	if (cleanMemoryLeaks)
	  jQuery(elem).remove(); // jQuery events leak in chrome as well

	if (cleanMemoryLeaks && ajaxart.isIE)  // http://msdn.microsoft.com/en-us/library/Bb250448 
	{
		function doCleanMemoryLeaks(elem) {
			if (elem.nodeType != 1) return;
		    if (elem.jbEvents && elem.detachEvent) {
		    	for(var i=0;i<elem.jbEvents.length;i++) {
		    		elem.detachEvent(elem.jbEvents[i].event,elem.jbEvents[i].callback);
		    	}
		    }
		    for (var i in elem) {
		  	  if (i.indexOf('on') == 0 || i.indexOf('jb') == 0) elem[i] = null;
	    	  if (elem['on'+i]) elem['on'+i] = null;
		  	}
		    if (elem.jBartDomProps) {
		    	for(var i=0;i<elem.jBartDomProps.length;i++) {
		    	  // if (elem.jBartDomProps[i] != 'jBartDomProps')
		    	  //   elem[elem.jBartDomProps[i]] = null; 
		    	}
		    	elem.jBartDomProps = null;
		    }
		    
		    elem.ajaxart = elem.Cntr = elem.Data = elem.ItemData = elem.Dialog = elem.jElem = elem.Field = elem.OnDetach = elem.Contents = null;
		    elem.FieldData = elem.contentChanged = elem.CellPresentation = elem.Context = elem.jBart = null;
		    
		    var cleanAllProps = false;
	  	    if (cleanAllProps) {
	  	    	for(var i in elem) {
		  		  try {
		  			if (elem[i]) {
		  				elem[i] = null;
		  			    ajaxart.log('memomry leak - ' + i,'error');
		  			}
		  		  } catch(e) {}
	  	    	}
		  	}
	  	    try {
		      // for (var i in elem) if (elem[i]) ajaxart.log('dom element property - ' + i,"error"); 
	  	    } catch(e) {}
	  	    
		    var child = elem.firstChild;
		    while(child) {
		    	doCleanMemoryLeaks(child);
		    	child = child.nextSibling;
		    }
		}
		doCleanMemoryLeaks(elem);
		
		var tag = aa_tag(elem) && aa_tag(elem).toLowerCase();
		try {
			if (tag != 'table' && tag != 'tfoot' && tag != 'thead' && tag != 'tr')	// http://support.microsoft.com/kb/239832
				elem.innerHTML = "";
		} catch(e) {}
	}
//	if (cleanMemoryLeaks && ajaxart.isIE)  { 
//	}
}
jBart.remove = function(elem) { aa_remove(elem,true); }
function aa_remove_from_list(list,item)
{
	for(var i in list)
		if (list[i] == item) {
			list.splice(i,1);
			return;
		}
}
function aa_renderStyleObject2(style,apiObject,field_data,field,context,settings) {
	try {
		apiObject.field = field;
		apiObject.field_data = field_data;
		apiObject.context = context;

		apiObject.params = style.params;
		if (field) aa_trigger(field,'initApiObject',{ apiObject: apiObject, field_data: field_data });

		if (style.Field) {  // style by field
			var wrapper = document.createElement('div');
			var ctx = aa_ctx(context,{ ApiObject: [apiObject] });
			var styleField = style.Field(field_data,ctx); 
			aa_fieldControl({ Field: styleField, Item: field_data, Wrapper: wrapper, Context: ctx });
			var content = $('<div style="display:inline-block;" class="aa_style_by_field_wrapper" />').append(wrapper);
			apiObject.control = apiObject.el = content[0];
			apiObject.$el = $(apiObject.el);
			apiObject.wrapperForStyleByField = wrapper;
			content[0].jbApiObject = apiObject;
			return content[0];
		}

		if (style.render) { 
			var out = style.render(apiObject,settings); 
			out.jbApiObject = apiObject;
			return out;
		}
		style.Html = style.Html.replace(/>\s+</g,'><');		// allow indentation in html without injecting whitespaces. e.g: <div class="text"/> <div class="separator" /> 
		var out = $(style.Html)[0] || $('<div/>')[0];
		apiObject.elem_class = aa_attach_global_css(style.Css,null,null,false,false,context,settings); 
		apiObject.el = out;
		apiObject.$el = $(out);

		$(out).addClass(apiObject.elem_class); 
		aa_apply_style_js(apiObject,style,context);
		
		return out;
	} catch(e) {
		ajaxart.logException('error rendering style object',e);
		return $('<div/>').get();		
	}	
}

function aa_renderStyleObject(style,objectProperties,context,objectIsNotTheElement,settings)
{
	try {
		if (style.Field) {  // style by field
			var object = aa_api_object(jQuery('<div/>')[0],objectProperties,objectIsNotTheElement);
			var item = objectProperties.data ? [objectProperties.data] : [];
			var wrapper = document.createElement('div');
			var ctx = aa_ctx(context,{ ApiObject: [object] });
			var styleField = style.Field(item,ctx); 
			aa_fieldControl({ Field: styleField, Item: item, Wrapper: wrapper, Context: ctx });
			var content = jQuery('<div style="display:inline-block;" class="aa_style_by_field_wrapper" />').append(wrapper);
			object.control = content[0];
			object.wrapperForStyleByField = wrapper;
			content[0].jbApiObject = object;
			return content[0];
		}
		style.Html = style.Html.replace(/>\s+</g,'><');		// allow indentation in html without injecting whitespaces. e.g: <div class="text"/> <div class="separator" /> 
		var jElem = jQuery(style.Html);
		if (!jElem[0]) jElem = jQuery('<div/>');
		objectProperties.context = context;
		if (style.params)
			objectProperties.params = style.params;
		var object = aa_api_object(jElem,objectProperties,objectIsNotTheElement);
		var cntr = context.vars._Cntr ? context.vars._Cntr[0] : null;
		object.elem_class = aa_attach_global_css(style.Css,cntr,null,false,false,context,settings); 
		jElem.addClass(object.elem_class); 
		aa_apply_style_js(object,style,context);
		
		return jElem[0];
	} catch(e) {
		ajaxart.logException('error rendering style object',e);
		return jQuery('<div/>').get();
	}
}

function aa_apply_style_js(obj,style,context,funcName)
{
	funcName = funcName || 'render';
	aa_style_context = { jElem: obj.jElem }
	if (!style.jsFunc && style.Javascript ) {
		jBart.compiledJS = jBart.compiledJS || {};
		var compiledJs = jBart.compiledJS[style.Javascript];
		if (!compiledJs) {
			compiledJs = {};
			try {
				if (style.Javascript.indexOf('function ' + funcName + '(') > -1) {
					eval('compiledJs.jsFunc = function(obj,context,funcToRun) { ' + style.Javascript + '\n return ' + funcName + '(obj,context); };');
				} else { // backward compatability
			  		eval('compiledJs.jsFunc = ' + style.Javascript);
			  	}
			} catch(e) {
				ajaxart.logException(e,'could not compile a js function ' + style.Javascript);
				if (jBart.onJsError)
					jBart.onJsError(e, style.Javascript);
			}
			jBart.compiledJS[style.Javascript] = compiledJs;
		}
		style.jsFunc = compiledJs.jsFunc;
	}
	try {
		if (style.jsFunc) return style.jsFunc(obj,context);
	} catch(e) {
		ajaxart.logException(e,'error running js code :' + style.Javascript);
		if (jBart.onJsError)
			jBart.onJsError(e, style.Javascript);
	}
}
function aa_find_class(jElem,cls)
{
	if (jElem.hasClass(cls)) return jElem;
	return jElem.find('.'+cls);
}
function aa_init_image_object(image,data,context)
{
	if (typeof(image) == 'string') return {StaticUrl: image, Size: ''};
	if (!image || !image.Url) return;
	image.StaticUrl = aa_totext(image.Url(data,context));
	return image;
}
function aa_set_image(elem,image,deleteWhenEmpty,size)
{
	if (!image) {
		if (deleteWhenEmpty) aa_remove(elem,true); 
		return; 
	}
	if (image && image.InCssClass) {
		jQuery(elem).css('display','block').addClass(image.CssClass);
		return;
	}
	if (image && (image.inSprite || image.asDivBackground) ) {
		var css = '#this { background:'+'url('+image.StaticUrl+') '+image.x+' ' + image.y + ' no-repeat; ';
		css += 'width: ' + image.width + '; height: ' + image.height + '; display:block; } ';
		
		if (image.hoverx) css += '#this:hover { background-position: ' + image.hoverx + ' ' + image.hovery + ' } ';
		if (image.activex) css += '#this:active { background-position: ' + image.activex + ' ' + image.activey + ' } ';
		jQuery(elem).addClass(aa_attach_global_css(css));
		return;
	}
	if (elem && elem.firstChild && elem.firstChild.tagName && elem.firstChild.tagName.toLowerCase() == 'img')
		return aa_set_image(elem.firstChild,image,true,size);
	if (elem && elem.tagName.toLowerCase() != 'img') {
		var imgElem = document.createElement('img');
		elem.appendChild(imgElem);
		var size2 = size || image.Size;
		if (size2) {
			size2 = size2.replace(/px/g,'');	// removing px for 
			var imageSize = size2.split(',');
			if (imageSize.length == 1) imageSize.push('0');
			for(var i in imageSize) if (imageSize[i] == '') imageSize[i] = '0';
			if (imageSize[0] != '0') elem.style.width = imageSize[0]+'px';
			if (imageSize[1] != '0') elem.style.height = imageSize[1]+'px';
		}
		return aa_set_image(imgElem,image,true,size);
	}
	if (typeof(image) == 'string') image = {StaticUrl: image, Size: ''};
	
	var src = image.StaticUrl || '';
	if (src == "") src = image.SecondUrl;
	if (src == "") {
		if (deleteWhenEmpty) aa_remove(elem,true);
		return;
	}
	elem.setAttribute('src',src);
	
	var size2 = size || image.Size;
	if (size2 == "") return;
	
	var imageSize = size2.split(',');
	if (imageSize.length == 1) imageSize.push('0');
	for(var i in imageSize) if (imageSize[i] == '') imageSize[i] = '0';
	
	aa_defineElemProperties(elem,'ImageWidth,ImageHeight');
	
	elem.ImageWidth = parseInt(imageSize[0].split('px')[0]); 
	elem.ImageHeight = parseInt(imageSize[1].split('px')[0]);
	if (elem.ImageWidth > 0) elem.width = elem.ImageWidth;
	if (elem.ImageHeight > 0) elem.height = elem.ImageHeight;
	if (elem.ImageWidth * elem.ImageHeight == 0) return;
	
	function FixImageSize(imgObj) 
	{
		var naturalWidth = imgObj.width,naturalHeight = imgObj.height;
		if (naturalWidth < elem.ImageWidth) elem.width = naturalWidth; 
		if (naturalHeight < elem.ImageHeight) elem.height = naturalHeight;
		var width = Math.min(naturalWidth,elem.ImageWidth), height = Math.min(naturalHeight,elem.ImageHeight); // IE hates img.width
		
		if (image.KeepImageProportions) {
			var ratio = naturalWidth / naturalHeight;
			var currRatio = width / height;
			if (ratio != currRatio) {
				if (naturalWidth >= naturalHeight * currRatio) {
					elem.width = elem.ImageWidth;
					elem.height = Math.floor(width / ratio);
				} else {
					elem.height = elem.ImageHeight;
					elem.width = Math.floor(height * ratio);
				}
			}
		}
	}
	  
	var imgObj = new Image(); imgObj.src = src;
	if (imgObj.complete) 
		FixImageSize(imgObj);
	else 
		elem.onload = function() { FixImageSize(imgObj);}
}
function aa_runActionOnClick(callback_func) {
  return function(e) {
	  var inner = jQuery(this)[0];
	  if (window.aa_incapture) return false;
	  if (inner.jbLastTimeClicked) {
		  if (new Date().getTime() - inner.jbLastTimeClicked < 300) return false; // double click
	  } 
	  inner.jbLastTimeClicked = new Date().getTime();
	  callback_func.call(inner,{event: e}); return false;
  }
}
function aa_api_object(jElem,props,objectIsNotTheElement)
{
	jElem = jQuery(jElem);
	if (objectIsNotTheElement) 
		var out = props;
	else {
		out = jElem[0];
		for(i in props) out[i] = props[i];
	}
	out.jElem = out.$el = jElem;
	out.control = out.el = jElem[0];
	jElem[0].jbApiObject = out;
	if (props)
	  if (props.context || props.Context) jElem[0].jbContext = props.context || props.Context;
	
	var props_str = 'jElem,getInnerElement,setInnerHTML,setImageSource,setImage,setOnClick,bind,trigger,control';
	for(var i in props) props_str += (','+i);
	if (!objectIsNotTheElement) aa_defineElemProperties(out,props_str); // for memory leaks
	
	out.bind = function(eventType,func) {
		this.jbListeners = this.jbListeners || [];
		this.jbListeners.push( { eventType: eventType, callback: func });
	}
	out.trigger = function(eventType,argsObject) {
		if (!this.jbListeners) return;
		for(var i=0;i<this.jbListeners.length;i++) {
			if (this.jbListeners[i].eventType == eventType)
				this.jbListeners[i].callback(argsObject);
		}
	}
	out.getInnerElement = function(classOrElement)
	{
		if (typeof(classOrElement) == 'string') {  // it is a class
			if (classOrElement == '') return this.jElem[0];
			if (classOrElement.indexOf('.') == 0)
			  return aa_find_class(this.jElem,classOrElement.substring(1))[0];
			return null;
		}
		return classOrElement || this;
	}
	out.setInnerHTML = function(classOrElement,text)
	{
		var inner = this.getInnerElement(classOrElement);
		if (inner) inner.innerHTML = text;
	}
	out.setImage = out.setImageSource = function(classOrElement,imageObject,deleteIfNoImage)
	{
		var inner = this.getInnerElement(classOrElement);
		if (inner) aa_set_image(inner,imageObject,deleteIfNoImage);
	}
	out.setOnClick = function(classOrElement,callback_func,jbart_click_behavior)
	{
		var inner = this.getInnerElement(classOrElement);
		if (!inner || !callback_func) return;
		inner.jbart_click_behavior = jbart_click_behavior;
		if (!jbart_click_behavior ) {
		  inner.onclick = function(e) {
			  if (window.aa_incapture) return false;
			  if (inner.jbLastTimeClicked) {
				  if (new Date().getTime() - inner.jbLastTimeClicked < 300) return false; // double click
			  } 
			  inner.jbLastTimeClicked = new Date().getTime();
			  callback_func.call(out,{event: e}); return false; 
		  }
		}
		else {
			// jbart click behavior
			var mouseHandlers = function(btn) { 
				  jQuery(btn).mousedown( function() {
					  var jbtn = jQuery(btn);
					  if (jbtn.attr('pressed_src') != "")
					  {
						  jbtn.attr('src',jbtn.attr('pressed_src'));
					  	  jbtn.addClass('pressed').addClass('pressing');
					  }
				  }).mouseout( function() {
					  var jbtn = jQuery(btn);
					  jbtn.removeClass('pressed');
					  jbtn.attr('src',jbtn.attr('original_src'));
				  }).mouseover( function() {
					  var jbtn = jQuery(btn);
					  if (jbtn.hasClass('pressing')) {
					    jbtn.addClass('pressed').removeClass('pressing');
						jbtn.attr('src',jbtn.attr('pressed_src'));
					  }
				  }).keydown( function(e) {
						e = e || event;
						if (e.keyCode == 13) // enter
						{
							ajaxart_stop_event_propogation(e);
							click(btn);
							return false;
						}
				  }).mouseup( function(e) {
					  var jbtn = jQuery(btn);
					  if (jbtn.hasClass('pressed') && !window.aa_incapture) callback_func();
				  });
			};
			mouseHandlers(inner);
		}
	}
	return out;
}
//whenever an html content changes, one needs to call aa_htmlContentChanged
//It will fix dialog sizes , special scrollbars (iscroll , tuiny scrollbar, etc.)
//To do something when the html content changes, one can define contentChanged method for an html element
function aa_htmlContentChanged(elem)
{
	while (elem != null) {
		if (elem.contentChanged) elem.contentChanged();
		elem = elem.parentNode;
	}
}
function aa_jbart_image(image,context)
{
   var base = (context.vars._Images && context.vars._Images[0]) || '';
   return base + image;
}
if (! window.aa_base_images)
aa_base_images = function()
{
	if (window.location.href.indexOf('http://localhost/ajaxart') == 0 || window.location.href.indexOf('https://localhost/ajaxart') == 0  || window.location.href.indexOf('http://localhost:8087/ajaxart') == 0)
		return 'images';
	return ajaxart.base_images || '';
};

if (! window.aa_base_lib)
aa_base_lib = function()
{
	if (window.location.href.indexOf('http://localhost/ajaxart') == 0 || window.location.href.indexOf('https://localhost/ajaxart') == 0 || window.location.href.indexOf('http://localhost:8087/ajaxart') == 0)
		return '/ajaxart/lib';
	return ajaxart.base_lib || '';
};

function aa_crossdomain_call(params, use_jsonp)
{
	if (!use_jsonp) {
		params.type = params.type || 'GET';
		var request = ajaxart.isIE ? new window.XDomainRequest() : new XMLHttpRequest();
        function handler(evtXHR) {
		    var request = this;
			if (request.readyState == 4 && params.success) 
				params.success(request.responseText,request.status);
		}
		if (jQuery.browser.msie) {
			request.open(params.type, params.url);
			request.onload = function(evtXHR) {
				if (this.responseText && params.success)
					params.success(this.responseText);
				if (!this.responseText && params.error)
					params.error();
			}
		} else {
			request.open(params.type, params.url, true);
			request.onreadystatechange = handler;
		}
		if (request.setRequestHeader)	// IE9 doesn't support this method
			request.setRequestHeader('Content-Type',params.dataType || 'text/plain; charset=utf-8');
		if (params.type == 'POST')
			request.send(params.data);
		else
			request.send();
	  ajaxart.log("calling crossdomain, type:" + params.type + ", \nurl:" + params.url + ",\ndata:" + params.data, "http");
	}
	else {
	  if (!ajaxart.jSonRequests) ajaxart.jSonRequests = {}
	  if (!ajaxart.jsonReqCounter) ajaxart.jsonReqCounter = 0;
	  window.aa_jsonp_callback = function(server_content,id,url)
	  {
	  	 if (ajaxart && ajaxart.jSonRequests[id]) {
	  		  ajaxart.jSonRequests[id].success(server_content);
	  		ajaxart.jSonRequests[id] = null;
	  	 }
	  }
	  ajaxart.jsonReqCounter = (ajaxart.jsonReqCounter + 1) % 1000;
	  ajaxart.jSonRequests[ajaxart.jsonReqCounter] = params; 
	  var url = params.url + '&aa_req_id=' + ajaxart.jsonReqCounter;
	  if (params.type == "POST" && params.data)
		  url = url + "&aa_postdata=" + encodeURIComponent(params.data);
	  jQuery.ajax( { cache: false ,dataType: 'script', httpHeaders : [], url: url, 
	  	error: function(jqXHR, textStatus, errorThrown) {
	  		params.error(textStatus + " " + errorThrown);
	  	} });
	}
}
jBart.aa_crossdomain_call = aa_crossdomain_call;	// to be able to access it from outside

function aa_getWidgetIDFromContext(context)
{
	if (context.vars.WidgetId) return aa_totext(context.vars.WidgetId);
	
	var elem = context.vars._AppContext[0].AppXtml;
	while (elem && elem.tagName != 'bart_sample' && elem.tagName != 'jbart_project')
		elem = elem.parentNode;
	if (elem) return elem.getAttribute('id') || '';
	return '';
}

jBart.utils.removeFromArray = function(array,object)
{
	for(var i=0;i<array.length;i++)
		if (array[i] == object) {
			array.splice(i,1);
			return;
		}
}
jBart.utils.refresh = function(element)
{
	while (element.ReplacedBy) element = element.ReplacedBy;
	
	var ctx = element.ajaxart;
	if (typeof(ctx) == "undefined" || ctx == null) return;

	var newData = ctx.data;
	if (ctx.origData != null) newData = ctx.origData;
	
	var newControl = aa_first(newData,ctx.script,"",ctx.params);
	if (newControl == "") newControl = document.createElement('div');
	aa_defineElemProperties(element,'ReplacedBy');
	element.ReplacedBy = newControl;
	
	aa_replaceElement(element,newControl,true);
	
	return newControl;
}
function aa_trigger(object,eventType,eventObject) {
	if (!object || !object.jbListeners || !object.jbListeners[eventType]) return;
	eventObject = eventObject || {};
	eventObject.eventType = eventType;
	
	var listeners = object.jbListeners[eventType];
	for(var i=0;i<listeners.length;i++) {
		try {
			listeners[i].handler.apply(object,[eventObject]);
		} catch(e) {
			ajaxart.logException(e,'error trigerring event ' + eventType);
		}
	}	
}
function aa_bind(object,eventType,handler,identifier,elementForAutoUnbind,addAsFirstListener) {
	if (!object) return;
	object.jbListeners = object.jbListeners || {};
	object.jbListeners.counter = object.jbListeners.counter || 0;
	var listenerID = ++object.jbListeners.counter;

	object.jbListeners[eventType] = object.jbListeners[eventType] || [];
	var listeners = object.jbListeners[eventType];

	for(var i=0;i<listeners.length;i++) {
		if (identifier && listeners[i].eventType == eventType && listeners[i].identifier == identifier) {
			listeners[i].handler = handler;
			return;
		}
  }
  var item = {eventType: eventType, handler: handler, identifier: identifier, listenerID: listenerID };
	if (addAsFirstListener)
		listeners.unshift(item);
	else
		listeners.push(item);	

	if (elementForAutoUnbind) {
		aa_addOnDetach(elementForAutoUnbind,function() { 
			aa_unbind(object,listenerID);
		});
	}

	return listenerID;
}

function aa_unbind(object,listenerID) {
	if (!object || !object.jbListeners) return;

	for(var i in object.jbListeners) {
		var listeners = object.jbListeners[i];
		if (!listeners.length) continue;

		for(var j=0;j<listeners.length;j++) {
			if (listeners[j].listenerID == listenerID) {
				listeners.splice(j,1);
				return;
			}
		}	
	}
}
function aa_async_trigger(object,eventType,eventObject) {
	var asyncDeferred = $.Deferred();

	if (!object || !object.jbListeners || !object.jbListeners[eventType]) return;
	eventObject = eventObject || {};
	eventObject.eventType = eventType;
	
	var listeners = object.jbListeners[eventType];
	var i=0;
	doNext();

	return asyncDeferred.promise();

	function doNext() {
		if (i>=listeners.length)
			return asyncDeferred.resolve();

		try {
			var promise = listeners[i].handler.apply(object,[eventObject]);
		} catch(e) {
			ajaxart.logException(e,'error trigerring event ' + eventType);
			var promise = null;			
		}
		$.when(promise).then(function() {
			i++;
			doNext();
		});
	}
	
}


jBart.trigger = aa_trigger;
jBart.bind = aa_bind;

jBart.activator = function(widgetSource) {
	jBart.xml2text = ajaxart.xml2text; // for F12
	// https://docs.google.com/a/artwaresoft.com/document/d/1SBPGSmYhLuwhxH9H7LtdOKsQ5VN4SdcqBMl1V3G6Kmc/edit#heading=h.k74m6lqj4kpw
	return {
		show: function(div,params) {
			div = jQuery(div)[0];
			var jbartObject = this;
			if (!params) params = {};
			if (!params.widget_src)
				params.widget_src = widgetSource;
			jBart.appendWidget(div,params,jbartObject);				
			jbartObject._initialized = true;
		},
		init: function(settings) {
			var jbartObject = this;
			settings = settings || {};
			aa_jbart_init_activator(jbartObject,settings);
		},
		showPage: function(div,settings) {
			// must be called after init
			div = jQuery(div)[0];
			if (!this.isInitialized()) return;
			aa_jbart_activator_showPage(this,div,settings);			
		},
		isInitialized: function() { 
			return !!this.Context;
		},
		jBart: jBart,
		_widgetSource: widgetSource
	}
} 
jBart.parsexml = function(contents,baseXml) { return aa_parsexml(contents,'','',false,baseXml); }

// settings include: 
// url 
// variableToFind - look for a variable under window
// isLoaded (optional) - a callback function which returns true when the js is loaded
// loadFunction (optional) - allows a different loading js rather than aa_load_js_css(url)
// success, error - callback functions
function aa_loadJsFile(settings) {
	settings.success = settings.success || function() {}
	if (!settings.isLoaded ) {
		settings.isLoaded = function() {
			if (!settings.variableToFind) return true;
			if (window[settings.variableToFind]) return true;
			return false;
		}
	}
	function checkLoaded() {
		try {
			if (settings.isLoaded()) return true;
		} catch(e) {}
		return false;
	}

	var availableTries = 20;
	var firstTime = true;
	checkWithTimeout();
	
	function checkWithTimeout()
	{
		if (checkLoaded()) return settings.success();
		if (firstTime) {
			if (settings.loadFunction) settings.loadFunction(settings.url);
			else aa_load_js_css(settings.url, 'js');
		}
		firstTime = false;
		
		if (--availableTries <=0 ) {
			settings.error = settings.error || function() {}
			return settings.error();
		}
		setTimeout(checkWithTimeout,500);
	}
}

function aa_create_jbart_context(settings) {
	var widgetXml = settings.WidgetXml;
	var context = settings.Context || ajaxart.newContext();
	var uiprefObj = uipref_in_cookies();
	
	var widgetId = widgetXml.getAttribute('id') || 'gdrive';
	var appXtml = aa_xpath(widgetXml,"bart_dev/db/bart_unit/bart_unit/Component[@id='App']/xtml")[0];
	if (!appXtml) appXtml = aa_xpath(widgetXml,"xtml/Component[@id='Widget']/xtml")[0];

	var language = settings.Language || aa_totext( aa_xpath(appXtml,"Language/@Language") ); 
	var globalVars = {};
	
	var resources = widgetDataResources();
	
	var bctx = {
	  AppXtml: appXtml,
	  Resources: resources,
	  Url: ajaxart.runComponent('bart_url.BrowserUrl',[],context)[0],
	  ValidationStyle: ajaxart.runComponent('validation.DefaultOld',[],context)[0]
	};

	if (settings.jbartObject) settings.jbartObject._AppContext = bctx;	

	var ctx = aa_ctx(context, { 
		_GlobalVars: [globalVars], _UIPref: [uiprefObj], Language: [language] , 
		_AppContext: [bctx], _WidgetXml: [widgetXml]
	});
	bctx.context = ctx;

	loadSampleComponents();		
	runAppFeatures();
	resourcesToGlobalVars();
	setOldPages();
	AppFeatures_Load();
	overrideUIPrefs();

	return ctx;

  function loadSampleComponents() {
  		ajaxart.componentsXtmlCache.sample = null;
    	
    	var namespaces = aa_xpath(widgetXml,"xtml");
    	var unit = aa_xpath(widgetXml,"bart_dev/db/bart_unit/bart_unit")[0];
    	if (unit) namespaces.push(unit);

    	for(var j=0;j<namespaces.length;j++) {
    		var ns = namespaces[j].getAttribute('ns') || 'sample';
	    	ajaxart.components[ns] = ajaxart.components[ns] || {};

    		var comps = aa_xpath(namespaces[j],'Component');
	    	for(var i=0;i<comps.length;i++) {
	    		  var id = comps[i].getAttribute("id");
	  	      ajaxart.components[ns][id] = comps[i];
	  	      ajaxart.componentsXtmlCache[ns+'.'+id] = null;
	  	      if (comps[i].getAttribute('execution') == 'native') {
	  	      	var code = aa_cdata_value(aa_xpath(comps[i],'Code')[0]);
	  	      	if (code) {
	  	      		ajaxart.gcs[ns] = ajaxart.gcs[ns] || {};
	  	      		eval('ajaxart.gcs[ns][id] = ' + code);
	  	      	}
	  	      }
	    	}
	    	
    		var types = aa_xpath(namespaces[j],'Type');
	    	for(var i=0;i<types.length;i++) {
    			ajaxart.types[ns + "_" + types[i].getAttribute('id')] = types[i];
    		}

    	}

  }
	function runAppFeatures() {
		bctx.Features = [];
		var featuresXtml = aa_xpath(appXtml,'ApplicationFeature');
		for(var i=0;i<featuresXtml.length;i++) {
			try {
			  ajaxart.concat(bctx.Features, ajaxart.run([],featuresXtml[i],'',ctx));
			} catch(e) {}
		}
	}
		
	function resourcesToGlobalVars()
	{
		window.jbDebugResource = globalVars;
		
		var resources = bctx.Resources;
		for(var i=0;i<resources.length;i++) {
			var init = function(resource) {
				var id = aa_totext(resource.ID);
				globalVars[id] = function() { return resource.Items; }
			}
			init(resources[i]);
		}

	}
	
	function setOldPages() {
		bctx.Pages = [];
		var pagesXtml = aa_xpath(appXtml,'Pages/Page');
		for(var i=0;i<pagesXtml.length;i++) 
			ajaxart.concat(bctx.Pages, ajaxart.run([],pagesXtml[i],'',ctx));
	}

	function AppFeatures_Load() {
		for(var i=0;i<bctx.Features.length;i++) {
			var feature = bctx.Features[i];
			try {
			  if (feature.Load) feature.Load([],ctx);
			} catch(e) {
				ajaxart.logException(e,'Loaing App Features Failure');
			}
		}
	}
	
	function overrideUIPrefs() {
		var uiPrefs = aa_xpath(widgetXml,'bart_dev/db/bart_unit/bart_unit/UIPref/*');
		for(var i=0;i<uiPrefs.length;i++) {
			var elem = uiPrefs[i];
			var prefix = elem.tagName;
			var attributes = elem.attributes;
			for(var j=0;j<attributes.length;j++) {
				var name = attributes.item(j).name;
				var value = elem.getAttribute(name);
				uiprefObj.SetProperty([],aa_ctx({ Prefix: [prefix], Property: [name], Value: [value] }));
			}
		}
	}
	function widgetDataResources() {
		var resources = [];
		var resourcesXtml = aa_xpath(appXtml,'Resources/Resource');
		if (!resourcesXtml.length) resourcesXtml = aa_xpath(appXtml,'DataResource');

		for(var i=0;i<resourcesXtml.length;i++) {
			var resourceXtml = resourcesXtml[i];
		    var resourceID = resourceXtml.getAttribute('ResourceID');
			var t = resourceXtml.getAttribute('t');
			var shortWidgetId = aa_array_lastItem(widgetId.split('/'));		    
			var varName = 'jBartWidget_' + shortWidgetId + '_' + resourceID;

			var resource = aa_first([],resourceXtml,'',aa_ctx(context,{WidgetId: [widgetId]}));
			if (window[varName]) {
				if (resource && resource.LoadFromValue && window[varName][0]) {
					resource.LoadFromValue(window[varName][0]);		// e.g. allow for xml cleaning
					resources.push( resource );
				} else {
					resources.push({ Id: resourceID, ID: [resourceID], Items: window[varName] });
				}
			} else {
				var resource = aa_first([],resourceXtml,'',aa_ctx(context,{WidgetId: [widgetId]}));
				if (resource) resources.push( resource );
				else ajaxart.log('could not create resource ' + resourceID,"error");
			}
		}
		return resources;
	}
	
	function uipref_in_cookies() {
		return {
		  GetProperty: function(data1,ctx) {
			var out = aa_valueFromCookie(aa_totext(ctx.vars.Prefix)+aa_totext(ctx.vars.Property));
			return out ? [out] : [];
		  },
		  SetProperty: function(data1,ctx) {
			aa_writeCookie(aa_totext(ctx.vars.Prefix)+aa_totext(ctx.vars.Property),aa_totext(ctx.vars.Value));
		  }
		}
	}
	
}

function aa_show_jbart_widget(settings)
{
	var ctx = aa_create_jbart_context(settings);
	if (settings.jbartObject) settings.jbartObject.Context = ctx;
	
	return aa_show_jbart_widget_page({
		Context: ctx,
		page: settings.Page,
		success: settings.success,
		ControlToShowInBartContext: settings.ControlToShowInBartContext,
		RunAfterControlWithTimer: settings.RunAfterControlWithTimer
	});
}

function aa_show_jbart_widget_page(settings)
{
	var ctx = settings.Context;
	var bctx = aa_var_first(ctx,'_AppContext');
	var pageID = settings.page;
	var appXtml = bctx.AppXtml;

	var out = document.createElement('div');
	jQuery(out).addClass('aa_widget jBartWidget');
	addWidgetCss();
	var widgetPage = showWidgetPage();
	out.appendChild(widgetPage);

	if (settings.RunAfterControlWithTimer) 
		setTimeout(runAfter,1); 
	else runAfter();
	
	if (settings.ControlToShowInBartContext) // for auto tests
		return settings.ControlToShowInBartContext([],ctx);
	
	aa_register_document_events(ctx);
  return out;

	function addWidgetCss()
	{
		var css = aa_totext(bctx.Css || []);
		if (css) 
			$(out).addClass(aa_attach_global_css(css));
	}
	function runAfter() {
		try {
			if (settings.success) settings.success([],ctx);
		} catch(e) {}
	}
	
	function showWidgetPage()
	{
	    var pageProfile = null;
	    if (pageID) {
	    	pageProfile = newPageByID(pageID);
	    	pageProfile = pageProfile || oldPageByID(pageID);
	    	if (!pageProfile) return $('<div/>').text('jbart page '+pageID+' not found')[0];
	    }
	    pageProfile = pageProfile || aa_xpath(appXtml,"MainPage1")[0];
	    if (!pageProfile && appXtml.getAttribute('MainPage')) {
	    	pageProfile = oldPageByID(appXtml.getAttribute('MainPage'));
	    }
	    pageProfile = pageProfile || newPageByID('main') || oldPageByID('main'); 
	    
	    var pageAsField = aa_first([],pageProfile,'',ctx);
	    if (pageAsField && pageAsField.Id) {
	    	var pageout = jQuery('<div/>')[0];
	    	aa_fieldControl({ Field: pageAsField, Wrapper: pageout, Item: [], Context: ctx });
	    	aa_trigger(bctx,'showPage',{ el: pageout });
	    	return pageout;
	    } else { // a page (e.g bart.SinglePage)
	    	var page = pageAsField;
	    	var pageout = page.Control([],aa_ctx(ctx,{_PageParams: [] }))[0];
	    	aa_trigger(bctx,'showPage',{ el: pageout });
	    	return pageout;
	    }
	}
  function newPageByID(pageID) {
    	return aa_xpath(appXtml, "../../Component[@id='"+pageID+"']/xtml")[0];
  }
  function oldPageByID(pageID) {
    	return aa_xpath(appXtml,"Pages/Page[@ID='"+pageID+"']")[0];		
  }
}
function aa_global_vars()
{
	window.jBartWidgets = window.jBartWidgets || { vars: {}};
	return jBartWidgets.vars;
}

function aa_loadRequiresJSFiles(settings) {
	/* Ensures some js files are loaded, and loads them if not loaded */
	var currentLoadIndex = -1;
	var timeOfAddingJsFile;

	settings.onload = settings.onload || function() {};
	settings.onerror = settings.onerror || function() {};
	
	step();

	function step() {
		currentLoadIndex++;
		if (currentLoadIndex >= settings.jsFiles.length) {
			settings.onload();
		} else {
			loadJsFile(settings.jsFiles[currentLoadIndex],step,settings.onerror);
		}
	}

	function loadJsFile(fileProperties,success,error) {
		if (checkJsVariable(fileProperties.jsVariable)) return success();

	    var fileref=document.createElement('script');
	    fileref.setAttribute("type","text/javascript")
	    fileref.setAttribute("src", fileProperties.url);
		document.body.appendChild(fileref);
		timeOfAddingJsFile = new Date().getTime();

		checkIfJsLoaded(fileProperties,success,error);
	}

	function checkIfJsLoaded(fileProperties,success,error) {
		if (checkJsVariable(fileProperties.jsVariable)) return success();
		if (new Date().getTime() - timeOfAddingJsFile > 15000) return error();

		setTimeout(function() { 
			checkIfJsLoaded(fileProperties,success,error);
		},400);
	}

	function checkJsVariable(jsVariable) {
		// support cases like: jQuery.fn.roundabout
		var parts = jsVariable.split(".");
		var current = window;
		for (i in parts) {
			current = current[ parts[i] ];
			if (!current) return false;
		}
		return true;
	}
}

function aa_hide(elem) {
	if (!jBart.classForHiddenAdded) {
		var css = '.aa_hidden_element { display: none !important; }';
		var styleElem = jQuery("<style></style>").text(css)[0];
		var head = document.getElementsByTagName("head")[0];
		head.appendChild(styleElem);
		jBart.classForHiddenAdded = true;
	}
	if (elem && elem.nodeType == 1)
	  jQuery(elem).addClass('aa_hidden_element');
}

function aa_show(elem) {
	if (elem && elem.nodeType == 1)
	  jQuery(elem).removeClass('aa_hidden_element');
}
function aa_refresh_widget_with_different_source(div, widget_as_str) {
	$(div).children().each(function() { aa_remove(this,true); });
	ajaxart.componentsXtmlCache = [];
	jBart.activator(widget_as_str).show(div);
}

function aa_bctx(context) {
	return context.vars._AppContext[0];
}

function aa_array_lastItem(arr) {
	if (arr.length) return arr[arr.length-1];
}

function aa_setDataResource(context,resourceID,newvalue) {
	if (!aa_isArray(newvalue)) newvalue = [newvalue];

	if (context.vars._AppContext) {
		var appContext = context.vars._AppContext[0];
		if (appContext.Vars && appContext.Vars[resourceID]) {
			appContext.Vars[resourceID] = function() { return newvalue; }
		}
		for(var i=0;i<appContext.Resources.length;i++)
			if (appContext.Resources[i].Id == resourceID) {
				appContext.Resources[i].Items = newvalue;
				if (appContext.Resources[i].Xml) appContext.Resources[i].Xml = newvalue[0];
			}
	}
	if (context.vars._GlobalVars && context.vars._GlobalVars[0][resourceID]) {
		context.vars._GlobalVars[0][resourceID] = function() { return newvalue; };
	}
}

function aa_errorLog(message) {
	if (window.console) {
		if (console.error) console.error(message);
		else console.log(message);
	}
}

function aa_consoleLog(message) {
	if (window.console && console.log) console.log(message);
}

function aa_path(object,path,value) {
  var cur = object;

  if (typeof value == 'undefined') {  // get
    for(var i=0;i<path.length;i++) {
      cur = cur[path[i]];
      if (cur == null || typeof cur == 'undefined') return null;
    }
    return cur;
  } else { // set
    for(var i=0;i<path.length;i++)
      if (i == path.length-1)
        cur[path[i]] = value;
      else
        cur = cur[path[i]] = cur[path[i]] || {};
    return value;
  }
}

/******************* Node JS *****************************/
function aa_runFromNodeJS(widgetXml,profileStr,data) {

	window.aa_hasAttribute = function(xml,attr) {
		console.log('mik mak');
		return xml.getAttribute(attr) != 'null';
	}

	var context = aa_create_jbart_context({
		WidgetXml: aa_parsexml(widgetXml),
		Language: '',
		jbartObject: {}
	});
	var input = data ? [data] : [];
	return aa_text(input,aa_parsexml(profileStr),'',context);
}



(function(jQuery) {
	jQuery.fn.jbart = function(params)
	{
		return this.each(function() {
			var elem = this;
			jBart.ready(function() {
				if (params.url)
				 	$.ajax({
				  		url: params.url,
				  		dataType: 'text',
				  		success: function(widgetSource) {
				  			jBart.appendWidget(elem,{ widget_src: widgetSource });
				  		}
				  	});
			});
		});
	};
})(jQuery);

function aa_loadZippedXtml(zipped) {
	var zip  = new JSZip();
	zip.load(zipped, {base64:true});
	zip.file(/.*/).forEach(function(file) { 
		ajaxart.load_xtml_content('',aa_parsexml(file.asText()));
	});
}


aa_gcs("jbartdb", {
	CreateNewNodeInJBartDB: function (profile,data,context)
	{
		var xml = aa_parsexml( aa_first(data,profile,'NodeXml',context) );
		if (aa_bool(data,profile,'AddTimestampToID',context)) {
			var id = xml.getAttribute('id') || '';
			id += '_' + aadate_dateObj2StdDate(new Date()).replace(/[:/ ]/g,'_');
			xml.setAttribute('id',id);
		}
		if (ajaxart.inPreviewMode) return;
		jBart.db.save({
			data: xml,
			success: function() {
				ajaxart.run([xml],profile,'OnSuccess',context);
			},
			error: function() {
				ajaxart.run(data,profile,'OnError',context);
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
	},
	CloneNodeInJBartDB: function (profile,data,context)
	{
		jBart.db.cloneNode({
			data: aa_parsexml( aa_first(data,profile,'Node',context) ),
			success: function(newnode) {
				ajaxart.run([newnode],profile,'OnSuccess',context);
			},
			error: function() {
				ajaxart.run([newnode],profile,'OnError',context);
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
	},
	DeleteNodeInJBartDB: function (profile,data,context)
	{
		var node = aa_first(data,profile,'Node',context);
		if (!node || node.nodeType != 1) return;
		if (ajaxart.inPreviewMode) return;
		
		jBart.db.deleteNode({
			data: node,
			success: function(newnode) {
				ajaxart.run([newnode],profile,'OnSuccess',context);
			},
			error: function() {
				ajaxart.run([newnode],profile,'OnError',context);
			},
			server: aa_text(data,profile,'Server',context),
			context: context			
		});
	},
	SaveNodeAsync: function (profile,data,context)
	{
		ajaxart_async_Mark(context);
		
		var xml = aa_parsexml( aa_first(data,profile,'Node',context) );
		if (ajaxart.inPreviewMode) return;

		jBart.db.save({
			data: xml,
			success: function() {
				ajaxart_async_CallBack([],context);				
			},
			error: function() {
				context.vars._AsyncCallback.success = false;
				ajaxart_async_CallBack([],context);				
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
	},
	JBartDBNode: function (profile,data,context)
	{
	    ajaxart_async_Mark(context,true);
	    
	    ajaxart.run(data,profile,'OnLoading',context);
	    
		jBart.db.get({
			id: aa_text(data,profile,'ID',context),
			contentType: aa_text(data,profile,'ContentType',context),
			success: function(node) {
				ajaxart.run([node],profile,'OnSuccess',context);
				ajaxart_async_CallBack([node],context); 
			},
			error: function(error) {
				context.vars._AsyncCallback.success = false;
				ajaxart.run(data,profile,'OnError',context);
				ajaxart_async_CallBack([],context); 
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
	},
	JBartDBQuery: function (profile,data,context)
	{
	    ajaxart_async_Mark(context,true);
	    
	    ajaxart.run(data,profile,'OnLoading',context);
	    
		jBart.db.query({
			contentType: aa_text(data,profile,'ContentType',context),
			templateOf: aa_text(data,profile,'TemplateOf',context),
			headersOnly: aa_bool(data,profile,'HeadersOnly',context),
			success: function(nodes) {
				ajaxart.run([nodes],profile,'OnSuccess',context);
				ajaxart_async_CallBack([nodes],context); 
			},
			error: function(error) {
				context.vars._AsyncCallback.success = false;
				ajaxart.run(data,profile,'OnError',context);
				ajaxart_async_CallBack([],context); 
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
	},
	LoadFullNodeFromHeader: function (profile,data,context)
	{
		var headerXml = aa_first(data,profile,'HeaderXml',context);
		var childPresent = aa_xpath(headerXml,'*').length > 0;
		if (childPresent && !aa_bool(data,profile,'DoNotLoadIfPresent',context)) return;

		while(headerXml.firstChild) headerXml.removeChild(headerXml.firstChild);

		var deferred = $.Deferred();

		jBart.db.get({
			id: headerXml.getAttribute('id'),
			contentType: headerXml.getAttribute('_type'),
			success: function(node) {
				var children = aa_xpath(node,'*');
				for(var i=0;i<children.length;i++) {
					aa_xml_appendChild(headerXml,children[i]);
				}
				deferred.resolve(result);
			},
			server: aa_text(data,profile,'Server',context),
			error: deferred.reject,
			context: context
		});

		return [deferred.promise()];		
	},
	SaveFileToJBartDB: function (profile,data,context)
	{
		var id = aa_text(data,profile,'ID',context);
		var content = aa_text(data,profile,'Content',context);
		var deferred = $.Deferred();

		jBart.db.saveFile({
			id: id,
			content: content,
			success: function(success_result) {
				ajaxart.run(data,profile,'OnSuccess',aa_ctx(context,{_Result:[success_result],_FileId:[id], _FileContent:[content] } ));
				deferred.resolve(success_result);
			},
			error: function(error) {
				ajaxart.log("Error saving file '" + id + "'' to JBart DB: " + error.message + " \nurl:" + error.url,'error');
				ajaxart.run(data,profile,'OnError',aa_ctx(context,{_Message:[error.message],_Url:[error.url],_FileId:[id], _FileContent:[content] } ));
				deferred.reject(error);
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});

		return [deferred.promise()];		
	},
	GetFileFromJBartDB: function (profile,data,context)
	{
		var id = aa_text(data,profile,'ID',context);
		var deferred = $.Deferred();
		jBart.db.getFile({
			id: id,
			success: function(server_content) {
				var converted_result = ajaxart_server_content2result(server_content,aa_text(data,profile,"ResultFormat",context));
				ajaxart.run(converted_result,profile,'OnSuccess',context);
				deferred.resolve(converted_result);
			},
			error: function(error) {
				ajaxart.log("Error getting file '" + id + "'' to JBart DB: " + error.message + " \nurl:" + error.url,'warning');
				ajaxart.run(data,profile,'OnError',aa_ctx(context,{_Message:[error.message],_Url:[error.url],_FileId:[id] } ));
				deferred.reject(error);
			},
			server: aa_text(data,profile,'Server',context),
			context: context
		});
		return [deferred.promise()];
	}
});

jBart.db = jBart.db || {};
function aa_jbartdb_getServer(settings)	{
	if (settings.server) return settings.server;
	if (settings.context && settings.context.vars.JBartDBServer) return ajaxart.totext_array(settings.context.vars.JBartDBServer);
	return (jBart.settings && jBart.settings.jbartdb_server) || ajaxart.urlparam('jbartdb_server') || window.jbartdbserver || '//jbartdb.appspot.com';
}
function aa_jbartdb_security_tokens(settings) {
	var result = '';
	var instance = ajaxart.urlparam('instance'); 
	if (instance) result = '&instance=' + instance;

	var appName = ajaxart.urlparam('appName');
	var appNameMatch = window.location.href.match(/WixPage\/([^\/]+)/); // Wix
	if (appNameMatch && appNameMatch[1]) appName = appNameMatch[1];
	if (appName)
		result += '&appName=' + appName;
	var more_security_tokens = settings && settings.context && settings.context.vars.JBartDBSecurityTokens && ajaxart.totext_array(settings.context.vars.JBartDBSecurityTokens);
	if (more_security_tokens)
		result += more_security_tokens;
	return result;
}

jBart.db.get = function(settings)
{
	settings.error = settings.error || function() {};
	settings.server = aa_jbartdb_getServer(settings);
//	settings.server = 'http://localhost:8888';
	settings.cache = settings.cache || true;
	
	var ajaxSettings = { 
		url: settings.server+'/jbart_db.js?op=loadnode&contenttype='+settings.contentType+'&id='+settings.id,
		cache: false, 
		success: function(result) {
			result = aa_parsexml(result);
			if (result && result.getAttribute('_type') == settings.contentType) {
				settings.success(result);
			} else {
				if (settings.defaultValue) {
					settings.defaultValue.setAttribute('_type',settings.contentType);
					settings.defaultValue.setAttribute('id',settings.id);
					settings.success(aa_parsexml(settings.defaultValue));
				}
				else
					settings.error({ message: 'node ' + settings.server + '::' + settings.contentType + ':'+ settings.id + ' not found, and no default value' , code: 'node does not exist'});
			}
		},
		error: function() { settings.error({message: ''}); }
	}
	aa_crossdomain_call(ajaxSettings, true);
}
jBart.db.save = function(settings)
{
	settings.error = settings.error || function() {};
	settings.success = settings.success || function() {};
	settings.server = aa_jbartdb_getServer(settings);
	// settings.server = 'http://localhost:8888';
	
	if (! settings.data || settings.data.nodeType != 1 || !settings.data.getAttribute('id') || !settings.data.getAttribute('_type') ) {
		return settings.error('settings.data should be an xml of the format: <item id="xx" _type="myType" myatt="..."><myElem>..</myElem></item>');
	}
	
	if (!settings.vidProtection)
		settings.data.setAttribute('vid','force');

	if (!settings.data.getAttribute('_lastModified'))
		settings.data.setAttribute('_created',currentDate());	

	settings.data.setAttribute('_lastModified',currentDate());

	var id = settings.data.getAttribute('id');
	var _type = settings.data.getAttribute('_type');
	var url = settings.server+'/bart.php?op=savenode' + aa_jbartdb_security_tokens(settings);
	
	var result = $.ajax({ 
	  	url: url,
	  	cache: false, 
	  	type: 'POST', 
	  	headers: {'Content-Type': 'text/plain; charset=utf-8' },
	  	data: ajaxart.xml2text(settings.data,false)
  });
	$.when(result).then(
		function(result) { 
			result = aa_parsexml(result);
			if (result && result.getAttribute('type')=="success") {
				if (settings.vidProtection) {
					settings.data.setAttribute('vid',result.getAttribute('vid'));
				}
			  settings.success();
			}
			else {
				if (window.console && result.getAttribute('type') == 'error') {
					console.log('error saving node ' + _type + ':' + id + ' ' + result.getAttribute('reason'));
				}
				if (result.getAttribute('type') == 'error' && (result.getAttribute('reason')||'').indexOf("wrong vid:") == 0) {
					handleWrongVid(result);
				} else {
					settings.error(result);
			  }
			}
		},
		function(er) { 
			settings.error();
	});

	function handleWrongVid(result) {
		if (settings.autoMergeOnWrrongVid) {
			// TODO: try doing auto merge
		}
		settings.error('wrong vid');
	}
	
	function currentDate() {
		var now = new Date();
		return '' + pad(now.getDate()) + "/" + pad(now.getMonth()+1) + "/" + now.getFullYear() + " " + pad(now.getHours())+ ':' + pad(now.getMinutes());
	}
	function pad(i) { return i<10?'0'+i:i; }
}
jBart.db.query = function(settings)
{
	settings.error = settings.error || function() {};
	settings.server = aa_jbartdb_getServer(settings);
	if (typeof(settings.headersOnly) == 'undefined') settings.headersOnly = true;
	
	var headersOnly = settings.headersOnly ? '&headersonly=true' : '&headersonly=false';
	var templateOf = settings.templateOf ? '&templateOf='+settings.templateOf : '';
	var ajaxSettings = { 
		url: settings.server+'/jbart_db.js?op=query&contenttype='+settings.contentType+headersOnly+templateOf,
		cache: settings.cache ? true : false, 
		success: function(result) {
			result = aa_parsexml(result);
			settings.success(result);
		},
		error: function() { 
			settings.error({message: ''}); 
		}
	}
	aa_crossdomain_call(ajaxSettings, true);
}
jBart.db.deleteNode = function(settings) {
	settings.error = settings.error || function() {};
	settings.server = aa_jbartdb_getServer(settings);
	if (!settings.data)
		return settings.error('you must supply the node in settings.data when calling jBart.db.deleteNode');
	
	var id = settings.data.getAttribute('id'), type = settings.data.getAttribute('_type');
	if (!id || !type)
		return settings.error('you must supply the node in settings.data when calling jBart.db.deleteNode');

	aa_crossdomain_call({ 
		url: settings.server+'/jbart_db.js?op=deletenode&contenttype='+type+'&id='+id + aa_jbartdb_security_tokens(),
		cache: false, 
		success: function(result) {
			settings.success();
		},
		error: function() { 
			settings.error({message: ''}); 
		}
	}, true);
}
jBart.db.saveFile = function(settings) {
	settings = aa_defaults(settings,{
		success: function() {},
		error: function() {}
	})
	settings.server = aa_jbartdb_getServer(settings);
	if (!settings.id)
		return ajaxart.error({message:'save file to jbartdb: id is empty'});
	
	var url = settings.server+'/bart.php?op=savefile&id='+settings.id + aa_jbartdb_security_tokens(); 

  var result = $.ajax({ 
	  	url: url,
	  	cache: false, 
	  	type: 'POST', 
	  	headers: {'Content-Type': 'text/plain; charset=utf-8' },
	  	data: settings.content
  });
	$.when(result).then(
		function(result) { 
			var result_as_xml = aa_parsexml(result,'',[],true);
			if (!result_as_xml)
				settings.error({message:result, url:url});
			else if (result_as_xml.getAttribute("type") != 'success')
				settings.error({message:result_as_xml.getAttribute("reason"), url:url});
			else
				settings.success('');
		},
		function(er) { 
			settings.error({message:er, url:url}); 
	});
}
jBart.db.appendToFile = function(settings) {
  // ?op=appendtofile&id=log.txt&toappend=bbbb&timestamp=true	
	settings.server = aa_jbartdb_getServer(settings);
	if (!settings.id)
		return ajaxart.error({message:'save file to jbartdb: id is empty'});
	
	var timestamp = settings.timestamp ? '&timestamp=true' : '';	
	var url = settings.server+'/jbart_db.js?op=appendtofile&id='+ encodeURIComponent(settings.id) + '&toappend=' + encodeURIComponent(settings.toAppend) + timestamp + aa_jbartdb_security_tokens(); 

  var result = $.ajax({ 
	  	url: url,
	  	cache: false
  });
	$.when(result).then(
		function(result) { 
			settings.success(result);
		},
		function(er) { 
			settings.error({message:er, url:url}); 
	});
}

jBart.db.getFile = function(settings) {
	settings.server = aa_jbartdb_getServer(settings);
	if (!settings.id)
		return ajaxart.error({message:'get file to jbartdb: id is empty'});
	
	var url = settings.server+'/file/' + settings.id; 
	var result;

	if (!aa_jbartdb_isSameDomain(settings.server)) {
		result = aa_proxyGetCall({ url: url });
	} else {
		result = $.ajax({ 
		 	url: url,
		 	cache: false
	  });
	}
	$.when(result).then(
		function(result) { 
			if (result && result.nodeType == 9 && result.firstChild && result.firstChild.getAttribute('_type') == 'error') {
				return settings.error({message: result.firstChild.getAttribute('reason') || '', url:url}); 	
			}
			settings.success(result);
		},
		function(er) { 
			settings.error({message:er, url:url}); 
	});
}

jBart.db.cloneNode = function(settings) {
	var newnode;
	var charsForRandomization = '0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM';
	var maxTries = settings.maxTries || 10;

	function tryRandomID(length,tryCount) {
		var str = '';
		tryCount = tryCount || 1;
		if (tryCount > maxTries) 
			return settings.error('could not create clone. Tries ' + maxTries + ' times to create a random id');

		for(var i=0;i<length;i++) {
			var rnd = Math.floor(Math.random() * charsForRandomization.length);
			str += charsForRandomization.charAt(rnd);
		}

		jBart.db.get({
			server: settings.server,
			success: function() {
				tryRandomID(length+1,tryCount+1);
			},
			error: function() {
				saveClone(str);
			}
		});
	}

	function saveClone(newid) {
		newnode.setAttribute('id',newid);
		jBart.db.save({
			server: settings.server,
			data: newnode,
			error: function(e) { 
				settings.error(e);
			},
			success: function() {
				settings.success(newnode);
			}
		});
	}

	settings.error = settings.error || function() {};
	settings.server = aa_jbartdb_getServer(settings);
	settings.cloneMethod = settings.cloneMethod || 'random number';

	if (! settings.data || settings.data.nodeType != 1 || !settings.data.getAttribute('id') || !settings.data.getAttribute('_type') ) {
		return settings.error('settings.data should be an xml of the format: <item id="xx" _type="myType" myatt="..."><myElem>..</myElem></item>');
	}
	newnode = settings.data.cloneNode(true);

	if (settings.useCounter) {
	} else {
		tryRandomID(settings.randomNumberFirstLength || 3);		
	} 
};
jBart.db.syncServerTime = function(settings) {
	settings = aa_defaults(settings,{
		success: function() {},
		error: function() {},
		doNotSyncTwice: true
	});

	settings.server = aa_jbartdb_getServer(settings);

	if (settings.doNotSyncTwice && window.jbServerTimeDiff) return settings.success();

	window.jbServerTimeDiff = 0;
	if (ajaxart.jbart_studio) return settings.success();
	
	var now = new Date().getTime();

	var url = settings.server+'/jbart_db.js?op=now';

  var ajaxSettings = { 
	  	url: url,
	  	cache: false,
	  	success: function(result) {
				var now2 = new Date().getTime();
				var clientTime = parseInt((now2 + now)/2); // heuristic
				if (window.console)
					console.log('synching server time. client diff time for server call ' + (now2-now));

				result = aa_parsexml(result);
				if (result.nodeType == 1) {
					var serverTime = result.getAttribute('now');
					if (serverTime && parseInt(serverTime)) {
						window.jbServerTimeDiff = serverTime - now;
						if (window.console)
							console.log('server time diff=' + window.jbServerTimeDiff);
					}
				}
				settings.success(window.jbServerTimeDiff);
			},
			error: function(er) { 
				settings.error({message:er, url:url}); 
			}
  };
	aa_crossdomain_call(ajaxSettings, true);	
}

function aa_get_client_location(tries) {
	tries = tries || 1;
	if (tries && tries > 5) return;

	if (!jBart.clientIP) {
		if (window.wix_instance_data && wix_instance_data.ipAndPort) {
			jBart.clientIP = wix_instance_data.ipAndPort.split('/')[0];
			return aa_get_client_location();
		}

		window.jbGetIPCB = function(ipjson) {			
			if (window.sessionStorage) sessionStorage.jbClientIP = ipjson.ip;
			jBart.clientIP = ipjson.ip;
			aa_get_client_location();
		};
		if (window.sessionStorage && sessionStorage.jbClientIP) {
			jBart.clientIP = sessionStorage.jbClientIP;
		} else {
			$.getScript('http://jsonip.appspot.com/?callback=jbGetIPCB');

			setTimeout(function() {
				if (!jBart.clientIP) aa_get_client_location(tries+1);
			},1000);			
			return;
		}
	}

	if (jBart.clientLocation) return;
	try {
		if (window.sessionStorage && sessionStorage.jbClientLocation) {
			jBart.clientLocation = JSON.parse(sessionStorage.jbClientLocation);
		} else {
			window.jbClientLocationCB = function(resultStr) {
				if (window.sessionStorage) sessionStorage.jbClientLocation = resultStr;
				jBart.clientLocation = JSON.parse(resultStr);
			};
			$.getScript('//jbartdb.appspot.com/jbart_db.js?op=proxy&url=http://freegeoip.net/json/'+jBart.clientIP+'&callback=jbClientLocationCB');
		}
	} catch(e) {
		ajaxart.logException(e,'get client location failed');
	}
}

function aa_jbartdb_isSameDomain(serverName) {
	var host = (serverName.indexOf('//') == -1) ? serverName : serverName.split('//')[1];
	if ( window.location.hostname == host ) return true;
	return false;
}

function aa_proxyGetCall(settings) {
	var deferred = $.Deferred();

	settings = aa_defaults(settings,{
		baseUrl: '//jbartdb.appspot.com/jbart_db.js?op=proxy'
	});
	window.jbJBartDBCallbackCounter = window.jbJBartDBCallbackCounter || 0;
	
	var callback = 'jbartdb_' + (++jbJBartDBCallbackCounter);
	window[callback] = function(result) {
		delete window[callback];
		deferred.resolve(result);
	};

	var url = settings.url;
	if (url.indexOf('http') != 0) {
		url = window.location.protocol + url;
	}
	$.getScript(settings.baseUrl + '&callback=' + callback + '&url=' + encodeURIComponent(url)).fail(deferred.reject);

	return deferred.promise();
}


aa_gcs("mobile", {
	IsMobilePhone: function (profile,data,context) {
	  var visualCntr = aa_findVisualContainer(null,context);
	  var width = visualCntr.width;
	  if (window.orientation == 90 || window.orientation == -90)
	  	width = visualCntr.height;

	  if (width < 600) return ["true"];
	},
	WidthOfMobilePhone: function (profile,data,context) {
		var visualCntr = aa_findVisualContainer(aa_var_first(context,'ControlElement'),context);
		return aa_frombool(visualCntr.width <= 350);
	},
	MobileDefaultFeatures: function (profile,data,context) 
	{
		if (aa_bool(data,profile,'DisableScaling',context)) {
		  var metatag =document.createElement("meta");
		  metatag.setAttribute("name", "viewport");
		  metatag.setAttribute("content", "initial-scale=1,maximum-scale=1,user-scalable=no");
		  document.getElementsByTagName("head")[0].appendChild(metatag);
		}
		if (aa_bool(data,profile,'AutoHideAddressBar',context)) {
			function hide_address_bar() {
				document.body.style.height = "2000px";	// The max height for all devices
				function restore() {
					setTimeout( function() { 	// Use timeout because in some Androids the onscroll is called before the address bar hides
						window.removeEventListener("scroll", restore);
						jQuery("body").find(".aa_window_resize_listener").each(function(i,elem) { jBart.trigger(elem,'WindowResize'); });
						document.body.style.height = "100%";
					},1);
				}
				window.addEventListener("scroll", restore);
				window.scrollTo(0, 1);
			}
			hide_address_bar();

			window.addEventListener("orientationchange", function() {
				if (window.scrollY <= 2)	// new size may be smaller, and address bar will aprear again
					hide_address_bar();
			});
		}
		if (aa_bool(data,profile,'DisableTextAdjustionOnOrientation',context)) {
			jQuery('body').css("-webkit-text-size-adjust","none");
		}
		if (aa_bool(data,profile,'EliminateMarginsFromHtmlBody',context))
			jQuery('body').css('margin','0').css('padding','0');
		return [];
	},
	MobileBottomPosition: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			var elem = cell.firstChild;
			aa_addOnAttach(elem, function() {
//				if (false) {
				if (ajaxart.isiPhone && !navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i)) {	// iphone <5 dosent have position:fixed
					var elem_height = elem.offsetHeight;
					var fix_top = function(height) { elem.style.top = window.innerHeight + window.scrollY - elem_height + "px"; };
					elem.jbFixTop = fix_top;
					fix_top(elem_height);
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'PositionAbsoluteCss',context)));
					jQuery(elem).show();
					jQuery(document).bind('scroll', function() { fix_top(elem.offsetHeight) } );
				    window.addEventListener("resize", function() { fix_top(elem.offsetHeight) }, false);
				} else if (jQuery('.studio_simulator').length > 0 && jQuery('.studio_simulator')[0].className.indexOf(' ') > -1) {	// in studio, use simulator window height
					var simulator = jQuery('.studio_simulator')[0];
					var elem_height = elem.offsetHeight;
					jQuery(elem).hide();
					var fix_top = function(height) { elem.style.top = simulator.clientHeight + simulator.scrollTop - elem_height + "px"; };
					fix_top(elem_height);
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'PositionAbsoluteCss',context)));
					jQuery(elem).show();
					jQuery('.studio_simulator').bind('scroll', function() { fix_top(elem.offsetHeight) } );
				} else {	// Android and other supporting position fixed browsers
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'PositionFixedCss',context)));
				}
				jQuery(cell).append(jQuery("<div class='aa_mobile_bottom_padding'/>").css("height", elem.offsetHeight + "px"));	// keep space in bottom for not hiding anything
			});
		});
	},
	MobileTopPosition:function (profile,data,context)
	{
		var field = context.vars._Field[0];
		aa_field_handler(field,'ModifyControl',function(cell,field_data,cell_presentation,ctx) {
			var elem = cell.firstChild;
			aa_addOnAttach(elem, function() {
				if (ajaxart.isiPhone && navigator.userAgent.match(/OS 4(_\d)+/i) || navigator.userAgent.match(/OS 3(_\d)+/i)) {	// iphone <5 dosent have position:fixed
					if (!aa_bool(data,profile,'UseAbsoluteWhenNoPositionFixed')) return;
					var fix_top = function() { elem.style.top = window.scrollY + "px"; };
					elem.jbFixTop = fix_top;
					fix_top();
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'PositionAbsoluteCss',context)));
					jQuery(elem).show();
					jQuery(document).bind('scroll', fix_top );
				    window.addEventListener("resize", fix_top, false);
				} else if (jQuery('.studio_simulator').length > 0 && jQuery('.studio_simulator')[0].className.indexOf(' ') > -1) {	// in studio, use simulator window height
					var simulator = jQuery('.studio_simulator')[0];
					jQuery(elem).hide();
					var fix_top = function() { elem.style.top = simulator.scrollTop + "px"; };
					fix_top();
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'SimulatorCss',context)));
					jQuery(elem).show();
					jQuery('.studio_simulator').bind('scroll', fix_top );
				} else {	// Devices that sopports position fixed, like Android and iPhone 5 and above
					jQuery(elem).addClass(aa_attach_global_css(aa_text(data,profile,'PositionFixedCss',context)));
					if (ajaxart.isIDevice) {	// iphone 5 BUG, when keyboard is open, it stucks as an absolute position
						setTimeout(function() {
							jQuery("input,textarea").focus(function() { elem.style.position = 'absolute'; })
								.blur(function() { elem.style.position = 'fixed'; }); }
						, 1000);
					}
				}
				jQuery(elem).addClass('aa_mobile_top_position');
				jQuery(cell).find('.aa_mobile_top_padding').remove();	// cleans previous calls
				jQuery(cell).append(jQuery("<div class='aa_mobile_top_padding'/>").css("height", elem.offsetHeight + "px"));	// keep space in bottom for not hiding anything
			});
		});
	},
	SimpleMobileVerticalScroll:function (profile,data,context)
	{
		return [{ 
			isObject: true,
			Prepare: function(data1,ctx) {
				var wrapper = jQuery("<DIV/>").addClass("aa_mobile_scroll_wrapper")[0];
				var elem = ctx.vars.ControlElement[0];
				elem.ScrollElement = wrapper;
		        elem.parentNode.appendChild(wrapper);
				wrapper.appendChild(elem);
				wrapper.jbScrolledElem = elem;
				jQuery(wrapper).css('overflow','hidden'); 
			},
			Activate : function(data1,ctx) {
				var wrapper = ctx.vars.ControlElement[0];
				var elem = wrapper.jbScrolledElem;
				elem.scrollPos = 0;	// starting with no scroll
				elem.maxOffset = 0; // used to fix virtual keyboard issue
				elem.MaxHeight = wrapper.offsetHeight;
				var scrollPosInRange = function(pos) {
					return Math.min(Math.max(pos,elem.MaxHeight-elem.offsetHeight),elem.maxOffset);
				}
				var ondown = function(e) {
					elem.start = {
					  // get touch coordinates for delta calculations in onTouchMove
					  pageX: e.touches ? e.touches[0].pageX : e.pageX,
					  pageY: e.touches ? e.touches[0].pageY : e.pageY,
					  // set initial timestamp of touch sequence
					  time: Number( new Date() )
					};
					elem.isVScrolling = undefined;
					elem.deltaX = elem.deltaY = elem.startScrollPos = elem.scrollPos;
					elem.style.MozTransitionDuration = elem.style.webkitTransitionDuration = 0;
					if (!ajaxart.isTouch)
						ajaxart_disableSelection(elem);
				};
				var onmove = function(e) {
				  var pageX = e.touches ? e.touches[0].pageX : e.pageX;
				  var pageY = e.touches ? e.touches[0].pageY : e.pageY;
				  if (!elem.start) return;
				  elem.deltaX = pageX - elem.start.pageX;
				  elem.deltaY = pageY - elem.start.pageY;
	
				  // determine if scrolling test has run - one time test
				  if ( typeof elem.isVScrolling == 'undefined') {
				 	elem.isVScrolling = !!( elem.isVScrolling || Math.abs(elem.deltaX) < Math.abs(pageY - elem.start.pageY) );
				  }
				  e.preventDefault();
				  // if user is trying to scroll vertically
				  if (elem.isVScrolling) {
						// translate immediately 1-to-1
						elem.scrollPos = scrollPosInRange(elem.startScrollPos + elem.deltaY);
						if (elem.scrollPos != elem.startScrollPos + elem.deltaY) {	// out of rance: resistance
							var not_allowed_diff = elem.startScrollPos + elem.deltaY - elem.scrollPos;
							elem.scrollPos += not_allowed_diff / ( (Math.abs(not_allowed_diff)/elem.MaxHeight) + 1 )
						}
						elem.style.MozTransform = elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}
				};
				var onup = function(e) {
				  if (!elem.start) return;
					// determine if slide attempt triggers next/prev slide
					var duration = Number(new Date()) - elem.start.time;
					if (duration < 300 || elem.scrollPos != scrollPosInRange(elem.scrollPos) ) {	// use speed or go back after resistance
						var deceleration = 0.0006;
						var speed = Math.abs(elem.deltaY) / duration;
						var dist = (speed * speed) / (2 * deceleration);
						var add = dist * ((elem.deltaY > 0) ? 1 : -1);
						elem.scrollPos = scrollPosInRange(elem.scrollPos + add);
						var style = elem.style;
						// set duration speed (0 represents 1-to-1 scrolling)
						style.webkitTransitionDuration = style.MozTransitionDuration = style.msTransitionDuration = style.OTransitionDuration = style.transitionDuration = 500 + 'ms';
						// translate to given index position
						style.MozTransform = style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}
				  elem.start = null;
				  if (!ajaxart.isTouch)
					  ajaxart_restoreSelection(elem);
				}
				if (ajaxart.isTouchDevice()) {
					wrapper.ontouchmove = onmove;
					wrapper.ontouchend = onup;
					wrapper.ontouchstart = ondown;
				} else {
					jQuery(wrapper).mousemove(onmove).mouseup(onup).mousedown(ondown);
				}
				elem.FixKeyboard = function() {
					if (aa_absTop(wrapper) < window.scrollY) {	// top is not visible, we fix it
						var offset = window.scrollY - aa_absTop(wrapper,true);
						if (elem.maxOffset != offset) {
							elem.maxOffset = offset;
							elem.scrollPos = scrollPosInRange(elem.scrollPos);// + elem.maxOffset);
							elem.style.webkitTransitionDuration = '150ms';
							elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
						}
					} else if (elem.maxOffset) {	// go back to normal
						var offset = elem.maxOffset;
						elem.maxOffset = 0;
						elem.scrollPos = scrollPosInRange(elem.scrollPos - offset);
						elem.style.webkitTransitionDuration = '150ms';
						elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}
				}
				if (ajaxart.isIDevice)
					jQuery("input,textarea").focus(function() { setTimeout(function() { elem.FixKeyboard(); },1)}).blur(elem.FixKeyboard);
				else
					window.addEventListener("resize", function(){ elem.FixKeyboard(); });
				this.SizeChanged = function() {
					elem.MaxHeight = wrapper.offsetHeight;
					if (elem.scrollPos != scrollPosInRange(elem.scrollPos)) {
						elem.scrollPos = scrollPosInRange(elem.scrollPos);
						elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}
				}
				this.ScrollToTop = function(duration) {
					if (elem.scrollPos != scrollPosInRange(elem.maxOffset)) {
						elem.scrollPos = scrollPosInRange(elem.maxOffset);
						elem.style.webkitTransitionDuration = duration ? duration : '150ms';
						elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}					
				}
				this.ScrollToBottom = function(duration) {
					if (elem.scrollPos != scrollPosInRange(-elem.offsetHeight)) {
						elem.scrollPos = scrollPosInRange(-elem.offsetHeight);
						elem.style.webkitTransitionDuration = duration ? duration : '150ms';
						elem.style.webkitTransform = 'translate3d(0,' + elem.scrollPos + 'px,0)';
					}					
				}
			}
		}];
	},
	HorizontalCurtain: function(profile,data,context) {
		var field = { isObject : true };
		field.Id = aa_text(data,profile,'ID',context);
		field.ID = [field.Id];
		field.FieldData = function(data1) { return data1; }
		field.CellPresentation = ["control"];
		field.HideTitle = true;
		field.Control = function(field_data,ctx) {
			var curtain = jQuery("<DIV class='aa_curtain'/>")[0];
			curtain.style.cssText = 'position:' + (aa_has_simulator() ? 'absolute' : 'fixed') + '; background:transparent; z-index:1; top:0px; left:0px';
			var page = ajaxart.runNativeHelper(field_data,profile,'Page',context)[0];
			jQuery(curtain).append(page)
				.append(aa_renderStyleObject(aa_first(data,profile,'HandlersStyle',context),{},ctx));
			curtain.open = aa_bool(data,profile,'StartAsOpen',context);
			var on_width_change = function() {
				curtain.width = aa_screen_size(true).width;
				curtain.style.webkitTransform = 'translate3d(' + -(curtain.open ? 0 : curtain.width) + 'px,0,0)';
			}
			on_width_change();
			window.addEventListener("resize", on_width_change);
			var ondown = function(e) {
				curtain.start = {
				  // get touch coordinates for delta calculations in onTouchMove
				  pageX: e.touches ? e.touches[0].pageX : e.pageX,
				  pageY: e.touches ? e.touches[0].pageY : e.pageY,
				  // set initial timestamp of touch sequence
				  time: Number( new Date() )
				};
				curtain.isVScrolling = undefined;
				curtain.deltaX = curtain.deltaY = 0;
				curtain.style.MozTransitionDuration = curtain.style.webkitTransitionDuration = 0;
			}
			var onmove = function(e) {
			  if (!curtain.start) return;
			  var pageX = e.touches ? e.touches[0].pageX : e.pageX;
			  var pageY = e.touches ? e.touches[0].pageY : e.pageY;
			  curtain.deltaX = pageX - curtain.start.pageX;
				if ( typeof curtain.isVScrolling == 'undefined') {
				  curtain.isVScrolling = !!( curtain.isVScrolling || Math.abs(curtain.deltaX) < Math.abs(pageY - curtain.start.pageY) );
				}
				if (curtain.isVScrolling) {
					curtain.start = null;
					return;
				}
				  // prevent native scrolling 
				e.preventDefault();

				if (curtain.open && curtain.deltaX > 0)	// cannot slide leftwards to curtain
					curtain.deltaX = 0;
//				if ((curtain.open && curtain.deltaX > 0 || !curtain.open && curtain.deltaX < 0))	// resistance
//			      curtain.deltaX = curtain.deltaX / ( Math.abs(curtain.deltaX) / curtain.width + 1 );

				curtain.style.MozTransform = curtain.style.webkitTransform = 'translate3d(' + (curtain.deltaX - (curtain.open ? 0 :curtain.width)) + 'px,0,0)';
			};
			var onup = function(e) {
			  	if (e.ctrlKey) { // simulate slide with mouse
			  		curtain.Move(true);
			  		return;
			  	}
			  	if (!curtain.start) return;
				// determine if slide attempt triggers next/prev slide
				var isValidSlide = 
					  ((Number(new Date()) - curtain.start.time < 250      // if slide duration is less than 250ms
					  && Math.abs(curtain.deltaX) > 20                   // and if slide amt is greater than 20px
					  || Math.abs(curtain.deltaX) > curtain.width/2)        // or if slide amt is greater than half the width
						&& ((curtain.deltaX > 0 && !curtain.open) || (curtain.deltaX<0  && curtain.open)));

				curtain.Move(isValidSlide);
			}
			curtain.start = null;
			if (ajaxart.isTouch) {
				document.body.ontouchmove = onmove;
				document.body.ontouchend = onup;
				document.body.ontouchstart = ondown;
			} else {	// simulator
				jQuery(aa_body()).unbind("mousemove").unbind("mouseup").unbind("mousedown").mousemove(onmove).mouseup(onup).mousedown(ondown);
			}
			curtain.Move = function(slide) {
				if (slide) {			// openning/closing curtain
					curtain.open = !curtain.open;
					var onTransitionEnd = function() {
						ajaxart.run(data,profile,curtain.open ? 'OnOpen' : 'OnClose',context);
						curtain.removeEventListener('webkitTransitionEnd', onTransitionEnd);
						curtain.removeEventListener('transitionend', onTransitionEnd);
					}
					curtain.addEventListener('webkitTransitionEnd', onTransitionEnd);
					curtain.addEventListener('transitionend', onTransitionEnd);
				}
				var style = curtain.style;
				style.webkitTransitionDuration = style.MozTransitionDuration = style.msTransitionDuration = style.OTransitionDuration = style.transitionDuration = 300 + 'ms';
				style.MozTransform = style.webkitTransform = style.transform = 'translate3d(' + -(curtain.open ? 0 : curtain.width) + 'px,0,0)';
				curtain.start = null;
			}
/*			if (aa_bool(data,profile,'AutoMoveWithVerticalScroll',context))
				jQuery(aa_has_simulator() ? aa_body() : document).bind('scroll', function() { 
					curtain.style.top = aa_window_scroll().Y + "px"; } );
*/
			return [curtain];
		};
	    return [field];		
	},
	IsMobileCurtainOpen: function(profile,data,context)
	{
		var out = [];
		jQuery(aad_find_field(aa_text(data,profile,'CurtainId',context),'aa_curtain')).each(function(index,curtain) {
			if (curtain.open) out = ["true"];
		});
		return out;
	},
	SlideMobileCurtain: function(profile,data,context)
	{
		var slide_to = aa_text(data,profile,'SlideTo',context);

		jQuery(aad_find_field(aa_text(data,profile,'CurtainId',context),'aa_curtain')).each(function(index,curtain) {
			if (curtain.Move)
				if (slide_to == 'toggle' || curtain.open && slide_to == 'close' || !curtain.open && slide_to == 'open')
						curtain.Move(true);
		});
		return [];
	},
	MobileDetailsReplacingAll: function(profile,data,context)
	{
		var cntr = context.vars._Cntr[0]; 
		var control = context.vars.DetailsControl;
		if (control == null || control.length == 0) return [];

		var details_background = aa_text(data,profile,'DetailsBackground',context);
		var details_control = jQuery(control).appendTo("<DIV/>").parent().appendTo("<DIV/>").parent().appendTo("<DIV class='aa_mobile_replacing_all'/>").parent()[0];
		// DIV1: android fix position:fixed cannot work with transform
		// DIV2: animation and scroll fix may colllide
		// details_control.style.cssText = 'position:' + (aa_has_simulator() ? 'absolute' : 'fixed') + '; z-index:1; top:0px; left:0px;';
		details_control.style.cssText = 'position:absolute; z-index:1; top:0px; left:0px;';
		details_control.firstChild.style.cssText = 'background:' + details_background + ";display: inline-block;";
		details_control.firstChild.style.minWidth = aa_screen_size(true).width + "px";
		details_control.firstChild.style.minHeight = Math.max(aa_screen_size(true).height + 70, aa_document_height()) + "px";	// 50: http://stackoverflow.com/questions/9678194/cross-platform-method-for-removing-the-address-bar-in-a-mobile-web-app
		var original_scroll = aa_window_scroll().Y;
		var animation = aa_first(data,profile,'DetailsAnimation',context);
		var original_control = cntr.Ctrl;
		// cntr.Ctrl.parentNode.style.position = 'relative';
		cntr.Ctrl.parentNode.appendChild(details_control);
		animation.animate(details_control, function() {
			setTimeout(function() {
				if (original_scroll > 1)	// scroll to top
					jQuery(aa_body()).animate({ scrollTop: navigator.userAgent.toLowerCase().match(/android/) ? 1 : 0 }, 200 );
			},1);
//			document.body.style.minHeight = aa_screen_size(true).height + 70 + "px";
//			aa_window_scroll_to(0,1);
//			jQuery(original_control).hide();
			cntr.Ctrl = details_control;
//			details_control.style.cssText = 'position:none; z-index:0; top:0px;';
//			document.body.style.minHeight = "none";
//			if (cntr.AfterDetailsReplacingAll) {
//				cntr.AfterDetailsReplacingAll();
				// document size may have changed (when canceling search)
//				details_control.firstChild.style.minHeight = Math.max(aa_screen_size(true).height + 70, aa_document_height()) + "px";	// 50: http://stackoverflow.com/questions/9678194/cross-platform-method-for-removing-the-address-bar-in-a-mobile-web-app
//			}
		});

		context.vars._ItemDetailsObject[0].HideDetails = function(data2,ctx2) {
			var list_animation = aa_first(data,profile,'ListAnimation',context);
			list_animation.hide(details_control, function() {
				aa_remove(details_control);
//				jQuery(aa_body()).animate({ scrollTop: original_control }, 500 );
				cntr.Ctrl = original_control;
			});
		};
		context.vars._ItemDetailsObject[0].HideDetails1 = function(data2,ctx2) {
			var list_animation = aa_first(data,profile,'ListAnimation',context);
			var list_background = aa_text(data,profile,'ListBackground',context);
			cntr.Ctrl.parentNode.removeChild(original_control);
			var original_control_wrapped = jQuery(original_control).appendTo("<DIV/>").parent().appendTo("<DIV/>").parent().appendTo("<DIV class='aa_mobile_original_control'/>").parent()[0];
			cntr.Ctrl.parentNode.appendChild(original_control_wrapped);
			original_control_wrapped.style.cssText = 'position:' + (aa_has_simulator() ? 'absolute' : 'fixed') +  ';z-index:1; top:0px; left:0px; ';
			original_control_wrapped.firstChild.style.cssText = 'background:' + list_background + ";display: inline-block;";
			original_control_wrapped.firstChild.style.width = aa_screen_size(true).width + "px";
			original_control_wrapped.firstChild.style.minHeight = aa_screen_size(true).height + "px";	// 50: http://stackoverflow.com/questions/9678194/cross-platform-method-for-removing-the-address-bar-in-a-mobile-web-app
			if (aa_has_simulator()) original_control_wrapped.style.top = aa_window_scroll().Y + "px";	//simulator scroll fix
			// scroll fix
			jQuery(original_control_wrapped.firstChild.firstChild).css("-webkit-transform",'translateY(-' + original_scroll + 'px)').css("transform",'translateY(-' + original_scroll + 'px)');
			jQuery(original_control).show();
			list_animation.animate(original_control_wrapped.firstChild,function() {
				aa_window_scroll_to(0,original_scroll);
				jQuery(original_control_wrapped.firstChild.firstChild).css("-webkit-transform",'none').css("transform",'none');
				original_control.style.cssText = 'z-index:1';
				cntr.Ctrl.parentNode.appendChild(original_control);
				cntr.Ctrl.parentNode.removeChild(original_control_wrapped);
				original_control.style.cssText = 'z-index:none';
				aa_remove(details_control);
				cntr.Ctrl = original_control;
			});
		}
		return [];
	}
});
function aa_has_simulator(elem) {
	if (!elem)
		return (ajaxart.jbart_studio && jQuery('.studio_simulator').length > 0 && jQuery('.studio_simulator')[0].className.indexOf(' ') > -1);
	else // studio shuld be parent of elem
		return (ajaxart.jbart_studio && jQuery(elem).parents('.studio_simulator').length > 0 && jQuery(elem).parents('.studio_simulator')[0].className.indexOf(' ') > -1);

}
function aa_window_scroll() {
	if (aa_has_simulator())
		return { Y:jQuery('.studio_simulator')[0].scrollTop, X:jQuery('.studio_simulator')[0].scrollLeft};
	else
		return { Y:window.scrollY, X:window.scrollX };
}
function aa_window_scroll_to(x,y) {
	if (aa_has_simulator())
		jQuery('.studio_simulator').scrollTop(y).scrollLeft(x);
	else
		window.scrollTo(x,y);
}
function aa_document_height() {
	if (aa_has_simulator())
		return jQuery('.studio_simulator').children().height();
	else return Math.max(
        jQuery(document).height(),
        jQuery(window).height(),
        /* For opera: */
        document.documentElement.clientHeight);
}

function aa_mobile_slide_transition(settings,slideToLeft,time) {
	settings = aa_defaults(settings, { scrollDuration: 200 });
	var transition = settings.transition;
	var directionClass = settings.direction == 'From Right' ? "slide_from_right" : "slide_from_left";
	// var device_width = aa_screen_width(transition.context);
	// var margin = slideToLeft ? device_width : -device_width;

	aa_body().scrollTop = navigator.userAgent.toLowerCase().match(/android/) ? 1 : 0;
	transition.$elNew.addClass("aa_new");
	// aa_alert('adding aa_new to son of ' + cssClass);
  	var cssClass = aa_attach_global_css(transition.css);
	transition.$elOriginal.parent().addClass(cssClass).addClass(directionClass);
	transition.elOriginal.parentNode.appendChild(transition.elNew);
  	aa_element_attached(transition.elNew);  	
	transition.onBeforeTransitionBegin();

	var _transitionEndEvents = "animationend animationend webkitAnimationEnd oanimationend MSAnimationEnd";
	transition.$elNew.on( _transitionEndEvents, onTransitionEnd );

	function onTransitionEnd() {
		// aa_alert('removing aa_new from son of ' + cssClass);
		transition.$elOriginal.parent().removeClass(cssClass).removeClass(directionClass);;
	    transition.removeOriginal(transition.elOriginal);
	    transition.$elNew.removeClass('aa_new');
		transition.onTransitionEnd();
	}
}



aa_gcs("fld_type",{
  MultiplePicklist: function (profile,data,context)
  {
    var field = context.vars._Field[0];
  
    field.RefreshOptions = function(data1,ctx) {
      field.Options = ajaxart.run(data1,profile,'Options',aa_ctx(context,ctx));
    };
    field.RefreshOptions(data,context);
    field.Style = aa_first(data,profile,'Style',context);
    field.AllowValueNotInOptions = aa_bool(data,profile,'AllowValueNotInOptions',context);
    
    field.Control = function(field_data,ctx) {
      ctx = aa_merge_ctx(context,ctx);
      var mpicklist = aa_initMultiPicklistObject(field,field_data,ctx);
      var out = [aa_renderStyleObject2(field.Style,mpicklist,field_data,field,ctx)];  
      return out;
    };
  }
});

function aa_multi_picklist(mpicklist,settings) {
  settings = aa_defaults(settings,{
    baseElement: mpicklist.$el.firstOfClass('aa_mpicklist_div'),
    itemElement: mpicklist.$el.firstOfClass('aa_mpicklist_item'),
    searchElement: mpicklist.$el.firstOfClass('aa_mpicklist_search'),
    maxItemsToShow: 50,
    popupElement: mpicklist.$el.firstOfClass('aa_mpicklist_popup'),
    popupItemElement: mpicklist.$el.firstOfClass('aa_picklist_item'),
    popupItemSettings: function(itemElement) {
      return {
        itemTextElement: $(itemElement).firstOfClass('aa_picklist_item_text'),
        itemImageElement: $(itemElement).firstOfClass('aa_picklist_item_image')
      };
    },
    itemInnerElements: function(item) {
      return {
        itemTextElement: $(item).firstOfClass('aa_mpicklist_item_text'),
        itemCloseElement: $(item).firstOfClass('aa_mpicklist_item_del')
      }
    } 
  });
  settings.search = settings.search || aa_searchbox_search; // for Compress: aa_searchbox_search()

  var $popupItemParent = $(settings.popupItemElement).parent();
  var $popupItemTemplate = $(settings.popupItemElement).remove();
  var disableSelectionOnHover = false;
  var itemsParent = $(settings.itemElement)[0].parentNode;
  $(settings.itemElement).remove();
  var $input = $(settings.searchElement);
  var searchValue = '';

  initPopup();
  bindInputEvents();
  aa_addOnAttach($input[0],function() { fixInputSize(); });

  refreshPicklistBase();
  dragNDrop();

  function refreshPicklistBase() {
    aa_empty(itemsParent,true);
    var values = mpicklist.getValues();
    for(var i=0;i<values.length;i++) {
       var option = aa_picklist_optionByCode(mpicklist.field.Options,values[i]) || { code: values[i], text: values[i] };
       
       var itemElement = $(settings.itemElement)[0].cloneNode(true);
       itemElement.jbOption = option;
       
       var innerElements = settings.itemInnerElements(itemElement);
       $(innerElements.itemTextElement).html(option.text);
       $(innerElements.itemCloseElement)[0].jbItemElement = itemElement;
       $(innerElements.itemCloseElement).click(function() {
         mpicklist.removeValue(this.jbItemElement.jbOption.code);
         
         aa_remove(this.jbItemElement,true);
         fixInputSize();
       });
       itemsParent.appendChild(itemElement);
    }
    if (ajaxart.isattached($input[0])) fixInputSize();
  }

  function findLastElement() {
    var nodes = itemsParent.childNodes;
    return nodes[nodes.length-1];
  }
  function fixInputSize() {
    setTimeout(function() {
      var totalWidth = $(settings.baseElement).width();
      var lastElement = findLastElement();

      var left =0;
      if (lastElement) 
          left = aa_absLeft(lastElement) + $(lastElement).outerWidth() - aa_absLeft($(settings.baseElement)[0]);

      var newWidth = totalWidth - left;

      if (settings.rtl && lastElement) 
        newWidth = aa_absLeft(lastElement) - aa_absLeft($(settings.baseElement)[0]) - 5;
      
      
      if (newWidth < 10) newWidth = totalWidth;
      $input.width(newWidth-8);
    },ajaxart.isIE ? 300 : 0);
  }

  function initPopup() {
    mpicklist.selectorPopup = aa_createLightPopup({
      el: $(settings.popupElement)[0],
      launchingElement: $(settings.baseElement)[0],
      location:  aa_popupNearLauncherLocation({ minWidthOfLaunchingElement: true }),
      features: [
        aa_popup_feature_closeOnEsc()
      ],
      apiObject: mpicklist,
      type: 'mpicklist',
      popupSettings: {
        closeWhenClickingOutside: 'except launching element',
        reusablePopup: true
      }
    });

    if (aa_isStudioRefreshAndPopupIsOpen('mpicklist',mpicklist)) {
      setTimeout(openPopup,100);
    }

    $(settings.popupNoResultsElement).text(mpicklist.field.TextForNoResults || 'No results match your search');
    $(settings.popupShowAllElement).text(mpicklist.field.TextForShowAll || 'Show All');
  } 

  function syncPopup() {
    if (mpicklist.selectorPopup.isOpen)
      refreshPopupOptions();
    else
      openPopup();
  }

  function openPopup() {
    if (mpicklist.field.OnOpenPopup) {
      mpicklist.field.OnOpenPopup(mpicklist.field_data,mpicklist.context);
    }
    if (mpicklist.field.CustomPopupContents) {
      showPicklistCustomContents();
    } else {
      refreshPopupOptions();
    }
    mpicklist.selectorPopup.show();
  }

  function showPicklistCustomContents() {
    var obj = {
      SelectAndClose: function(data1) {
        var code = aa_totext(data1);
        mpicklist.selectorPopup.close();
        mpicklist.setValue(code);
        refreshPicklistBase();
      }
    };
    aa_empty(mpicklist.selectorPopup.el.firstChild);
    aa_fieldControl({ 
      Field: mpicklist.field.CustomPopupContents, 
      Wrapper: mpicklist.selectorPopup.el.firstChild,
      FieldData: [],
      Context: aa_ctx(mpicklist.context,{ _Picklist: [obj]})
    });
  }
  function bindInputEvents() {
    $input.click(function() {
      if (!ajaxart.isattached(mpicklist.selectorPopup.el)) {
        searchValue = $input.val();
        openPopup();
      } else
        mpicklist.selectorPopup.close();
    });
    $input.focus(function() {
      mpicklist.$el.addClass('aa_focus');
    });
    $input.blur(function() {
      mpicklist.$el.removeClass('aa_focus');
    });
    $input.keydown(function(e) {
      this.jbValueForKeyDown = $(this).val();
      if (e.keyCode == 27 && mpicklist.selectorPopup)  // esc
        mpicklist.selectorPopup.close();
      
      if (e.keyCode == 13) {
        var selected = $popupItemParent.find('>.selected')[0];
        if (selected) {
          selectItem(selected);
          return;
        }
      }
      if (e.keyCode == 40) { // arrow down
        var selected = $popupItemParent.find('>.selected')[0];
        if (selected && selected.nextSibling) {
          $(selected).removeClass('selected');
          $(selected.nextSibling).addClass('selected');
          selected.nextSibling.scrollIntoView();
          
          return;
        }
      }
      if (e.keyCode == 38) { // arrow up
        var selected = $popupItemParent.find('>.selected')[0];
        if (selected && selected.previousSibling) {
          $(selected).removeClass('selected');
          $(selected.previousSibling).addClass('selected');
          selected.previousSibling.scrollIntoView();
          return;
        }
      }     
    });

    $input.keyup(function(e) {
      if (this.jbValueForKeyDown == $(this).val()) return;
      if (!ajaxart.isattached(mpicklist.selectorPopup.el)) {
        searchValue = $input.val();
        openPopup();
      }     
      refreshPopupOptions();
    });
  }

  function refreshPopupOptions(showAll) {
    while ($popupItemParent[0].firstChild)
      aa_remove($popupItemParent[0].firstChild,true);

    var items = mpicklist.OptionsLeft();
    settings.search($input.val(),items);

    var added = 0;
  if (mpicklist.field.AllowValueNotInOptions && $input.val()) {
      items = items.concat([{ code: $input.val(), text: $input.val(), passed: true }]);
    }

    if (mpicklist.field && mpicklist.field.SortPicklistOptions) 
      items = mpicklist.field.SortPicklistOptions(items,mpicklist.context,picklist);

    for(var i=0;i<items.length;i++) {
      if (!items[i].passed) continue;
      var $item = $popupItemTemplate.clone().appendTo($popupItemParent);
      $item[0].jbItem = items[i];

      var innerSettings = settings.popupItemSettings($item[0]);
      $(innerSettings.itemTextElement).text(items[i].text);
      highlightText($(innerSettings.itemTextElement),$input.val());

      aa_trigger(mpicklist.field,'picklistRenderOption',{ 
        optionTextEl: $(innerSettings.itemTextElement)[0], 
        context: mpicklist.context, 
        option: items[i], 
        picklist: mpicklist
     });

      var imageObject = aa_create_static_image_object(items[i].image);
      if (imageObject && imageObject.url) {
        imageObject.keepImageProportions = imageObject.fillImage = imageObject.centerImage =  true;
        imageObject.height = settings.imageHeight;
        imageObject.width = settings.imageWidth;        
      }
      aa_setImage($(innerSettings.itemImageElement)[0],imageObject);

      try {
        if (settings.onRenderOption) settings.onRenderOption($item[0],items[i]);
      } catch(e) {
        ajaxart.logException('error calling onRenderOption',e);
      }

      if (added === 0) $item.addClass('selected');
      if (++added >= settings.maxItemsToShow && !showAll) {
        addShowAll();
        break;
      }
    }
    $popupItemParent.children().click(function() {
      if (this == $(settings.popupShowAllElement)[0]) return;

      selectItem(this);
    });
    $popupItemParent.children().mouseover(function() {
        if (this == $(settings.popupShowAllElement)[0] || disableSelectionOnHover) return;

        if ( $(this).hasClass('selected') ) return;
        $popupItemParent.children().removeClass('selected');
        $(this).addClass('selected');
    });
    if (!added) {
      $(settings.popupNoResultsElement).appendTo($popupItemParent);
    }
  }

  function selectItem(itemElement) {
    var code = itemElement.jbItem.code;
    mpicklist.selectorPopup.close();
    mpicklist.addValue(code);
    $input.val('');
    refreshPicklistBase();
  }

  function addShowAll() {
    $(settings.popupShowAllElement).appendTo($popupItemParent);
    $(settings.popupShowAllElement).click(function() {
      var lastItem = this.previousSibling && this.previousSibling.jbItem;
      refreshPopupOptions(true);

      var children = $popupItemParent.children();
      for(var i=0;i<children.length;i++)
        if (children[i].jbItem == lastItem) {
          if (children[i].tabIndex == -1) children[i].tabIndex = 0;
          children[i].focus();
          children[i].tabIndex = -1;
        }
    });
  }

  function highlightText($elem,searchtext) {
    $elem.html( ajaxart_field_highlight_text($elem.text(),searchtext,'.aa_highlight') );
  }

  function makeItemVisible(element,direction) {
    if (!element) return;

    var frame = picklist.selectorPopup.frameElement;
    var top = aa_relTop(element,frame);
    var bottom = top + $(element).outerHeight();
    var scrollY = $(frame).scrollTop();
    var frameHeight = $(frame).height();

    disableSelectionOnHover = true;

    if (direction == 'down') {
      if (bottom > scrollY + frameHeight ) {
        $(frame).scrollTop(bottom-frameHeight);  
      }
    }
    if (direction == 'up') {
      if (top < scrollY) {
        $(frame).scrollTop(top);
      }
    }

    setTimeout(function() {     // to prevent the selection to go to the mouse
      disableSelectionOnHover = false;
    },100);
  }

  function dragNDrop() {
    aa_dragDropItems({
      parent:itemsParent,
      isItemElement: function(elem) { return $(elem).hasClass('aa_mpicklist_item'); },
      moveBefore: function(elem,beforeElem) {
        var code = elem.jbOption.code;
        var beforeCode = beforeElem.jbOption.code;
        mpicklist.removeValue(code,true);
        var values = aa_totext(mpicklist.field_data).split(',');
        var startIndex = values.indexOf(beforeCode);
        if (startIndex<0) startIndex=0;
        values = values.slice(0,startIndex).concat([code]).concat(values.slice(startIndex));

        mpicklist.updateValue(values.join(','));
      },
      moveToEnd: function(elem) {
        var code = elem.jbOption.code;
        mpicklist.removeValue(code,true);
        mpicklist.addValue(code);
      },
      draggedSpaceCssClass: 'draggedItem',
      draggedCssClass: 'draggedItemSpace',
      canStartDrag: function(mouseX,mouseY) {
          return true;
      }     
    });
  }

}


/********************* old **************************/
aa_gcs("multiple_picklist",{
  MultiPicklistBaseArea: function (profile,data,context)
  {
    var field = {
      Id: aa_text(data,profile,'ID',context),
      Title: aa_multilang_text(data,profile,'Title',context),
      Style: aa_first(data,profile,'Style',context),
      MultiPicklistApiObject: aa_first(data,profile,'MultiPicklistApiObject',context)
    };

    field.Control = function(field_data,ctx) {
      var multipicklistBase = aa_initMultiPicklistBaseObject(field,field_data,ctx);
      multipicklistBase.OpenPopup = function() {
        ajaxart.runNativeHelper(data,profile,'OpenPopup',aa_ctx(context,{ _MultiPicklistBase: [multipicklistBase], ControlElement: [this.SearchInput] }));
      }
      multipicklistBase.FilterType = aa_first(data,profile,'SearchFilterType',context);
      
      return [ aa_renderStyleObject(field.Style,multipicklistBase,ctx,true)];
    }
    return [field];
  },
  PicklistSelect: function (profile,data,context)
  {
    var option = aa_first(data,profile,'Option',context);
    var multipicklistBase = context.vars._MultiPicklistBase[0];
    var multiPicklist = multipicklistBase.multiPicklist;
    
    var code = option.code;
    multiPicklist.addValue(code);
    if (multipicklistBase.SearchInput.jbPopup) multipicklistBase.SearchInput.jbPopup.close();

    aa_refresh_cell(multiPicklist.wrapperForStyleByField,context);
  }
});

function aa_initMultiPicklistObject(field,field_data,context)
{
  var multi_picklist = {
    Multiple: true,
    Field: field, FieldData: field_data, data: field_data[0], Context: context,
    getValues: function() {
      return aa_split(aa_totext(field_data),',',true);
    },
    addValue: function(code) {
      var val = aa_totext(field_data);
      if (val) val += ',';
      val += code;

      this.updateValue(val);
    },
    updateValue: function(val,noUpdateEvent) {
      ajaxart.writevalue(field_data,val);
      if (!noUpdateEvent) {
        var content = this.el;
        aa_invoke_field_handlers(field.OnUpdate,content,null,field,field_data,{});
        aa_trigger(field,'update',{ FieldData: field_data, wrapper: content.parentNode });
      }
    },
    removeValue: function(code,noUpdateEvent) {
      var vals = aa_totext( field_data ).split(',');
      for(var i=0;i<vals.length;i++) {
        if (vals[i] == code) {
          vals.splice(i,1);
          break;
        }
      }
      var newval = vals.join(',');
      this.updateValue(newval,noUpdateEvent);
      aa_trigger(this,'removeItem',{ });
    },
    OptionsLeft: function() {
      var values = this.getValues();
      var options = field.Options;
      var optionsLeft = [];
      for(var i=0;i<options.length;i++) {
        var optionCode = options[i].code;
        var added=false;
        for(var j=0;j<values.length;j++)
          if (values[j]==optionCode) added = true;
        if (!added) optionsLeft.push(options[i]);
      }
      return optionsLeft;
    }
  };
  return multi_picklist;
}

function aa_initMultiPicklistBaseObject(field,field_data,context)
{
  var multipicklistBase = {
    Field: field,
    multiPicklist: field.MultiPicklistApiObject,
    context: context,
    SearchValue: '',
    PopupFeatures: [ {
      init: function(popup) {
        multipicklistBase.Popup = popup;
        aa_bind(popup,'show',function() {
          var cntr = multipicklistBase.GetItemListCntr();
          aa_initContainerFilters(cntr);
          cntr.AddFilter({
            Id: 'search',
            FieldData: function(item) { return [item.text]; },
            FilterType: multipicklistBase.FilterType
          });
          
          cntr.RunQuery(multipicklistBase.QueryXml());
        });
      }
    }],
    GetItemListCntr: function() {
      var elem = jQuery(this.Popup.frameElement).find('.fld_Picklist_options')[0];
      return elem.jbContext.vars.ItemListCntr[0];
    },
    SyncPopup: function() {
      if (!this.Popup || !ajaxart.isattached(this.Popup.frameElement)) {
        this.OpenPopup();
      } else {
        // just update the filter
        var cntr = this.GetItemListCntr();
        cntr.RunQuery(this.QueryXml());
      }
    },
    QueryXml: function() {
      var xml = aa_parsexml('<query/>');
      xml.setAttribute('search',this.SearchValue);
      return xml;
    }
  };
  return multipicklistBase;
}

function aa_multipicklistbase(multipicklistBase,settings)
{
  var itemTemplate = settings.itemElement;
  multipicklistBase.jbItemsParent = itemTemplate.parentNode;
  
  var multiPicklist = multipicklistBase.multiPicklist;
  
  var values = multiPicklist.getValues();
  for(var i=0;i<values.length;i++) {
     var option = aa_picklist_optionByCode(multiPicklist.Field.Options,values[i]) || { code: values[i], text: values[i] };
     
     var itemElement = itemTemplate.cloneNode(true);
     itemElement.jbOption = option;
     
     var innerElements = settings.itemInnerElements(itemElement);
     innerElements.itemTextElement.innerHTML = option.text;
     innerElements.itemCloseElement.jbItemElement = itemElement;
     innerElements.itemCloseElement.onclick = function() {
       var itemElement = this.jbItemElement;
       var option = itemElement.jbOption;
       multiPicklist.removeValue(option.code);
       
       aa_remove(itemElement,true);
       fixInputSize();
     }   
     jQuery(itemTemplate).before(itemElement);
  }
  var jInput = jQuery(settings.searchElement);
  multipicklistBase.SearchInput = jInput[0];
  jInput[0].onkeyup = jInput[0].onclick = function() {
    multipicklistBase.SearchValue = jInput.val();
    multipicklistBase.SyncPopup([],multipicklistBase.context);
  }
  aa_remove(itemTemplate,true);

  function findLastElement() {
    var last = null;
    for(var iter=multipicklistBase.jbItemsParent.firstChild;iter;iter=iter.nextSibling) {
      if (iter.jbOption) last = iter;
    }
    return last;
  }
  function fixInputSize() {
    var totalWidth = multipicklistBase.$el.width();
    var lastElement = findLastElement();
    if (lastElement)
      var left = aa_absLeft(lastElement) + jQuery(lastElement).width() - aa_absLeft(multipicklistBase.el);
    else 
      var left = 0;
      
    var padding = (jInput.outerWidth() - jInput.width())*2; 
    jInput.width(totalWidth - left - padding - 5);
  }
  
  aa_addOnAttach(jInput[0],function() {fixInputSize();});
}
function aa_picklist_checkboxes(multi_picklist,settings)
{
  settings = aa_defaults(settings,{
    OptionElement: multi_picklist.$el.find('.aa_option')[0],
    OptionInnerElements: function(optionEl) {
      return {
        CheckBoxElement: jQuery(optionEl).find('.aa_option_checkbox')[0],
        TextElement: jQuery(optionEl).find('.aa_option_text')[0]
      }
    }    
  });
  
  var optionTemplate = settings.OptionElement;
  var templateParent = optionTemplate.parentNode;
  var values = multi_picklist.getValues();  
  var options = multi_picklist.Field.Options;
  for(var i=0;i<options.length;i++) {
    var option = options[i];
    var optionElem = optionTemplate.cloneNode(true);
    var optionSettings = settings.OptionInnerElements(optionElem);
    optionElem.jbOption = option;
    if (optionSettings.TextElement) { 
      optionSettings.TextElement.innerHTML = option.text; 
      optionSettings.TextElement.jbCheckbox = optionSettings.CheckBoxElement; 
      optionSettings.TextElement.jbOption = option;
      optionSettings.TextElement.onclick = function() {
        $(this.jbCheckbox).click();
      };
    }
    if (optionSettings.CheckBoxElement) {
      optionSettings.CheckBoxElement.jbOption = option;
      var checked = false;
      for (var j in values) {
        if (values[j] == option.code)
          checked = true;
      }
      if (checked) 
        optionSettings.CheckBoxElement.checked = true;
      optionSettings.CheckBoxElement.onchange = function() {
        if (this.checked) 
          multi_picklist.addValue(this.jbOption.code);
        else
          multi_picklist.removeValue(this.jbOption.code);
      };
    }   
    $(optionTemplate).before(optionElem);
  } 
  templateParent.removeChild(optionTemplate);
}

aa_gcs("fld_type",{
	Number: function (profile,data,context) {
		var field = context.vars._Field[0];
		field.Style = aa_first(data,profile,'Style',context);
		field.FieldType = 'number';
		
		field.NumberFormat = aa_first(data,profile,'Format',context);

		field.Control = function(field_data,ctx) {
			var number = {
				value: aa_totext(field_data),
				format: field.NumberFormat,
				field: field,	context: context, field_data: field_data
			};
			return [aa_renderStyleObject(field.Style,number,ctx,true)];
		} 
		ajaxart.runNativeHelper(data,profile,'SortType',context);

		if (aa_bool(data,profile,'AlignToRightOnTables',context))	{
			ajaxart.runNativeHelper(data,profile,'AlignToRight',context);
		}
	},
	EditableNumber: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		field.Style = aa_first(data,profile,'Style',context);
		field.NumberFormat = aa_first(data,profile,'Format',context);

		aa_init_class_EditableNumber();

		field.Control = function(field_data,ctx) {			
			var numberApiObject = new ajaxart.classes.EditableNumber({
				value: aa_totext(field_data), 
				field: field, field_data: field_data,
				format: field.NumberFormat,
				allowEmptyValue: field.AllowEmptyValue,
				data: field_data, profile: profile, context: context
			});
			return [aa_renderStyleObject(field.Style,numberApiObject,ctx,true)];
		}

		if (aa_bool(data,profile,'NumberValidation',context)) {
			ajaxart.runNativeHelper(data,profile,'DefaultValidation',context);
		}
	}	
});
aa_gcs("number",{	
	Format: function (profile,data,context)
	{
		aa_init_class_NumberFormat();

		var format = new ajaxart.classes.NumberFormat({
			profile: profile, context: context,

			name: aa_text(data,profile,'Name',context),
			symbol: aa_text(data,profile,'Symbol',context),
			useDynamicSymbol: aa_bool(data,profile,'UseDynamicSymbol',context),
			min: parseFloat(aa_text(data,profile,'Min',context)), // do not use aa_float to avoid default 0
			max: parseFloat(aa_text(data,profile,'Max',context)),
			step: 1,
			initialPixelsPerUnit: 1
		});

		var ctx = aa_ctx(context,{_NumberFormat: [format]});
		ajaxart.run(data,profile,'UIHints',ctx);

		return [format];
	},
	FormatUIHints: function (profile,data,context) {
		var format = context.vars._NumberFormat[0];
		format.step = aa_float(data,profile,'Step',context) || 1;
		format.initialPixelsPerUnit = aa_float(data,profile,'InitialPixelsPerUnit',context);
	},
	FormatMoney: function (profile,data,context) {
		var value = aa_accounting().formatMoney(
			parseFloat(data[0].Value),
			'',
			aa_text(data,profile,'Precision',context),
			aa_text(data,profile,'Thousand',context),
			aa_text(data,profile,'Decimal',context),
			'%v'
		);

		var input = {
			Value: value,
			Symbol: data[0].Symbol
		}
		return aa_text([input],profile,'Format',context);
	}
});

function aa_init_class_NumberFormat() {
	
	if (ajaxart.classes.NumberFormat) return;

	ajaxart.classes.NumberFormat = function(settings) {	
		aa_extend(this,settings);
	};
	ajaxart.classes.NumberFormat.prototype.parse = function(dataString) {
		if (!dataString) return NaN;
		var parts = (''+dataString).match(/([^0-9\.\-]*)([0-9\.\-]+)([^0-9\.\-]*)/); // remove prefix string
		if (this.useDynamicSymbol && parts)
			this.symbol = parts[1] || parts[3] || this.symbol;
		var value = parts && parts[2];
		var v = parseFloat(value);
		return v;
	};
	ajaxart.classes.NumberFormat.prototype.getDisplayString = function(number) {
		if (isNaN(number)) return [(this.field && this.field.TextForEmptyValue) || ''];
		var data = [ { Value: number, Symbol: this.symbol }];
		return ajaxart.run(data,this.profile,'DisplayString',this.context);
	};

	ajaxart.classes.NumberFormat.prototype.getDataString = function(number) {
		if (isNaN(number)) return '';
		if (typeof number === 'number') number = '' + number;
		var data = [ { Value: number, Symbol: this.symbol }];
		return aa_text(data,this.profile,'DataString',this.context);
	};

}

function aa_number(number,settings) {
	settings = settings || {};
	settings.textElement = settings.textElement || number.el;

	var format = number.format;

	var num = format.parse(number.value);
	var text = format.getDisplayString(num);

	$(settings.textElement).text(text);
}


aa_gcs("prefstorage", {
	UrlFragmentKey: function(profile,data,context) {
		var separator = aa_text(data,profile,'Separator',context);
		var keyPrefix = aa_text(data,profile,'KeyPrefix',context);
		var regSeparator = separator == '?' ? '\\?' : separator;
		return [{
			get: function(key) {
				var keyToUse = keyPrefix + key;
				return aa_urlHashValue(keyToUse);
			},
			set: function(key,value) {
				var keyToUse = keyPrefix + key;
				aa_setUrlHashValue(keyToUse,value);
			}
		}];
	},
	LocalStorage: function(profile,data,context) {
		var keyPrefix = aa_text(data,profile,'KeyPrefix',context);
		var browserSupport = 'localStorage' in window && window['localStorage'] !== null;
		return [{
			get: function(key) {
				if (!browserSupport) { ajaxart.log("cannot read '" + key + "' from local storage, no browser support","error"); return ""; }
				return localStorage.getItem(keyPrefix + key);
			},
			set: function(key,value) {
				if (!browserSupport) { ajaxart.log("cannot write '" + key + "'='" + value + "' to local storage, no browser support","error"); return; }
				if (value)
					localStorage.setItem(keyPrefix + key, value);
				else
					localStorage.removeItem(keyPrefix + key);
			}
		}];
	},
	SessionStorage: function(profile,data,context) {
		var keyPrefix = aa_text(data,profile,'KeyPrefix',context);
		var browserSupport = 'sessionStorage' in window && window['sessionStorage'] !== null;
		return [{
			get: function(key) {
				if (!browserSupport) { ajaxart.log("cannot read '" + key + "' from local storage, no browser support","error"); return ""; }
				return sessionStorage.getItem(keyPrefix + key);
			},
			set: function(key,value) {
				if (!browserSupport) { ajaxart.log("cannot write '" + key + "'='" + value + "' to local storage, no browser support","error"); return; }
				if (value)
					sessionStorage.setItem(keyPrefix + key, value);
				else
					sessionStorage.removeItem(keyPrefix + key);
			}
		}];
	},
	Cookie: function(profile,data,context) {
		var keyPrefix = aa_text(data,profile,'KeyPrefix',context);
		return [{
			get: function(key) {
				return aa_valueFromCookie(keyPrefix + key);
			},
			set: function(key,value) {
				aa_writeCookie(keyPrefix + key,value);				
			}
		}];
	},
	GetPreferenceValue: function(profile,data,context) {
		var storage = aa_first(data,profile,'Storage',context);
		var key = aa_text(data,profile,'Key',context);
		return [ "" + storage.get(key) ];
	},
	SetPreferenceValue: function(profile,data,context) {
		var storage = aa_first(data,profile,'Storage',context);
		var key = aa_text(data,profile,'Key',context);
		var value = aa_text(data,profile,'Value',context);
		storage.set(key,value);
		return [];
	}
});
function aa_roundabout(imagegallery, settings) {
  settings = aa_defaults(settings, {
    autoPlayAfter: 5000,
    roundDuration: 600
  })
  var baseUrl = imagegallery.BaseUrl || aa_base_lib() + '/roundabout/';
  aa_loadRequiresJSFiles({
    jsFiles: [{
      url: baseUrl + 'jquery.roundabout.js',
      jsVariable: 'jQuery.fn.roundabout'
    }, {
      url: baseUrl + 'jquery.roundabout-shapes.js',
      jsVariable: 'jQuery.roundaboutShapes.waterWheel'
    }],
    onload: function() {
      var ul = imagegallery.$el.find("ul");
      var images = imagegallery.images;
      if (images.length < 4 && images.length > 1) { // works well with at-least 4 items
        images = [];
        for (i = 0; i < imagegallery.images.length * 4; i++)
        images.push(imagegallery.images[i % imagegallery.images.length]);
      }
      for (i in images) {
        var imageObj = images[i];
        var li = jQuery('<li><a href="javascript:;"><img class="roundabout_image"/></a></li>');
        li.find("img").attr("src", imageObj.url).attr("title", imageObj.title)[0].jbImageObject = imageObj;
        if (imageObj.link) li.find("a").attr("href", imageObj.link).attr("target", "_blank");
        li.appendTo(ul);
      }
      aa_addOnAttach(imagegallery.el, function() {
        if (images.length == 1) {
          ul.addClass("roundabout-holder single-image");
          ul.find("li").addClass("roundabout-moveable-item");
        } else {
          ul.roundabout({
            shape: 'waterWheel',
            minOpacity: 0,
            duration: settings.roundDuration
          });
          // fix image positions on every move
          $('ul').bind('childrenUpdated', {}, function() {
            $('ul').children('.li').each(function() {
              fixImagePosition($(this).find('.roundabout_image')[0], this);
            });
          });
          ul.inHover = false;
          imagegallery.$el.mousemove(function() {
            ul.inHover = true;
          }).mouseout(function() {
            ul.inHover = false;
          });

          function autoPlay() {
            if (!ajaxart.isattached(ul)) return;
            if (!ul.inHover) ul.roundabout('animateToNextChild');
            setTimeout(autoPlay, settings.autoPlayAfter);
          }
          setTimeout(autoPlay, settings.autoPlayAfter);
        }
        // fix initial image positions
        $('ul').find('.roundabout_image').each(function(index, image) {
          function fix() {
            fixImagePosition(image, $(image).parents('li')[0]);
          }
          if (this.width) fix(); // already loaded
          else {
            $(this).css('width', $(this).parent().width() + 'px');
            this.onload = fix;
          }
        });
      });
    }
  });

  function fixImagePosition(img, li) {
    var imageObject = img.jbImageObject;
    var boxHeight = settings.height;
    var boxWidth = settings.width;

    if (imageObject.originalHeight) {
      $(img).height(boxHeight);
      var width = boxHeight * imageObject.originalWidth / imageObject.originalHeight;
      var marginLeft = Math.max(parseInt((boxWidth - width) / 2),0);
      $(img).width(parseInt(width)).css('margin-left', marginLeft + 'px');
    } else {
      $(img).css('width', '');
      var imageRatio = img.naturalWidth / img.naturalHeight;
      var desiredRatio = boxWidth / boxHeight;
      var $img = jQuery(img);
      if (imageRatio == desiredRatio) {
        $img.css('width', '100%').css('height', '100%;');
      } else if (imageRatio < desiredRatio) {
        $img.css('width', '100%').css('height', 'none');
        var marginTop = ((imageRatio - desiredRatio) * boxHeight) * 0.5;
        $img.css('margin-top', marginTop + 'px');
      } else {
        $img.css('height', '100%').css('width', 'none');
        var marginLeft = ((desiredRatio - imageRatio) * boxWidth) * 0.5;
        $img.css('margin-left', marginLeft + 'px');
      }
    }
  }

}


function aa_ImageWithNextPrevButtons(imagegallery,settings) {
  if (!imagegallery.images.length) imagegallery.$el.css('opacity', 0);

  $find(".visible").width(settings.width + "px");
  if (imagegallery.images.length == 0) return;
  var current = 0;
  var max_circles = 10;
  for (i = 0; i < imagegallery.images.length; i++) {
    var imageObject = imagegallery.images[i];

    var td = $('<td><div/></td>').appendTo($find('tr'));
    var div = td.find('div');
    if (imagegallery.images[i].originalHeight) {
      var width = settings.height * imageObject.originalWidth / imageObject.originalHeight;
      aa_setImage(div[0], {
        url: imageObject.url,
        height: settings.height,
        width: width,
        keepImageProportions: false
      });
      var marginLeft = Math.max(parseInt((settings.width - width) / 2),0);
      div.find('img').css('margin-left',marginLeft + 'px');
      $(div).width(settings.width).css('overflow','hidden');
    } else {
      aa_setImage(div[0], {
        url: imageObject.url,
        height: settings.height,
        width: settings.width,
        keepImageProportions: true,
        fillImage: true,
        centerImage: true
      });
    }
    if (i < max_circles) {
      var circle = jQuery("<div class='circle'></div>").appendTo($find('.circles'));
      circle.click(function() {
        current = $(this).index();
        show();
      });
    }
  }
  if (imagegallery.images.length < 2) $find('.circles').hide();
  $find('.button').css('top', settings.height / 2);
  show();

  function show() {
    $find('.images').css('margin-left', "-" + $find('.visible').width() * current + "px");
    $find('.prev').removeClass('disable').addClass(current == 0 ? 'disable' : '');
    $find('.next').removeClass('disable').addClass(current >= imagegallery.images.length - 1 ? 'disable' : '');
    $find('.circles').children().removeClass("current");
    $find('.circles').children(":nth-child(" + (current + 1) + ")").addClass("current");
  }
  $find('.next').click(function() {
    if (current < imagegallery.images.length - 1) {
      current++;
      show();
    }
  });
  $find('.prev').click(function() {
    if (current > 0) {
      current--;
      show();
    }
  });

  function $find(selector) {
    return imagegallery.$el.find(selector);
  }

}


function aa_replace_transition(settings,context)
{	/* settings must have: transition, elOriginal, elNew 
	   optional: onTransitionEnd, removeOriginal, onBeforeTransitionBegin
	*/
	aa_defaults(settings, {
		$elOriginal: 	$(settings.elOriginal),
		$elNew: 		$(settings.elNew),
		css: 			settings.transition.Css,
		onTransitionEnd:function() {},
		removeOriginal: function(original) { aa_remove(settings.elOriginal); },
		onBeforeTransitionBegin: function() {},
		context: context,
		params: settings.transition.params
	});
	aa_apply_style_js(settings,settings.transition,context,'animate');
}

function aa_fade_transition(transition, duration) {
	  function onTransitionEnd() {
	    transition.$elOriginal.css( { opacity: 1 } );
	    transition.$elOriginal.removeClass('aa_original');
	    transition.removeOriginal(transition.elOriginal);
	    transition.$elNew.removeClass('aa_new');
	    transition.$elOriginal.parent().removeClass(cssClass);
	    transition.onTransitionEnd();
	  }
	  transition.$elOriginal.addClass('aa_original');
	  transition.$elNew.addClass('aa_new');
	  transition.$elNew.css("height",transition.$elOriginal.height());		// To keep original size before attaching
	  transition.$elNew.css("width",transition.$elOriginal.width());
	  transition.$elOriginal.css("height",transition.$elOriginal.height());	// To keep the size after detaching it
	  transition.$elOriginal.css("width",transition.$elOriginal.width());
	  transition.elOriginal.parentNode.appendChild(transition.elNew);
	  aa_element_attached(transition.elNew);
	  var cssClass = aa_attach_global_css(transition.css);
	  transition.$elOriginal.parent().addClass(cssClass);
	  transition.$elNew.css({opacity:0});
	  transition.onBeforeTransitionBegin();
	  transition.$elOriginal.animate({ opacity:0 },duration, "swing");
	  transition.$elNew.animate({ opacity:1 },duration, "swing", onTransitionEnd);
}



aa_gcs("field_aspect",{
	ValidationStyle: function(profile,data,context) {
		var field = context.vars._Field[0];
		field.ValidationStyle = aa_first(data,profile,'Style',context);

		aa_bind(field,'ModifyCell', function(args) {
			var validationStyle = aa_renderStyleObject(field.ValidationStyle,{},context,true,{
				funcName: 'init'
			}).jbApiObject;
			$(args.Wrapper).addClass(validationStyle.elem_class + ' aa_validation_style');
			validationStyle.$el.removeClass(validationStyle.elem_class);
			args.Wrapper.jbValidationStyle = validationStyle;
		});
	},
	Validation: function (profile,data,context)
	{
		var field = context.vars._Field[0];
		if (! field.Validations ) field.Validations = [];
		var obj = {};
		obj.CheckValidation = aa_text(data,profile,'CheckValidation',context);
		aa_setMethod(obj,'Validation',profile,'ValidationLogic',context);
		aa_setMethod(obj,'ErrorMessage',profile,'ErrorMessage',context);
		obj.AddTitleToErrorMessage = aa_bool(data,profile,'AddTitleToErrorMessage',context);
		obj.HideErrorMessage = ! aa_bool(data,profile,'ShowErrorMessageNextToField',context);
		field.Validations.push(obj);

		aa_bind(field,'ModifyControl',function(args){
			var contentElement = $(args.Wrapper).find('input')[0] || args.Wrapper.firstChild;
			if (!contentElement) return;
			$(contentElement).addClass('aa_has_validations');
			aa_bind(contentElement,'validation',function(validationObject) {
				if (aa_bool(args.FieldData,profile,'ValidationLogic',context)) {
					validationObject.passed = false;
					validationObject.errorMessage = aa_text(args.FieldData,profile,'ErrorMessage',context);
				}
			},'');
		},'');	
	}
});

aa_gcs("app_feature",{
	ValidationStyle: function(profile,data,context) {
		var bctx = context.vars._AppContext[0];

		var style = aa_first(data,profile,'Style',context);
	
		var validationStyle = aa_renderStyleObject(style,{},context,true,{
				funcName: 'init'
		}).jbApiObject;

		validationStyle.$el.removeClass(validationStyle.elem_class);
		bctx.ValidationStyle2 = validationStyle;

		aa_bind(bctx,'showPage',function(args) {
			$(args.el).addClass(validationStyle.elem_class);
		});
	}
});

function aa_checkValidations(topElement,noMandatoryChecks)
{
	// https://docs.google.com/a/artwaresoft.com/document/d/1o6Uv_k3rlnm-Wp_Z7-oRVaAbfAYHcbecHzr39_0gNbU/edit#heading=h.bgjp8atg2ug5

	var validationStyle = aa_findValidationStyle(topElement);
	validationStyle.clearErrors(validationStyle,topElement);

	var scrollToMargins = validationStyle.scrollMargins || { top: 30, bottom: 30 };

	var firstTime = true;
	var elems = $(topElement).find('.aa_has_validations');
	
	var passed = true;
	var errors = [];

	for(var i=0;i<elems.length;i++) {
		var elem = elems[i];
		var errorObject = {
			passed: true,
			element: elem
		};
		aa_trigger(elem,'validation',errorObject);
		if (noMandatoryChecks && errorObject.mandatoryFailure) errorObject.passed = true;
		
		if (!errorObject.passed) {
			if (firstTime) {
				aa_scrollToShowElement(elem,'',scrollToMargins);
				firstTime = false;
			}
			validationStyle.showValidationError(validationStyle,topElement,errorObject);
			passed = false;
			errors.push(errorObject);
		}
	}
	if (!passed) {
		validationStyle.showErrorSummary(validationStyle,topElement,errors);
	}
	return passed;
}

function aa_findValidationStyle(elem) {
	if ($(elem).hasClass('aa_validation_style')) return elem.jbValidationStyle;
	var parent = $(elem).closest('.aa_validation_style')[0];
	if (parent) return parent.jbValidationStyle;

	var bctx = aa_find_bart_context(elem);
	if (bctx && bctx.ValidationStyle2) return bctx.ValidationStyle2;

	if (!ajaxart.defaultValidationStyle) {
		var el = $('<div/>')[0];
		ajaxart.defaultValidationStyle = {
			el: el,
			$el: $(el)
		};
		aa_initValidationStyle(ajaxart.defaultValidationStyle,{});	
	}
	
	return ajaxart.defaultValidationStyle;
}

function aa_initValidationStyle(validationStyle,settings) {
	settings = aa_defaults(settings,{
		clearErrors: function(validationStyle,topElement) {
			$(topElement).find('.aa_error').removeClass('aa_error');
			$(topElement).find('.aa_error_message').remove();			
			$(topElement).find('.aa_validation_error').remove();			
		},
		showValidationError: function(validationStyle,topElement,errorObject) {
			var elem = errorObject.element;
			if (aa_isArray(elem)) {
				for(var i=0;i<elem.length;i++)
					this.showValidationError(validationStyle,topElement,$.extend({},errorObject,{element: elem[i]}))
				return;
			}
			var messageDiv = $(validationStyle.el.cloneNode(true)).addClass('aa_error_message').text(errorObject.errorMessage);
			elem.parentNode.appendChild(messageDiv[0]);

			elem.jbValidationMessage = messageDiv;
			$(elem).addClass('aa_error');

			if (!elem.jbValidationFocusEventBound) {
				elem.jbValidationFocusEventBound = true;
				if (elem.tabIndex == -1) elem.tabIndex = 1;

				$(elem).add($(elem).find("input")).add($(elem).find("textarea")).add($(elem).find(".aa_picklist_div")).focus(function() {
					$(elem).removeClass('aa_error');
					if (elem.jbValidationMessage)
						aa_remove(elem.jbValidationMessage,true);
					validationStyle.clearErrorSummary(validationStyle,topElement);
				});
			}
		},
		clearErrorSummary: function(validationStyle,topElement) {
		},
		showErrorSummary: function(validationStyle,topElement,errors) {			
		}
	});

	validationStyle.clearErrors = settings.clearErrors;
	validationStyle.showValidationError = settings.showValidationError;
	validationStyle.showErrorSummary = settings.showErrorSummary;
	validationStyle.clearErrorSummary = settings.clearErrorSummary;
	validationStyle.scrollMargins = settings.scrollMargins;	
}





aa_gcs("parser", {
	RemoveSection: function (profile,data,context) {
		var begin = aa_text(data,profile,'BeginPattern',context);
		var end = aa_text(data,profile,'EndPattern',context);
		
		function removeOneSection(html) {
			var lowerCase = html.toLowerCase();
			var from = lowerCase.indexOf(begin);
			var to = lowerCase.indexOf(end,from);
			if (from == -1 || to == -1) return html;
			return html.substring(0,from) + html.substring(to + end.length);
		}
		
		var result = aa_text(data,profile,'Html',context);
		var next = removeOneSection(result);
		while (next.length < result.length) {
			result = next;
			next = removeOneSection(result);
		}
		return [result];
	},
	ExtractBody: function (profile,data,context) {
		var result = aa_text(data,profile,'Html',context);
		var lowerCase = result.toLowerCase();
		var from = lowerCase.indexOf('<body');
		if (from != -1) from = lowerCase.indexOf('>',from);
		var to = lowerCase.indexOf('</body');
		if (from != -1 && to != -1)
			result = '<div' + result.substring(from,to) + '</div>';
		return [result];
	}
});



/*********************** UI For Preview Html *************************************/

aa_gcs("parser",{
	PreviewHtml: function(profile, data, context) {
		var field = aa_create_base_field(data, profile, context);
		var style = aa_first(data, profile, 'Style', context);

		field.Control = function(field_data, ctx) {
			var ctx2 = aa_merge_ctx(context,ctx);
			var htmlPreview = { 
				html_text: aa_text(field_data,profile,'Html',context) 
			};
			return [aa_renderStyleObject2(style,htmlPreview,field_data,field,ctx2,{})];
		};
		return [field];
	}
});


function aa_htmlPreview(htmlPreview) {
	var iframe = $('<iframe src="about:black" />')[0];
	htmlPreview.el.appendChild(iframe);

	aa_addOnAttachMultiple(htmlPreview.el,function() {
		var doc = iframe.contentDocument;
		doc.open();
	  doc.write(htmlPreview.html_text);
	  doc.close();
	});
}



aa_gcs("popup", {
	OpenPopup: function (profile, data, context) {
		var style = aa_first(data,profile,'Style',context);

		aa_init_class_Popup();

		var popup = new ajaxart.classes.Popup({
			title: aa_text(data,profile,'PopupTitle',context),
			data: data, context: context, profile: profile,
			launchingElement: aa_var_first(context,'ControlElement'),
			base_features: ajaxart.runsubprofiles(data,profile,'Feature',context)
		});

		aa_renderStyleObject(style,popup,context,true,{
			jsFunctionName: 'show'
		});
		return [popup];
	},
	CloseContainingPopup: function (profile, data, context) {
		var exitMode = aa_text(data,profile,'ExitMode',context);
		var control = aa_var_first(context,'ControlElement');
		aa_close_containing_popup(control,function() {
			ajaxart.run(data,profile,'DoOnExit',context);
		},exitMode);
	},
	CloseUniquePopup: function (profile, data, context) {
		var uniqueID = aa_text(data,profile,'UniqueID',context);
		var openPopups = aa_open_popups();
		for(var i=0;i<openPopups.length;i++) {
			if (openPopups[i].uniqueID && openPopups[i].uniqueID == uniqueID)
				openPopups[i].close();
		}
	},
	RunAsyncActionAndCloseContainingPopup: function (profile, data, context) {
		var deferred = $.Deferred();
		var control = aa_var_first(context,'ControlElement');
		var top = control && $(control).closest('.aa_popup')[0];
		if (!top || !top.jbPopup || !aa_checkValidations(top.jbPopup.frameElement)) return;

		var promise = aa_first(data,profile,'Action',context);
		$.when(promise).then(function() {
			top.jbPopup.close();
			deferred.resolve();
		},function() {
		});
		return [deferred.promise()];
	},
	RunOnPopup: function (profile, data, context) {
		var openPopups = aa_open_popups();
		if (openPopups.length>0) {
			var popup = openPopups[openPopups.length-1];
			ajaxart.run(data,profile,'Action',aa_ctx(context,{ControlElement: [popup.el]}));
		}
	},
	ZIndex: function (profile, data, context) {
		return [aa_popup_feature_zindex({
			zindex: aa_int(data,profile,'ZIndex',context)
		})];
	},
	UniquePopup: function (profile, data, context) {
		return [aa_popup_feature_UniquePopup({
			uniqueID: aa_text(data,profile,'UniqueID',context)
		})];
	},
	TitleDragAndDrop: function (profile, data, context) {
		return [aa_popup_title_dragAndDrop()];
	},
	CloseOnEnter: function (profile, data, context) {
		return [aa_popup_closeOnEnter()];
	},
	CloseOnBrowserBackButton: function (profile, data, context) {
		return [aa_popup_feature_closeOnBackButton()];
	},
	AutoFocusOnFirstInput: function (profile, data, context) {
		return [aa_popup_feature_autoFocus()];
	},
	StudioPopupFeature: function (profile, data, context) {
		return [{
			init: function(popup) {
				popup.jbStudio = true;
			}
		}];
	}, 
	PopupSize: function (profile, data, context) {
		return [aa_popup_feature_size({ 
			width: aa_text(data,profile,'Width',context),
			height: aa_text(data,profile,'Height',context)
		})];
	},
	FloatingPopup: function (profile, data, context) {
		return [aa_popup_feature_floating_popup({ 
			identifier: aa_text(data,profile,'Identifier',context),
			autoBringToFront: aa_bool(data,profile,'AutoBringToFront',context),
			rememberLocations: aa_bool(data,profile,'RememberPopupLocations',context),
			fieldsToRefresh: aa_text(data,profile,'FieldIdsToRefreshWhenOpenOrClosed',context),
			location: aa_first(data,profile,'Location',context),
			closeCondition: function() {
				return aa_bool(data,profile,'CloseCondition',context)
			}
		})];
	},
	IsFloatingPopupOpen: function (profile, data, context) {
		var popups = aa_open_popups();
		var id = aa_text(data,profile,'Identifier',context);
		if (!id) return [];
		
		for(var i=0;i<popups.length;i++)
			if (popups[i].identifier == id) return ['true'];
	},
	HandleEvent: function (profile, data, context) {
		return [{
			init: function(popup) {
				var eventAction = {
					run: function(data1, ctx) {
						var ctx2 = aa_merge_ctx(context, ctx);
						if (ctx2.vars.EventAction) delete ctx2.vars.EventAction;
						ajaxart.run(data1, profile, 'Action', ctx2);
					}
				};
				ajaxart.run(data, profile, 'Event', aa_ctx(context, {
					EventAction: [eventAction], 
					_Popup: [popup]
				}));
			}
		}];
	},
	CloseFloatingPopup: function (profile, data, context) {
		var id = aa_text(data,profile,'Identifier',context);

		var openPopups = aa_open_popups();
		for(var i=openPopups.length-1;i>=0;i--) {
			if (openPopups[i].identifier == id) 
				openPopups[i].close();
		}
	},
	CheckFloatingPopupsCloseCondition: function (profile, data, context) {
		var openPopups = aa_open_popups();
		for(var i=openPopups.length-1;i>=0;i--) {
			var popup = openPopups[i];
			if (popup.identifier && popup.closeCondition && popup.closeCondition() )
				popup.close();
		}
	},
	RestoreFloatingPopup: function (profile, data, context) {
		var id = aa_text(data,profile,'Identifier',context);
		if (sessionStorage['jbFloatingPopupIsOpen_'+id] != 'true') return;

		var openPopups = aa_open_popups();
		for(var i=openPopups.length-1;i>=0;i--) {
			if (openPopups[i].identifier == id) return; // already open
		}

		ajaxart.run(data,profile,'OpenPopup',context);
	}
});

aa_gcs("popup_event", {
	Close: function(profile, data, context) {
		var popup = context.vars._Popup[0];
		aa_bind(popup,'close',function() {
			context.vars.EventAction[0].run([], context);
		});
	},
	Show: function(profile, data, context) {
		var popup = context.vars._Popup[0];
		aa_bind(popup,'show',function() {
			context.vars.EventAction[0].run([], context);
		});
	}
});

aa_gcs("popup_field_aspect", {
  PopupOnHover: function (profile, data, context) {
      var field = context.vars._Field[0];
      var popupStrategy = aa_first(data,profile,'OpenPopup',context);

      aa_bind(field,'ModifyControl',function(args) {
        var ctx2 = aa_ctx(context,{ControlElement: [args.Wrapper]});

        var popupAdapter = {
          wrapper: args.Wrapper,
          $wrapper: $(args.Wrapper),
          openPopup: function() {
            this.popup = ajaxart.runNativeHelper(args.FieldData,profile,'OpenPopup',ctx2)[0];
          },
          closePopup: function() {
            if (this.popup) {
            	this.popup.close();
            	this.popup = null;
            }
          }
        };
        aa_renderStyleObject(popupStrategy,popupAdapter,ctx2,true,{ funcName: 'attach'});
        aa_apply_style_js(popupAdapter,popupStrategy,ctx2,'attach');
      },'Popup');
  },
	ToolbarPopup: function(profile, data, context) {
		var field = context.vars._Field[0];
		field.PopupToolbarID = aa_text(data,profile,'ToolbarID',context);
		field.ToolBarPopupStyle = aa_first(data,profile,'PopupStyle',context);

		aa_init_class_Popup();

		aa_bind(field,'ModifyControl',function(args) {
			var contentElement = args.Wrapper.firstChild;
			contentElement.onclick = function() {
				if (contentElement.jbPopup && ajaxart.isattached(contentElement.jbPopup.frameElement)) {
					contentElement.jbPopup.close();
				}
				else 
					openPopup(contentElement,args.FieldData);
			};
			contentElement.onmouseover = function() {
				if (hasPopupOfToolbar(contentElement)) {
					openPopup(contentElement,args.FieldData);	
				};
			}
		});

		function openPopup(launchingElement,field_data) {
			var features = ajaxart.runsubprofiles(data,profile,'PopupFeature',context);
			features.push(aa_popup_feature_toolbar_popup({ toolbarID: field.PopupToolbarID }));

			var popup = new ajaxart.classes.Popup({
				title: '',
				data: data, context: context, profile: profile,
				launchingElement: launchingElement,
				base_features: features
			});
			aa_bind(popup,'close',function() {
				$(launchingElement).removeClass('toolbarPopupOpen');
			});
			// close other popups
			var openPopups = aa_open_popups();
			for(var i=openPopups.length-1;i>=0;i--) {
				if (openPopups[i].toolbarID == field.PopupToolbarID) {
					openPopups[i].close();
				}
			}

			launchingElement.jbPopup = popup;
			$(launchingElement).addClass('toolbarPopupOpen');

			aa_renderStyleObject(field.ToolBarPopupStyle,popup,context,true,{
				jsFunctionName: 'show'
			});
		}

		function hasPopupOfToolbar(contentElement) {
			var openPopups = aa_open_popups();
			for(var i=openPopups.length-1;i>=0;i--) {
				if (openPopups[i].toolbarID == field.PopupToolbarID && openPopups[i] != contentElement.jbPopup) {
					return true;
				}
			}
			return false;
		}
	},
	CascadingMenuPopup: function(profile,data,context) {
		var field = context.vars._Field[0];
		field.ToolBarPopupStyle = aa_first(data,profile,'PopupStyle',context);
		field.CascadingMenuPopup = true;
		aa_init_class_Popup();

		aa_bind(field,'ModifyControl',function(args) {
			aa_addOnAttach(args.Wrapper,function() {
				var containingPopup = getContainingPopup(args.Wrapper);
				if (!containingPopup) return;

				var contentElement = args.Wrapper.firstChild;
				contentElement.onmouseover = function() {
					openPopup(containingPopup,contentElement,args.FieldData);	
				};				
			});
		});

		function getContainingPopup(elem) {
			var top = elem && $(elem).closest('.aa_popup')[0];			
			var containingPopup = top && top.jbPopup;
			if (!containingPopup) return;
			if (!containingPopup.innerCascadingPopupInitialized) {
				containingPopup.innerCascadingPopupInitialized = true;

				var elems = $(elem).siblings('.aa_cell_element');
				for(var i=0;i<elems.length;i++) {
					if (elems[i].Field && !elems[i].Field.CascadingMenuPopup) {
						elems[i].onmouseover = function() {
							containingPopup.closeInnerPopups();			
						};
					}
				}

			}
			return containingPopup;
		}
		function openPopup(containingPopup,launchingElement,field_data) {
			containingPopup.closeInnerPopups();

			var features = ajaxart.runsubprofiles(data,profile,'PopupFeature',context);

			var popup = new ajaxart.classes.Popup({
				title: '',
				data: data, context: context, profile: profile,
				launchingElement: launchingElement,
				base_features: features
			});
			aa_bind(popup,'close',function() {
				if (!popup.closedByParent) containingPopup.close();
				$(launchingElement).removeClass('cascadingPopupOpen');
			});

			containingPopup.innerPopups = [popup];
			launchingElement.jbPopup = popup;
			$(launchingElement).addClass('cascadingPopupOpen');

			aa_renderStyleObject(field.ToolBarPopupStyle,popup,context,true,{
				jsFunctionName: 'show'
			});
		}

		function hasPopupOfToolbar(contentElement) {
			var openPopups = aa_open_popups();
			for(var i=openPopups.length-1;i>=0;i--) {
				if (openPopups[i].toolbarID == field.PopupToolbarID && openPopups[i] != contentElement.jbPopup) {
					return true;
				}
			}
			return false;
		}
	}
});

aa_gcs("popup_confirmation",{
	OpenConfirmationPopup: function(profile,data,context) {
		var confirmationPopup = {
			title: aa_text(data,profile,'Title',context),
			question: aa_text(data,profile,'Question',context),
			labelForYes: aa_text(data,profile,'LabelForYes',context),
			labelForNo: aa_text(data,profile,'LabelForNo',context),
			launchingElement: aa_var_first(context,'ControlElement'),
			features: ajaxart.runsubprofiles(data,profile,'Feature',context),
			action: function() {
				return ajaxart.run(data,profile,'Action',context);
			}
		};

		var style = aa_first(data,profile,'Style',context);

		aa_renderStyleObject(style,confirmationPopup,context,true,{
			jsFunctionName: 'show'
		});
	}
});

function aa_init_class_Popup() {	
	if (ajaxart.classes.Popup) return;

	ajaxart.classes.Popup = function(settings) {	
		aa_extend(this,settings);
		this.intest = window.aa_intest;
		this.timeOpened = new Date();
		this.base_features = this.base_features || [];
	};
	
	ajaxart.classes.Popup.prototype.appendContents = function(contentsTop) {
		if (!contentsTop) return;
		var ctx2 = aa_ctx(this.context,{ PopupLaunchingElement: [this.launchingElement]});
		this.field = aa_first(this.data,this.profile,'Contents',ctx2);
		if (this.field)
			aa_fieldControl({ Field: this.field, Item: this.data, Wrapper: contentsTop, Context: ctx2 });
	};

	ajaxart.classes.Popup.prototype.RefreshPreview = function(contentsTop) {
		this.close();
		ajaxart.gcs.popup.OpenPopup(this.profile,this.data,this.context);
	};
}

function aa_createLightPopup(settings) {
	aa_init_class('LightPopup',{
		_ctor: function() {
			this.intest = window.aa_intest;
			this.timeOpened = new Date();
			this.base_features = this.features || [];
			this.$el = $(this.el);
			if (this.el.parentNode) this.el.parentNode.removeChild(this.el);
			this.$el.css('visibility','none');
			if (this.apiObject.elem_class)
				this.$el.addClass(this.apiObject.elem_class+'_popup');
		},
		appendContents: function() {},
		show: function() {
			this.zindex = null;
			aa_popup(this,this.popupSettings);
		}
	});
	return new ajaxart.classes.LightPopup(settings);
}

function aa_popupDefaultSettings(popup,more) {
	return aa_extend({
		frameElement: popup.$el.find('.aa_popup_frame'),
		titleElement: popup.$el.find('.aa_popup_title'),
		contentsElement: popup.$el.find('.aa_popup_contents'),
		closeElement: popup.$el.find('.aa_popup_close'),
		defaultLocation: aa_popupCenterLocation()
	},more);	
}

function aa_popup(popup,settings) {
	settings = aa_popupDefaultSettings(popup,settings || {});
	if (popup.intest) popup.$el.css('display','block');
	popup.frameElement = $(settings.frameElement)[0] || popup.el;
	$(popup.frameElement).addClass('aa_popup').addClass(ajaxart.deviceCssClass);

	if (settings.features) 
		popup.features = [].concat(popup.base_features,settings.features);
	else
		popup.features = popup.base_features;

	popup.contentsEl = $(settings.contentsElement)[0];

	for(var i=0;i<popup.features.length;i++) {
		try {
			popup.features[i].init(popup);
		} catch(e) {
			if (window.ajaxart) ajaxart.logException('error initialing popup feature',e);
		}
	}

	if (popup.PreventOpen && popup.PreventOpen()) return;

	// add it to body
	var popupsTop = $('body').children('.jbart_popups');
	if (!popupsTop.length)
		popupsTop = $('<div class="jbart_popups" />').appendTo( $('body') );

	// notify previous popups (some of them might close themselves)
	var openPopups = popupsTop.children();
	for(i=0;i<openPopups.length;i++) {
		var prevPopup = openPopups[i];
		if (prevPopup.jbPopup != popup)
			aa_trigger(prevPopup.jbPopup,'anotherPopupOpened',{ popup: popup });
	}

	popup.el.jbPopup = popup.frameElement.jbPopup = popup;

	$(settings.titleElement).text(popup.title);
	if (popup.contentsEl)
		popup.appendContents(popup.contentsEl);

	popup.close = function(closeType) {
		popup.preventClose = false;
		var closeArgs = { closeType: closeType};
		aa_trigger(popup,'beforeClose',closeArgs);		
		if (closeArgs.preventClose) return false; // allow beforeClose to prevent the closing of the popup
		
		aa_remove(this.el,!settings.reusablePopup);

		if (popup.launchingElement) {
			popup.launchingElement.jbPopup = null;
			$(popup.launchingElement).removeClass('aa_opened_popup');
		}
		aa_trigger(popup,'close',{ closeType: closeType });

		this.closeInnerPopups();
		return true;
	};
	popup.dispose = function() {		
		aa_remove(this.el,true);
	};

	popup.closeInnerPopups = function() {
		if (this.innerPopups) {
			for(var i=0;i<this.innerPopups.length;i++) {
				this.innerPopups[i].closedByParent = true;
				this.innerPopups[i].close();
				this.innerPopups[i].closedByParent = false;
			}
	  }
	};
	popup.isOpen = function() {
		return ajaxart.isattached(this.el);
	}

	var $close = $(settings.closeElement);
	$close.click(function() {
		popup.close(false);
	});

	doOpen();
	if (popup.reusablePopup) {
		aa_addOnDetach(popup.launchingElement,function() {
			popup.dispose();
		});
	}

	function doOpen() {
		popupsTop[0].appendChild(popup.el);

		if (settings.closeWhenClickingOutside) closeWhenClickingOutside();	
		aa_popup_setMaxZIndex(popup);

		positionPopup();
		markLaunchingElement();
		addValidationChecks();
		aa_element_attached(popup.el);
	}

	function addValidationChecks() {
		aa_bind(popup,'beforeClose',function(args) {
			if (args.closeType == 'OK') {
				var passed = aa_checkValidations(popup.frameElement);
				if (!passed) args.preventClose = true;
			}
		});
	}
	function markLaunchingElement() {
		if (popup.launchingElement) {
			popup.launchingElement.jbPopup = popup;
			$(popup.launchingElement).addClass('aa_opened_popup');
		}		
	}
	function positionPopup() {
		try {
			popup.location = popup.location || settings.defaultLocation || aa_popupCenterLocation();
			popup.location.setPopupLocation(popup);
			aa_trigger(popup,'show');
		} catch(e) {
			ajaxart.logException('error positioning popup',e);
		}	
	}

	function closeWhenClickingOutside() {
		popup.origMousedown = (window.captureEvents) ? window.onmousedown : document.onmousedown;
		var ignoreLaunchingElement = (settings.closeWhenClickingOutside == 'except launching element') && (popup.launchingElement);
		
		function isDescendant(child,parent) {
			if (!child) return false;
			if (child == parent) return true;
			return isDescendant(child.parentNode,parent);  
		}
		function captureClick(e) {
		    var $elem = $( (typeof(event)== 'undefined')? e.target : event.srcElement );

		    if ($elem.parents('html').length === 0 && $elem[0].tagName.toLowerCase() != 'html') return; // detached
		    if (isDescendant($elem[0],popup.el)) return;  // inside the popup
		    ignoreLaunchingElement = ignoreLaunchingElement || popup.ignoreCloseOnLaunchingElementClick;
		    if (ignoreLaunchingElement && isDescendant($elem[0],popup.launchingElement)) return; // from the launching element
				
				var clickedPopup = $elem.closest('.aa_popup')[0];
				if (clickedPopup && isDescendant(clickedPopup.jbPopup.launchingElement,popup.el)) return;  // clicked from an inner popup opened by us

				if (popup.innerPopups) {
					for(var i=0;i<popup.innerPopups.length;i++) {
						if ( isDescendant($elem[0],popup.innerPopups[0].frameElement) )
							return;
					}
			  }

		    popup.close('cancel');
	    }		
		
		aa_bindBodyMouseDown(captureClick);
		
		aa_bind(popup,'close',function() {
			aa_unbindBodyMouseDown(captureClick);
		},'clicking outside');
	}
}

function aa_open_popups() {
	var out = [];
	var openPopups = $('body').children('.jbart_popups').children();
	for(var i=0;i<openPopups.length;i++) {
		out.push(openPopups[i].jbPopup);
	}
	return out;
}

function aa_bindBodyMouseDown(callback) {
	var obj = window.captureEvents ? window : document;
	if (obj.addEventListener) 
		obj.addEventListener('mousedown',callback,true);
	else 
		obj.attachEvent('onmousedown',callback,true);
}
function aa_unbindBodyMouseDown(callback) {
	var obj = window.captureEvents ? window : document;
	if (obj.removeEventListener) 
		obj.removeEventListener('mousedown',callback,true);
	else 
		obj.detachEvent('onmousedown',callback);
}

function aa_popup_setMaxZIndex(popup) {
	var max = 20;

	if (!popup.zindex) {
		if (popup.launchingElement && $(popup.launchingElement).closest('.jbstudio_dlg').length > 0 || popup.jbStudio) {
			max = 2000;
			// we should also be jbstudio_dlg
			var otherStudioPopups = $('.jbstudio_dlg');
			for(var i=0;i<otherStudioPopups.length;i++) {
				if (otherStudioPopups[i].jbPopup == popup) continue;
				var zindex = parseInt($(otherStudioPopups[i])[0].style.zIndex || '0') || 0;
				if (!isInnerOldPopup(otherStudioPopups[i]))
					max = Math.max(max,zindex+2);
			}
			$(popup.el).addClass('jbstudio_dlg');
		} else {
			var openPopups = aa_open_popups();
			for(var i=0;i<openPopups.length;i++) {
				if (openPopups[i] != popup && !openPopups[i].jbStudio)
					max = Math.max(max,openPopups[i].zindex+2);
			}
			if (ajaxart.jbart_studio) {
				// make it the heightest z-index if ctrl+click
				$(popup.frameElement).click(function (e) {
					if (e.ctrlKey) {
						popup.jbStudio = true;
						popup.zindex = null;
						aa_popup_setMaxZIndex(popup);
					}
				});
			}
		}

		popup.zindex = max+1;
	} else {
		max = popup.zindex-1;
	}
	popup.$el.css('z-index',max);
	popup.$el.children().css('z-index',max);
	$(popup.frameElement).css('z-index',max+1);	

	function isInnerOldPopup(otherElem) {
		if (otherElem.Dialog && otherElem.Dialog.Mode == 'popup' && otherElem.Dialog.onElem && aa_isParent(otherElem.Dialog.onElem,popup.frameElement))

			return true;

		return false;
	}
}

function aa_new_popup_feature(settings,className,prototypeFunctions) {
	aa_init_class(className,prototypeFunctions);
	return new ajaxart.classes[className](settings || {});
}
function aa_popup_title_dragAndDrop() {
	return aa_new_popup_feature({},'PopupFeatureTitleDragNDrop',{
		init: function(popup) {
			var draggable_area = popup.$el.find('.aa_popup_title')[0];
			var draggable_frame = popup.frameElement;
			aa_enable_move_by_dragging(draggable_frame,draggable_area,this.onstartdrag,function() {
				aa_trigger(popup,'endDrag');
			});
		},
		onstartdrag: function() {},
		onenddrag: function() {}
	});
}

function aa_popup_feature_autoFocus() {
	return aa_new_popup_feature({},'PopupFeatureAutoFocus',{
		init: function(popup) {
			aa_bind(popup,'show',function() {
				setTimeout(function() {					
					var inp = $(popup.frameElement).find('input');
					if (!inp[0]) inp = $(popup.frameElement).find('textarea');
					if (inp[0]) inp[0].focus();
				},1);
			});
		}
	});
}

function aa_popup_feature_zindex(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureZIndex',{
		init: function(popup) {
			popup.zindex = this.zindex
		}
	});
}
function aa_popup_feature_UniquePopup(settings) {
	return aa_new_popup_feature(settings,'UniquePopup',{
		init: function(popup) {
			popup.uniqueID = this.uniqueID;
			aa_bind(popup,'anotherPopupOpened',function(args) {
				var otherpopup = args.popup;
				if (otherpopup.uniqueID && otherpopup.uniqueID == popup.uniqueID) {
					popup.close();
				}
			});			
		}
	});
}
function aa_popup_feature_size(settings) {	
	return aa_new_popup_feature(settings,'PopupFeatureSize',{
		init: function(popup) {
			if (this.width) $(popup.contentsEl).width(this.width).css('overflow-x','auto');
			if (this.height) $(popup.contentsEl).height(this.height).css('overflow-y','auto');
		}
	});
}
function aa_popup_feature_floating_popup(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureFloatingPopup',{
		init: function(popup) {
			var feature = this;
			popup.floatingPopup = true;
			popup.identifier = this.identifier;
			popup.closeCondition = this.closeCondition;
			// close others with the same identifier
			aa_bind(popup,'anotherPopupOpened',function(args) {
				var otherpopup = args.popup;
				if (otherpopup.floatingPopup && otherpopup.identifier == popup.identifier)
					popup.close();
			});

			aa_bind(popup,'show',refreshFields);
			aa_bind(popup,'close',refreshFields);

			if (feature.autoBringToFront) {
				$(popup.frameElement).mousedown(function() {
					var startZindex = popup.zindex;
					popup.zindex = null;
					aa_popup_setMaxZIndex(popup);
					if (popup.zindex < startZindex) {
						popup.zindex = startZindex;
						popup.$el.css('z-index',startZindex);
						$(popup.frameElement).css('z-index',startZindex+1);
					}
					$('.jbFloatingPopupActive').removeClass('jbFloatingPopupActive');
					$(popup.frameElement).addClass('jbFloatingPopupActive');
				});
			}

			if (feature.rememberLocations) {
				aa_bind(popup,'show',function() {
					sessionStorage['jbFloatingPopupIsOpen_'+popup.identifier] = 'true';
					if (feature.autoBringToFront) {
						$('.jbFloatingPopupActive').removeClass('jbFloatingPopupActive');
						$(popup.frameElement).addClass('jbFloatingPopupActive');
					}
				});

				aa_bind(popup,'endDrag',function() {
					var left = $(popup.frameElement).css('left').split('px')[0];
					var top = $(popup.frameElement).css('top').split('px')[0];

					sessionStorage['jbFloatingPopupLeft_'+popup.identifier] = left;
					sessionStorage['jbFloatingPopupTop_'+popup.identifier] = top;
				});

				aa_bind(popup,'beforeClose',function() {
					sessionStorage['jbFloatingPopupIsOpen_'+popup.identifier] = 'false';
				});
			}
			if (this.location) popup.location = this.location;
			popup.previousLocation = popup.location;
			popup.location = {
				setPopupLocation: function(popup) {
					var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
					var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
					var usePrevLocation;

					var top = 20,left=0;
					if (feature.rememberLocations && sessionStorage['jbFloatingPopupLeft_'+popup.identifier]) {
						left = sessionStorage['jbFloatingPopupLeft_'+popup.identifier];
						top = sessionStorage['jbFloatingPopupTop_'+popup.identifier];
						left = Math.min(Math.max(0,left),screenWidth-50);
						top = Math.min(Math.max(0,top),screenHeight-50);
					} else {
						if (popup.previousLocation) {
						 popup.previousLocation.setPopupLocation(popup);
						 usePrevLocation = true;
						} else {
							// auto location
							$(popup.frameElement).css('display','inline-block'); // so that width() will work

							var popupWidth = $(popup.frameElement).outerWidth();
							left = screenWidth - popupWidth - 30;

							var openPopups = aa_open_popups();
							for(var i=0;i<openPopups.length;i++) {
								if (openPopups[i].floatingPopup) {
									top += 30;
									left -= 30;
								}
							}							
						}
					}
					var maxWidth = $(popup.frameElement).css('max-width');
					if (!maxWidth || maxWidth == 'none')
						$(popup.frameElement).css('max-width',parseInt(screenWidth * 0.9)+'px');
					
					var $popupContents = $(popup.frameElement).find('.aa_popup_contents');
					var maxHeight = $popupContents.css('max-height');
					if (!maxHeight || maxHeight == 'none')
						$popupContents.css('max-height',parseInt(screenHeight * 0.9)+'px');
					
					if (!usePrevLocation)
						$(popup.frameElement).css('position','fixed').css('left',left+'px').css('top',top+'px');						
				}
			};

			aa_bind(popup,'beforeResizer',function() {
				if (window.sessionStorage && sessionStorage['jbUniquePopupWidth_'+popup.identifier]) {
					$(popup.contentsEl).width(sessionStorage['jbUniquePopupWidth_'+popup.identifier]);
					$(popup.contentsEl).height(sessionStorage['jbUniquePopupHeight_'+popup.identifier]);				
				}
			});

			aa_bind(popup,'resize',function(args) {
				if (window.sessionStorage) {
					sessionStorage['jbUniquePopupWidth_'+popup.identifier] = args.width + 'px';
					sessionStorage['jbUniquePopupHeight_'+popup.identifier] = args.height + 'px';
				}
			});

			function refreshFields() {
				var fields = aa_split(feature.fieldsToRefresh,',',true);
				aa_refresh_field(fields,'screen',false,null,popup.context);
			}
		}
	});
}
function aa_popup_feature_toolbar_popup(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureToolbar',{
		init: function(popup) {
			popup.toolbarID = this.toolbarID;
		}
	});
}
function aa_closePopupsInTest() {
	var openPopups = aa_open_popups();
	for(var i=openPopups.length-1;i>=0;i--) {
		if (openPopups[i].intest) {
			aa_remove(openPopups[i].el,true);
		}
	}
}

function aa_popupElementForTests() {
	var openPopups = aa_open_popups();
	for(var i=openPopups.length-1;i>=0;i--) {
		if (openPopups[i].intest) {
			return [openPopups[i].el];
		}
	}
	return null;
}
function aa_popupsForPreview() {
	var out = [];
	var openPopups = aa_open_popups();
	for(var i=openPopups.length-1;i>=0;i--) {
		if (openPopups[i].RefreshPreview) {
			out.push(openPopups[i]);
		}
	}
	return out;
}

function aa_popup_closeOnEnter() {
	return aa_new_popup_feature({},'PopupFeatureCloseOnEnter',{
		init: function(popup) {
			$(popup.frameElement).attr('tabindex','0').keydown(function(e) {
				if(e.keyCode == 13) popup.close();
			});
		}
	});
}
function aa_popup_feature_closeOnBackButton() {
	return aa_new_popup_feature({},'PopupFeatureCloseOnBackButton',{
		init: function(popup) {
			aa_bind(popup,'show',function() {
				jBart.popupToClose = popup;
				aa_setUrlHashValue('openDialog','true');
			});
			aa_bind(popup,'close',function() {
				jBart.popupToClose = null;
				aa_setUrlHashValue('openDialog','');
			});

			if (!jBart.hashValueChangedClosePopup) {
				jBart.hashValueChangedClosePopup = function() {
					if (aa_urlHashValue('openDialog') != 'true' && jBart.popupToClose) {
						jBart.popupToClose.close();
					}
				};
				$(window).bind('hashchange',jBart.hashValueChangedClosePopup);
			}
		}
	});
}
function aa_popup_feature_closeOnEsc(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureCloseOnEsc',{
		init: function(popup) {
			$(popup.frameElement).attr('tabindex','0').keydown(function(e) {
				if(e.keyCode == 27) popup.close();
			});
		}
	});
}

function aa_popup_feature_hoverPopup(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureHoverPopup',{
		init: function(popup) {
			var isInside,hasFocus;
			popup.isHoverPopup = true;

			aa_bind(popup,'anotherPopupOpened',function(otherPopup) {
				if (otherPopup.isHoverPopup) popup.close();
			});

			$(popup.launchingElement).mouseout(mouseOut);
			$(popup.frameElement).mouseout(mouseOut);
			$(popup.launchingElement).mouseover(mouseOver);
			$(popup.frameElement).mouseover(mouseOver);
			$(popup.frameElement).focus(function() {
				hasFocus = true;
			});
			$(popup.frameElement).blur(function() {
				hasFocus = false;
			});

			function mouseOut() {
				isInside = false;
				if (!hasFocus) startClosingPopup();				
			}
			function mouseOver() {
				isInside = true;
			}
			function startClosingPopup() {
				setTimeout(function() { 
					if (ajaxart.isattached(popup.frameElement) && !isInside) { popup.close(); }
				},200);
			}
		}
	});
}


function aa_isStudioRefreshAndPopupIsOpen(type,apiObject) {
	if (ajaxart.inStudioRefresh) {
		var field = apiObject && (apiObject.Field || apiObject.field);
		var openPopups = aa_open_popups();
		for(var i=openPopups.length-1;i>=0;i--) {
			var popup = openPopups[i];
			var popupField = popup.apiObject && (popup.apiObject.Field || popup.apiObject.field);
			if (popup.type == type && popupField && field && field.Id == popupField.Id) {
				popup.close();
				return true;			
			}
		}
	}
	return false;
}

function aa_close_containing_popup(elem,doOnExitCallback,exitMode) {
	exitMode = exitMode || null;
	doOnExitCallback = doOnExitCallback || function() {};

	var top = elem && $(elem).closest('.aa_popup')[0];
	if (top && top.jbPopup) {
		var closeReturn = top.jbPopup.close(exitMode);
		if (closeReturn) { // closed properly without failing validations
			doOnExitCallback();			
		}
	}
}

function aa_confirmation_popup(confirmationPopup,settings) {
	settings = aa_defaults(settings,{
		yesButtonElement: confirmationPopup.$el.firstOfClass('aa_popup_yes'),
		noButtonElement: confirmationPopup.$el.firstOfClass('aa_popup_no'),
		questionElement: confirmationPopup.$el.firstOfClass('aa_popup_question'),
		location: aa_popupCenterLocation(),
		features: []
	});

	$(settings.questionElement).text(confirmationPopup.question);
	$(settings.yesButtonElement).text(confirmationPopup.labelForYes);
	$(settings.noButtonElement).text(confirmationPopup.labelForNo);

	var features = (confirmationPopup.features || []).concat(settings.features);

	var popup = aa_createLightPopup({
		el: confirmationPopup.el,
		launchingElement: confirmationPopup.launchingElement,
		location: settings.location,
		apiObject: confirmationPopup,
		type: 'confirmation',
		features: features,
		title: confirmationPopup.title,
		popupSettings: {
			closeWhenClickingOutside: settings.closeWhenClickingOutside
		}
	});

	$(settings.yesButtonElement).click(function() {
		popup.close();
		confirmationPopup.action();
	});

	$(settings.noButtonElement).click(function() {
		popup.close();
	});

	popup.show();
}

function aa_hasPositionFixedParent(elem) {
	for(var iter=elem;iter && iter.nodeType ==1;iter=iter.parentNode) {
		if ($(iter).css('position') == 'fixed') return true;
	}
	return false;
}

function aa_windowHeight() {
	var height = $(window).height();
	if (jBart.footerHeight) height -= jBart.footerHeight;
	return height;
}

function aa_popup_strategy_onhover(popupAdapterObject,settings) {
	settings = aa_defaults(settings,{ delay: 1000 });
	var isInside,timerID = false;

	popupAdapterObject.$wrapper.mouseover(function() {
		if (isInside || !ajaxart.isattached(popupAdapterObject.$wrapper[0])) return;
		if (timerID) clearTimeout(timerID);
		timerID = setTimeout(function() {
			if (isInside && ajaxart.isattached(popupAdapterObject.$wrapper[0])) popupAdapterObject.openPopup();
			timerID = null;
		},settings.delay);
		isInside = true;
	});
	popupAdapterObject.$wrapper.mouseout(function() { 
		isInside = false;
	});
	if (settings.alsoOpenOnClick) {
		popupAdapterObject.$wrapper.click(function() {
			if (timerID) { clearTimeout(timerID); timerID=null; }
			popupAdapterObject.openPopup();
		});
	}

	aa_addOnDetach(popupAdapterObject.$wrapper[0],function() {
		popupAdapterObject.closePopup();
	});
}

aa_gcs("popup_feature",{
	RunOnClose: function(profile,data,context) {
		var closeTypeFilter = aa_text(data,profile,'CloseType',context);
		return [{
			init: function(popup) {
				aa_bind(popup,'close',function(closeType) {
					if (closeTypeFilter && closeType != closeTypeFilter) return;
					ajaxart.run(data,profile,'Action',context);
				});				
			}			
		}];
	}
});

//******************* popup resizer ************************/

aa_gcs("popup_feature",{
	Variable: function(profile,data,context) {
		return [{
			init: function(popup) {
				popup.context.vars[aa_text(data,profile,'VarName',context)] = aa_run(data,profile,'Value',context);
			}
		}];
	},
	PopupData: function(profile,data,context) {
		return [{
			init: function(popup) {
				popup.data = aa_run(data,profile,'Value',context);
			}
		}];
	},
	Resizer: function(profile,data,context) {
		return [{
			init: function(popup) {
				var style = aa_first(data,profile,'Style',context);
				var resizerObj = {
					popup: popup
				};
				aa_renderStyleObject2(style,resizerObj,data,null,context,{ funcName: 'add' });
			}
		}];
	}
});

function aa_popup_resizer(resizerObj,settings) {
	var popup = resizerObj.popup;
	aa_bind(popup,'show',function() {		
		var resizeCover = $('<div id="aa_resize_cover" style="height:100%; width: 100%; background:pink;z-index:10000; opacity:0; filter: alpha(opacity=0);position:fixed;top:0;left:0;top:0;bottom:0"/>');
		var contentsEl = popup.contentsEl;
		contentsEl.parentNode.appendChild(resizerObj.el);
		var props = null;
		if (resizerObj.minWidth) $(contentsEl).css('min-width',resizerObj.minWidth+'px');
		if (resizerObj.minHeight) $(contentsEl).css('min-height',resizerObj.minHeight+'px');

		aa_trigger(popup,'beforeResizer');

		resizerObj.$el.css('z-index',popup.zIndex+1);

		resizerObj.$el.mousedown(function(e) {
			if (! props) {
				var width = $(contentsEl).width();
				var height = $(contentsEl).height();
				props = { mouse_x: (e.clientX || e.pageX), mouse_y: (e.clientY || e.pageY), width: width, height: height };
				jBart.disableSelections();

				$('body').append(resizeCover);
			}
			var mouse_move = function(e) {
				  e = e || event;
				  var mouse_x = (e.clientX || e.pageX), mouse_y = (e.clientY || e.pageY);
				  var newWidth = props.width + (mouse_x - props.mouse_x);
				  var newHeight = props.height + (mouse_y - props.mouse_y);
				  $(contentsEl).width(newWidth).height(newHeight);				  
				  aa_trigger(popup,'resize',{ width: newWidth, height: newHeight });
		  };
			var mouse_up = function(e) {
				  e = e || event;
				  props = null;
				  window.onmousemove = null; window.onmouseup =null;  document.onmouseup=null; document.onmousemove=null; 
					jBart.restoreSelections();
					$('#aa_resize_cover').remove();
			  }
			  if (window.captureEvents){ window.onmousemove = mouse_move;window.onmouseup = mouse_up; }
			  else { document.onmouseup=mouse_up; document.onmousemove=mouse_move; }
	    });
	},'resizer');	
}

/******************************** features *******************************************************/

aa_gcs("popup_feature",{
	TogglePopup: function(profile,data,context) {
		var identifier =  aa_text(data,profile,'PopupIdentifier',context);

		return [{
			init: function(popup) {
				popup.identifier = identifier;
				popup.ignoreCloseOnLaunchingElementClick = true;
				popup.PreventOpen = function() {
					var openPopups = aa_open_popups();
					for(var i=openPopups.length-1;i>=0;i--) {
						if (openPopups[i].identifier == identifier) {
							openPopups[i].close();
							return true;
						}
					}
				};
			}
		}];
	}
});


function aa_popup_feature_closeButton(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureCloseButton',{
		init: function(popup) {
			var $btn = $(popup.frameElement).find('.aa_popup_close_button');
			$btn.text(settings.text);
			$(popup.frameElement).find('.aa_popup_close').click(function() {
				popup.close();
			});
		}		
	});	
}

function aa_popup_feature_autoClose(settings) {
	return aa_new_popup_feature(settings,'AutoClose',{
		init: function(popup) {
			if (window.jbDoNotAutoClosePopups) return; // for debugging
			setTimeout(function(){
				$(popup.frameElement).fadeOut("slow",function() {
					popup.close();	
				});				
			},this.closeTimeout || 1000);
		}		
	});	
}


/************************ locations *************************/

aa_gcs("popup",{
	PopupLocation: function (profile, data, context) {
		return [{
			init: function(popup) {
				popup.location = aa_first(data,profile,'Location',context);
			}
		}];
	},
	ScreenCenter: function (profile, data, context) {
		return [aa_popupCenterLocation()];
	},
	ScreenTopRight: function (profile, data, context) {
		return [aa_popupScreenTopRightLocation({
			marginTop: aa_int(data,profile,'MarginTop',context),
			marginRight: aa_int(data,profile,'MarginRight',context)
		})];
	},
	NearLauncher: function (profile, data, context) {
		return [aa_popupNearLauncherLocation({
			minWidthOfLaunchingElement: aa_bool(data,profile,'MinWidthAsLaunchingElement',context),
			location: aa_text(data,profile,'Location',context)
		})];
	}	
});


function aa_popupCenterLocation(settings) {
	jBart.footerHeight = jBart.footerHeight || 0;
	return aa_new_popup_feature(settings,'PopupCenterLocation',{
		setPopupLocation: function(popup) {
			var hasHeaderHeight = jBart.headerHeight && !popup.$el.hasClass('jbstudio_dlg');
			var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
			var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
			if (hasHeaderHeight) screenHeight -= (jBart.headerHeight+jBart.footerHeight);

			$(popup.frameElement).css('display','inline-block'); // so that width() will work
			
			var popupWidth = $(popup.frameElement).outerWidth();
			var popupHeight = $(popup.frameElement).outerHeight();

			$(popup.frameElement).css('max-width',parseInt(screenWidth * 0.9)+'px');

			if (popupWidth > screenWidth) {
				// can be relevant in mobile scenarios
				popupWidth = parseInt(screenWidth * 0.85);
				$(popup.frameElement).css('max-width',popupWidth+'px');
			}
			var $popupContents = $(popup.frameElement).find('.aa_popup_contents');
			// var maxHeight = $popupContents.css('max-height');
			// if (!maxHeight || maxHeight == 'none')
			// 	$popupContents.css('max-height',parseInt(screenHeight * 0.8)+'px');

			var left = parseInt( (screenWidth - popupWidth)/2 );
			var top = parseInt( (screenHeight - popupHeight)/2 );
			if (top<0) top = 0;
			if (left<0) left = 0;
			if (hasHeaderHeight) top += jBart.headerHeight;

			$(popup.frameElement).css('position','fixed').css('left',left+'px').css('top',top+'px');
		}
	});
}

function aa_popupScreenTopRightLocation(settings) {
	return aa_new_popup_feature(settings,'PopupScreenTopRightLocation',{
		setPopupLocation: function(popup) {
			var hasHeaderHeight = jBart.headerHeight && !popup.$el.hasClass('jbstudio_dlg');
			var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);

			$(popup.frameElement).css('display','inline-block'); // so that width() will work
			
			var popupWidth = $(popup.frameElement).outerWidth();

			var left = screenWidth - popupWidth - this.marginRight;
			var top = this.marginTop;
			if (hasHeaderHeight) top += jBart.headerHeight;

			$(popup.frameElement).css('position','fixed').css('left',left+'px').css('top',top+'px');
		}
	});
}

function aa_popupStackingNotificationLocation(settings) {
	settings = aa_defaults(settings,{
		marginBottom: 0,
		marginLeft: 0,
		marginTop: 0
	});
	return aa_new_popup_feature(settings,'StackingNotificationLocation',{
		setPopupLocation: function(popup) {
			popup.isStackingNotificationLocation = true;
			this.marginBottom = this.marginBottom || 0;
			this.marginRight = this.marginRight || 0;

			$(popup.frameElement).css('display','inline-block'); // so that width() will work
			
			var popupHeight = $(popup.frameElement).outerHeight();

			var bottom = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);

			var openPopups = aa_open_popups();
			for(var i=0;i<openPopups.length;i++) {
				if (openPopups[i].isStackingNotificationLocation && openPopups[i] != popup)
					$(openPopups[i].frameElement).animate({top: '-='+ (popupHeight+this.marginBottom) },'slow');
			}

			var right = this.marginRight;
			var top = bottom - popupHeight - this.marginBottom;
			popup.stackingTop = top;

			$(popup.frameElement).css('position','fixed').css('right',right+'px').css('top',top+popupHeight+'px');
			$(popup.frameElement).animate({top: '-='+ popupHeight },'slow');
		}
	});
}

function aa_popupNearLauncherLocation(settings) {
	settings = aa_defaults(settings,{ 
		location: 'bottom',
		marginFromWindowTop: 10,
		marginFromWindowBottom: 10,
		marginFromWindowRight: 10,
		marginFromWindowLeft: 10
	});

	return aa_new_popup_feature(settings,'PopupNearLauncherLocation',{
		setPopupLocation: function(popup) {
			var feature = this;
			//  See Sample: http://localhost/ajaxart/gstudio.html?widget=features/PopupLauncherLocations
			var position = 'absolute';
			if (aa_hasPositionFixedParent(popup.launchingElement)) position = 'fixed';

			$(popup.frameElement).css('position',position);
			if (!popup.launchingElement) return;

			var top = aa_absTop(popup.launchingElement);
			var left = aa_absLeft(popup.launchingElement);
			var width = $(popup.launchingElement).outerWidth();
			var height = $(popup.frameElement).outerHeight();
			var popupTop = top + $(popup.launchingElement).outerHeight();
			var popupLeft = left;
			var windowHeight = aa_windowHeight();
			var windowWidth = $(window).width();
			var windowTop = (position == 'fixed' ? 0 : window.pageYOffset);
			var windowLeft = (position == 'fixed' ? 0 : window.pageXOffset);
			// if (ajaxart.jbart_studio) {
			// 	var studio_header_pos = $(".fld_gstudio_widget_wrapper").children().position();
			// 	windowTop += studio_header_pos.top;
			// 	windowHeight -= studio_header_pos.top;
			// 	windowLeft += studio_header_pos.left
			// 	windowWidth -= studio_header_pos.left;
			// }

			// Vertical Positioning
			if (popupTop+height-windowTop + this.marginFromWindowBottom > windowHeight) // going up instead of down (no room enough down)
				popupTop = top - height;

			if (popupTop < windowTop + this.marginFromWindowTop)
				popupTop = top - $(popup.launchingElement).outerHeight()/2 -height/2; // try centering it

			if (popupTop+height+this.marginFromWindowBottom > windowHeight + windowTop ||	// overflowing to bottom
					 popupTop < windowTop + this.marginFromWindowTop)						// overflowing to top
				popupTop = windowTop + this.marginFromWindowTop;	// Overflowing to top or to bottom, try adjusting it to top

			if (popupTop+height+this.marginFromWindowBottom > windowHeight + windowTop)	// too high: make the popup shorter
				$(popup.frameElement).css("max-height",windowHeight - this.marginFromWindowTop - this.marginFromWindowBottom).css("overflow-y","auto");

			if (this.minWidthOfLaunchingElement)
				$(popup.frameElement).css('min-width',width+'px');

			// Horizontal Positioning
			var popupWidth = $(popup.frameElement).outerWidth();
			if (popupLeft + popupWidth + this.marginFromWindowRight > windowLeft + windowWidth)	// try going left instead of right
				popupLeft -= popupWidth - $(popup.launchingElement).outerWidth();
			if (popupLeft < windowLeft + this.marginFromWindowRight)	// too left, align to window left
				popupLeft = windowLeft + this.marginFromWindowRight;
			if (popupLeft + popupWidth + this.marginFromWindowRight > windowLeft + windowWidth)	// too wide, make the popup narrower
				$(popup.frameElement).css("max-width",windowWidth - this.marginFromWindowRight - this.marginFromWindowLeft).css("overflow-x","auto");

			if (feature.location == 'right') {	// TODO: handle going too right or too low
				popupTop = top;
				popupLeft = left + width + 2;				
			}
			if (feature.location == 'above center') {	
				popupTop = top - height;
				popupLeft = parseInt(left + (width/2) - (popupWidth/2));
				if (settings.topMargin) popupTop -= settings.topMargin;
			}

			$(popup.frameElement).css('top',popupTop+'px').css('left',popupLeft+'px').css("box-sizing","border-box");

		}
	});
};


/******************************  async popup ***************************************/

aa_gcs("popup_async", {
	OpenPopupAsync: function (profile, data, context) {
		var deferred = $.Deferred();

		var style = aa_first(data,profile,'Style',context);

		aa_init_class_Popup();
		var base_features = ajaxart.runsubprofiles(data,profile,'Feature',context);
		base_features.push(aa_popup_feature_asyncPopupResult({
			deferred: deferred
		}));

		var popup = new ajaxart.classes.Popup({
			title: aa_text(data,profile,'PopupTitle',context),
			data: data, context: context, profile: profile,
			launchingElement: aa_var_first(context,'ControlElement'),
			base_features: base_features
		});

		aa_renderStyleObject(style,popup,context,true,{	jsFunctionName: 'show' });

		return [deferred.promise()];
	}
});

function aa_popup_feature_asyncPopupResult(settings) {
	return aa_new_popup_feature(settings,'PopupFeatureAsyncPopupResult',{
		init: function(popup) {
			var feature = this;
			aa_bind(popup,'close',function(args) {
				if (args.closeType == 'OK')
					feature.deferred.resolve();
				else
					feature.deferred.reject();
			});				
		}
	});
}


aa_gcs("text", {
  FirstSucceeding: function (profile,data,context)
  {
    var itemProfiles = ajaxart.subprofiles(profile,'Item');

    for(var i=0;i<itemProfiles.length;i++)
    {
    	var subresult = ajaxart.run(data,itemProfiles[i],"",context);
   		for(var j=0;j<subresult.length;j++)
   		{
   			if (ajaxart.totext_item(subresult[j]).length > 0)
   				return subresult;
    	}
    }
  	return [];  	
  },
  NormalizeNewLines: function(profile,data,context) {
	  var result = aa_text(data,profile,'Text',context).replace(/\r\n/g,'\n'); 
	  return [result];
  },
  Extract: function (profile,data,context)
  {
	  var startMarkers = ajaxart.runsubprofiles(data,profile,'StartMarker',context);
	  if (startMarkers.length == 0) // backward compatible
		  startMarkers = ajaxart.run(data,profile,'StartMarker',context);
	  var endMarker = aa_text(data,profile,'EndMarker',context);
	  var includingStartMarker = aa_bool(data,profile,'IncludingStartMarker',context);
	  var includingEndMarker = aa_bool(data,profile,'IncludingEndMarker',context);
	  var onlyFirst = aa_bool(data,profile,'OnlyFirstResult',context);
	  var trim = aa_bool(data,profile,'Trim',context);
	  var str = aa_text(data,profile,'From',context);;
	  if (startMarkers.length == 0) return data;

	  var index = 0, out = [], prev_index=-1;
	  var string_start =0;
	  var position = function(str, marker, startpos) { return { pos: str.indexOf(marker,startpos), length: marker.length } } 
	  if (aa_bool(data,profile,'Regex',context)) 
		  position = function(str, marker, startpos) {
	  		var len = 0;
	    	var pos = -1;
	  		try {
		  		startpos = startpos || 0;
		  		var str = str.substring(startpos);
		  		var marker_regex = new RegExp(marker,'m');
		    	pos = str.search(marker_regex);
		    	if (pos > -1) { // get the length of the regex
		    		pos = (pos >= 0) ? pos + startpos : pos;
		    		var match = str.match(marker_regex)[0];
		    		len = match ? match.length : 0;
		    	}
	  		} catch(e) {} // probably regex exception
		    return { pos: pos , length: len };
	  	  	}
	  while (1) {
	  	  if (prev_index == index) break;	// prevent infinitive loop
	  	  prev_index = index;
		  var cut_previous_index;
		  for(var i=0; i<startMarkers.length; i++)
		  {
			  var marker = startMarkers[i];
			  var markerPos = position(str,marker,index);
			  index = markerPos.pos;
			  if (i==0)
				  cut_previous_index = markerPos.pos - string_start;
			  if (markerPos.pos == -1) return out;
			  string_start = markerPos.pos;
			  if (!includingStartMarker)
				  string_start += markerPos.length;
			  index += markerPos.length;
		  }
		  if (out.length>0 && endMarker == ''){  // cutting previous item
			  out[out.length-1] = out[out.length-1].substring(0,cut_previous_index);
		  }
		  var endPos = position(str,endMarker,index);
		  var out_item;
		  if (endMarker == '')
			  out_item = str.substring(string_start);
		  else if (endPos.pos == -1)
			  return out;
		  else if (includingEndMarker)
			  out_item = str.substring(string_start,endPos.pos+endPos.length);
		  else
			  out_item = str.substring(string_start,endPos.pos);
		  if (trim)
			  out_item = aa_text_trim(out_item);
		  if (out_item)
			  out.push(out_item);
		  if (onlyFirst) 
			  return out;
		  if (endMarker != '') 
		  	index = endPos.pos+endPos.length;
	  }
	  return out;
  },
  MomentTimeFormat: function (profile,data,context) {
  	var timeInt = aa_int(data,profile,'Time',context);
  	if (!timeInt && ajaxart.inPreviewMode) timeInt = new Date().getTime();

  	var format_str = aa_text(data,profile,'Format',context);
  	return timeInt ? [aa_moment(timeInt).format(format_str)] : [];
  },
  TimeDurationAsHumanText: function(profile, data, context) {
  	var fromTime = aa_int(data,profile,'FromTimeInMillis',context);
  	var toTime = aa_int(data,profile,'ToTimeInMillis',context);
  	if (!fromTime || !toTime) return [];
  	return [aa_moment().duration({ seconds: (fromTime-toTime)/1000 }).humanize(true)];
  },
  TimeFromNow: function (profile,data,context) {
  	var timeInt = aa_int(data,profile,'Time',context);
  	if (isNaN(timeInt)) return '';
  	
  	var now = new Date().getTime();
  	if (now < timeInt) return ['0 seconds ago']; // do not allow negative time
  	var seconds = parseInt((now - timeInt) / 1000);
  	if (seconds < 60) return [seconds + ' seconds ago'];
  	return timeInt ? [aa_moment(timeInt).fromNow(true) + ' ago'] : ['now'];
  },
  MultiLang: function (profile,data,context)
  {
  	return ajaxart_multilang_run(data,profile,'Pattern',context);
  },  
  Split: function (profile,data,context)
  {
    var sep = aa_text(data,profile,'Separator',context);
    var part = aa_text(data,profile,'Part',context);
    var index_num = aa_int(data,profile,'Index',context);
    var str = aa_text(data,profile,'Text',context);
    
    if (aa_bool(data,profile,'Regex',context))
    	sep = new RegExp(sep);
    var result = '';
	if (str == '') return [];

	var items = str.split(sep);
	if (aa_bool(data,profile,'NoEmptyValues',context)) {
		for(var i=items.length-1;i>=0;i--)
			if (items[i] == "") items.splice(i,1);
	}
	switch(part)
	{
	case "ButFirst" : if (items.length >= 1) return items.slice(1); break;
	case "First" : if (items.length >= 1) result = items[0]; break;
	case "Second" : if (items.length >= 2) result = items[1]; break;
	case "Third" : if (items.length >= 3) result = items[2]; break;
	case "All but Last" :
		var out = [];
		for (var i=0; i<items.length-1; i++)
			out.push(items[i]);
		return out;
	case "All but First" :
		var out = [];
		for (var i=1; i<items.length; i++)
			out.push(items[i]);
		return out;
	case "All but First and Last" :
		var out = [];
		for (var i=1; i<items.length-1; i++)
			out.push(items[i]);
		return out;
	case "Second" : if (items.length >= 2) result = items[1]; break;
	case "All" :
		if (index_num && items.length >= index_num) 
			result = items[index_num-1];
		else
			return items;
		break;	
	case "By index" : 
		if (index_num && items.length >= index_num) 
			result = items[index_num-1];
		else
			return items;
		break;
	case "Last" : if (items.length > 0) result = items[items.length-1]; break;
	};

	if (result == '')
		result = aa_text(data,profile,'Default',context);
	return [result];
  },
  Text: function (profile,data,context)
  {
    var pattern = aa_text(data,profile,'Text',context);
    
    var result = ajaxart.dynamicText(data,pattern,context);
    var text_result = ajaxart.totext_array(result);
    if (aa_bool(data,profile,'RemoveEmptyParenthesis',context))
    	test_result = text_result.replace('\(\)','').replace(/^\s*/, '').replace(/\s*$/, '');
    return [ text_result ];
  },
  StartsWith: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var _with = aa_text(data,profile,'With',context);
	  
	  if ( text.indexOf(_with) == 0 ) return ["true"];
	  return [];
  },
  EndsWith: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var _with = aa_text(data,profile,'With',context);
	  
	  if ( text.lastIndexOf(_with) != -1 && text.lastIndexOf(_with) + _with.length == text.length ) return ["true"];
	  return [];
  },
  Length: function (profile,data,context)
  {
	  var str = ajaxart.totext_array(data);
	  var length = str.length;
	  return [length];
  },
  ToChars: function (profile,data,context)
  {
	  var str = ajaxart.totext_array(data);
	  var length = str.length;
	  var result = [];
	  for(var i=0;i<str.length;i++)
		  result.push(str.charAt(i));
	  return result;
  },
  Truncate: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var length = aa_int(data,profile,'Length',context);
	  if (text.length <= length) return [text];
	  var newtext = text.substring(0,length) + aa_text(data,profile,'Suffix',context);
	  return [newtext];
  },
  NumberFormat: function (profile,data,context)
  {
	  var number = ajaxart.totext_array(data);
	  var symbol = aa_text(data,profile,'Symbol',context);
	  var symbolLeft = ! aa_bool(data,profile,'SymbolAtRight',context);
	  var noCommaSeparator = aa_bool(data,profile,'NoCommaSeparator',context);
	  var use_cents = aa_bool(data,profile,'Cents',context);

	  var num = number.split('.')[0];
	  if (!noCommaSeparator)
		  for (var i = 0; i < Math.floor((num.length - (1 + i)) / 3); i++)
			  num = num.substring(0, num.length - (4 * i + 3)) + ',' + num.substring(num.length - (4 * i + 3)); 
	 
	  if (use_cents)
	  {
		  var cents = '00';
		  if (number.split('.').length > 1)
			  cents = number.split('.')[1];
		  cents = (cents + '00').substring(0,2);
		  num = num + '.' + cents;
	  }
	  if (num[0] == '-' && aa_bool(data,profile,'MinusInParenthesis',context))
		  num = symbolLeft ? '(' + symbol + num.substring(1) + ')' : '(' + num.substring(1) + symbol  + ')';
	  else
		  num = symbolLeft ? symbol + num : num + symbol;

	  return [num];
  },
  Concat: function (profile,data,context)
  {
    var prefix = aa_text(data,profile,'Prefix',context);
    var suffix = aa_text(data,profile,'Suffix',context);
    var sep = aa_text(data,profile,'Separator',context);
    var items = ajaxart.run(data,profile,'Items',context);
    var lastSeparator = aa_text(data,profile,'LastSeparator',context);
    var maxLength = aa_int(data,profile,'MaxLength',context);
    
    if (lastSeparator == "")
    	lastSeparator = sep;
    var out = prefix;

	var compiledItemText = ajaxart.compile(profile,'ItemText',context);
    
    for(var i=0;i<items.length;i++) {
    	var item = items[i];
    	var current = "";
    	
    	if (compiledItemText == "same") current = ajaxart.totext_item(item);
    	else if (compiledItemText == null) current = aa_text([item],profile,'ItemText',context);
    	else current = ajaxart.totext_array(compiledItemText([item],context));
    	
//    	if (current != "") {
	    	if (i!=0 && i+1<items.length) out += sep;
	    	if (i!=0 && i+1 == items.length) out += lastSeparator;
	    	out += current;
//    	}

  		if (out.length > maxLength && maxLength > 0) {
  			var overmaxtext = aa_text(data,profile,'SuffixForMax',context);
  			out = out.substring(0,maxLength) + overmaxtext;
  			return [out + suffix];
  		}
    }
  	var items_array = ajaxart.subprofiles(profile,'Item');
  	for(var i=0;i<items_array.length;i++) {
  		var current = aa_text(data,items_array[i],"",context);
  		if (current != "") {
	    	if (i!=0 && i+1<items_array.length) out += sep;
	    	if (i!=0 && i+1 == items_array.length) out += lastSeparator;
	    	out += current;
  		}
  	}

    out += suffix;
    return [out];
  },
  Capitalize: function (profile,data,context)
  {
	  var str = ajaxart.totext_array(data);
	  var mode = aa_text(data,profile,'Mode',context);
	  if (mode == "capital to separate words")
		  return [aa_text_capitalizeToSeperateWords(str)];
	  if (mode == "upper to separate capital")
	  {
		  var out = "";
		  str = str.toLowerCase();
		  var begin_of_word=true;
		  var counter=0;
		  while (counter < str.length)
		  {
			  var ch = str.charAt(counter);
			  var ch_str = "" +ch;

			  if (ch == '_')
			  {
				  begin_of_word= true;
				  out = out + " ";
				  counter++;
				  continue;
			  }

			  if (begin_of_word)
				  out = out + ch_str.toUpperCase();
			  else 
				  out = out + ch_str;

			  begin_of_word= false;
			  counter++;
		  }
		  return [out];
	  }
	  if (mode == "split and capitalize words")
	  {
		  var out = "";
		  //str = str.toLowerCase();
		  var begin_of_word=true;
		  var counter=0;
		  while (counter < str.length)
		  {
			  var ch = str.charAt(counter);
			  var ch_str = "" +ch;

			  if (ch == '_')
			  {
				  begin_of_word= true;
				  out = out + " ";
				  counter++;
				  continue;
			  }

			  if (ch >= 'A' && ch <= 'Z' && counter != 0)
			  {
				  begin_of_word= true;
				  out = out + " ";
			  }

			  if (begin_of_word)
				  out = out + ch_str.toUpperCase();
			  else 
				  out = out + ch_str;

			  begin_of_word= false;
			  counter++;
		  }
		  return [out];
	  }
	  if (mode == "separate words to capital")
	  {
		  var out = "";
		  var counter=0;
		  while (counter < str.length)
		  {
			  var ch = str.charAt(counter);
			  if (counter == 0) out += str.charAt(counter).toUpperCase();
			  else if (' !@#$%^&*()./'.indexOf(ch) != -1) {
				 if (counter+1 < str.length)  {
					 out += str.charAt(counter+1).toUpperCase();
					 counter++;
				 }
			  }
			  else out += str.charAt(counter);
			  
			  counter++;
		  }
		  str = out;
	  }
	  if (mode == "capital each word")
	  {
		  var out = "";
		  var counter=0;
		  while (counter < str.length)
		  {
			  if (counter == 0) out += str.charAt(counter).toUpperCase();
			  else if (str.charAt(counter) == " ") {
				 if (counter+1 < str.length)  {
					 out += " " + str.charAt(counter+1).toUpperCase();
					 counter++;
				 }
			  }
			  else out += str.charAt(counter);
			  
			  counter++;
		  }
		  str = out;
	  }
	  return [str];
  },
  Replace: function (profile,data,params)
  {
    var find = aa_text(data,profile,'Find',params);
    var replaceWith = aa_text(data,profile,'ReplaceWith',params);
    var useRegex = aa_bool(data,profile,'UseRegex',params);
    var replaceAll = aa_bool(data,profile,'ReplaceAll',params);
    var str = aa_text(data,profile,'Text',params);
    
	var result = "";
//	  		if (useRegex) {
		if (replaceAll)
			var reg = new RegExp(find, "g");
		else
			var reg = new RegExp(find);
		result = str.replace(reg, replaceWith);
//	  		}
	return [ result ];
  },
  ToIdText: function (profile,data,context)
  {
	return [aa_string2id(aa_totext(data))];
  },
  ToId: function (profile,data,context)
  {
	  var result = aa_string2id(aa_text(data,profile,'Text',context));
	  var usedArr = ajaxart.run(data,profile,'UsedIDs',context),usedIds=",";
	  
	  if (usedArr.length == 0) return [result];
	  for (var i=0;i<usedArr.length;i++) usedIds += aa_totext([usedArr[i]]) + ',';
	  
	  while ( usedIds.indexOf(','+result+',') > -1 ) {
		  var lastDigit = result.charAt(result.length-1);
		  if (lastDigit > '0' && lastDigit < '8')
		    result = result.substring(0,result.length-1) + (parseInt(lastDigit)+1);
		  else if (lastDigit == '9')
		    result = result.substring(0,result.length-1) + '10';
		  else 
			result = result + '1';
	  }
	  return [result];  
  },
  Translate: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var out = ajaxart_multilang_text(text,context);
	  return [out];
  },
  TranslatePattern: function (profile,data,context)
  {
	  return ajaxart_multilang_run(data,profile,'Pattern',context);
  },
  ReplaceWithRegex: function (profile,data,params)
  {
	  var pattern = aa_text(data,profile,'Pattern',params);
	  var replaceWith = aa_text(data,profile,'ReplaceWith',params);
	  var flags = aa_text(data,profile,'Flags',params);
	  var str = aa_text(data,profile,'Text',params);
	  try
	  {
		  return [ str.replace(new RegExp(pattern,flags),replaceWith) ];
	  }
	  catch(e) {}
	  return [];
  },
  ReplaceMulti: function (profile,data,params)
  {
	  var find = ajaxart.run(data,profile,'Find',params);
	  var replaceWith = ajaxart.run(data,profile,'ReplaceWith',params);
	  var replaceAll = aa_bool(data,profile,'ReplaceAll',params);
	  var str = aa_text(data,profile,'Text',params);
	  
	  if (find.length != replaceWith.length) return data;
	  for (var i=0; i<find.length; i++) {
			if (replaceAll)
				var reg = new RegExp(find[i], "g");
			else
				var reg = new RegExp(find[i]);
			str = str.replace(reg, replaceWith[i]);
	  }
	  return [ str ];
  },
  MultiLangSuite: function (profile,data,context)
  {
	 var lang = aa_text(data,profile,'Language',context);

	 aa_mlTable = typeof(aa_mlTable) == 'undefined' ? {} : aa_mlTable;
	 aa_mlTable[lang] = aa_mlTable[lang] || {};
	 var trList = aa_mlTable[lang];
	 
	 var items = aa_xpath(profile,'Pattern');
	 for(var k=0;k<items.length;k++) {
		trList[items[k].getAttribute('Original')] = items[k].getAttribute('T') || items[k].getAttribute('Tranlation');
	 }
	 
	 var items = aa_xpath(profile,'item');
	 for(var i=0;i<items.length;i++) {
		 var v = items[i].getAttribute('v') || '';
		 if (v != '')
		   trList[items[i].getAttribute('k')] = v;
	 }
  },
  Between: function (profile,data,params)
  {
    var from = aa_text(data,profile,'From',params);
    var to = aa_text(data,profile,'To',params);
    var includeFrom = aa_bool(data,profile,'IncludeFrom',params);
    var includeTo = aa_bool(data,profile,'IncludeTo',params);

	var str = ajaxart.totext_array(data);
	var index_from = str.indexOf(from);
	if (index_from != -1)
	{
		if (includeFrom)
			str = str.substring(index_from);
		else
			str = str.substring(index_from+from.length);
	}
		
	var index_to = str.indexOf(to);
	if (index_to != -1)
	{
		if (includeTo)
			str = str.substring(0,index_to+to.length);
		else
			str = str.substring(0,index_to);
	}
    return [str];
  },
  PromoteStartingWith: function (profile,data,context)
  {
	  var with1 = aa_text(data,profile,'StartsWith',context);
	  if (with1 == '') return [];
	  var out = [];
	  var out2 = [];
	  
	  for(var i=0;i<data.length;i++) {
		  var text = ajaxart.totext_item(data[i]);
		  if (text.indexOf(with1) == 0) out.push(data[i]); else out2.push(data[i]);
	  }
	  for (var i=0;i<out2.length;i++)
		  out.push(out2[i]);
	  
	  return out;
  },
  SplitByCommas: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var spl = text.split(',');
	  var out = [];
	  for(var i=0;i<spl.length;i++)
		  if (spl[i].length > 0) out.push(spl[i]);
	  
	  return out;
  },
  Pad: function (profile,data,context)
  {
	    var length = aa_text(data,profile,'Length',context);
	    var filler = aa_int(data,profile,'Filler',context);
	    var str = aa_text(data,profile,'Text',context);
	
	    while (str.length < length)
	        str = filler + str;
	   
	    return [str];
  },
  AddToCommaText: function (profile,data,context)
  {
	var text = ajaxart.run(data,profile,'Text',context);
	var toadd = aa_text(data,profile,'ToAdd',context);
	var text_str = aa_totext(text);
	if ((','+text_str+',').indexOf(','+toadd+',') == -1) {
		var val = (text_str == "") ? toadd : text_str + ',' + toadd;
		ajaxart.writevalue(text,[val]);
	}
  },
  RemoveFromCommaText: function (profile,data,context)
  {
	  var text = ajaxart.run(data,profile,'Text',context);
	  var toremove = aa_text(data,profile,'ToRemove',context);
	  var text_str = aa_totext(text);
	  var pos = (','+text_str+',').indexOf(','+toremove+','); 
	  if (pos > -1) {
		  var val = text_str.substring(0,pos-1) + text_str.substring(pos+toremove.length+1);  
		  ajaxart.writevalue(text,[val]);
	  }
  },
  RemoveSuffix: function (profile,data,context)
  {
    var sep = aa_text(data,profile,'Separator',context);
    var suffix = aa_text(data,profile,'Suffix',context);
    var emptyIfNoSeparator = aa_bool(data,profile,'EmptyIfNoSeparator',context);
    var text = ajaxart.totext_array(data);
    
    if (suffix.length > 0)
    {
    	var pos = text.lastIndexOf(suffix);
    	if (pos == text.length - suffix.length)
    		return [text.substring(0,pos)];
    }
    
    var index = text.lastIndexOf(sep);
    if (index == -1) 
   		if (emptyIfNoSeparator) 
   			return [""];
    	else 
    		return [text];
    return [text.substring(0,index)];
  },
  ToLowerCase: function (profile,data,context)
  {
	  return [ ajaxart.totext_array(data).toLowerCase() ];
  },
  ToUpperCase: function (profile,data,context)
  {
	  return [ ajaxart.totext_array(data).toUpperCase() ];
  },
  ExtractPrefix: function (profile,data,context)
  {
	 var sep = aa_text(data,profile,'Separator',context);
	 var useRegex = aa_bool(data,profile,'UseRegex',context);
	 var text = ajaxart.totext_array(data);
	 
	 if (useRegex)
		 var index = text.search(sep);
	 else
		 var index = text.indexOf(sep);
	 
	 if (index == -1) return [];
	 var result = '';
	 if (aa_bool(data,profile,'KeepSeparator',context))
		 result = text.substring(0,index+sep.length);
	 else
		 result = text.substring(0,index);
	 if (result.length == 0)
		 result = aa_text(data,profile,'Default',context);
	 return [result];
  },
  RemovePrefix: function (profile,data,context)
  {
    var sep = aa_text(data,profile,'Separator',context);
    var prefix = aa_text(data,profile,'Prefix',context);
    var text = ajaxart.totext_array(data);
    if (prefix != "") {
    	if (text.indexOf(prefix) == 0)
    		return [text.substring(prefix.length)];
    }
    if (sep == "") return [text];
    var index = text.indexOf(sep);
    if (index == -1) return [text];
    return [text.substring(index+sep.length)];
  },
  CountOfSubtext: function (profile,data,params)
  {
    var subtext = aa_text(data,profile,'Text',params);
    var text = ajaxart.totext_array(data);
    if (subtext.length == 0) return ["0"];
    
    var arr = text.split(subtext);
    return ["" + (arr.length-1)];
  },
  Encode: function (profile,data,params)
  {
    var text = ajaxart.totext_array(data);
    var result = unescape( encodeURIComponent(text));
    return [result];
  },
  MatchesRegex: function (profile,data,context)
  {
    var pattern = '^' + aa_text(data,profile,'Expression',context) + '$';
    var text = aa_text(data,profile,'Text',context);
    
    return text.match(pattern) ? ['true'] : [];
  },
  FindInText: function (profile,data,context)
  {
    var pattern = aa_text(data,profile,'Pattern',context);
    var useRegex = aa_bool(data,profile,'UseRegex',context);
    var text = ajaxart.totext_array(data);
    var result = -1;
    if (useRegex)
    	result = text.search(pattern);
    else
    	result = text.indexOf(pattern);
    return [ result != -1 ];
  },
  UrlEncoding: function (profile,data,context)
  {
	  var urlpart = ajaxart.totext_array(data);
	  var type = aa_text(data,profile,'Type',context);
	  if (type == "encode")
		  return [ encodeURIComponent( urlpart ) ];
	  else
		  return [ decodeURIComponent( urlpart )];
  },
  Substring: function (profile,data,context)
  {	
	  var start = aa_int(data,profile,'Start',context);
	  var stop = aa_int(data,profile,'Stop',context);
	  var text = aa_text(data,profile,'Text',context);
	  if (stop != null && stop != "" && !isNaN(stop) )
		  return [ text.substring(start-1,stop-1) ];
	  else
		  return [ text.substring(start-1) ];
  },
  Reverse: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var reverse = "";
	  for (i=0;i<text.length;i++)
		  reverse = reverse + text.charAt(text.length-i-1);
	  return [reverse];
  },
  DecodeMimeType: function (profile,data,context)
  {
	  var win1255Lookup = ['00','01','02','03','04','05','06','07','08','09','0a','0b','0c','0d','0e','0f','10','11','12','13','14','15','16','17','18','19','1a','1b','1c','1d','1e','1f','20','21','22','23','24','25','26','27','28','29','2a','2b','2c','2d','2e','2f','30','31','32','33','34','35','36','37','38','39','3a','3b','3c','3d','3e','3f','40','41','42','43','44','45','46','47','48','49','4a','4b','4c','4d','4e','4f','50','51','52','53','54','55','56','57','58','59','5a','5b','5c','5d','5e','5f','60','61','62','63','64','65','66','67','68','69','6a','6b','6c','6d','6e','6f','70','71','72','73','74','75','76','77','78','79','7a','7b','7c','7d','7e','7f','20ac','81','201a','0192','201e','2026','2020','2021','02c6','2030','8a','2039','8c','8d','8e','8f','90','2018','2019','201c','201d','2022','2013','2014','02dc','2122','9a','203a','9c','9d','9e','9f','a0','a1','a2','a3','20aa','a5','a6','a7','a8','a9','d7','ab','ac','ad','ae','af','b0','b1','b2','b3','b4','b5','b6','b7','b8','b9','f7','bb','bc','bd','be','bf','05b0','05b1','05b2','05b3','05b4','05b5','05b6','05b7','05b8','05b9','05ba','05bb','05bc','05bd','05be','05bf','05c0','05c1','05c2','05c3','05f0','05f1','05f2','05f3','05f4','f88d','f88e','f88f','f890','f891','f892','f893','05d0','05d1','05d2','05d3','05d4','05d5','05d6','05d7','05d8','05d9','05da','05db','05dc','05dd','05de','05df','05e0','05e1','05e2','05e3','05e4','05e5','05e6','05e7','05e8','05e9','05ea','f894','f895','200e','200f','f896' ];
	  function uTF8DecodeOfWin1255(input) {
		  var result = '';
		  for(var i=0;i<input.length;i++)
		  {
			  c = input.charCodeAt(i);
			  if (c < 256)
			  result += String.fromCharCode(parseInt(win1255Lookup[c],16));
		  }
		  return result;
	  }
		function uTF8Decode(input,charset) {
			if (charset=='windows-1255') 
				return uTF8DecodeOfWin1255(input);
			var string = "";
			var i = 0;
			var c = c1 = c2 = 0;
			while ( i < input.length ) {
				c = input.charCodeAt(i);
				if (c < 128) {
					string += String.fromCharCode(c);
					i++;
				} else if ((c > 191) && (c < 224)) {
					c2 = input.charCodeAt(i+1);
					string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
					i += 2;
				} else {
					c2 = input.charCodeAt(i+1);
					c3 = input.charCodeAt(i+2);
					string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
					i += 3;
				}
			}
			return string;
		}

//		function uTF8Decode(input,charset) {
//			var string = "";
//			var i = 0;
//			var c = c1 = c2 = 0;
//			while ( i < input.length ) {
//				c = input.charCodeAt(i);
//				if (c >= 32 && c < 128) {
//					string += String.fromCharCode(c);
//					i++;
//				} else if ((c >= 224) && (c < 256) && (charset=='windows-1255')) {
//					string += String.fromCharCode(c+1488-224);
//					i++;
//				} else if (c == 0) { 
//					i++;string += ' ';
//				} else if (c == 10 || c == 13) { 
//					string += '\n'; i++;
//				} else {
//					string += '?' + c + '?';
//					i++;
//				}
//			}
//			return string;
//		}
		var keyString = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
		function base64Decode(input,charset) {
			var output = "";
			var chr1, chr2, chr3;
			var enc1, enc2, enc3, enc4;
			var i = 0;
			input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
			while (i < input.length) {
				enc1 = keyString.indexOf(input.charAt(i++));
				enc2 = keyString.indexOf(input.charAt(i++));
				enc3 = keyString.indexOf(input.charAt(i++));
				enc4 = keyString.indexOf(input.charAt(i++));
				chr1 = (enc1 << 2) | (enc2 >> 4);
				chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
				chr3 = ((enc3 & 3) << 6) | enc4;
				output = output + String.fromCharCode(chr1);
				if (enc3 != 64) {
					output = output + String.fromCharCode(chr2);
				}
				if (enc4 != 64) {
					output = output + String.fromCharCode(chr3);
				}
			}
			output = uTF8Decode(output,charset);
			return output;
		}

		function QTDecode(input,charset) {
			var output = "";
			var i = 0;
			while (i < input.length)
			{
				if (input.charAt(i) != '=')
				{
					output += input.charAt(i);
					i++;
				}
				else
				{
					var code = parseInt("0x"+input.charAt(i+1)+input.charAt(i+2));
					i += 3;
					output += String.fromCharCode(code);
				}
			}
			output = uTF8Decode(output,charset);
			return output;
		}


	  var text = aa_text(data,profile,'Text',context);
	  var encoding = aa_text(data,profile,'Encoding',context);
	  var charset = aa_text(data,profile,'Charset',context);
	  var result = [text];
	  if (encoding == "auto" && text.indexOf('=?') == 0)
	  {
		  var parts = text.split('?');
		  var charset = parts[1] || charset;
		  var type = parts[2];
		  var content = parts[3];
		  content = content.replace(/ =[\n\r]+/mg,'')
		  if (type == 'B') 
			  result = [base64Decode(content,charset)];
		  if (type == 'Q')
			  result = [QTDecode(content,charset)];
	  }
	  else if (encoding == "Base64")
		  result = [base64Decode(text,charset)];
	  else if (encoding == "Quoted Printable")
		  result = [QTDecode(text.replace(/ =[\n\r]+/mg,''),charset)];
	  return result;
  },
  SplitLines: function (profile,data,context)
  {
	  var text = aa_text(data,profile,'Text',context);
	  var newLineChars = aa_text(data,profile,'NewLineChars',context);
	  
	  return text.split(newLineChars);
  }
});
function aa_text_trim(str) {
    return str.replace(/^\s*/, "").replace(/\s*$/, "");
}

function aa_text_comma_seperate(text) // ignore \,
{
	var out = [];
	var last_index = 0;
	for (var i=0; i<text.length; i++) {
		if (text[i] == ',') {
			if (i == 0)
				last_index++;
			else if (text[i-1] != '\\') {
				var t = text.substring(last_index,i);
				if (t.indexOf('\\,') != -1)
					t = t.replace('\\,',','); 
				out.push(t);
				last_index = i+1;
			}
		}
	}
	if (last_index < text.length) {
		var t = text.substring(last_index);
		if (t.indexOf('\\,') != -1)
			t = t.replace('\\,',','); 
		out.push(t);
	}
	return out;
}
function aa_strreverse(str)
{
  return str.split('').reverse().join('');
}

function aa_base64ArrayBuffer(arrayBuffer) {
	  var base64    = ''
	  var encodings = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

	  var bytes         = new Uint8Array(arrayBuffer)
	  var byteLength    = bytes.byteLength
	  var byteRemainder = byteLength % 3
	  var mainLength    = byteLength - byteRemainder

	  var a, b, c, d
	  var chunk

	  // Main loop deals with bytes in chunks of 3
	  for (var i = 0; i < mainLength; i = i + 3) {
	    // Combine the three bytes into a single integer
	    chunk = (bytes[i] << 16) | (bytes[i + 1] << 8) | bytes[i + 2]

	    // Use bitmasks to extract 6-bit segments from the triplet
	    a = (chunk & 16515072) >> 18 // 16515072 = (2^6 - 1) << 18
	    b = (chunk & 258048)   >> 12 // 258048   = (2^6 - 1) << 12
	    c = (chunk & 4032)     >>  6 // 4032     = (2^6 - 1) << 6
	    d = chunk & 63               // 63       = 2^6 - 1

	    // Convert the raw binary segments to the appropriate ASCII encoding
	    base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d]
	  }

	  // Deal with the remaining bytes and padding
	  if (byteRemainder == 1) {
	    chunk = bytes[mainLength]

	    a = (chunk & 252) >> 2 // 252 = (2^6 - 1) << 2

	    // Set the 4 least significant bits to zero
	    b = (chunk & 3)   << 4 // 3   = 2^2 - 1

	    base64 += encodings[a] + encodings[b] + '=='
	  } else if (byteRemainder == 2) {
	    chunk = (bytes[mainLength] << 8) | bytes[mainLength + 1]

	    a = (chunk & 64512) >> 10 // 64512 = (2^6 - 1) << 10
	    b = (chunk & 1008)  >>  4 // 1008  = (2^6 - 1) << 4

	    // Set the 2 least significant bits to zero
	    c = (chunk & 15)    <<  2 // 15    = 2^4 - 1

	    base64 += encodings[a] + encodings[b] + encodings[c] + '='
	  }

	  return base64
}

function aa_capitalize_each_word(str)
{
	  var out = "";
	  var counter=0;
	  while (counter < str.length)
	  {
		  if (counter == 0) out += str.charAt(counter).toUpperCase();
		  else if (str.charAt(counter) == " ") {
			 if (counter+1 < str.length)  {
				 out += " " + str.charAt(counter+1).toUpperCase();
				 counter++;
			 }
		  }
		  else out += str.charAt(counter);
		  
		  counter++;
	  }
	  return out;
}

function aa_text_capitalizeToSeperateWords(str)
{
	  var out = "";
	  var start=0; var counter=1;
	  while (counter < str.length)
	  {
		  if (str.charAt(counter) >= 'A' && str.charAt(counter) <= 'Z')
		  {
			  if (counter+1 < str.length && ( str.charAt(counter-1) < 'A' || str.charAt(counter-1) > 'Z') )
			  {
			    out = out + str.substring(start,counter) + " " + str.charAt(counter);
			    start = counter+1;
			  }
		  }
		  counter++;
	  }
	  out = out + str.substring(start);
	  return out;
}
function ajaxart_language(context)
{
	if (context.vars.Language == null || context.vars.Language.length == 0) return "";
	return ajaxart.totext( context.vars.Language[0] );
}

function aa_multilang_text(data,script,field,context)
{
	return ajaxart_multilang_run(data,script,field,context)[0] || '';
}
function ajaxart_multilang_run(data,script,field,context)
{
	var fieldscript = ajaxart.fieldscript(script,field,true);
	if (fieldscript == null) return [""];
	var result = null;
	if (fieldscript.nodeType == 2) {
		if (fieldscript.nodeValue.indexOf('%') != -1) {
		  result = ajaxart.dynamicText(data,ajaxart_multilang_text(fieldscript.nodeValue,context),context);

		  if (ajaxart.xtmls_to_trace.length > 0) {
		    if (field == "") { field = script.nodeName; script = aa_xpath(script,'..')[0]; }
	        if (script.getAttribute("Trace") == field) ajaxart.trace(script,data,result,context,field);
		    aa_try_probe_test_attribute(script,field,data,result,context,data);
		  }
		}
	}
	if (result == null)
	  result = ajaxart.run(data,script,field,context);
	
	if (result.length > 0) result = [ajaxart_multilang_text(ajaxart.totext_array(result),context)];
	return result;
}
function ajaxart_multilang_text(text,context)
{
	if (context.vars.Language && context.vars.Language.length > 0 && text)
	{
		if (!window.aa_mlTable) ajaxart_fill_mlTable();
		var lang = aa_totext(context.vars.Language);
		if ( aa_mlTable[lang] && aa_mlTable[lang][text]) 
			return aa_mlTable[lang][text];
		if (typeof(aa_mlDefaultLanguage) != 'undefined' && aa_mlTable[aa_mlDefaultLanguage] && aa_mlTable[aa_mlDefaultLanguage][text])
			return aa_mlTable[aa_mlDefaultLanguage][text];
		var text_lc = text.toLowerCase();
		if ( aa_mlTable[lang] && aa_mlTable[lang][text_lc]) 
			return aa_mlTable[lang][text_lc];
	}
	return text; //text.split('__')[0];
}

function ajaxart_fill_mlTable() 
{
	window.aa_mlTable = window.aa_mlTable || {};
	for(ns in ajaxart.components)
	{
		if (!ajaxart.components.hasOwnProperty(ns)) continue;
		var list = ajaxart.components[ns];
		for(var j in list) {
			if (!list.hasOwnProperty(j)) continue;
			var comp = list[j];
			if (comp.getAttribute('type') == "text.MultiLangSuite") {
			  ajaxart.run([],aa_xpath(comp,'xtml')[0],'',ajaxart.newContext());
			}
		}
	}
}

function aa_textAutoLinks(text,target) {
	target = target || '_blank';
	// replaces links with <a href
	return text.replace(/[^"'](http[s]?[^\s]*)/g,'<a href="$1" target="'+target+'">$1</a>');
}

function aa_toValidFileName(str) {
	return str.replace(/[:*<>?\[\]#]*/g,'');
}

ajaxart.load_usage_plugin("text");

function ajaxart_field_highlight_text(text,highlight,highlight_class)
{
	if (!text) return '';
	if (!highlight) return text;

	var result = text;
  	var lCaseTxt = text.toLowerCase();
  	var found_at = lCaseTxt.indexOf(highlight);
  	var endTag = lCaseTxt.indexOf('>');
  	if (found_at != -1 && found_at > endTag)
  	{
  		var to_replace = text.substring(found_at,found_at + highlight.length);
  		result = text.replace(to_replace,'####' + to_replace + '~~~~');
  	}
  	result = result.replace(/####/g,'<span class="aa_highlight ' + highlight_class + '">');
  	result = result.replace(/~~~~/g,'</span>');
  	return result;
}
function aa_replaceElement(element,newControl,cleanMemoryLeaks,transition)
{
	if (element.ParentObject != null) { 
		aa_defineElemProperties(newControl,'ParentObject');
		newControl.ParentObject = element.ParentObject; 
		newControl.ParentObject[0].ControlHolder = [newControl];
	}
	if (newControl) {
		if (transition) {
			element.parentNode.appendChild(newControl);
			transition.replace(element,newControl);
		}
		else
			ajaxart.replaceXmlElement(element,newControl,true,cleanMemoryLeaks);
		aa_clear_virtual_inner_element(element);
		aa_element_attached(newControl);
		aa_element_detached(element);
	}
	return newControl;
}
function aa_set_element_size(element,text,prefix) // prefix can be empty, min-,max-
{
	prefix = prefix || '';
	var arr = text.split(',');
	var width = aa_size_to_pixels(arr[0],"width");	// fix percentages
	var height = aa_size_to_pixels(arr[1] || '',"height");
	if (width) $(element).css(prefix + "width",width);
	if (height) $(element).css(prefix + "height",height);
}
function aa_size_to_pixels(value,type)
{
	if (!value) return null;
	if (value.match(/^[0-9 ]+$/)) return value + "px";
	if (value.indexOf("%") == -1) return value;
	var num = parseInt(value);
	if (isNaN(num)) return null;
	return Math.floor(aa_screen_size()[type] * num / 100) + "px";
}
function aa_ensure_visible(elem, padding) 	// auto scroll parents to ensure elem is visible (only vertical scroll)
{
	return;	// todo: fix this function, sometimes it scrolls with no need.
//	if ($(elem).is(':visible')) return;
	
    var elem_height = elem.offsetHeight;

    var curr = elem;
    var top = 0;
    if (!padding) padding = 10;

    while (true) {
    	var parent = curr.parentNode;
    	if (!parent) return;
    	top += curr.offsetTop;
    	if (parent.offsetParent == curr.offsetParent)
    		 top -= parent.offsetTop;	// offsetTop is relative to offsetParent and not to parent
    	if (top + elem_height + padding > parent.offsetHeight + parent.scrollTop)	// need to scroll down
    		parent.scrollTop = elem_height + top + padding - parent.offsetHeight;
    	if (top - padding < parent.scrollTop)	// need to scroll up
    		parent.scrollTop = Math.max(top - padding,0);
    	top -= parent.scrollTop;

    	curr = parent;
    }
}
function aa_addDescriptionForEmptyText(cell,emptyTextDescription,emptyTextClass)
{
	var field = cell.Field;
	var input = $(cell).find('input')[0] || $(cell).find('textarea')[0];
	if (input)
	{
		if (ajaxart.isChrome || ajaxart.isFireFox || ajaxart.isSafari) {
			input.setAttribute('placeholder',emptyTextDescription);
			return;
		}
		aa_defineElemProperties(input,'getValue','RefreshDescriptionForEmptyText');
		input.getValue = function() {
			var input = this;
			if ($(input).hasClass('empty_text_description') && input.value == emptyTextDescription) return '';
			return input.value;
		}
		input.RefreshDescriptionForEmptyText = function() {
			var input = this;
			if (input.value == '')
			{
				$(input).addClass('empty_text_description').addClass(emptyTextClass);
				input.value = emptyTextDescription;
				input.setAttribute('value',emptyTextDescription); // for tests
			} else {
				$(input).removeClass('empty_text_description').removeClass(emptyTextClass);
			}
		}
		input.RefreshDescriptionForEmptyText();
	}
	else {
		var textDiv = $(cell).find('.text');
		if (textDiv[0] && textDiv.text() == '') textDiv.text(emptyTextDescription).addClass(emptyTextClass);
	}
}

function aa_run_delayed_action(action_id,callback,delay,postpone_callback)
{
	window.jbDelayed_actions = window.jbDelayed_actions || {};

	delay = delay || 100;
	var time_to_delay = delay;
	var first_call_time = jbDelayed_actions[action_id] ? jbDelayed_actions[action_id].first_call_time : new Date().getTime();

	if (jbDelayed_actions[action_id]) {
		clearTimeout(jbDelayed_actions[action_id].timeoutid);
		if (!postpone_callback) 	// make sure the call is invoked exactly with the delay after the first call
			time_to_delay = delay - (new Date().getTime() - first_call_time);		
	}
	jbDelayed_actions[action_id] = {
		first_call_time: first_call_time,
		timeoutid: setTimeout(function() {
			jbDelayed_actions[action_id] = null;
			callback();
		},time_to_delay),
		callback: callback
	};
}
function aa_run_existing_delayed_action(action_id) {
	if (!window.jbDelayed_actions) return;
	if (jbDelayed_actions[action_id]) {
		clearTimeout(jbDelayed_actions[action_id].timeoutid);
		var callback = jbDelayed_actions[action_id].callback;
		jbDelayed_actions[action_id] = null;		
		callback();
	}
}
function aa_cancel_delayed_action(action_id)
{
	window.jbDelayed_actions = window.jbDelayed_actions || {};
	if (jbDelayed_actions[action_id]) {
		clearTimeout(jbDelayed_actions[action_id].timeoutid);
		jbDelayed_actions[action_id] = null;
	}
}
function aa_attach_window_resize(func, elem)
{
	if (!elem || !func) return;
	if (ajaxart.aa_windowresize == null) {
		ajaxart.aa_windowresize = 0; 
		ajaxart.window_size = { height: window.innerHeight, width:window.innerWidth};
		function onresize() {
			if (ajaxart.window_size && window.innerHeight == ajaxart.window_size.height && window.innerWidth == ajaxart.window_size.width)
				return;
			if (ajaxart.aa_windowresize != 0)
				clearTimeout(ajaxart.aa_windowresize);
			if (ajaxart.window_size.width == window.innerWidth &&
				Math.abs(ajaxart.window_size.height - window.innerHeight) > 100) return;  // Android fix: openning the keyboard should not call on resize.	
																						// Notive that when address bar is hiding, we need resize event. Address bar size is about 40-60 pixels.
			 ajaxart.window_size = { height: window.innerHeight, width:window.innerWidth};																		
			 aa_windowresize = setTimeout(function() {
				var listeners = $(".aa_window_resize_listener");
				for(var i=0;i<listeners.length;i++)
					aa_trigger(listeners[i],'WindowResize');

				 aa_windowresize = 0;
				}, 100);
		}
		window.addEventListener('resize', onresize,false);
		window.addEventListener('orientationchange', onresize,false);	// sometimes orientationchange is fired and sometimes resize, http://blog.blazingcloud.net/2012/05/08/orientationchange-and-resize-events-on-the-iphone/
		window.addEventListener('scroll', onresize,false);	// sometimes orientationchange is fired and sometimes resize, http://blog.blazingcloud.net/2012/05/08/orientationchange-and-resize-events-on-the-iphone/
	}
	$(elem).addClass('aa_window_resize_listener');
	aa_bind(elem,'WindowResize',func);
}



ajaxart.gcs.gchart =
{
	GoogleChart: function (profile,data,context)
	{
		var graph = aa_generic_graph(data,profile,context);
		graph.OnClick =  function(selection) 
		{
   			var wrapper  = this.items[selection[0].row];
   			var item = wrapper.__item || wrapper;
   			var ctx = aa_ctx(context,{_ItemsOfOperation: [item]})
   			ajaxart.run([item],profile,'OnClick',ctx);
   		}
		graph.PrepareGraphData= function(gdata) {
		  var cntr = context.vars._Cntr[0];
		  var dataholder_cntr = context.vars.DataHolderCntr && context.vars.DataHolderCntr[0];
		  if (!dataholder_cntr) return [];
		  var fields = dataholder_cntr.DataHolder.Fields;

		  var type = aa_text(data,profile,'Type',context);
		  var requiresNumericLabel = type == 'ScatterChart';
		  var dateAsObject = aa_text(data,profile,'Type',context) == 'AnnotatedTimeLine';
		  //this.dataview = context.vars.DataView ? context.vars.DataView[0] : cntr.DataHolder.UserDataView;
		  var items = this.items = aa_items(cntr);
		  var labelField = aa_fieldById(aa_text(data,profile,'LabelField',context),fields);
		  var amountField = aa_fieldById(aa_text(data,profile,'AmountField',context),fields);
		  var amount2Field = aa_fieldById(aa_text(data,profile,'Amount2Field',context),fields);
		  var amount3Field = aa_fieldById(aa_text(data,profile,'Amount3Field',context),fields);
		  if (labelField == null) // look for label
			  labelField = aa_fieldById('Name',fields) || aa_fieldById('Id',fields) || aa_fieldById('Label',fields);
		  if (labelField == null) // look for first date
			  for(var i in fields)
				  if (fields[i].IsDate)
				  {
					  labelField = fields[i];
					  break;
				  }
		  if (amountField == null) // look for first numeric
			  for(var i in fields)
				  if (fields[i].FieldType == 'number')
				  {
					  amountField = fields[i];
					  break;
				  }
		  if (amountField == null || labelField == null) return;
		  this.Params.hAxis = {title: labelField.Title};
		  if (!amount2Field)
			  this.Params.vAxis = {title: amountField.Title};

		  if (dateAsObject && labelField.IsDate)
			  gdata.addColumn('date', labelField.Title);
		  else if (labelField.IsNumber && requiresNumericLabel)
			  gdata.addColumn('number', labelField.Title);
		  else
			  gdata.addColumn('string', labelField.Title);
		  gdata.addColumn('number', amountField.Title);
		  if (amount2Field) gdata.addColumn('number', amount2Field.Title);
		  if (amount3Field) gdata.addColumn('number', amount3Field.Title);
		  
		  gdata.addRows(items.length);
		  for(var i=0;i<items.length;i++) {
        	var item = items[i];
        	var label = ajaxart.totext_array(ajaxart_field_calc_field_data(labelField,[item],context));
        	var amount = parseFloat(ajaxart.totext_array(ajaxart_field_calc_field_data(amountField,[item],context))) || 0;
			if (dateAsObject && labelField.IsDate)
				gdata.setValue(i, 1, new Date(amount));
			else if (requiresNumericLabel) 
				gdata.setValue(i, 0, parseFloat(label) || 0);
			else
				gdata.setValue(i, 0, label || '');
			gdata.setValue(i, 1, amount);
			if (amount2Field) gdata.setValue(i, 2, parseFloat(ajaxart.totext_array(ajaxart_field_calc_field_data(amount2Field,[item],context))) || 0);
			if (amount3Field) gdata.setValue(i, 3, parseFloat(ajaxart.totext_array(ajaxart_field_calc_field_data(amount3Field,[item],context))) || 0);
		  }
	   }
	   var out = aa_create_graph_div(graph);
	   // for tests
	   var test_string = '';
	   var cntr = context.vars._Cntr[0];
	   var items = aa_items(cntr);
 	   var dataholder_cntr = context.vars.DataHolderCntr && context.vars.DataHolderCntr[0];
	   var fields = dataholder_cntr.DataHolder.Fields;
	   var labelField = aa_fieldById(aa_text(data,profile,'LabelField',context),fields);
	   var amountField = aa_fieldById(aa_text(data,profile,'AmountField',context),fields);
	   for(var i=0;i<items.length;i++)
		   test_string += ajaxart.totext_array(ajaxart_field_calc_field_data(labelField,[items[i]],context)) + ' - ' +  
		                  ajaxart.totext_array(ajaxart_field_calc_field_data(amountField,[items[i]],context));
	   var test_div = document.createElement('div');
	   test_div.className= 'aa_test';
	   test_div.setAttribute('test_string',test_string);
	   out.appendChild(test_div);
	   
	   return [out];
	},
	PieChart: function (profile,data,context) // depricated
	{
		var chartObj = { isObject: true, Items: ajaxart.run(data,profile,'Items',context) }
		chartObj.Title = aa_text(data,profile,'Title',context);
		chartObj.ChartClass = 'google.visualization.PieChart';
		chartObj.FrameWidth = chartObj.FrameHeight = "400px"; 
			
		aa_addMethod(chartObj,'ItemText',profile,'ItemText',context);
		aa_addMethod(chartObj,'ItemAmount',profile,'ItemAmount',context);
		aa_addMethod(chartObj,'OnItemClick',profile,'OnItemClick',context);
		
		return [ aa_piechart(chartObj,context) ];
	},		
	TimelineChart: function (profile,data,context) // depricated
	{
		var chartObj = { isObject: true, Items: ajaxart.run(data,profile,'Items',context).reverse() }
		
		chartObj.Title = aa_text(data,profile,'Title',context);
		chartObj.ChartClass = 'google.visualization.AreaChart';
		chartObj.GoogleParams = aa_text(data,profile,'GoogleParams',context);
		chartObj.FrameWidth = aa_text(data,profile,'FrameWidth',context);
		chartObj.FrameHeight = aa_text(data,profile,'FrameHeight',context);
			
		aa_addMethod(chartObj,'ItemText',profile,'Date',context);
		aa_addMethod(chartObj,'ItemAmount',profile,'ItemAmount',context);
		aa_addMethod(chartObj,'OnItemClick',profile,'OnItemClick',context);
		
		return [ aa_piechart(chartObj,context) ];
	}
}

function aa_piechart(chartObj,context)  // depricated
{
	var out = jQuery('<iframe src="lib/googlechart.html?ver='+ajaxart.build_version+'" style=" border-width:0 " width="'+chartObj.FrameWidth+'" height="'+chartObj.FrameHeight+'" frameborder="0" scrolling="no"/>')[0];
	out.info = { width: 450, height: 300 , chartClass: chartObj.ChartClass, title: chartObj.Title, googleParams: chartObj.GoogleParams};
	//out.info.googleParams = "width: '" + chartObj.Width + "', height: '" + chartObj.Height + "'";
	out.info.googleParams = '';
	if (chartObj.GoogleParams != "") out.info.googleParams = chartObj.GoogleParams;
	
	out.info.data = [];
	for(var i=0;i<chartObj.Items.length;i++) {
		var item = [ chartObj.Items[i] ], obj = {item: item};
		obj.text = aa_totext(aa_runMethod(item,chartObj,'ItemText',context));
		obj.amount = aa_toint(aa_runMethod(item,chartObj,'ItemAmount',context));
		obj.onclick = function(obj) { aa_runMethod(obj.item,chartObj,'OnItemClick',context); }
		out.info.data.push(obj);
	}
	return out;
}
function aa_load_googlegraph() {
	if (window.loading_googlegraphs) return;
	   window.loading_googlegraphs = true;
	   jQuery.ajax({
		   url: (window.location.host1 == 'localhost') ? 'lib/googlechart.js' : 'https://www.google.com/jsapi',  
		   dataType: 'script',
		   success: function(){
		   		jQuery('.aa_waiting_for_ggraph_load').each(function() { this.LoadGraph();});
		 	}
	   });
}
function aa_generic_graph(data,profile,context)
{
	   var graph = {
		   isObject: true,
		   Packages: ["corechart"],
		   Params: {
				width: aa_int(data,profile,'FrameWidth',context), 
				height: aa_int(data,profile,'FrameHeight',context), 
				title: aa_text(data,profile,'Title',context),
				isStacked: aa_bool(data,profile,'Stacked',context),
				legend: aa_text(data,profile,'Legend',context)
				},
		   Class: 'google.visualization.' + aa_text(data,profile,'Type',context),
		   drawChart: function() {
			        var data = new google.visualization.DataTable();
			        this.PrepareGraphData(data);
			        var chart;
			        var out = this.div;
			        var newChart = "new "+this.Class+"(out)"; // should be called without eval
			        try {
			        	chart = eval(newChart);
			        } catch(e) {}
			        chart.draw(data, this.Params);
			        google.visualization.events.addListener(chart, 'select', function(graph) { return function(e) {
			            var selection = this.getSelection();
			            if (!selection) return;
			            if (graph.OnClick)
			            	graph.OnClick(selection);
			        }}(graph));
			}
	   }
	   return graph;
}
function aa_create_graph_div(graph)
{
	   var out = document.createElement('div');
	   out.graph= graph;
	   graph.div = out;
 	   function ChartFactory(div) { return function() 
 	  	   { 
 		   		jQuery(div).removeClass("aa_waiting_for_ggraph_load");
 		   		div.graph.drawChart();
 	  	   }
 	   };

	   if (!window.google)
	   {
		   out.className="aa_waiting_for_ggraph_load";
		   out.LoadGraph = function()
		   {
			   google.load("visualization", "1", {packages:graph.Packages, callback: ChartFactory(this)});
		   }
		   aa_load_googlegraph();
	   }
	   else
	   {
		   google.load("visualization", "1", {packages:graph.Packages, callback: ChartFactory(out)});
	   }
	   return out;
}

// fusion charts
ajaxart.gcs.fusion_chart =
{
	FusionChart: function (profile,data,context)
	{
	   function load(out)
	   {
		   var xml = ajaxart.runNativeHelper(out.Items,profile,'GraphXml',aa_ctx(context,{ChartId: [out.getAttribute('id')], Items: out.Items}));
		   var swf = '/ajaxart/lib/chart/charts_library/FCF_' + (aa_bool(data,profile,'Stacked',context) ? 'Stacked' : 'MS') + aa_text(data,profile,'Type',context) + ".swf";
		   var myChart = new FusionCharts(swf, "myChartId", aa_text(data,profile,'Width',context), aa_text(data,profile,'Height',context)); 
		   var xmlAsText = ajaxart.xml2text(xml);
		   myChart.setDataXML(xmlAsText);
		   myChart.render(out);
	   }

	   if (! window.aa_FusionChartId) aa_FusionChartId =0;
	   aa_FusionChartId++;
	   var out = document.createElement('div');
	   out.setAttribute('id','aa_fusion_chart_' + aa_FusionChartId);
	   var items = out.Items = aa_items(context.vars._Cntr[0]);
	   
	   out.Profile = profile;
	   out.Context = context;
	   
	   // add index to items
	   for(var i=0;i<items.length;i++)
		   items[i].__Index = i;

	   if (!window.infosoftglobal)
	   {
		   out.className="aa_waiting_for_fusion_chart_load";
		   out.LoadGraph = function() 
		   {
			   load(this);
		   }
		   aa_load_fusion_chart();
	   }
	   else
		   load(out);

	   return [out];
	}
}

function aa_fusion_eventHandler(chartId,labelField,amountFieldId,index)
{
	var out = jQuery().find('#' + chartId)[0];
	if (!out) return;
	var item = out.Items[parseInt(index)+1];
	ajaxart.run([item],out.Profile,'OnClick',out.Context);
}
function aa_load_fusion_chart() {
	if (window.loading_fusion_chart) return;
	   window.loading_fusion_chart = true;
	   jQuery.ajax({
		   url: 'lib/chart/charts_library/FusionCharts.js', 
		   dataType: 'script',
		   success: function(){
		   		jQuery('.aa_waiting_for_fusion_chart_load').each(function() { this.LoadGraph();});
		 	}
	   });
}




aa_gcs("operation", {
  RunActionInJavascript: function(profile, data, context) {
    var result = aa_apply_style_js(data,{
      Javascript: aa_text(data,profile,'Code',context)
    },context,'run');
    return aa_isArray(result) ? result : [];
  },
  RunInOperationContext: function (profile,data,context)
    {
      var jElem = $(context.vars.ControlElement);
      var itemElem = null;
      while (jElem.length > 0) {
        if (jElem.hasClass('aa_item') && !itemElem) itemElem = jElem[0];
        if (jElem.hasClass('aa_layoutgroup') ) itemElem = null; // try the next one
        if (jElem.hasClass('aa_container') && itemElem ) break; // all found
        
        jElem = jElem.parent();
      }
      if (itemElem == null) var ctx = context;
      else var ctx = aa_ctx(context,{_ElemsOfOperation: [itemElem] , _ItemsOfOperation: itemElem.ItemData , _Items: context.vars._Cntr[0].Items });
      
      return ajaxart.run(data,profile,'Action',ctx);
    },
    OpenSecondaryItemDetails: function (profile,data,context)
    {
      var dataitems = context.vars._Cntr[0].Items[0];
      var newContext = aa_ctx(context,{ _Transactional: ajaxart.run(data,profile,'Transactional',context), 
        _InnerItem: context.vars._ItemsOfOperation });
      var subset = newContext.vars._InnerItems = aa_runMethod(data,dataitems,'Subset',newContext);
      if (subset.length == 0) {
        var subsetObj = { isObject: true , Items: newContext.vars._InnerItem };
        subsetObj.Save = function(data1,ctx) {
          var info = aa_getXmlInfo(this.Items[0],context);
          if (info.Save) return info.Save(data1,ctx);
        }
        subset = newContext.vars._InnerItems = [subsetObj];
      }
      if (subset.length == 0) return []; 
      if (aa_bool(data,profile,'ReadOnly',context))
        subset[0].ReadOnly = ["true"];

      var openCtrl_func = function(subset) { return function() 
      {
        var cntr = context.vars._Cntr[0];
        var item = [subset.Items[0]];
        ajaxart.run(item,profile,'ChangeItemBeforeOpen',context);
        var page_params = {isObject:true, DataItems: subset};
        var newContext = aa_ctx(context,{ _InnerItems: [subset], _PageParams: [page_params], _Transactional: ajaxart.run(data,profile,'Transactional',context) });
        var page = aa_first(item,profile,'ItemPage',context);
        var itemDetailsObj = { isObject: true }

        var info = aa_getXmlInfo(subset.Items[0],context);
        if (info && info.PrepareForEdit) info.PrepareForEdit([],newContext);
        
        aa_init_itemdetails_object(itemDetailsObj,item,info,subset,page,context);
        newContext.vars._ItemDetailsObject = [ itemDetailsObj ];
        newContext.vars.DetailsControl = aa_runMethod(item,page,'Control',newContext);
        newContext.vars.ItemPage = [page];
        
        return ajaxart.run(item,profile,'OpenIn',newContext);
      }};
      
      ajaxart_RunAsync(data,subset[0].Prepare,context, openCtrl_func(subset[0]));
      return ["true"];
    },
    RunOperationFromParent: function (profile,data,context)
    {
      var parentCntr = context.vars._ItemDetailsObject[0].ParentCntr;
      var opid = aa_text(data,profile,'Operation',context);
      var ops = aa_runMethod([],parentCntr,'Operations',context)
      var op = aad_object_byid(ops,opid);
      if (op != null) {
        var newContext = aa_ctx(context,{_ElemsOfOperation: context.vars._ItemDetailsObject[0].ElemsOfOperation , _Cntr: [parentCntr]});
        aa_runMethod(data,op,'Action',newContext);
      }
    },
    ChangeTab: function (profile,data,context)
    {
      var moveto = aa_text(data,profile,'MoveTo',context);
      var movetotab = aa_text(data,profile,'TabToMoveTo',context);
      var tabcontrol = aa_text(data,profile,'TabControl',context);
      var animation = aa_first(data,profile,'Animation',context);
      
      // new tab control
      var controlElement = aa_var_first(context,'ControlElement');
      var root = (controlElement && (ajaxart.isattached(controlElement) || aa_intest) ) ? ajaxart.xml.root(controlElement) : document.body;
      var tabcontrols = $(root).find('.aa_tabcontrol').get();
      if (!tabcontrols[0] && root != document.body) tabcontrols = $('body').find('.aa_tabcontrol').get();
      var closestTab = (controlElement && (ajaxart.isattached(controlElement) || aa_intest) ) ? $(controlElement).closest('.aa_tabcontrol.fld_'+tabcontrol) : $([]);
      if (closestTab[0]) tabcontrols.unshift(closestTab[0]);
       
      for(var i=0;i<tabcontrols.length;i++) { 
        var tabID = '';
        if (tabcontrols[i].Field) tabID = tabcontrols[i].Field.Id || aa_totext(tabcontrols[i].Field.ID);
        if (tabcontrols[i].Cntr) tabID = aa_totext(tabcontrols[i].Cntr.ID); 
        if (tabID == tabcontrol) {
          if (tabcontrols[i].jbChangeTab) {
            tabcontrols[i].jbChangeTab(moveto,movetotab);
            return;
          }
          if (tabcontrols[i].jbContext)
            if (tabcontrols[i].jbContext.vars._AppContext[0] != context.vars._AppContext[0]) continue;
          
          var tabs = tabcontrols[i].TabControl.Tabs;
          if (tabcontrols[i].RefreshTabsHead)
            tabcontrols[i].RefreshTabsHead();
          if (moveto == 'specific tab') {
            for(var j=0;j<tabs.length;j++)
              if (tabs[j].Field.Id == movetotab) { 
                if (tabs[j].Select) tabs[j].Select(null,animation);
                else if (tabs[j].onmousedown) tabs[j].onmousedown(); 
                return; 
              }
          } else {
            var selected = $(tabs).filter('.aa_selected_tab')[0];
            if (moveto == "refresh current tab") selected.Select(null,animation);
            if (moveto == "next tab" && selected.nextSibling) selected.nextSibling.Select(null,animation);
            if (moveto == "previous tab" && selected.previousSibling) selected.previousSibling.Select(null,animation);
          } 
          return;
        }
      }
      return;
    },
    Copy: function (profile,data,context)
    {
      var op = { isObject : true, isOperation : true };
      op.Id = aa_text(data,profile,'Copy',context);
      
      var copy = function(data1,ctx)
      {
        var cntr = ctx.vars._Cntr[0]; 
        var selected = ctx.vars._ItemsOfOperation;
        if (selected.length > 0)
        {
          document.aa_clipboard = selected[0];
          document.aa_cut = false;
        }
        return [];
      };

      ajaxart_addScriptParam_js(op,'Action',copy ,context);

      op.Shortcut = aa_text(data,profile,'Shortcut',context);
      aa_addMethod(op,'Icon',profile,'Icon',context);
      aa_addMethod(op,'Title',profile,'Title',context);
      op.Disabled = function(data1,ctx) { return aa_bool(data1,profile,'Disabled',aa_merge_ctx(context,ctx)) };

      var newContext = aa_ctx(context,{_Operation: [op]} );
      ajaxart.runsubprofiles(data,profile,'Aspect',newContext);

      return [op];
    },
    Cut: function (profile,data,context)
    {
      var op = { isObject : true, isOperation : true };
      op.Id = aa_text(data,profile,'Cut',context);
      
      var cut = function(data1,ctx)
      {
        var cntr = ctx.vars._Cntr[0]; 
        var selected = ctx.vars._ItemsOfOperation;
        if (selected.length > 0)
        {
          document.aa_clipboard = selected[0];
          document.aa_cut = true;
        }
        return [];
      };
      ajaxart_addScriptParam_js(op,'Action',cut ,context);

      op.Shortcut = aa_text(data,profile,'Shortcut',context);
      aa_addMethod(op,'Icon',profile,'Icon',context);
      aa_addMethod(op,'Title',profile,'Title',context);
      op.Disabled = function(data1,ctx) { return aa_bool(data1,profile,'Disabled',aa_merge_ctx(context,ctx)); };

      var newContext = aa_ctx(context,{_Operation: [op]} );
      ajaxart.runsubprofiles(data,profile,'Aspect',newContext);
      
      return [op];
    },
    Paste: function (profile,data,context)
    {
      var op = { isObject : true, isOperation : true };
      op.Id = aa_text(data,profile,'Paste',context);
      
      var paste = function(data1,ctx)
      {
        var cntr = ctx.vars._Cntr[0]; 
        var selected = ctx.vars._ItemsOfOperation;
        if (selected.length > 0)
        {
          var newcontext = aa_ctx(context,{Clipboard: document.aa_clipboard} );
          ajaxart.run(selected,profile,document.aa_cut ? 'CutPasteAction' : 'CopyPasteAction',newcontext);
        }
        return [];
      };
      ajaxart_addScriptParam_js(op,'Action',paste ,context);

      op.Shortcut = aa_text(data,profile,'Shortcut',context);
      aa_addMethod(op,'Icon',profile,'Icon',context);
      aa_addMethod(op,'Title',profile,'Title',context);
      op.Disabled = function(data1,ctx) { return aa_bool(data1,profile,'Disabled',aa_merge_ctx(context,ctx)) };

      var newContext = aa_ctx(context,{_Operation: [op]} );
      ajaxart.runsubprofiles(data,profile,'Aspect',newContext);

      return [op];
    },
    ContextMenu: function (profile,data,context)
    {
      var menu = { isObject : true,  Items : [], IncludeOperationsFromParent: true };
      menu.Presentation = function(data1, ctx) { return aa_run_component("ui.ButtonAsHyperlink",data1,ctx); };
      var cntr = context.vars._Cntr[0];
      var newContext = aa_ctx(context,{_Menu: [menu], _ElemsOfOperation: cntr.ElemsOfOperation() , _ItemsOfOperation: cntr.ItemsOfOperation() } );
      var aspects = ajaxart.runsubprofiles(data,profile,'MenuAspect',newContext);
      for(var i=0;i<aspects.length;i++)
        if (aspects[i].addOperations) aspects[i].addOperations();
      
      return [menu];
    },
    OperationsByIDs: function (profile,data,context)
    {
      return [{ isObject: true, addOperations: function()
        {
      var menu = context.vars._Menu[0];
      var cntr = context.vars._Cntr[0];
      var operations = aa_text(data,profile,'OperationIDs',context).split(',');
      var result = [];
      for(var i=0;i<operations.length;i++)
      {
        op = aad_object_byid(menu.Items,operations[i]); 
        if (op != null)
          result.push(op);
      }

      menu.Items = result;
      return [];
      }}];
    },
    Validate: function (profile,data,context)
    {
      var groupID = aa_text(data,profile,'Group',context);
      var controls = [];
      
        var top = aa_intest ? aa_intest_topControl : document;
      var controls = groupID ? $(top).find('.fld_'+groupID).get() : [];
      
      for(var i=0;i<controls.length;i++) {
        if (!aa_passing_validations(controls[i])) return;
      }
      
      return ajaxart.run(data,profile,'WhenValid',context);
    },
    IncludeItemOperationsFromParent: function (profile,data,context)
    {
      var menu = context.vars._Menu[0];
      menu.IncludeOperationsFromParent = aa_bool(data,profile,'Include',context);
      return [];
    },
    Presentation: function (profile,data,context)
    {
      var menu = context.vars._Menu[0];
      aa_addMethod(menu,'Presentation',profile,'Style',context);
      return [];
    },
    ExportItemlistTableToExcel: function (profile,data,context)
    {
      var control = aa_find_field_controls({ fieldID: aa_text(data,profile,'Itemlist',context) , context: context })[0];
      if (!control || !control.jbItemList) return;
      var itemlist = control.jbItemList;
      
      var csv='';

      var fields = itemlist.VisibleFields;
      for(var i=0;i<fields.length;i++) {
        var title = aa_fieldTitle(fields[i],itemlist.InputData,itemlist.Context);
        csv += fixCsvCell(title);
        if (i < fields.length-1) csv += ',';
      }

      var items = itemlist.itemlistCntr.Items;
      for(var i=0;i<items.length;i++) {
        csv += '\n';
        for (var j=0; j<fields.length; j++) {
          var item = [items[i]];
          var cell = $('<td/>')[0];
          itemlist.CreateFieldControl(item,cell,fields[j],i+1);
          var val = $(cell).text();
          csv += fixCsvCell(val);

          if (j < fields.length-1) csv += ',';
        }
      }

      var fileName = aa_text(data,profile,'FileName',context);
      // var url = aa_text(data,profile,'ServerBaseUrl','context') + '&fileName=' + encodeURIComponent(fileName);
      // url += '&fileData=' + encodeURIComponent(csv) + '&_' + new Date().getTime();

      // var $link = $('<a/>').attr('href',url).attr('target','_new').attr('download',fileName);
      // $link[0].click();

      var url = aa_text(data,profile,'ServerBaseUrl','context');
      var $form = $('<form />').attr('action',url).attr('method','post').attr('target','_new');
      $('<input/>').attr('type','hidden').attr('name','fileData').val(csv).attr('value',csv).appendTo($form);
      $('<input/>').attr('type','hidden').attr('name','fileName').val(fileName).attr('value',fileName).appendTo($form);
      $form[0].submit();

      function fixCsvCell(cell) {
        if (cell.indexOf(',') > -1)
          return '"'+cell.replace(/"/,'""')+'"';
        return cell;
      }
    },
    Search: function(profile,data,context)
    {
      var cntr = (context.vars.HeaderFooterCntr || context.vars._Cntr)[0];
      if (cntr == null) return;
      
      aa_recalc_filters_and_refresh(cntr,context.vars._Item,context);
      var pagesToRefresh = aa_text(data,profile,'MorePagesToRefresh',context).split(',');
      for(var i in pagesToRefresh)
      {
        var page = pagesToRefresh[i];
        var top = aa_intest ? $(cntr.Ctrl).parents().slice(-1) : $();
        var cntr_ctrl = top.find('.aa_container').filter(function() { return this.Cntr.ID[0] == page })[0];
        if (cntr_ctrl)
        {
          var target_cntr = cntr_ctrl.Cntr; 
          target_cntr.FilteredWrappers = cntr.FilteredWrappers;
          aa_refresh_itemlist(target_cntr,context);
        }
      }
      return [];
    },
    RunJavascript :function(profile,data,context)
    {
      aa_run_js_code(aa_text(data,profile,'Code',context),data,context);
      return [];
    }
});


aa_gcs("action",{
  Validate: function(profile,data,context) {
    var groupID = aa_text(data,profile,'Group',context);
    var controls = [];
    
    var top = aa_intest ? aa_intest_topControl : document;
    var control = groupID ? $(top).find('.fld_'+groupID)[0] : null;
    if (!control) return;

    if (!aa_checkValidations(control)) {
      ajaxart.run(data,profile,'WhenError',context);
      return;
    }

    return ajaxart.run(data,profile,'WhenValid',context);
  }
});
// TODO: make it all function aa_suggestbox_...
ajaxart.suggestbox = {};
ajaxart.contextWithControlToRunOn = function(context,control) {
	  var newContext = ajaxart.clone_context(context);
	  newContext.vars['ControlElement'] = control;
	  return newContext;
	}

ajaxart.suggestbox.attachToTextbox = function(data,profile,context,textbox)
{
  if (data.length == 0) return ;
	  
  ajaxart.suggestbox.setTextBoxValue(data,profile,context,textbox);
  var max = aa_text(data,profile,'MaxItems',context);
  
  jQuery(textbox).addClass('suggestion_box_input');
  
  jQuery(textbox).blur(function(e) {
	  var element = (typeof(e.target)== 'undefined')? e.srcElement : e.target;
	  if (jQuery(element).parents(".suggestionpopup").length > 0 )	// event from the popup
		  return;
//	  ajaxart.suggestbox.setValue(data,profile,context,textbox,false);
	  setTimeout(function() { 
		  ajaxart.suggestbox.setValue(data,profile,context,textbox,false);
	  },300);
  });

  jQuery(textbox).click(function(e) {
	  if (this.value == "")
		  ajaxart.suggestbox.openPopup(data,profile,context,textbox,true);
  });

  jQuery(textbox).focus(function(e) {
	  if (this.value == "") {
		  var options = ajaxart.run(data,profile,'Options',context);
		  if (options.length > 0 && options.length <= max)
			  ajaxart.suggestbox.openPopup(data,profile,context,textbox,true);
	  }
  });
  
  jQuery(textbox).keydown(function(e) {
	  if (e.keyCode == 27) {
		  if ( ajaxart.suggestbox.isPopupOpen()  ) {
			  jQuery(ajaxart.ui.suggestBoxPopup).hide();
			  ajaxart_stop_event_propogation(e);
		  }
	  }
	  if (e.keyCode == 13 && ajaxart.suggestbox.isPopupOpen())
		  ajaxart_stop_event_propogation(e);
  });
  jQuery(textbox).keyup(function(e) {
	  if (e.keyCode == 27) {
		  if ( ajaxart.suggestbox.isPopupOpen()  )
			  ajaxart_stop_event_propogation(e);
		  return;
	  }
	  if (e.keyCode == 9) {
		  ajaxart_stop_event_propogation(e);
		  return;
	  }
	  if (e.keyCode == 13 ) {
		  if (ajaxart.suggestbox.isPopupOpen()) {
			  ajaxart.suggestbox.setValue(data,profile,context,textbox,true);
			  ajaxart_stop_event_propogation(e);
		  }
		  return;
	  }
	  if (e.keyCode == 38 || e.keyCode == 40) { // arrows up/down
		  var jSelected = jQuery(ajaxart.ui.suggestBoxPopup).find('.selected:visible');
		  if (jSelected.length == 0) {
			  if (ajaxart.ui.suggestBoxPopup.allowTextNotInOptions) {
				  var items = jQuery(ajaxart.ui.suggestBoxPopup).find('.suggestion_item');
				  if (items.length > 0) jQuery(items[0]).addClass('selected');
			  }
			  return;
		  }
		  var nextItem = null;
		  if (e.keyCode == 38) {
			  nextItem = jSelected[0].previousSibling;
			  while (nextItem != null && nextItem.style.display == 'none')
				  nextItem = nextItem.previousSibling;
		  }
		  if (e.keyCode == 40) { 
			  nextItem = jSelected[0].nextSibling;
			  while (nextItem != null && nextItem.style.display == 'none')
				  nextItem = nextItem.nextSibling;
		  }
		  if (nextItem != null) {
			  jSelected.removeClass('selected');
			  jQuery(nextItem).addClass('selected');
		  }
		  return;
	  }
	  ajaxart.suggestbox.openPopup(data,profile,context,textbox,false);
  });
}
ajaxart.suggestbox.setValue = function(data,profile,context,textbox,clickOnSelected)
{
	  var allowNotInCombo = aa_bool(data,profile,'AllowTextNotInOptions',context);
	  if (ajaxart.ui.suggestBoxPopupInput != textbox) return;
	  
	  var jPopup = jQuery(ajaxart.ui.suggestBoxPopup);
	  var sel = jPopup.find('.selected:visible');
	  if (sel.length > 0 && sel[0].ajaxart_menu != null && clickOnSelected) {
		  var newContext = ajaxart.clone_context(context);
		  newContext.vars['ControlElement'] = [textbox];
		  newContext.vars['SuggestionBoxText'] = [ textbox.value ];
		  ajaxart.run_xtml_object(data,sel[0].ajaxart_menu['Action'],newContext);
		  return;
	  }
	  var newval = "";
	  if (allowNotInCombo) newval = textbox.value;
	  if (sel.length > 0 && sel[0].ajaxart_menu == null)
		  var newval = sel[0].ajaxart_value;
	  
	  if (textbox.value == "" && !clickOnSelected)
		  newval = "";
	  
	  if (sel.length == 0 && !allowNotInCombo && !clickOnSelected) {
		  ajaxart.suggestbox.setTextBoxValue(data,profile,context,textbox);
		  return;
	  } else if (allowNotInCombo && !clickOnSelected) 
		  newval = textbox.value;
	  else 
		  ajaxart.suggestbox.setTextBoxValue([newval],profile,context,textbox);
	  
	  ajaxart.writevalue(data,[newval]);
	  ajaxart.run(data,profile,'OnUpdate',ajaxart.contextWithControlToRunOn(context,[textbox]));
	  
	  jPopup.hide();
}
ajaxart.suggestbox.setTextBoxValue = function(value,profile,context,textbox)
{
  jQuery(textbox).removeClass('suggetion_text_for_empty');
  
  var label = aa_text(value,profile,'OptionLabelInTextbox',context);
  if (label == "") label = ajaxart.totext(value);
  if (label == "") { 
	  label = aa_text(value,profile,'TextForEmpty',context);
	  if (label != "")
		  jQuery(textbox).addClass('suggetion_text_for_empty');
  }
  if (label.indexOf('_') == 0)
	  label = label.substring(1);
  textbox.value = label;
}
ajaxart.suggestbox.openPopup = function(data,profile,context,textbox,showAll)
{
	  var max =  aa_text(data,profile,'MaxItems',context);

	  var searchAnywhere = true; //aa_bool(value,profile,'SearchAnywhere',context);
	  if (ajaxart.ui.suggestBoxPopupInput != textbox) {
		  var popup = ajaxart.ui.suggestBoxPopup;
		  if(popup != null && popup.parentNode != null)
			  aa_remove(popup,true);
		  
		  ajaxart.ui.suggestBoxPopup = document.createElement('div');
		  jQuery(ajaxart.ui.suggestBoxPopup).addClass('aapopup suggestionpopup');
		  var hasDescription = true, hasImage = true, hasOptionText = false;
		  if (profile.getAttribute('OptionLabel') != null || aa_xpath(profile,'OptionLabel').length > 0)
			  hasOptionText = true;
		  
		  var optionDivs = [];
		  var options = ajaxart.run(data,profile,'Options',context);
		  var hasMore = false;
		  
		  for(var i=0;i<options.length;i++) {
			  var option = options[i];
			  var optionText = "";
			  if (hasOptionText)
				  optionText = aa_text([option],profile,'OptionLabel',context); 
			    else optionText = ajaxart.totext(option);
			  
			  var optionDescription = "",optionImage="";
			  if (hasDescription) optionDescription = aa_text([option],profile,'OptionDescription',context);
			  if (hasImage) optionImage = aa_text([option],profile,'OptionImage',context);
			  
			  var itemDiv = document.createElement('div');
			  jQuery(itemDiv).addClass('suggestion_item');
			  itemDiv.ajaxart_value = option;
			  itemDiv.ajaxart_text = optionText.toLowerCase();
			  var itemText = document.createElement('div'); itemText.innerHTML = optionText; itemDiv.appendChild(itemText);
			  if (hasImage) {
				  itemText.style.backgroundImage = 'url(' + optionImage + ')';
				  jQuery(itemText).addClass('suggestion_withimage');
			  }
			  if (optionDescription != null) {
				  var itemDescDiv = document.createElement('div'); jQuery(itemDescDiv).addClass('suggestion_description'); itemDescDiv.innerHTML = optionDescription; itemDiv.appendChild(itemDescDiv);
			  }
			  ajaxart.ui.suggestBoxPopup.appendChild(itemDiv);
			  optionDivs.push(itemDiv);
			  if (i >= max) { itemDiv.style.display = 'none'; hasMore = true; }
		  }
		  ajaxart.ui.suggestBoxPopup.aaitems = optionDivs;	  
		  
		  var moreDiv = jQuery('<div class="suggestion_item suggestion_menuitem suggestion_more">more</div>')[0];
		  ajaxart.ui.suggestBoxPopup.appendChild(moreDiv);
		  ajaxart.ui.suggestBoxPopup.aamore = moreDiv;
		  
		  ajaxart.ui.suggestBoxPopup.aamore.style.display = (hasMore) ? 'block' : 'none';
		  
		  var menuItems = ajaxart.runsubprofiles(data,profile,'AdditionalMenuItem',context);
		  for(var i=0;i<menuItems.length;i++) {
			  var itemDiv = document.createElement('div');
			  jQuery(itemDiv).addClass('suggestion_item suggestion_menuitem');
			  itemDiv.ajaxart_menu = menuItems[i];
			  var itemText = document.createElement('div'); itemText.innerHTML = ajaxart.totext(itemDiv.ajaxart_menu['Text']); itemDiv.appendChild(itemText);
			  var itemImage = itemDiv.ajaxart_menu['Image'];
			  if (itemImage != null && itemImage != "") {
				  itemText.style.backgroundImage = 'url(' + itemImage + ')';
				  jQuery(itemText).addClass('suggestion_withimage');
			  }
			  ajaxart.ui.suggestBoxPopup.appendChild(itemDiv);
			  ajaxart.ui.suggestBoxPopup.aaitems.push(itemDiv);
		  }

		  ajaxart.ui.suggestBoxPopup.allowTextNotInOptions = aa_bool(data,profile,'AllowTextNotInOptions',context);
		  
		  jQuery(ajaxart.ui.suggestBoxPopup.aaitems).hover(
				    function() { jQuery(this.parentNode).find('.selected:visible').removeClass('selected'); jQuery(this).addClass('selected'); },
				    function() {}
		  );

		  ajaxart.ui.suggestBoxPopupInput = textbox;
		  
		  jQuery(ajaxart.ui.suggestBoxPopup).click(function(event) {
			  var element = (typeof(event.target)== 'undefined')? event.srcElement : event.target;
			  if (!jQuery(element.parentNode).hasClass("suggestion_item") || jQuery(element.parentNode).hasClass("suggestion_more"))
				  return;
			  var jPopup = jQuery(ajaxart.ui.suggestBoxPopup);
			  jPopup.find('.selected').removeClass('selected');
			  jQuery(element).parent().addClass('selected');
			  ajaxart.suggestbox.setValue(data,profile,context,textbox,true);
		  });
		  
		  jQuery('body').append(jQuery(ajaxart.ui.suggestBoxPopup));
	  }
	  var jPopup = jQuery(ajaxart.ui.suggestBoxPopup);
//	  var left = aa_absLeft(textbox);
//	  var top = aa_absTop(textbox) + jQuery(textbox).height()+5;
	  
	  jQuery(ajaxart.ui.suggestBoxPopup).width(jQuery(textbox).width()-5);
	  ajaxart.ui.suggestBoxPopup.style.display = 'block';
	  ajaxart.dialog.positionPopup(jQuery(ajaxart.ui.suggestBoxPopup), textbox);

//	  var width = jQuery(textbox).width()-5;
//	  jPopup.css("left",left).css('top',top).css('min-width',""+width+"px").find('.selected').removeClass('selected');
	  var text = textbox.value.toLowerCase();
	  var count=0; var items = ajaxart.ui.suggestBoxPopup.aaitems; var hasSelected=false; var hasMore = false;
	  if ( ajaxart.ui.suggestBoxPopup.allowTextNotInOptions ) hasSelected = true;
	  
	  for(var i=0;i<items.length;i++) {
		  if (items[i].ajaxart_menu != null) { if (! hasSelected) { jQuery(items[i]).addClass('selected'); hasSelected=true;} continue;  }
		  if (count >=max) { items[i].style.display = 'none'; hasMore = true; }
		  else {
			  var found_at = items[i].ajaxart_text.indexOf(text);
			  var found = (searchAnywhere && found_at != -1) || (!searchAnywhere && found_at == 0);
			  if (!showAll && !found ) items[i].style.display = 'none';
			  else {
				  items[i].style.display = 'block';
				  count++;
				  if (! hasSelected) { jQuery(items[i]).addClass('selected'); hasSelected=true;}
				  else
					  jQuery(items[i]).removeClass('selected');
			  }
		  }
	  }
	  ajaxart.ui.suggestBoxPopup.aamore.style.display = (hasMore) ? 'block' : 'none';
	  if (count == 0)
		  ajaxart.suggestbox.closePopup();
}
ajaxart.suggestbox.closePopup = function()
{
	jQuery(ajaxart.ui.suggestBoxPopup).hide();
}
ajaxart.suggestbox.isPopupOpen = function()
{
	return (ajaxart.ui.suggestBoxPopup != null && jQuery(ajaxart.ui.suggestBoxPopup).css("display") == 'block');
}
ajaxart.customsuggestbox = {};
ajaxart.customsuggestbox.init = function(field,data,profile,context)
{
	aa_field_handler(field,'ModifyControl', function(cell,field_data,cell_presentation,ctx,item) {
		if (ajaxart_field_is_readOnly(ctx.vars._Cntr[0],cell.Field,ctx)) return; 
		var input = jQuery(cell).find('.field_control')[0];
		  input["profile"] = profile;
		  input["context"] = context;
		  input["data"] = field_data;
		  jQuery(input).keypress(function(e) {
			  if (e.charCode == 32 && e.ctrlKey) { // ctrl + space
				  ajaxart.run(data,profile,'OnCtrlSpace',ajaxart.ui.contextWithCurrentControl(context, this)); 
				  return false;
			  }
			  return true;
		  });
		  // dirty
		  jQuery(input).focus(function(e) {
			  if (ajaxart.getVariable(context,"_Context").length == 0 && input["context_calculated"] == null) {
				  var obj = ajaxart.getVariable(context,"_XtmlDt");
				  if (obj == null || obj.length == 0) return;
				  var scriptParam = obj[0]["Context"];
				  ajaxart.setVariable(context,"_Context", ajaxart.runScriptParam(data,scriptParam,aa_ctx(context,{_FieldData: field_data})) );
				  input["context_calculated"] = true;
			  }
		  });
		  jQuery(input).change(function(e) {
			  var prev_value = ajaxart.totext(data);
			  ajaxart.writevalue(data,this.value);
			  ajaxart.run(data,profile,'OnUpdate',ajaxart.ui.contextWithCurrentControl(context, this));
		  });
	});
	aa_field_handler(field,'OnKeydown',function(field,field_data,input,e) {
		  if (e.keyCode == 27) { //escape
			  if ( ajaxart.suggestbox.isPopupOpen()  ) {
				  jQuery(ajaxart.ui.suggestBoxPopup).hide();
				  ajaxart_stop_event_propogation(e);
			  }
		  }
		  if (e.keyCode == 13 && ajaxart.suggestbox.isPopupOpen())
			  ajaxart_stop_event_propogation(e);
	  });
	aa_field_handler(field,'OnKeyup',function(field,field_data,input,e) {
		  if (e.keyCode == 27) {
			  if ( ajaxart.suggestbox.isPopupOpen()  )
				  ajaxart_stop_event_propogation(e);
			  return;
		  }
		  if (e.keyCode == 13) { //enter
			  if ( ajaxart.suggestbox.isPopupOpen()  ) {
				  var selected = jQuery(ajaxart.ui.suggestBoxPopup).find('.selected:visible');
				  if (selected.length > 0) {
					  jQuery(ajaxart.ui.suggestBoxPopup).hide();
					  var textToAdd = selected[0].ajaxart_text;
					  if (input.openedWithTrigger)
					  	  textToAdd = aa_text( [textToAdd], input.triggerProfile, "TextPatternToAdd", input.triggerContext );
					  input.value = input.value + textToAdd;
					  ajaxart.writevalue(field_data,input.value);
					  aa_runMethod([selected[0].ajaxart_value],ajaxart.ui.suggestBoxPopup,"OnSelect",context);
					  input["openedWithTrigger"] = false;
					  ajaxart.run(field_data,profile,'OnAfterTextAdded',ajaxart.ui.contextWithCurrentControl(context, input) );
					  ajaxart.run(field_data,profile,'OnUpdate',ajaxart.ui.contextWithCurrentControl(context, input) );
					  ajaxart_stop_event_propogation(e);
				  }
			  }
			  return;
		  }
		  var prev_value = ajaxart.totext(field_data);
		  ajaxart.writevalue(field_data,input.value);
		  if (prev_value != input.value)
			  ajaxart.run(field_data,profile,'OnUpdate',ajaxart.ui.contextWithCurrentControl(context, input));
		  var lastChar = "";
		  if (e.keyCode == 9)
			  ajaxart_stop_event_propogation(e);
		  else if (e.keyCode == 38 || e.keyCode == 40) { // arrows up/down
			  var jSelected = jQuery(ajaxart.ui.suggestBoxPopup).find('.selected:visible');
			  var nextItem = null;
			  if (e.keyCode == 38)  // up
				  nextItem = jSelected[0].previousSibling;
			  if (e.keyCode == 40)  // arrow down
				  nextItem = jSelected[0].nextSibling;
			  if (nextItem != null) {
				  jSelected.removeClass('selected');
				  jQuery(nextItem).addClass('selected');
			  }
			  ajaxart_stop_event_propogation(e);
		  }
		  else {
			  if (prev_value != input.value && ajaxart.ui.suggestBoxPopup != null) // not for non-function keys like shift
				  jQuery(ajaxart.ui.suggestBoxPopup).hide();
			  var selEnd = input.selectionEnd;
//			  if ((input.value.length == prev_value.length+1 && prev_value == input.value.substring(0,input.value.length-1)) ||  
//					  (input.value.length == prev_value.length-1 && input.value == prev_value.substring(0,prev_value.length-1)) ) {// todo: fix
			  if ( selEnd == null || selEnd == input.value.length ) {	// at end of text or IE and 
				  if (!(e.keyCode == 32 && e.ctrlKey) && e.keyCode != 17 && e.keyCode != 16)  {// not clicking Ctrl+Space or loosing the Ctrl
					  input["openedWithTrigger"] = false;
					  ajaxart.run(field_data,profile,'OnChangeAtEndOfText',ajaxart.ui.contextWithCurrentControl(context,input) );
				  }
			  }
		  }
	  });
}
ajaxart.customsuggestbox.openSuggestionBoxList = function(profile,data,context)
{
	var textbox = ajaxart.getControlElement(context,true);
	if (textbox == null) return [];
	
	  var popup = document.createElement('table');
	  popup.setAttribute("cellpadding","0");
	  popup.setAttribute("cellspacing","0");
	  var halfWrittenPart = aa_text(data,profile,'HalfWrittenPart',context);
	  var halfWrittenAlwaysOnStart = aa_bool(data,profile,'HalfWrittenAlwaysOnStart',context);
	  var filterItemsDifferantThanHalfWrittern = aa_bool(data,profile,'FilterItemsDifferantThanHalfWrittern',context);
	  var halfWrittenPartLower = halfWrittenPart.toLowerCase();
	  aa_addMethod(popup,"OnSelect",profile,"OnSelect",context);
	  var label_compiled = ajaxart.compile(profile,'OptionLabel',context);
	  
	  var options = ajaxart.run(data,profile,'Options',context);
	  var empty = true;
	  for(var i=0;i<options.length;i++) {
		  var option = options[i];
		  var optionText = ajaxart_runcompiled_text(label_compiled, [option], profile, "OptionLabel" ,context);
		  if (optionText.indexOf('__') == 0) continue;
		  if (halfWrittenPart != "" && optionText.indexOf(halfWrittenPart) != 0 && halfWrittenAlwaysOnStart) continue;
		  if (filterItemsDifferantThanHalfWrittern && halfWrittenPart != "" && optionText.toLowerCase().indexOf(halfWrittenPartLower) == -1) continue;
		  if (filterItemsDifferantThanHalfWrittern && halfWrittenPart != "" && optionText.length == halfWrittenPart.length) continue;
		  var optionDescription = aa_text([option],profile,'OptionDescription',context);
		  var optionImage = aa_text([option],profile,'OptionImage',context);
		  var itemDiv = document.createElement('tr');
		  jQuery(itemDiv).addClass('suggestion_item');
		  if (empty) {
			  empty = false;
			  jQuery(itemDiv).addClass('selected');
		  }
		  itemDiv.ajaxart_value = option;
		  itemDiv["ajaxart_text"] = optionText;
		  var td =  document.createElement('td'); itemDiv.appendChild(td); //itemDiv.className="suggestion_item";
		  var itemText;
		  if (halfWrittenPart != "" && halfWrittenAlwaysOnStart) {
			  var halfWrittenSpan = document.createElement('span'); halfWrittenSpan.className="half_written"; jQuery(halfWrittenSpan).text(halfWrittenPart); td.appendChild(halfWrittenSpan);
			  var restText = optionText.substring(halfWrittenPart.length);
			  var rest = document.createElement('span'); jQuery(rest).text(restText ); td.appendChild(rest);
			  rest.className = "suggestion_text";
			  itemText = halfWrittenSpan;
			  itemDiv["ajaxart_text"] = restText;
		  } else if (halfWrittenPart != "" && !halfWrittenAlwaysOnStart) {
			  var index = optionText.toLowerCase().indexOf(halfWrittenPartLower);
			  if (index == -1) {itemText = document.createElement('span'); jQuery(itemText).text(optionText); td.appendChild(itemText); itemText.className = "suggestion_text"; }
			  else {
				  var start = document.createElement('span'); jQuery(start).text(optionText.substring(0,index)); td.appendChild(start);
				  var highlighted_text = optionText.substring(index, index+halfWrittenPart.length);
				  var halfWrittenSpan = document.createElement('span'); halfWrittenSpan.className="half_written"; jQuery(halfWrittenSpan).text(highlighted_text); td.appendChild(halfWrittenSpan);
				  var restText = optionText.substring(index+halfWrittenPart.length);
				  var rest = document.createElement('span'); jQuery(rest).text(restText ); td.appendChild(rest);
				  rest.className = "suggestion_text";
				  itemText = start;
				  itemDiv["ajaxart_text"] = restText;
			  }
		  }	else {
			  itemText = document.createElement('span'); jQuery(itemText).text(optionText); td.appendChild(itemText); itemText.className = "suggestion_text";
		  }
		  if (optionImage != null) {
			  itemText.style.backgroundImage = 'url(' + optionImage + ')';
			  jQuery(itemText).addClass('suggestion_withimage');
		  }
		  if (optionDescription != null) {
			  var itemDescDiv = document.createElement('span'); jQuery(itemDescDiv).addClass('suggestion_description');
			  if (optionDescription.length > 30) optionDescription = optionDescription.substring(0,30)+"..."; 
			  ajaxart_set_text(itemDescDiv,optionDescription); itemDiv.appendChild(itemDescDiv);
			  var td =  document.createElement('td'); td.style.width="100%"; td.appendChild(itemDescDiv); itemDiv.appendChild(td);
		  }
		  popup.appendChild(itemDiv);
		  jQuery(itemDiv).hover(
				    function() { jQuery(this.parentNode).find('.selected:visible').removeClass('selected'); jQuery(this).addClass('selected'); },
				    function() {}
		  );
		  jQuery(itemDiv).click(function(event) {
			  var element = (typeof(event.target)== 'undefined') ? event.srcElement : event.target;
			  var parent = jQuery(element).parents(".suggestion_item");
			  if (parent.length == 0) return;
			  var jPopup = jQuery(ajaxart.ui.suggestBoxPopup);
			  jQuery(ajaxart.ui.suggestBoxPopup).hide();
			  var textToAdd = parent[0].ajaxart_text;
			  if (textbox.openedWithTrigger)
			    textToAdd = aa_text( [textToAdd], textbox.triggerProfile, "TextPatternToAdd", textbox.triggerContext );
			  textbox.value = textbox.value + textToAdd;
			  ajaxart.writevalue(ajaxart.ui.suggestBoxPopup.textbox.ajaxart.data,textbox.value);
			  aa_runMethod([parent[0].ajaxart_value],ajaxart.ui.suggestBoxPopup,"OnSelect",context);
			  textbox["openedWithTrigger"] = false;
			  ajaxart.run(textbox.data,textbox.profile,'OnAfterTextAdded', ajaxart.ui.contextWithCurrentControl(textbox.context,textbox) );
			  ajaxart.run(textbox.data,textbox.profile,'OnUpdate', ajaxart.ui.contextWithCurrentControl(textbox.context,textbox) );
			  ajaxart.ui.suggestBoxPopup.textbox.focus();
		  });
	  }
	  if (!empty)
		  ajaxart.customsuggestbox.openPopup(popup,textbox);
		else
		  if (ajaxart.ui.suggestBoxPopup) jQuery(ajaxart.ui.suggestBoxPopup).hide();
}
ajaxart.customsuggestbox.openSuggestionBoxPopup = function(profile,data,context)
{
	var textbox = ajaxart.getControlElement(context,true);
	if (textbox == null) return [];
	  var control = aa_first(data,profile,'Control',context);
	  if (control != null)
		  ajaxart.customsuggestbox.openPopup(control,textbox);
	  return [];
}
ajaxart.customsuggestbox.openPopup = function(element, textbox)
{
	  var popup = ajaxart.ui.suggestBoxPopup;
	  if (popup != null && popup.parentNode != null)
		  popup.parentNode.removeChild(popup);
	  
	  ajaxart.ui.suggestBoxPopup = element;
	  ajaxart.ui.suggestBoxPopup.textbox = textbox;
	  jQuery(ajaxart.ui.suggestBoxPopup).addClass('aapopup suggestionpopup customsuggestionpopup');
	  
	  var close_button = jQuery('<IMG src="' + aa_base_images() + '/close2.png" class="suggestionpopup_close_button"></IMG>');
	  close_button.click(function(e) {
			ajaxart_stop_event_propogation(e);
			jQuery(ajaxart.ui.suggestBoxPopup).hide();
			textbox.focus();
	  });
	  ajaxart.ui.suggestBoxPopup.appendChild(close_button[0]);

	  jQuery('body').append(jQuery(ajaxart.ui.suggestBoxPopup));
	  var width = jQuery(textbox).width()-5;
	  if (width < 300) width = 300;
	  jQuery(ajaxart.ui.suggestBoxPopup).width(width);
	  ajaxart.ui.suggestBoxPopup.style.display = 'block';
	  ajaxart.dialog.positionPopup(jQuery(ajaxart.ui.suggestBoxPopup), textbox);
//	  var left = aa_absLeft(textbox);
//	  var top = aa_absTop(textbox) + jQuery(textbox).height()+5;
	  
//	  jPopup.css("left",left).css('top',top);//.css('min-width',""+width+"px");
}
ajaxart.customsuggestbox.addTextToSuggestionBox = function(profile, data,context)
{
	var textToAdd = aa_text(data,profile,'Text',context);
	var textbox = ajaxart.getControlElement(context,true);
	if (ajaxart.ui.suggestBoxPopup != null && ajaxart.ui.suggestBoxPopup.textbox != null)
		textbox = ajaxart.ui.suggestBoxPopup.textbox;
    if (textbox.openedWithTrigger)
	  textToAdd = aa_text( [textToAdd], textbox.triggerProfile, "TextPatternToAdd", textbox.triggerContext );
	textbox.value = textbox.value + textToAdd;
	ajaxart.writevalue(textbox.data,textbox.value);
	textbox.focus();
	if (ajaxart.ui.suggestBoxPopup != null)
		jQuery(ajaxart.ui.suggestBoxPopup).hide();
	 textbox["openedWithTrigger"] = false;
	var textboxCtx = textbox.context || textbox.jbContext;
	if ( aa_bool(data,profile,'TriggerOnAfterTextAdded',context) )
		ajaxart.run(textbox.data,textbox.profile,'OnAfterTextAdded', ajaxart.ui.contextWithCurrentControl(textboxCtx,textbox) );
	ajaxart.run(textbox.data,textbox.profile,'OnUpdate', ajaxart.ui.contextWithCurrentControl(textboxCtx,textbox) );
	if ( aa_bool(data,profile,'TriggerPopup',context) )
		ajaxart.run(data,textbox.profile,'OnChangeAtEndOfText', ajaxart.ui.contextWithCurrentControl(textboxCtx,textbox) );
}
ajaxart.customsuggestbox.triggerSuggestionBoxPopup = function(profile, data,context)
{
	var textbox = ajaxart.getControlElement(context,true);
	if (textbox == null) return [];
	var textToSimulate = ajaxart.run(data,profile,'TextToSimulate',context);
	textbox["openedWithTrigger"] = true;
	textbox["triggerProfile"] = profile;
	textbox["triggerContext"] = context;
	ajaxart.run(textToSimulate,textbox.profile,'OnChangeAtEndOfText', ajaxart.ui.contextWithCurrentControl(textbox.context,textbox) );
}








aa_gcs("ui", {
	ControlUsage: function (profile,data,context)
	{
		window.aa_intest_topControl = null;
		aa_intest = true;
		try
		{
			ajaxart.run(data,profile,'RunBefore',context);
			var control = ajaxart.run(data,profile,'Control',context);
			if (control.length == 0) return ["no control"];	
			window.aa_intest_topControl = control[0];
		
			var newContext = aa_ctx(context,{ControlElement: control, TopControlForTest: control, TopControlElement: control, InTest: ['true']});

			if (context.vars._TestOutput) {
				if (context.vars._TestOutput[0].OutputControl) {
					context.vars._TestOutput[0].OutputControl[0].appendChild(control[0]);
					aa_fixTopDialogPosition();
				}
				else
					context.vars._TestOutput[0].OutputControl = control[0];
			}
			
			ajaxart.run(data,profile,'RunOnControl',newContext);
		
			if (aa_text(data,profile,'ResultType',context) == 'Data')
				var result = data;
			else 
				var result = newContext.vars.TopControlElement;
		
			var passed = aa_bool(result,profile,'ExpectedResult',newContext);
			ajaxart.run(data,profile,'CleanAfter',newContext);
			window.aa_intest_topControl = null;
		
		  if (openDialogs.length > 0) { // close dialogs
		      var dlg = openDialogs[openDialogs.length-1];
		      if ( ! jQuery(dlg.dialogContent).hasClass('aaeditor') )
		        aa_remove(ajaxart.dialog.closeDialog(dlg),true);
		  }
		  aa_closePopupsInTest();
	}
	catch (e) { 
		aa_intest = false; 
		ajaxart.logException(e); 
	}
	aa_intest = false;
	if (passed == false)
		return result;//ajaxart.usage.resultAsText(result);
	return [];
  },
  ControlUsage_Result: function (profile,data,context)
  {
	  ajaxart.run(data,profile,'RunBefore',context);
	  return ajaxart.run(data,profile,'Control',context);
  },  
  ControlData: function (profile,data,context)
  {
	 var type = aa_text(data,profile,'Type',context);
	 var control = ajaxart.run(data,profile,'Control',context);
	 if (! ajaxart.ishtml(control)) return [];
	 
     var context1 = control[0]["ajaxart"];
     if (typeof(context1) == "undefined")
    	 return control[0].ItemData;
     if (type == "data") return context1.data;
     if (type == "original_data") {
    	 if (context1.origData == null) return context1.data;
    	 else return context1.origData;
     }
     if (type == "script") return [context1.script];
     if (type == "context") return [context1.params];
     if (type == "all")
     { 
   	    var out = { isObject: true };
  	    out.input = context1.data;
  	    if (context1.origData != null) out.input = context1.origData;
  	    out.script = context1.script;
  	    out.context = context1.params;
    	 
    	return [out];
     }
     return [];
  },
  ControlInObject: function (profile,data,context)
  {
	  var obj = aa_first(data,profile,'Object',context);
	  obj.ControlHolder = ajaxart.run(data,profile,'Control',context);
	  if (!obj.ControlHolder[0]) obj.ControlHolder = [ document.createElement('div') ];
	  obj.ControlHolder[0].ParentObject = [obj];
	  return obj.ControlHolder;
  },
  AttachGlobalCss: function(profile,data,context)
  {
	  return [ aa_attach_global_css(aa_text(data,profile,'Css',context),null,aa_text(data,profile,'Name',context) )];
  },
  UseDataBoundParams: function(profile,data,params)
  {
	  if (! ajaxart.ishtml(data)) return data;
	  for(var i=0;i<data.length;i++) {
		  var dataitem = data[i];
		  if (typeof(dataitem["ajaxart"]) != "undefined")
		  {
			  var controlParams = dataitem["ajaxart"].params;
			  ajaxart.setVariable(controlParams,"InputForChanges",dataitem["ajaxart"].data);
			  ajaxart.run([ dataitem ],profile,'Change',controlParams);
		  }
	  }
	  return data;
  },
  LoadCssFile: function(profile,data,context)
  {
      var url = aa_text(data,profile,'Url',context);
      var media = aa_text(data,profile,'Media',context);
	  
      if (url == "") return [];
      
      var fileref=document.createElement("link");
      fileref.setAttribute("rel", "stylesheet");
      fileref.setAttribute("type", "text/css");
      fileref.setAttribute("href", url);
      if (media)
        fileref.setAttribute("media", media);
      document.getElementsByTagName("head")[0].appendChild(fileref)
      
	  return ["true"];
  },
  SetCssText: function(profile,data,params)
  {
 	 var style = aa_text(data,profile,'Style',params);
 	 if (style == "") return;
 	 ajaxart.each(data, function(item) {
 		 try {
 	 		 item.style.cssText = style;
 		 }
 		 catch (e) { ajaxart.log("failed to change css text: "+ style +" :" +e.message,"error"); }
 	 });
  },
  UrlParameter: function(profile,data,context)
  {
    var strParamName = aa_text(data,profile,'Param',context);
    return [ajaxart.urlparam(strParamName)];
  },
  CurrentUrlWithChangedParam: function(profile,data,context)
  {
	var param = aa_text(data,profile,'Param',context);
	var val = aa_text(data,profile,'Value',context);
	var strHref= aa_text(data,profile,'Url',context);
	
	var params = [];
    if (strHref.indexOf('#') > -1) strHref = strHref.substr(0,strHref.indexOf("#"));
	var baseUrl = strHref;
    if ( strHref.indexOf("?") > -1 ) {
      baseUrl = strHref.substr(0,strHref.indexOf("?"));
      var strQueryString = strHref.substr(strHref.indexOf("?")+1);
      var aQueryString = strQueryString.split("&");
      for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
        var aParam = aQueryString[iParam].split("=");
        if (aParam[0] != param)
          params.push( {name:aParam[0],value:aParam[1] } );
      }
    }
    params.push( {name:param,value:val } );
    var newUrl = baseUrl + "?";
    for (var i=0;i<params.length;i++)
    {
    	if (i > 0) newUrl += "&";
    	newUrl += params[i].name + "=" + params[i].value; 
    }
	return [newUrl];
  },
  SetCssProperty: function(profile,data,params)
  {
 	 var property = aa_text(data,profile,'Property',params);
 	 var value = aa_text(data,profile,'Value',params);
 	 if (property == "" || !ajaxart.ishtml(data[0]) ) return data;
 	 jQuery(data[0]).css(property,value);
 	 return data;
// 	 data[0].style[property] = value;
  },
  ExecJQuery: function(profile,data,params)
  {
		var expression = aa_text(data,profile,'Expression',params);
		var controls = data;
		if (controls.length == 0 || !ajaxart.ishtml(controls[0]))
			controls = ajaxart.getControlElement(params);

		ajaxart.each(controls, function(item) {
			if (!ajaxart.ishtml(item)) return;
			var exp = "jQuery(item)" + expression + ";";
			try {
				var $ = jQuery;
				eval(exp);
			}
			catch (e) { ajaxart.log("failed to run jQuery exp: "+ exp +" :" +e.message,"error"); }
		});
		return ["true"];
  },
  DayOfWeek: function(profile,data,context)
  {
	  var value = ajaxart.totext_array(data);
	  var d = jQuery.datepicker.parseDate("dd/mm/yy",value);
	  var weekday=new Array(7);
	  weekday[0]="Sunday";
	  weekday[1]="Monday";
	  weekday[2]="Tuesday";
	  weekday[3]="Wednesday";
	  weekday[4]="Thursday";
	  weekday[5]="Friday";
	  weekday[6]="Saturday";

	  var out = weekday[d.getDay()];
	  return [out];
  },
  TextboxValue: function(profile,data,context)
  {
	  var out= [];
		var elements = ajaxart.getControlElement(context);
		ajaxart.each(elements, function(element) {
			if (typeof(element.value) != "undefined")
				out.push("" + element.value);
		});
		return out;
  },
  DataFromJavaScript: function(profile,_data,context)
  {
		if (_data.length == 0) _data = [null];
		var expression = aa_text(_data,profile,'Expression',context);
		var _element = ajaxart.getControlElement(context);
		var element = null;
		if (_element.length>0) element = _element[0];
		var control = element;
		var data = _data[0];
		var result = null;
		try { var $ = jQuery; result = eval(expression); }
		catch(e) { 
			ajaxart.log("Failed to run JS expression:" + expression + ", " + e.message,"error"); 
		}
		if (typeof(result) == "number")
			return ["" + result];
		if (typeof(result) == "object" && !(ajaxart.isxml))//number in FF
			return ["" + result];
		if (result == null || typeof(result) == "undefined")
			return [];
		if (result["jquery"] != null) {
			return result.get();
		}
		return [result];
  },
  RunJavaScript: function(profile, data, params) {
  	var out = ajaxart.gcs.ui.DataFromJavaScript(profile, data, params);
  	return ['true'];
  },
  TextToHtml: function(profile, data, params) {
		if (ajaxart.ishtml(data[0])) return data[0];
		var text = ajaxart.totext(data[0]);
		if (text == "") return [];
		return [jQuery(text)[0]];
  },
  Switch: function (profile,data,params)
  {
	  return aa_switch(profile,data,params);
  },
  IsHtml: function (profile,data,context)
  {
	  if (ajaxart.ishtml(data)) return ["true"];
	  return [];
  },
  FirstSucceeding: function (profile,data,context)
  {
    var itemProfiles = ajaxart.subprofiles(profile,'Control');

    for(var i=0;i<itemProfiles.length;i++)
    {
    	var subresult = ajaxart.run(data,itemProfiles[i],"",context);
    	if (subresult.length > 0) 
    		return subresult;
    }
  	
  	return [];  	
  },
  OnKeyDown: function (profile,data,context)
  {
	  var control = context.vars.ControlElement[0];
	  control.onkeydown = function(e) {
		e = e || event;
        var newContext = ajaxart.clone_context(context);
    	ajaxart.ui.applyKeyboardEvent(e,newContext);
    	var elem = jQuery( (typeof(event)== 'undefined')? e.target : event.srcElement  );
    	if (elem[0] && elem[0].tagName.toLowerCase() == 'textarea')
    	  newContext.vars.EventTargetIsTextArea = ["true"];
    	else 
    	  newContext.vars.EventTargetIsTextArea = [];
    	
    	ajaxart.run(data,profile,'Action',newContext);
    	return true;
	  }
	  return ["true"];
  },
  BindEvent: function (profile,data,context)
  {
  	if (data.length == 0) return;
	var newData = ajaxart.getVariable(context,"InputForChanges");
	var element = data;
	ajaxart.databind(element,newData,context,null);

	  var event = aa_text(data,profile,'Event',context);
	  var action = function(e) {
    	if (typeof(ajaxart_captured_element) != "undefined" && ajaxart_captured_element.length > 0) return [];
        var element = data[0];
    	
        var newContext = ajaxart.clone_context(context);
        
        if (!aa_bool(data,profile,'KeepOriginalRunOnControl',newContext))
          ajaxart.setVariable(newContext,"ControlElement",data);
        
    	ajaxart.ui.applyKeyboardEvent(e,newContext);
        
	  	var input = []; 
	  	if ('ajaxart' in element)
	  	  input = element.ajaxart.data;
	  	
  		ajaxart.run(input,profile,'Action',newContext);
	  };
	  aa_bind_ui_event(data[0],event,action);
	  return ["true"];
  },
  StandardButton: function (profile,data,context)
  {
	  var buttonContext = context.vars.ButtonContext[0];

	  var text = ajaxart.totext_array(buttonContext.Text);
		  
	  var str = '<span class="button_wrapper" tabindex="1"><span class="button_outer">'
		   + '<span class="button_inner" >' + text + '</span></span><br/></span>';
	  var btn = $(str)[0];
	  $(btn).find('.button_outer').css('background','url('+aa_base_images()+'/css/button.png) no-repeat left top');
	  $(btn).find('.button_inner').css('background','url('+aa_base_images()+'/css/button.png) no-repeat right top');

	  ajaxart_disableSelection(btn);
	  ajaxart.databind([btn],data,context,profile);
	  
	  var click = function(btn)
	  {
		  var jbtn = jQuery(btn);
		  try {
		  if (ajaxart.isattached(btn))
			  btn.focus();
		  } catch(e) { }
		  var buttonContext = context.vars.ButtonContext[0];
    	  var newContext = aa_ctx(context,{ControlElement: [btn]} );
		  ajaxart.runScriptParam(data,buttonContext.OnClick,newContext);
		  jbtn.removeClass('pressed').removeClass('pressing');
	  }

	  var mouseHandlers = function(btn) { 
	  jQuery(btn).mousedown( function() {
		  var jbtn = jQuery(btn);
		  if (jbtn.attr('pressed_src') != "")
		  {
			  jbtn.attr('src',jbtn.attr('pressed_src'));
		  	  jbtn.addClass('pressed').addClass('pressing');
		  }
	  }).mouseout( function() {
		  var jbtn = jQuery(btn);
		  jbtn.removeClass('pressed');
		  jbtn.attr('src',jbtn.attr('original_src'));
	  }).mouseover( function() {
		  var jbtn = jQuery(btn);
		  if (jbtn.hasClass('pressing')) {
				  jbtn.addClass('pressed').removeClass('pressing');
				  jbtn.attr('src',jbtn.attr('pressed_src'));
		  }
	  }).keydown( function(e) {
			e = e || event;
			if (e.keyCode == 13) // enter
			{
				ajaxart_stop_event_propogation(e);
				click(btn);
				return false;
			}
	  }).mouseup( function() {
		  if (window.aa_incapture) return;
		  var jbtn = jQuery(btn);
		  if (jbtn.hasClass('pressed'))
			  click(btn);
	  });
	  };
	  
	  mouseHandlers(btn);
	  
	  return [btn];
  },
  SuggestionBox: function (profile,data,context)
  {
	  var out = document.createElement('input');
	  ajaxart.suggestbox.attachToTextbox(data,profile,context,out);
	  return [out]; 
  },
  CustomSuggestionBox: function (profile,data,context)
  {
	  var out = document.createElement('input');
	  ajaxart.customsuggestbox.attachToTextbox(data,profile,context,out);
	  return [out]; 
  },
  AddTextToSuggestionBox: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.addTextToSuggestionBox(profile, data,context);  
	  return [];
  },
  CloseSuggestionBox: function (profile, data,context)
  {
	  ajaxart.suggestbox.closePopup();
	  return [];
  },
  OpenSuggestionBoxPopup: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.openSuggestionBoxPopup(profile, data,context);
	  return [];
  },
  OpenSuggestionBoxList: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.openSuggestionBoxList(profile, data,context);
	  return [];
  },
  TriggerSuggestionBoxPopup: function (profile, data,context)
  {
	  ajaxart.customsuggestbox.triggerSuggestionBoxPopup(profile, data,context);
	  return [];
  },
  UrlFragmentAttribute: function (profile,data,context)
  {
		var url = aa_text(data,profile,'Url',context);
		var attr = aa_text(data,profile,'Attribute',context);
		return [ aa_url_attribute(url,attr) ];
  },  
  RunInControlContext: function (profile,data,context)
  {
  	var elements = ajaxart.getVariable(context,"ControlElement");
  	var mode = aa_text(data,profile,'Mode',context);
  	var out = [];
  	ajaxart.each(elements,function(element) {
   	  var elem_context = element["ajaxart"];
	  if (elem_context == null) {
//		  ajaxart.log("RunInControlContext - control has no databind","warning")
		  return [];
	  }
	  var newContext = elem_context.params;
	  if (mode == 'copy control variables')
	  {
		  newContext = ajaxart.clone_context(context);
		  for(i in elem_context.params.vars)
			  newContext.vars[i] = elem_context.params.vars[i]; 
	  }
	  ajaxart.setVariable(newContext,"ControlElement",[element]);
	  ajaxart.concat(out,ajaxart.run(elem_context.data,profile,'Item',newContext));
 	});
  	return out;
  },
  DisableTextSelection: function(profile, data, context)
  {
	if (! ajaxart.ishtml(data)) return [];
	control = jQuery(data[0]);
	
	if( ajaxart.isFirefox ) { control.css({ 'MozUserSelect' : 'none' });
	} else if( ajaxart.isIE ) {
		control.each( function() { jQuery(this).bind('selectstart.disableTextSelect', function() { return false; }); });
	} else {
		control.each(function() { jQuery(this).bind('mousedown.disableTextSelect', function() { return false; }); });
	}
	return ["true"];
  },
  AddMousePressedEffect: function (profile,data,context)
  {
	  if (! ajaxart.ishtml(data) ) return data;
	  
	  var control = data[0];
	  jQuery(control).mousedown( function() {
		  if (jQuery(this).attr('pressed_src') != "")
			  jQuery(this).attr('src',jQuery(this).attr('pressed_src'));
		  jQuery(this).addClass('pressed').addClass('pressing');
	  }).mouseout( function() {
		  jQuery(this).removeClass('pressed');
		  jQuery(this).attr('src',jQuery(this).attr('original_src'));
	  }).mouseover( function() {
		  if (jQuery(this).hasClass('pressing')) {
			  jQuery(this).addClass('pressed').removeClass('pressing');
			  jQuery(this).attr('src',jQuery(this).attr('pressed_src'));
		  }
	  }).mouseup( function() {
		  jQuery(this).attr('src',jQuery(this).attr('original_src'));
		  jQuery(this).removeClass('pressed').removeClass('pressing');
	  });
	  return data;
  },
  InternalRefreshToAddItem: function (profile,data,context)
  {
	  var parent = aa_first(data,profile,'ParentControl',context);
	  var newItems = ajaxart.run(data,profile,'NewItems',context);
	  var controlForContext = aa_first(data,profile,'ControlForNewItemControlContext',context);
	  var jqPath = aa_text(data,profile,'JQPathForItems',context);
	  
	  if (parent == null || controlForContext == null || controlForContext.ajaxart == null) return [];
	  var controlContext = controlForContext.ajaxart.params;
	  
	  var currentControls = jQuery(parent).find(jqPath);
	  for(var i=0;i<newItems.length;i++)
	  {
		if (currentControls.length <=i) // adding at the end
		{
			var newControl = aa_first([newItems[i]],profile,'NewItemControl',controlContext);
			if (newControl != null)
			{
				aa_xml_appendChild(parent,newControl);
				ajaxart.run([newControl],profile,'OnNewItem',context);
			}
		}
	  }
  },  
  CheckboxesList: function (profile,data,context)
  {
	controls = ajaxart.getControlElement(context);
	if (controls.length == 0) return [];
	var elem = controls[0];
    var timeout = 1;
    if (ajaxart.isSafari) timeout = 100;
    
    var try_run_onload = function(count,timeout) {
    	if (count == 0) return;
	    if (jQuery(elem).parents("body").length == 0)  //detached
	    	setTimeout(function() { try_run_onload(count-1,timeout); } ,timeout); 
    else
    	ajaxart.run(data,profile,'OnLoad',context);	
    }
    try_run_onload(5,timeout);
  },  
	IsChrome: function (profile,data,context)
	{
		if (ajaxart.isChrome)
			return [ "true" ];
		else
			return [];
	},
	HtmlUnderElement: function(profile, data, context) {
		if (! ajaxart.isxml(data)) return [];

		var text = "";
		var node = data[0].firstChild;
		while (node != null) {
			if (node.nodeType == 3 || node.nodeType == 4) text += node.nodeValue;
			if (node.nodeType == 1) text += ajaxart.xml2text(node);
			node=node.nextSibling;
		}
		return [text];
	},
 	ValidationList: function (profile,data,context)
 	{
	    var itemProfiles = ajaxart.subprofiles(profile,'Validation');
	    for(var i=0;i<itemProfiles.length;i++)
	    	ajaxart.run(data,itemProfiles[itemProfiles.length - i -1],"",context);
	    return [];
 	},
	HorizontalSplitter: function (profile,data,context)
	{
		var idForCookie = aa_text(data,profile,'IdForCookie',context);
		var height = aa_text(data,profile,'Height',context);
		var totalWidth = aa_text(data,profile,'TotalWidth',context);
		var sections = ajaxart.dynamicText(data,"%$SectionsContext/Sections%",context);

		var widths = aa_valueFromCookie(idForCookie + "_splitterwidths");
		var keepTotalWidth = aa_bool(data,profile,'KeepTotalWidth',context);
		if (widths == null || widths == "")
			widths = ajaxart.run(data,profile,'DefaultWidths',context);
		else
			widths = widths.split(",");
		if (totalWidth != "" && widths.length+1 >= sections.length) {	// setting last column width
			var width_sum = 0;
			for (var j=0; j<sections.length-1; j++)
				width_sum += ajaxart.ui.width_as_num(widths[j]) + 15;// 15 is one splitter width
			widths[sections.length-1] = (ajaxart.ui.width_as_num(totalWidth) - width_sum) + "px";
		}
		var middle_splitter_height = ajaxart.ui.width_as_num(height) - 22 - 47 - 43;//22 - title, 47,43 - top & bottom splitters
		var sections_height = ajaxart.ui.width_as_num(height) - 22;
		var table = jQuery('<table cellpading="0" cellspacing="0" />')[0];
		var tr = document.createElement("TR"); table.appendChild(tr);
		for (var i=0; i<sections.length; i++) {
			var section = sections[i];
			var td1 = document.createElement("TD"); tr.appendChild(td1); td1.className="horizontal_section_td";
			var width = (widths.length > i) ? widths[i] : "200px";
			var div1 = jQuery("<div class='horizontal_section' style='width:"+ width+";height:" + sections_height + "px' />")[0]; td1.appendChild(div1);
			var title = ajaxart.totext(ajaxart.dynamicText([section],"%Title%",context));
			if (title != "")
				jQuery(div1).append(jQuery('<div class="horizontal_section_title">').text(title));
			var control = ajaxart.runNativeHelper([section],profile,'Control',context);
			if (control.length > 0)
				div1.appendChild(control[0]);
			
			// splitter
			if (i+1 < sections.length) {	//not last
				var splitter = $('<td class="splitter" > <div class="splitter_top" /><div class="splitter_middle" style="height:' + middle_splitter_height + 'px" /><div class="splitter_bottom" /></td>');
				splitter.find('.splitter_top').css('background','url('+aa_base_images()+'/css/splitter_top.png)');
				splitter.mousedown(function(e) {
					var mousepos = aa_mousePos(e);
					var splitter = jQuery( (typeof(event)== 'undefined')? e.target : event.srcElement  ); 
					table["section"] = jQuery(splitter).parents(".splitter").prev().find(".horizontal_section")[0];
					table["diff"] = mousepos.x - jQuery(table["section"]).width();
					table["last_section"] = jQuery(splitter).parents(".splitter").siblings(":last").find(".horizontal_section")[0];
					table["last_section_diff"] = jQuery(table["last_section"]).width() + mousepos.x;
					table["moving"] = true;
				} );
				jQuery(tr).append( splitter );
			}
		}
		jQuery(table).mouseup(function(e) {
			if (table["moving"]) {	// write widths to cookie
				var widths = "";
				var sections = jQuery(table).find(".horizontal_section");
				for (i=0; i<sections.length; i++)
					widths += jQuery(sections[i]).width() + "px,";
				aa_writeCookie(idForCookie + "_splitterwidths", widths);
			}
			table["moving"] = false;
		} );
		jQuery(table).mousemove(function(e) {
			if (!table["moving"] || table["section"]==null) return;
			var mousepos = aa_mousePos(e);
			jQuery(table["section"]).width(mousepos.x - table["diff"]);
			if (keepTotalWidth)
				jQuery(table["last_section"]).width(table["last_section_diff"] - mousepos.x);
		} );
		return [table];
	},
	IsMobileDevice: function (profile,data,context)
	{
		var checkInSimulator = aa_bool(data,profile,'SimulatorSupport',context);
		if (aa_screen_size(checkInSimulator).width < 450) 
			return ['true'];
		return [];
	},
	  ScreenSize: function (profile,data,context)
	  {
		  var axis = aa_text(data,profile,'Axis',context);
		  var margin = aa_int(data,profile,'Margin',context);
		  
		  var visualCntr = aa_findVisualContainer(null,context);

		  var num=0;
		  if (axis == 'height')
				num = visualCntr.height;
		  else
				num = visualCntr.width;

		  num -= margin;
		  
		  if (axis == 'height' && aa_bool(data,profile,'ReduceStudioHeaderFooter',context) && ajaxart.jbart_studio) {
		  	num -= jBart.footerHeight + jBart.headerHeight;
		  }
		  if ( aa_bool(data,profile,'AsHtmlString',context))
			  return ["" + num + "px"];
		  
		  return [num];
	  },
	ScreenPercentage: function (profile,data,context)
	{
			var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
			var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);

			var axis = aa_text(data,profile,'Axis',context);
			var total = (axis == 'width') ? screenWidth : screenHeight;
			var percent = aa_int(data,profile,'Percent',context);
			var value = parseInt( (total * percent)/100 );

			if (aa_bool(data,profile,'AddPxSuffix',context)) value = value + 'px';
			return [value];
	},
	CssClassesInControl: function (profile,data,context)
	{
		var control = aa_first(data,profile,'Control',context);
		var classes = {}
		var obj = {};
		obj.find = function(elem) {
			var cls = elem.className.split(' ');
			for(var i=0;i<cls.length;i++) classes[cls[i]] = true;
			var children = jQuery(elem).children();
			for(var i=0;i<children.length;i++) obj.find(children[i]);
		}
		
		if (control != null) obj.find(control);
		var out = [];
		for(var i in classes)
			out.push("."+i);
		return out;
	}
});

function aa_tinyMCE(textbox,settings) {
    var tinyID = "tinymce" + (ajaxart.unique_number++);

	settings = aa_defaults(settings,{
		textareaElement: textbox.el
	});
	$(settings.textareaElement).val(textbox.value);

	var jsList = [ '//tinymce.cachefly.net/4.0/tinymce.min.js' ];
	$.when( aa_loadLib("tinymce", [] , jsList) ).then( init );

    function init() {
		aa_addOnAttach(settings.textareaElement, function() {
			  	settings.textareaElement.setAttribute('id',tinyID);
				tinymce.init({
					width: parseInt(settings.width),
					height: parseInt(settings.height) - 110, // 110 px is the height of menu+toolbat+footer
					plugins: "code",
					selector: "#" + tinyID,
					setup : function(ed) {
						ed.on('change',function() {
							if (textbox.setValue) textbox.setValue(ed.getContent()	);
						});
					}
		    });
		});
    }
}
function aa_nicEdit(textbox,settings) {
	aa_defaults(settings, { autoUpdateFrequency: 700 } );
	var cssList = [];
	var jsList = [ aa_base_lib() + '/nicedit/nicEdit.js'];
	$.when( aa_loadLib("nicedit", cssList , jsList) ).then( init );
	textbox.$el.find("textarea").val( textbox.value ).css({height: settings.height +"px", width: settings.width + "px"});

	function init() {
		aa_addOnAttachMultiple(textbox.el, function() {
			var buttonList = settings.buttons ? settings.buttons.split(",") : [];
			var nicOptions = { 
				iconsPath: aa_base_lib() + '/nicedit/nicEditorIcons.gif',
				buttonList: buttonList,
				maxHeight: parseInt(settings.height - 30) // Reducing the header & footer
			};
			textbox.$el.find("textarea").css({height: settings.height-40 +"px"});	// Reducing the header & footer and some more to avoid scroll
			var editor = new nicEditor(nicOptions).panelInstance(textbox.$el.find("textarea")[0]);
			nicEditors.editors.push(editor);
			textbox.el.jbNicEditorInstance = editor.nicInstances[0];
			textbox.el.jbNicEditor = editor;
			autoUpdate();
		});
	}

	function autoUpdate() {
		if (textbox.el.jbNicEditorInstance && textbox.el.jbNicEditorInstance.getContent() != textbox.value)
			textbox.setValue(textbox.el.jbNicEditorInstance.getContent());
		if (ajaxart.isattached(textbox.el))
			setTimeout( autoUpdate, settings.autoUpdateFrequency );
	}
	textbox.el.jbAddTextAtCursor = function(text) {
		textbox.$el.find('.nicEdit-main').focus(); // Without focus it wont work!
    textbox.el.jbNicEditorInstance.nicCommand('InsertHTML', text); 		
	}
}
function aa_loadLib(loadId, cssList, jsList) {
	var deferred = $.Deferred();

	function doLoad() {
		var loadDeferred = $.Deferred();
		var jsLoadedCount = 0;
		function done() {
			jsLoadedCount++;
			if (jsLoadedCount == jsList.length)
				loadDeferred.resolve();
		}
		for (var i=0; i<cssList.length; i++)
			aa_load_js_css(cssList[i],'css');
		for (var i=0; i<jsList.length; i++)
			$.getScript(jsList[i], done);
		if (!jsList.length)
			loadDeferred.resolve();
		return loadDeferred;
	}
	if (!jBart.singleLoadItems) jBart.singleLoadItems = {};
	if (jBart.singleLoadItems[loadId] && jBart.singleLoadItems[loadId].loaded)	// already loaded
		deferred.resolve();
	else {
		if (!jBart.singleLoadItems[loadId]) 
			jBart.singleLoadItems[loadId] = { waiting: [] };
		jBart.singleLoadItems[loadId].waiting.push( deferred );
		if (jBart.singleLoadItems[loadId].waiting.length > 1) return deferred; // someone else is already loading it

		$.when( doLoad() ).then( function() { 
			for (var i=0; i<jBart.singleLoadItems[loadId].waiting.length; i++)
				jBart.singleLoadItems[loadId].waiting[i].resolve();
			jBart.singleLoadItems[loadId].loaded = true;
			jBart.singleLoadItems[loadId].waiting = [];
		});
	}
	return deferred;
}
if (!ajaxart.ui ) ajaxart.ui = {}
ajaxart_condition = function(element,actionContext,actionToRun,controlData)
{
	var result = ajaxart_runevent(element,actionContext,actionToRun,controlData);
	return (typeof(result) != "undefined" && result.length == 1 && (result[0] == true || result[0] == "true") );
}
ajaxart_delay_counter=0;

aa_tinymce_handleEvent = function(e,obj)
{
	if (e.type != 'keyup') return;
   
   var elem = jQuery('#'+obj.id);
   if(elem.length > 0 && elem[0].aa_update)
       elem[0].aa_update();
}
ajaxart_delayrunevent = function(element,actionContext,actionToRun,controlData,_event,delay)
{
  if (! ajaxart.isattached(element)) {
	  ajaxart_runevent(element,actionContext,actionToRun,controlData,_event);
	  return;
  }
  
  if (typeof(delay) == "undefined") delay = 200;
  
  var counter1 = ++ajaxart_delay_counter;
  
  var func = function(counter)
  {
	  setTimeout(function() { 
		  if (ajaxart_delay_counter != counter) return;
		  ajaxart_runevent(element,actionContext,actionToRun,controlData,_event); 
	  } ,delay);
  }
  func(counter1);
}
ajaxart_selectionchanged = function(element)
{
	ajaxart_runevent(element,'MasterDetailContext','SelectionChanged');
}
ajaxart_css_selection = function(element,topElementByCss)
{ 
	var top = jQuery(element).parents("." + topElementByCss);
	var mosttop = top.parents(".ajaxart_single_selection_top");
	if (mosttop.length > 0) top = mosttop;
	top.find(".selected").removeClass("selected");
	
	jQuery(element).addClass('selected');	
}
ajaxart_container_event = function(event,topElementCls,itemCls,actionContext)
{
    var element = (typeof(event.target)== 'undefined')? event.srcElement : event.target;
    if (ajaxart.isSafari && ajaxart_source_elem_in_test != null)
    	element = ajaxart_source_elem_in_test;
    
    if (event.type == 'keydown') {
    	var selectedItems = jQuery(element).parents("."+topElementCls).find('.selected');
    	if (selectedItems.length > 0)
    		element = selectedItems[0];
    }
    	
    var dataElem = ajaxart_container_find_databound_elem(element,itemCls);
    
    if (dataElem != null)
    {
    	if (event.type == 'click') {
    		ajaxart_css_selection(dataElem,topElementCls);
    		ajaxart_selectionchanged(dataElem);
    		ajaxart_runevent(dataElem,actionContext,'OnSelect');
    	}
    	else if (event.type == 'dblclick')
    		ajaxart_runevent(dataElem,actionContext,'OnDoubleClick');
    	else if (event.type == 'keydown')
    	{
    		if (event.keyCode == "13") // enter
        	  ajaxart_runevent(dataElem,actionContext,'OnDoubleClick');
  	        if (event.keyCode == 40)  // down  
			  ajaxart_container_move_cursor(dataElem,1);
	  	    if (event.keyCode == 38)  // up  
  			  ajaxart_container_move_cursor(dataElem,-1);
    	}
    }
    
	if ( jQuery(element).find("#key_sink").focus().length == 0)
		jQuery(element).parents("."+topElementCls).find("#key_sink").focus();
}


ajaxart_container_find_databound_elem = function(element,itemCls)
{
	if ( jQuery(element).hasClass(itemCls) ) return element;
	var result = jQuery(element).parents("."+itemCls);
	if (result.length == 0) return null;
	return result[0];
}

ajaxart_container_move_cursor = function(element,delta)
{
}

ajaxart.ui.lastEvent = null;

function aa_is_fixed_position(elem) 
{
	for (var curr=elem; curr && curr != document.body; curr=curr.parentNode)
	  if ( (curr.currentStyle && curr.currentStyle['position'] == 'fixed') ||
	  	(window.getComputedStyle && window.getComputedStyle(curr, null)['position'] == 'fixed'))
	  		return true;
	return false;
}

function aa_widthToWindowRight(control,delta,applyOn)
{
	if (!ajaxart.isattached(control) ) return;
	if (!applyOn) applyOn="width";

	if (typeof(delta) == "undefined" || isNaN(delta)) delta=0;

	if (jQuery(control).parents('.studio_simulator').length > 0) {	// in studio, use simulator window height
		  var simulator = jQuery(control).parents('.studio_simulator')[0];
		  if (simulator.className.indexOf(' ') > -1) { // only when a view is on
			  screenWidth = simulator.clientWidth;
		  	  var controlLeft = aa_absLeft(control) - aa_absLeft(simulator.firstChild);
		  	  var newWidth = screenWidth-controlLeft- delta; 
			  if (newWidth < 50) newWidth = 0;
			  jQuery(control).css(applyOn,newWidth + 'px');
		  }
	} else {
		var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
		var controlLeft = aa_absLeft(control);
	  	if (!aa_is_fixed_position(control))
	  	  controlLeft -= window.pageXOffset;
		jQuery(control).css(applyOn,(screenWidth - controlLeft-delta) + 'px');
	}
}

ajaxart.ui.HeightToWindowBottom = function (control,delta,applyOn)
{
	if (!ajaxart.isattached(control) ) return;
	if (!applyOn) applyOn="height";
	if (typeof(delta) == "undefined" || isNaN(delta)) delta=0;
	var newHeight = 0;
	
	// see if control is in a dialog
	if (control.jbInDialog == null)
		control.jbInDialog = jQuery(control).parents('.dialog_box').length > 0;
	if (control.jbInDialog)
	{
		var dlg = jQuery(control).parents('.dialog_box');
		if (dlg[0].dialogHeight == null) dlg[0].dialogHeight = dlg.height();
		
		var dlgBottom = dlg[0].dialogHeight + aa_absTop(dlg[0]);
	  	var controlTop = jQuery(control).position().top;
	  	if (dlgBottom - controlTop - delta > 50) {
	  		newHeight = dlgBottom - controlTop - delta;
	  	}
	}
	else if (aa_has_simulator(control)) {	// in studio, use simulator window height
		  var simulator = jQuery(control).parents('.studio_simulator')[0];
	  	  var controlTop = aa_absTop(control,true) - aa_absTop(simulator.firstChild,true);
	  	  newHeight = simulator.clientHeight -controlTop- delta; 
	} else {// normal mode
	  var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
  	  var controlTop = aa_absTop(control,true);
  	  if (!aa_is_fixed_position(control))
  	  	controlTop -= window.scrollY;
  	  newHeight = screenHeight - controlTop- delta; 
	}
	if (newHeight < 50) newHeight = 0; // ???
	if (newHeight > 0) {
	  if (control.jbPrevHeight != newHeight)
	  	height_changed = true;
	  control.jbPrevHeight = newHeight;
	  jQuery(control).css(applyOn, newHeight+'px');
	  if (height_changed && control.jbSizeChanged)
	  	control.jbSizeChanged();
	}
	return newHeight;
}

ajaxart_update = function(element,value,expression)
{
	var dataBoundElem = jQuery(element);
	if (! dataBoundElem.hasClass("aa_custom_control"))
		dataBoundElem = jQuery(element).parents(".aa_custom_control");
	if (dataBoundElem.length == 0) return;
	ajaxart_runevent(dataBoundElem[0], '_CustomControlContext', 'UpdateData', value);
}
ajaxart_data = function(element)
{
	var context = ajaxart_get_context(element);
	if (context == null) return null;
    if (context.data.length > 0)
    	return context.data[0];
}
ajaxart_param = function(element,param_name)
{
	var context = ajaxart_get_context(element);
	if (context == null) return null;
	var param = context.params.componentContext.params[param_name];
	if (param == null) {
		ajaxart.log("Param " + param_name + " does not exist", "warning");
		return null;
	}
	if (param.length == 0) return "";
	var as_text = ajaxart.totext(param);
	if (as_text != "")
		return as_text;
	else
		return param[0];
}
ajaxart_get_context = function(element)
{
	var dataBoundElem = jQuery(element);
	if (! dataBoundElem.hasClass("aa_custom_control"))
		dataBoundElem = jQuery(element).parents(".aa_custom_control");
	if (dataBoundElem.length == 0) return;
    var context = dataBoundElem[0]["ajaxart"];
    if (typeof(context) == "undefined") {
    	ajaxart.log("control does not contain ajaxart data","warning");
    	return null;
    }
    return context;
}

ajaxart.ui.getScriptParamContext = function(scriptObject)
{
	if (typeof(scriptObject.objectForMethod) == undefined) 
		return scriptObject.context;

	var newContext = ajaxart.clone_context(scriptObject.context);
    newContext.vars['_This'] = scriptObject.objectForMethod;
    return newContext;
}

ajaxart_ui_imposeMaxLength = function(event, element, maxLen)
{
	return (element.value.length < maxLen) || ajaxart_ui_isbackwards(event);
}

ajaxart_ui_isbackwards = function(event)
{
	return (event.keyCode == 8 || event.keyCode==46 ||(event.keyCode>=35 && event.keyCode<=40));
}

ajaxart_ui_validate = function(event, element)
{
	var elem_context = element["ajaxart"];
	if (typeof(elem_context) == "undefined") 
		return true;
	
	var params = elem_context.params;
	var actionToRunPack = { script: ajaxart.getVariable(params,'KeyPressValidator')[0] , context: params};
	
	var keyCode = event.charCode;
	if (keyCode == undefined)
		keyCode = event.keyCode;
	var validation = ajaxart.run([String.fromCharCode(keyCode)],actionToRunPack.script,"",elem_context);
	var result = (validation[0] == 'true') || ajaxart_ui_isbackwards(event); 
	return result;
}
ajaxart_capture_onclick = function(f)
{
    if (window.captureEvents)
    	window.onclick = f;
	else  // IE
		document.onclick = f;
}
ajaxart_ui_capture_mousemove = function(f)
{
    if (window.captureEvents)
    	window.onmousemove = f;
	else  // IE
		document.onmousemove = f;
}
function ajaxart_stop_event_propogation(e)
{
	if (!e) return;
	if (e.stopPropagation) e.stopPropagation();
    if (e.preventDefault) e.preventDefault();
	e.cancelBubble = true;
	return false;
}

ajaxart_set_text = function(element,text)
{
	  text = text.replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;");
	  element.innerHTML = text;
}

function ajaxart_disableSelection(target){
	function makeUnselectable(node) {
	    if (node.nodeType == 1)
	        jQuery(node).addClass('unselectable');
	    var child = node.firstChild;
	    while (child) {
	        makeUnselectable(child);
	        child = child.nextSibling;
	    }
	}
	if (target) makeUnselectable(target);
}

function ajaxart_restoreSelection(target)
{
	function unmakeUnselectable(node) {
	    if (node.nodeType == 1)
	        jQuery(node).removeClass('unselectable');
	    var child = node.firstChild;
	    while (child) {
	        unmakeUnselectable(child);
	        child = child.nextSibling;
	    }
	}
	if (target) unmakeUnselectable(target);
}
ajaxart.ui.contextWithCurrentControl = function(context, control)
{
	  var newcontext = ajaxart.clone_context(context);
	  ajaxart.setVariable(newcontext,"ControlElement",[control]);
	  return newcontext;
}
ajaxart.ui.width_as_num = function(width)
{
	var out;
	if (width.indexOf("px") > 0)
		out = Number(width.split("px")[0]);
	else
		out = Number(width);
	if (isNaN(out)) return 0;
	return out;
} 
ajaxart.ui.page_dimensions = function()
{
	var d = {};
	if( window.innerHeight ) {
		d.pageYOffset = window.pageYOffset;
		d.pageXOffset = window.pageXOffset;
		d.innerHeight = window.innerHeight;
		d.innerWidth = window.innerWidth;
	} else if( document.documentElement && document.documentElement.clientHeight ) {
		d.pageYOffset = document.documentElement.scrollTop;
		d.pageXOffset = document.documentElement.scrollLeft;
		d.innerHeight = document.documentElement.clientHeight;
		d.innerWidth = document.documentElement.clientWidth;
	} else if( document.body ) {
		d.pageYOffset = document.body.scrollTop;
		d.pageXOffset = document.body.scrollLeft;
		d.innerHeight = document.body.clientHeight;
		d.innerWidth = document.body.clientWidth;
	}
	return d;
}

function aa_find_field(context,field_id)
{
	var class_to_find = "fld_" + field_id;
	if (!context || !field_id) return;
	if (context.vars.ControlElement) {
		var out = $(context.vars.ControlElement).find('.'+class_to_find);
		if (out[0]) return out.get();
	}
	var root = aa_intest ? aa_intest_topControl : document;
	var out = $(root).find('.'+class_to_find);
	if (out.length == 0) return [];
	if (out.length == 1) return out.get();
	if (out.length > 1) {
		// todo - try finding siblings to get the right one
		return out.get();
	}
}


function ajaxart_shortcut_matchs_event() 
{
	//Work around for stupid Shift key bug created by using lowercase - as a result the shift+num combination was broken
	var shift_nums = {"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":"\"",",":"<",".":">","/":"?","\\":"|"
	}
	//Special Keys - and their codes
	var special_keys = {'esc':27,'escape':27,'tab':9,'space':32,'return':13,'enter':13,'backspace':8,
'scrolllock':145,'scroll_lock':145,'scroll':145,'capslock':20,'caps_lock':20,'caps':20,'numlock':144,'num_lock':144,'num':144,'pause':19,'break':19,'insert':45,'home':36,'delete':46,'end':35,'pageup':33,'page_up':33,'pu':33,
'pagedown':34,'page_down':34,'pd':34,
'left':37,'up':38,'right':39,'down':40,
'f1':112,'f2':113,'f3':114,'f4':115,'f5':116,'f6':117,'f7':118,'f8':119,'f9':120,'f10':121,'f11':122,'f12':123
	}

	return function(shortcut_combination,e) {
		shortcut_combination = shortcut_combination.toLowerCase();
		e = e || window.event;
		
		//Find Which key is pressed
		if (e.keyCode) code = e.keyCode;
		else if (e.which) code = e.which;
		var character = String.fromCharCode(code).toLowerCase();
		
		if(code == 188) character=","; //If the user presses , when the type is onkeydown
		if(code == 190) character="."; //If the user presses , when the type is onkeydown

		var keys = shortcut_combination.split("+");
		//Key Pressed - counts the number of valid keypresses - if it is same as the number of keys, the shortcut function is invoked
		var kp = 0;
		
		var modifiers = { 
			shift: { wanted:false, pressed:false},
			ctrl : { wanted:false, pressed:false},
			alt  : { wanted:false, pressed:false},
			meta : { wanted:false, pressed:false}	//Meta is Mac specific
		};
                    
		if(e.ctrlKey)	modifiers.ctrl.pressed = true;
		if(e.shiftKey)	modifiers.shift.pressed = true;
		if(e.altKey)	modifiers.alt.pressed = true;
		if(e.metaKey)   modifiers.meta.pressed = true;
                    
		for(var i=0; k=keys[i],i<keys.length; i++) {
			//Modifiers
			if(k == 'ctrl' || k == 'control') {
				kp++;
				modifiers.ctrl.wanted = true;

			} else if(k == 'shift') {
				kp++;
				modifiers.shift.wanted = true;

			} else if(k == 'alt') {
				kp++;
				modifiers.alt.wanted = true;
			} else if(k == 'meta') {
				kp++;
				modifiers.meta.wanted = true;
			} else if(k.length > 1) { //If it is a special key
				if(special_keys[k] == code) kp++;
				
			} else { //The special keys did not match
				if(character == k) kp++;
				else {
					if(shift_nums[character] && e.shiftKey) { //Stupid Shift key bug created by using lowercase
						character = shift_nums[character]; 
						if(character == k) kp++;
					}
				}
			}
		}
		
		if(kp == keys.length && 
					modifiers.ctrl.pressed == modifiers.ctrl.wanted &&
					modifiers.shift.pressed == modifiers.shift.wanted &&
					modifiers.alt.pressed == modifiers.alt.wanted &&
					modifiers.meta.pressed == modifiers.meta.wanted) {
			return true;
		}
	}
	return false;
}

jQuery.extend(jQuery.fn, {
	disableTextSelect: function() {
		this.each( function () { ajaxart_disableSelection(this); } );
		return this;
	}
});

function aa_add_virtual_inner_element(elem,inner)
{
	if (!elem.virtual_inner_elements) elem.virtual_inner_elements = [];
	elem.virtual_inner_elements.push(inner);
}
function aa_addClassNoCheck(element,cls)
{
	if (element.className == "") element.className = cls;
	else element.className += " " + cls;
}
function aa_addClass(element,cls)
{
	if (element.className.indexOf(cls) == -1) {
		if (element.className == "") element.className = cls;
		else element.className += " " + cls;
	}
	else jQuery(element).addClass(cls);
}
function aa_hide(elem)
{
  elem.style.display = 'none'; elem.display = 'none';
}

function aa_urlHashValue(url,attr)
{
	if (url.indexOf('#') > -1) url = url.substring(url.indexOf('#'));
	var pos = url.indexOf('?'+attr+'='); 
	if (pos == -1) return "";
	var out = url.substring(pos+1);
	out = out.substring(out.indexOf('=')+1);
	if (out.indexOf('?') > -1) out = out.substring(0,out.indexOf('?'));
	if (out != "" && out.charAt(out.length-1) ==';' ) out = out.substring(0,out.length-1);
	return out;
}
aa_DateIframe = null;
function aa_fixStretchOnElem(elem)
{
	if (elem.fixStretchBottom) elem.fixStretchBottom();
	if (elem.fixStretchRight) elem.fixStretchRight();
}
function aa_fixstretch()
{
	var elems = jQuery('body').find('.aa_stretch');
	for(var i=0;i<elems.length;i++) 
	  aa_fixStretchOnElem(elems[i]);
}
function aa_init_onresize()
{
	window.aa_windowresize_timer = window.aa_windowresize_timer || 0; 
	window.onresize = function() {
		if (aa_windowresize_timer != 0)  clearTimeout(aa_windowresize_timer);
		aa_windowresize_timer = setTimeout(function() {
			aa_fixstretch();
			jBart.trigger(jBart,'windowResize',{});
			aa_windowresize_timer = 0;
		},100);
	}
}
function aa_stretchToRight(elem,margin,doNotAddOverflow)
{
	jQuery(elem).addClass('aa_stretch');
	if (!doNotAddOverflow) jQuery(elem).css('overflow','auto');
	elem.fixStretchRight = function () { aa_widthToWindowRight(this,margin); aa_htmlContentChanged(this); }
	aa_addOnAttach(elem,function() { aa_fixStretchOnElem(this); });
	aa_init_onresize();
}
function aa_stretchToBottom(elem,margin,doNotAddOverflow)
{
	jQuery(elem).addClass('aa_stretch');
	if (!doNotAddOverflow) jQuery(elem).css('overflow','auto');
	elem.fixStretchBottom = function () { ajaxart.ui.HeightToWindowBottom(this,margin); aa_htmlContentChanged(this); }
	aa_addOnAttach(elem,function() { aa_fixStretchOnElem(this); });
	aa_init_onresize();
}
function aa_init_horiz_resizer(elem,resizer)
{
	resizer.onmousedown = function(e) {
		document.onmouseup = function(e1) {
			document.onmouseup = null;
			document.onmousemove = null;
			ajaxart_disableSelection(jQuery('body')[0]);
			return false;
		}
		document.onmousemove = function(e1) {
			var mousepos = aa_mousePos(e1);
			var elemX = aa_absLeft(elem,false);
			if (mousepos.x < elemX+5) return;
			var newWidth = mousepos.x - elemX;
			jQuery(elem).width(newWidth+"px");
			aa_fixstretch();
			aa_stop_prop(e1);
			ajaxart_restoreSelection(jQuery('body')[0]);
			return false;
		}
	}
	return false;
}
function aa_load_js_css(filename, filetype) {
	filetype = filetype || 'js';
	if (ajaxart.loaded_js == null) ajaxart.loaded_js = {};
	if (ajaxart.loaded_js[filename] != null) return;
	ajaxart.loaded_js[filename] = "loaded";

	if (filetype=="js"){ //if filename is a external JavaScript file
		  var fileref=document.createElement('script');
		  fileref.setAttribute("type","text/javascript");
		  fileref.setAttribute("src", filename);
	}
	else if (filetype=="css"){ //if filename is an external CSS file
		  var fileref=document.createElement("link");
		  fileref.setAttribute("rel", "stylesheet");
		  fileref.setAttribute("type", "text/css");
		  fileref.setAttribute("href", filename);
	}
	if (fileref)
	    document.body.appendChild(fileref);
}
function aa_run_when_js_is_loaded(expression_to_check, to_run) {
	var again = function() {
		aa_run_when_js_is_loaded(expression_to_check, to_run);
	};
	if (typeof(eval(expression_to_check)) == "undefined") {
		setTimeout( again , 500 );
		return;
	}
	to_run();
}
function aa_run_when_attahced(elem, to_run)
{
	var again = function() {
		aa_run_when_attahced(elem,to_run);
	}
	if (! ajaxart.isattached(elem)) {
		  setTimeout( again , 100 );
		  return;
	  }
	to_run();
}
function aa_text_val(exp,data,context) {
	return ajaxart.totext_array(ajaxart.dynamicText(data,exp,context));
}

function aa_findByClass(elem,className) {
	var $el = jQuery(elem);
	var out = $el.find('.'+className).get();
	if ($el.hasClass(className)) out.unshift(elem);
	return jQuery(out);
}



function aa_urlHashValue(param) {
	var hash = location.hash || '#';
	if (!hash) return '';

	var pos = hash.indexOf('?'+param+'='); 
	if (pos == -1) return "";
	var out = hash.substring(pos+1);
	out = out.substring(out.indexOf('=')+1);
	if (out.indexOf('?') > -1) out = out.substring(0,out.indexOf('?'));
	if (out != "" && out.charAt(out.length-1) ==';' ) out = out.substring(0,out.length-1);
	return out;
}

aa_gcs("ui",{
	SetUrlHashValue: function(profile,data,context) {
		aa_setUrlHashValue(aa_text(data,profile,'Attribute',context),aa_text(data,profile,'Value',context))
	},
	UrlHashValue: function(profile,data,context) {
		return [aa_urlHashValue(aa_text(data,profile,'Attribute',context))];
	}	
});

function aa_setUrlHashValue(param,value) {
	var hash = location.href.split('#')[1] || '';

	var entries = aa_split(hash,'?',true);
	var value_set=false;

	for(var i=0;i<entries.length;i++) {
		if (entries[i].indexOf(param+'=') == 0) {
			entries[i] = param+'=' + value;
			value_set = true;
			if (!value) { entries.splice(i,1); i--; }
		}
	}
	if (!value_set && value)
		entries.push(param+'=' + value);

	var newhash = entries.length > 0 ? '?' + entries.join('?') : '';
	window.jbHashChangeFromJS = true;
	location.hash = '#'+newhash;
	setTimeout(function() {
		window.jbHashChangeFromJS = false;
	},50);
}

function aa_removeUrlHashValue(param) {
	var hash = location.href.split('#')[1] || '';

	var entries = aa_split(hash,'?',true);

	for(var i=0;i<entries.length;i++) {
		if (entries[i].indexOf(param+'=') == 0) {
			entries.splice(i,1);
			break;
		}
	}

	var newhash = entries.length > 0 ? '?' + entries.join('?') : '';
	location.hash = '#'+newhash;	
}

if (!ajaxart.ui) ajaxart.ui = {};
ajaxart.ui.applyKeyboardEvent = function(_event,context)
{
	if (_event != null && _event.keyCode != null) {
		var codeAsString = "";
		switch (_event.keyCode) {
		case 40: codeAsString = "down arrow"; break;
		case 38: codeAsString = "up arrow"; break;
		case 13: codeAsString = "enter"; break;
		case 32: codeAsString = " "; break;		
		}
		if (_event.keyCode >= 48 && _event.keyCode <= 126)
			codeAsString = String.fromCharCode(_event.keyCode).toUpperCase();
		if (_event.ctrlKey == true && codeAsString != null)
			codeAsString = 'Ctrl+' + codeAsString; 
		if (_event.altKey == true && codeAsString != null)
			codeAsString = 'Alt+' + codeAsString;
		ajaxart.setVariable(context, "KeyPressed",[codeAsString]);
	}
}
aa_incapture = false;
function ajaxart_runevent(element,actionContext,actionToRun,controlData,_event)
{
	if (typeof(ajaxart_captured_element) != "undefined" && ajaxart_captured_element.length > 0) return [];
	var elem_context = element["ajaxart"];
	if (typeof(elem_context) == "undefined") 
		return [];
	
	var params = elem_context.params;
	
	if (actionContext.length > 0)
	{
		var actionContextPack = params.vars[actionContext];
		if (actionContextPack == null || actionContextPack.length == 0) return [];
		var actionToRunPack = actionContextPack[0][actionToRun];
		if (actionToRunPack == null || typeof(actionToRunPack) == "undefined") return [];
	}
	else {
		var actionToRunPack = { script: ajaxart.getVariable(params,actionToRun) , context: params};
	}
	var newContext = ajaxart.clone_context(actionToRunPack.context);
	for(var i in elem_context.params.vars)
		newContext.vars[i] = elem_context.params.vars[i];
	
	if (typeof(controlData) != "undefined")
		ajaxart.setVariable(newContext,"ControlData",[controlData]);
	ajaxart.setVariable(newContext,"ControlElement",[element]);

	ajaxart.ui.applyKeyboardEvent(_event,newContext);
	if (aa_isArray(actionToRunPack.script)) return [];
	return ajaxart.run(elem_context.data,actionToRunPack.script,"",newContext);
}
function aa_stop_prop(e) 
{
	if (!e) return;
	
	if (e.stopPropagation)
		e.stopPropagation();
    if(e.preventDefault)
        e.preventDefault();

	e.cancelBubble = true;
	return false;
}

function aa_center_position_absolute(el) {
	el.style.position = 'absolute';
	el.style.top = '50%';
	aa_addOnAttachMultiple(el,function() {
		var height = $(el).height();
		el.style.marginTop = '-'+parseInt(height/2)+'px';
		if (!height) el.style.top = '40%';
	});	
}


function aa_addActionOnWindowResize(el,callback,identifier) {
	if (!el) return;
	$(el).addClass('aa_resize_listener');
	el.jbOnWindowResize = function() {
		for(var i=0;i<el.jbWindowResizeCallbacks.length;i++)
			el.jbWindowResizeCallbacks[i].callback();
	}
	el.jbWindowResizeCallbacks = el.jbWindowResizeCallbacks || [];
	if (identifier) {
		for(var i=0;i<el.jbWindowResizeCallbacks.length;i++)
			if (el.jbWindowResizeCallbacks[i].identifier == identifier) {
				el.jbWindowResizeCallbacks[i].callback = callback;
				return;
			}
	}
	el.jbWindowResizeCallbacks.push({ identifier: identifier, callback: callback});

	if (!window.jbWindowResizeListener) {
		jBart.windowResizeListenerTimeout = 0;
		window.jbWindowResizeListener = function() {
			if (jBart.windowResizeListenerTimeout) clearTimeout(jBart.windowResizeListenerTimeout);
			jBart.windowResizeListenerTimeout = setTimeout(doOnResize,200);
		};
		$(window).resize(jbWindowResizeListener);
	}

	function doOnResize() {
		jBart.windowResizeListenerTimeout = 0;
		var elems = $('.aa_resize_listener');
		for(var i=0;i<elems.length;i++) {
			try {
				elems[i].jbOnWindowResize();
			} catch(e) {
				ajaxart.logException('error in window resize callback',e);
			}
		}		
	}
}

function aa_screen_size(consider_design_time_simulator_view)
{
	if (consider_design_time_simulator_view) {
		var elem = aa_body();
		if (elem != document.body)
			return { width: $(elem).width(), height: $(elem).height()	};
	}
	var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
	var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
	return { width:screenWidth, height:screenHeight };
}

function aa_body() {
	return document.body;
}

/******************************************* Visual Container *********************************************************************/

aa_gcs('field_aspect',{
	VisualContainer: function (profile,data,context) {	
		var field = context.vars._Field[0];
		field.SectionStyle = aa_first(data,profile,'Style',context);
		var heightByCss = aa_bool(data,profile,'HeightByCss',context);
		var doNotPutWidthInElement = aa_bool(data,profile,'DoNotPutWidthInElement',context);
		var useMinHeight = aa_bool(data,profile,'SetHeightAsMinHeight',context);

		aa_bind(field,'ModifyInstanceContext',function(args) {
			var visualCntr = {
				ID: aa_text(data,profile,'ID',context),
				type: 'div',
				heightByCss: heightByCss,
				init: function(top) {
					this.el = top;
					top.jbVisualContainer = this;
					$(top).addClass('aa_visual_container').addClass(aa_text(data,profile,'CssClass',context));
					$(top).css('position','relative');
					if (this.width && !doNotPutWidthInElement) {
						$(top).width(this.width).css('overflow-x','hidden');
					}
					if (! aa_bool(data,profile,'IsDesktop',context))
						this.el.className += ' mobile';

					if (this.originalHeight) {
						$(top).css('overflow-y','auto');
						if (useMinHeight)	
							$(top).css('min-height',this.height+'px')
						else
							$(top).height(this.height);

					} else if (this.width && !heightByCss) {
						$(top).css('overflow-y','hidden');
					}
					if (this.originalHeight || heightByCss) {
						$(top).scroll(function() {
							aa_handleScroll(visualCntr,top);
						});						
					}
			
					aa_trigger(field,'initVisualContainer',{ visualContainer: this });
				},
				ForceWidth: function(width) { 
					this.width = this.forceWidth = width; 
					$(this.el).width(width);
					this.fireResize();
				},
				ForceHeight: function(height) { 
					this.height = this.forceHeight = height; 
					if (useMinHeight)	
						$(this.el).css('min-height',height+'px')
					else
						$(this.el).height(height);
					this.fireResize();
				},
				fireResize: function() {
					if (!this.el) return;
					var elems = $(this.el).find('.aa_resize_listener');
					for(var i=0;i<elems.length;i++) {
						try {
							elems[i].jbOnWindowResize();
						} catch(e) {
							ajaxart.logException('error in visual container resize callback',e);
						}
					}		
				},
				recalc: function() {
					var widthObj = aa_first(data,profile,'Width',context);
					var heightObj = aa_first(data,profile,'Height',context);
					this.width = widthObj ? widthObj.val : 0;
					this.originalHeight = heightObj ? heightObj.val : 0;
					this.height = this.originalHeight || aa_windowVisualContainer().height;
					if (heightByCss && !this.originalHeight) this.height = 0;

					if (this.forceWidth) this.width = this.forceWidth;
					if (this.forceHeight) this.height = this.forceHeight;
				},
				scrollY: function() {
					return (this.originalHeight  || heightByCss) ? this.el.scrollTop : window.pageYOffset;
				},
				scrollTop: function(y) {
					if (this.originalHeight || heightByCss)
						$(this.el).scrollTop(y);
					else
						$(window).scrollTop(y);
				},
				absTop: function() {
					return aa_absTop(this.el,true);
				}
			}
			visualCntr.recalc();

	    args.Context.vars.VisualContainer = [visualCntr];
	  });

		aa_bind(field,'beforeWrapWithSection',function(args) {
			args.sectionObject.VisualContainer = args.context.vars.VisualContainer[0];
		});

	}	

});

function aa_visualContainerStyle(section,settings) {
	settings = aa_defaults(settings,{
		sectionBody: section.$el.firstOfClass('section_body')
	});
	var visualCntr = aa_var_first(section.context,'VisualContainer');
	if (visualCntr)
		visualCntr.init($(settings.sectionBody)[0]);
	section.addSectionBody($(settings.sectionBody)[0]);	
}

function aa_windowVisualContainer() {
	if (!ajaxart.jbWindowVisualContainer) {

		var screenWidth = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
		var screenHeight = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);

		ajaxart.jbWindowVisualContainer = {
			type: 'window',
			el: document.body,
			init: function(top) {			
				$(window).scroll(function() {
					aa_handleScroll(ajaxart.jbWindowVisualContainer,document.body);					
				});
			},
			recalc: function() {
				this.width = window.innerWidth || (document.documentElement.clientWidth || document.body.clientWidth);
				this.height = window.innerHeight || (document.documentElement.clientHeight || document.body.clientHeight);
			},
			scrollY: function() {
				return window.pageYOffset;
			},
			scrollTop: function(y) {
				$(window).scrollTop(y);
			},
			absTop: function() { 
				return 0;
			},
			supportsFixedPosition: true
		}
		ajaxart.jbWindowVisualContainer.init(document.body);
	}
	ajaxart.jbWindowVisualContainer.recalc();
	return ajaxart.jbWindowVisualContainer;
}

function aa_handleScroll(visualCntr,top,delayedAction) {
	aa_run_delayed_action('scroll',function() { 
		var elems = $(top).find('.aa_scroll_listener');
		if ($(top).hasClass('aa_scroll_listener')) elems.push(top);

		for(var i=0;i<elems.length;i++) {
			try {
				var cntr2 = aa_findVisualContainer(elems[i]);
				if (visualCntr == cntr2 || !cntr2.originalHeight)
					elems[i].jbWindowScrollCallbacks();
			} catch(e) {
				ajaxart.logException('error in window scroll callback',e);
			}
		}
	},3);
}
function aa_findVisualCntrByID(id) {
	var elems = $('.aa_visual_container');
	for(var i=0;i<elems.length;i++)
		if (elems[i].jbVisualContainer && elems[i].jbVisualContainer.ID == id) 
			return elems[i].jbVisualContainer;
}

function aa_findVisualContainer(elem,context) {
	var out;
	if (context && context.vars.VisualContainer) out = context.vars.VisualContainer[0];
	else if (elem) {
		var top = $(elem).closest('.aa_visual_container')[0];
		if (top && top.jbVisualContainer) out = top.jbVisualContainer;
	}
	out = out || aa_windowVisualContainer();

	out.recalc();
	return out;
}

function aa_positionFixed(el,settings) {
	settings = aa_defaults(settings,{
		addMarginToParent: false
	});
	var ctx = settings.object && settings.object.context;

	var visualCntr = aa_findVisualContainer(el,ctx);
	if (visualCntr.supportsFixedPosition && !ajaxart.isAndroid) {
		$(el).css('position','fixed');
		if (typeof settings.bottom != 'undefined') $(el).css('bottom',settings.bottom+'px');
		if (typeof settings.top != 'undefined') $(el).css('top',settings.top+'px');

		aa_addOnAttach(el,fixParentMargin);
	} else {
		$(el).css('position','absolute');
		aa_addOnAttach(el,appear);
		aa_addActionOnScroll(el,appear,'position_fixed');
	}

	function fixParentMargin() {
		if (!settings.addMarginToParent) return;
		
		var parent = el.parentNode;
		if (parent && !parent.jbMarginFixed) {
			var height = $(el).height();
			parent.jbMarginFixed = true;
			var marginType = (typeof settings.top != 'undefined') ? 'padding-top' : 'padding-bottom';
			$(parent).css(marginType,height+'px');
		}
	}

	function appear() {
		visualCntr.recalc();
		var top = visualCntr.scrollY();
		if (!visualCntr.originalHeight && !visualCntr.heightByCss) {
			top -= visualCntr.absTop();
			if (top<0) top=0;
		}
		if (ajaxart.jbart_studio && !visualCntr.originalHeight && !visualCntr.heightByCss && top>0) {
			top += $('.studio_collapsed')[0] ? 34 : 93;
		}
		fixParentMargin();

		if (typeof settings.bottom != 'undefined') {
			var cntrHeight = visualCntr.height;
			var height = $(el).height();
			top += cntrHeight - height - settings.bottom;
		}

		$(el).css('top',top+'px');

			// if (!settings.disableZoom && screen.width) {
			// 	var inverseZoom = ((window.innerWidth)/(screen.width));
			//   el.style.zoom = inverseZoom;			
			// }
	}

}

function aa_addActionOnScroll(el,callback) {
	if (el) {
		$(el).addClass('aa_scroll_listener');
		el.jbWindowScrollCallbacks = callback;
	}
}

function aa_url_attribute(url,attr)
{
	if (url.indexOf('#') > -1) url = url.substring(url.indexOf('#'));
	var pos = url.indexOf('?'+attr+'='); 
	if (pos == -1) return "";
	var out = url.substring(pos+1);
	out = out.substring(out.indexOf('=')+1);
	if (out.indexOf('?') > -1) out = out.substring(0,out.indexOf('?'));
	if (out != "" && out.charAt(out.length-1) ==';' ) out = out.substring(0,out.length-1);
	return out;
}

function aa_setEventExtraVariables(vars) {
	jBart.eventExtraVars = null;
	if (!vars || !vars.length) return;
	jBart.eventExtraVars = {};
	for(var i=0;i<vars.length;i++)
		jBart.eventExtraVars[vars[i].Name] = vars[i].Value;
}

function aa_removeEventExtraVariables(vars) {
	jBart.eventExtraVars = null;
}

function aa_contextWithEventExtraVars(ctx) {
	if (!jBart.eventExtraVars) return ctx;
	return aa_ctx(ctx,jBart.eventExtraVars);
}
function aa_addEventListener(object,evt,callback,useCapture,wantsUntrusted ) {
	if (!object) return
	if (object.addEventListener) 
		object.addEventListener(evt,callback,useCapture,wantsUntrusted );
	else if (object.attachEvent) 
		object.attachEvent('on'+evt,callback,useCapture,wantsUntrusted );
	
	if (ajaxart.isIE) {
		// jbEvents is used for memmory cleanup (IE)
	  object.jbEvents = object.jbEvents || [];
	  object.jbEvents.push({ event: "on" + evt, callback: callback });
	}
}
function aa_removeEventListener(object,evt,callback) {
	if (!object) return
	if (object.removeEventListener) 
		object.removeEventListener(evt,callback);
	else if (object.attachEvent) 
		object.detachEvent('on'+evt,callback);

	if (object.jbEvents) {
		for(var i=0;i<object.jbEvents.length;i++)
			if (object.jbEvents[i].event == 'on'+evt && object.jbEvents[i].callback == callback)
				object.jbEvents.splice(i+1);
	}
}


function aa_register_handler(obj,event,handler,id,phase)
{
	if (obj[event] == null) obj[event] = [];
	handler.phase = phase || 0;
	var replaced = false;
	if (id)
	{
		// replace the handler if exists
		handler.Id = id;
		for(var i=0;i<obj[event].length;i++)
			if (obj[event][i].Id == id)
			{
				obj[event][i] = handler;
				replaced = true;
			}
	}
	if (! replaced)
		obj[event].push(handler);
	obj[event].sort(function(a,b) { return a.phase > b.phase ? 1 : -1; });
}


// aa_create_static_image_object converts an old image object to the new imageObject
function aa_create_static_image_object(imageObject)
{
	if (!imageObject) return null;
	if (typeof(imageObject) == 'string') return { url: imageObject};
	if (imageObject && imageObject.css3Image) return imageObject;
	
	var width = imageObject.width, height = imageObject.height;
	if (imageObject.Size) {
		var sizeArr = aa_split(imageObject.Size,',',false);
		width = sizeArr[0] ? parseInt(sizeArr[0]) : null;
		height = sizeArr[1] ? parseInt(sizeArr[1]) : null;
	}

	return {
		url: imageObject.StaticUrl,
		width: width,
		height: height,
		inSprite: imageObject.inSprite,
		x: imageObject.x,
		y: imageObject.y,
		keepImageProportions: imageObject.KeepImageProportions,
		fillImage: imageObject.FillImage,
		zoomAndOffet: imageObject.ZoomAndOffet,
		offsetY: imageObject.OffsetY,
		offsetX: imageObject.OffsetX,
		zoom: imageObject.Zoom,
		centerImage: imageObject.CenterImage,
		baseImageObject: imageObject,
		marginTop: imageObject.MarginTop,
		marginLeft: imageObject.MarginLeft,
		boxWidth: imageObject.boxWidth,
		boxHeight: imageObject.boxHeight
	};
}




aa_gcs("ui_async", {
  LoadingControl: function (profile,data,context)
  {
	  var id = aa_text(data,profile,'DivID',context);
	  var div = jQuery('#'+id);
	  if (div.length >0) { div[0].IsUsed = true; div.show(); return [div[0]]; }
	  return jQuery('<div>'+ajaxart_multilang_text("loading...",context)+"</div>").get();
  },
  ControlWithTimer: function (profile,data,context)
  {
	var out = jQuery('<div>')[0];
	setTimeout(function() {
		var contents = aa_first(data,profile,'Control',context);
		if (contents) out.appendChild(contents);
		aa_element_attached(contents);
	},20);
	return [out];
  },
  ControlUsage: function (profile,data,context)
  {
	  ajaxart_async_Mark(context);
	  aa_intest = true;
	  var control = aa_first(data,profile,'Control',context);
	  window.aa_intest_topControl = control;
	  if (control == null) { ajaxart_async_CallBack(["no control"],context); return }

      var listener = {};
      var listen = function(listener,control) {
    	  aa_async_finished_listeners.push(listener);
    	  listener.OnAsyncActionFinished = function() {
    		  if (jQuery(control).hasClass('aa_loading') || jQuery(control).find('.aa_loading').length > 0) return; // still have aa_loading. we'll wait for the next time
    		  aad_remove_async_finished_listener(listener);

    		  var newContext = aa_ctx(context,{ControlElement: [control], TopControlForTest: [control], InTest: ['true']});

    		  aa_intest = true;
    		  ajaxart_RunAsync(data,ajaxart.fieldscript(profile, 'RunOnControl',false),newContext,function() {
        		  aa_intest = true;
        		  var newContext = aa_ctx(context,{ControlElement: [control], TopControlForTest: [control], InTest: ['true']});
        		  
        		  if (context.vars._TestOutput) context.vars._TestOutput[0].OutputControl = control;

        		  var passed = aa_bool([control],profile,'ExpectedResult',newContext);
        		  ajaxart.run(data,profile,'CleanAfter',newContext);
        		  window.aa_intest_topControl = null;
        		  if (!ajaxart.inPreviewMode)
        			  ajaxart.runNativeHelper([],profile,'CloseDialogAndPopUp',context);
        		  var out= [];
        		  if (!passed) out = [control];
        		  
        		  aa_intest = false;
        		  ajaxart_async_CallBack(out,context); 
    		  });
    	  }
    	  listener.OnAsyncActionFinished();
      }
      listen(listener,control);
  },
  WaitForAsyncToFinish: function (profile,data,context)
  {
	  var jControl = jQuery(context.vars.TopControlForTest);
	  if (jControl.find('.aa_loading').length == 0) return;
      ajaxart_async_Mark(context);
      var listener = {};
      var listen = function(listener,jControl) {
    	  aa_async_finished_listeners.push(listener);
    	  listener.OnAsyncActionFinished = function() {
    		  if (jControl.find('.aa_loading').length > 0) return;	// still have aa_loading. we'll wait for the next time
    		  aad_remove_async_finished_listener(listener);
    		  ajaxart_async_CallBack(data,context);  
    	  }
      }
      listen(listener,jControl);
  }
});



ajaxart.load_usage_plugin("ui");




aa_gcs("uiaction", {
	ReloadPage: function(profile, data, context) {
		if (!ajaxart.inPreviewMode) location.reload(true);
	},
	ScrollIntoView: function(profile, data, context) {
	  	var field_id = aa_text(data,profile,'FieldID',context);
	    var control = aa_find_field_controls({ fieldID: field_id, context: context })[0];
	    if (control)
	    	control.scrollIntoView();
	},
	FireEvent: function(profile, data, context) {
		var event = aa_text(data,profile,'Event',context);
		var elements = ajaxart.getControlElement(context);
		for (var i=0;i<elements.length;i++) {
			if (i==1 && aa_bool(data,profile,'ForOnlyOneElement',context)) return ['true'];
			
			var item = elements[i];
			var props = {};
			var propButton = aa_text(data,profile,'MouseButton',context);
			var keyCode = aa_text(data,profile,'KeyCode',context);
			if (propButton == "right") { props.button = 2; };
			if (keyCode != "") { props.keyCode = keyCode; };
			aa_fire_event(item,event,context,props);
		}
		return ["true"];
	},
	ButtonClick: function(profile, data, context) 
	{
		var runOn = context.vars.ControlElement[0];
		if (!runOn) return;
		var jRunOn = jQuery(runOn);
		if (jRunOn.hasClass('aa_clickable') || jRunOn.hasClass('button_hyperlink_image') || jRunOn.hasClass('aa_button_clickable') && !runOn.jbart_click_behavior) 
			aa_fire_event(runOn,'click',context,{});
		else {
		  aa_fire_event(runOn,'mousedown',context,{});
		  aa_fire_event(runOn,'mouseup',context,{});
		}
	},
	PutInputValuesInHtmlForTests: function(profile, data, context) {
		var top = aa_var_first(context,'TopControlForTest');
		if (!top) return;
		var inputs = jQuery(top).find('input');
		for(var i=0;i<inputs.length;i++) {
			inputs[i].setAttribute('value',jQuery(inputs[i]).val());
		}
	},
	SimulateTreeDragBegin: function(profile, data, context) {
		var elem = ajaxart.getControlElement(context)[0];
		if (!elem) return;
		var cntr_ctrl = jQuery(elem).parents('.aa_container')[0];
		if (cntr_ctrl && cntr_ctrl.Cntr.TreeDragBegin)
		{
			var cntr = cntr_ctrl.Cntr;
			cntr.SuspectItemDrag = {elem: jQuery(elem), mousePos: {x:0,y:0}}
			cntr.TreeDragBegin(null,true);
		}
	},
	SimulateTreeDragEnd: function(profile, data, context) {
		var elem = ajaxart.getControlElement(context)[0];
		if (!elem) return;
		var cntr_ctrl = jQuery(elem).parents('.aa_container')[0];
		if (cntr_ctrl && cntr_ctrl.Cntr.TreeDragEnd)
		{
			var cntr = cntr_ctrl.Cntr;
			elem.appendChild( cntr.SpaceElem );
			cntr.TreeDragEnd(null,false,true);
		}
	},
	SimulateTreeDrop: function(profile, data, context) {
		var elements = ajaxart.getControlElement(context);
		return elements;
	},
	ControlElementToRunOn: function(profile, data, context) {
		var elements = ajaxart.getControlElement(context);
		return elements;
	},
	Refresh: function(profile, data, context) 
	{
		var elements = ajaxart.getControlElement(context);
		for(var i=0;i<elements.length;i++)
		{
			var newControl = jBart.utils.refresh(elements[i]);
		
			ajaxart.run(data,profile,'RunOnControl',aa_ctx(context,{ControlElement: [newControl]}));
		}
		return ["true"];
	},
	FilterContainer: function(profile, data, context)
	{
		var cntr_field_id = aa_text(data,profile,'Cntr',context),cntr=null;
		var xml = aa_first(data,profile,'FilterQueryXml',context);
		if (!ajaxart.isxml(xml)) return;
		
		if (cntr_field_id == '') 
			cntr = (context.vars.HeaderFooterCntr || context.vars._Cntr)[0];
		else if (cntr_field_id.indexOf('Page_') == 0) {
			var elem = jQuery('.'+cntr_field_id)[0];
			if (elem) cntr = elem.Cntr; 
		}
		else if (cntr_field_id.indexOf('fld_') == 0) {
			var elem = jQuery('.'+cntr_field_id)[0];
			if (elem) cntr = elem.Cntr; 
		}
		if (!cntr) return;
		
		cntr.DataHolder = cntr.DataHolder || aad_createDataHolderFromCntr(cntr,context);
		cntr.DataHolder.UserDataView.Filters = aad_cntr_filterXml2Objects(cntr,xml);
		aa_recalc_filters_and_refresh(cntr,data);
	},
	UpdateBrowserTitle: function(profile, data, context)
	{
		var title = aa_text(data,profile,'Title',context);
		document.title = title;
		return ["true"];
	},
	Hide: function(profile, data, context) 
	{
		var elem = ajaxart.getControlElement(context)[0];
		if (ajaxart.ishtml(elem))
		{
			elem.display = 'none';
			elem.style.display = 'none';
		}
		return ["true"];
	},
	SetBrowserIcon: function(profile, data, context)
	{
		var icon = aa_text(data,profile,'Icon',context);
		if (icon == "") return [];
		var link = jQuery('<link rel="shortcut icon" href="'+icon+'" type="image/x-icon">');
		$('head').append( link ) ; 
	},
	AddCssForBody: function(profile, data, context)
	{
		var cssClass = aa_cssClass(data,profile,'Css',context,'jbBody');
		if (ajaxart.jbart_studio) {
			setTimeout(function() {
				$('.gstudio_preview_top').addClass(cssClass);
			},50);
		} else {
			$('body').addClass(cssClass);
		}
	},
	FindFirstInput: function(profile, data, context)
	{
		var elements = ajaxart.getControlElement(context);
		if (elements.length == 0) return [];
		var inp = jQuery(elements[0]).find('input, textarea, .ok_button');
		if (inp.length > 0) return [ inp[0] ];
		return [];
	},
	Show: function(profile, data, context) 
	{
		var elements = ajaxart.getControlElement(context);
		
		for(var i=0;i<elements.length;i++) 
		  elements[i].style.display = 'block';
		return [];
	},
	RunEvent: function(profile, data, context)
	{
		var elements = ajaxart.getControlElement(context);
		var varname = aa_text(data,profile,'VarName',context);
		var action = aa_text(data,profile,'Action',context);
		
		for(i in elements)
			ajaxart_runevent(elements[i],varname,action);
		
		return ["true"];
	},
	Alert: function(profile, data, context)
	{
		var text = aa_text(data,profile,'Text',context);
		alert(text);
	},
	ElementByID: function(profile, data, params)
	{
		var startFrom = ajaxart.run(data,profile,'StartFrom',params);
	    var ID = aa_text(data,profile,'ID',params);
	    
	    var newparams = ajaxart.calcParamsForRunOn(params,ID,startFrom);
	    return ajaxart.getControlElement(newparams);
	},
	ElementByClass: function(profile, data, params)
	{
		var startFrom = aa_first(data,profile,'StartFrom',params);
	    var cls = aa_text(data,profile,'Cls',params);
	    if (startFrom == null || startFrom.length == 0) return [];
	    var jresult = jQuery(startFrom).find('.'+cls);
	    var out = [];
	    for (var i=0; i<jresult.length; i++)
	    	out.push(jresult[i]);
	    return out;
	},
	GoUp: function(profile, data, params)
	{
	    var topHtmlTag = aa_text(data,profile,'TopHtmlTag',params).toLowerCase();
	    var topId = aa_text(data,profile,'TopId',params);
	    topId = topId.replace(/ /g, "_");
	    var topClass = aa_text(data,profile,'TopClass',params);
	    
	    var elems = ajaxart.getControlElement(params);
	    if (! ajaxart.ishtml(elems)) return [];
	    var elem = elems[0];
	    while (elem != null && elem.nodeType != 4) {
	    	if (topClass != "" && jQuery(elem).hasClass(topClass)) return [elem];
	    	if (topId != "" && elem.id == topId) return [elem];
	    	if (typeof(elem.tagName) != "undefined" && elem.tagName.toLowerCase() == topHtmlTag) return [elem];
	    	elem = elem.parentNode;
	    }
	    
	    return [];
	},
 	RefreshItemElements: function (profile,data,context)
 	{
		var elems = ajaxart.run(data,profile,'ItemElements',context);
		ajaxart_uiaspects_refreshElements(elems);
	    
	    return ["true"];
 	},
 	SelectedItemElement: function (profile,data,context)
 	{
		var elem = ajaxart.getControlElement(context);
		if (elem.length == 0) return [];
		
		var selected = jQuery(elem[0]).find('.aa_selected_item');
		if (selected.length == 0) return [];
	    return [selected[0]];
 	},
	DeleteItemElements: function (profile,data,context)
	{
		var elems = ajaxart.run(data,profile,'ItemElements',context);
		for(var i in elems)
	  	{
			var elem = elems[i];
			if (jQuery(elem).hasClass('aa_selected_item'))
  			{
		  		 var newSel = elem.nextSibling;
		  		 if (newSel == null) newSel = elem.previousSibling; 
		  		 if (newSel == null) {
		  			 var parents = jQuery(elem).parents('.aa_item');
		  			 if (parents.length > 0) newSel = parents[0];
		  		 }
		  		 if (newSel != null)
	  	  	     {
		  			ajaxart_uiaspects_select(jQuery(newSel),jQuery(elem),"auto",context,true);
	  	  	     }
	  		 }
  			 elem.parentNode.removeChild(elem);
	  	}
	  	return ["true"];
	},
	AddItemElement: function (profile,data,context)
	{
		var item_data = ajaxart.run(data,profile,'Item',context);
		var parent_elem = aa_first(data,profile,'ParentElement',context);
		var cntr = ajaxart_uiaspects_container(context);
		var new_elem = ajaxart_uiaspects_addElement(item_data,cntr,parent_elem);
	    
		if (aa_bool(data,profile,'SelectIt',context))
			ajaxart_uiaspects_select(jQuery(new_elem),jQuery([]),"auto",context,true);
		
		ajaxart.run([new_elem],profile,'DoOnAddedElement',aa_ctx(context,{ControlElement: [new_elem]}));
	    return ["true"];
	},
	ExpandText: function (profile,data,context)
	{
		var elem = aa_first(data,profile,'ItemElement',context);
		var tds = jQuery(elem).find('>.aa_cell_element');
		for(var i=0;i<tds.length;i++)
			if (tds[i].expandableText)
				tds[i].expandableText.Build(tds[i].expandableText.States['control']);
	},
	CheckAll: function (profile,data,context)
	{
		var select = aa_bool(data,profile,'Select',context);
		var cntr = ajaxart_uiaspects_container(context);

		var elems = jQuery(cntr.Ctrl).find('.aa_item');
		for(var i=0;i<elems.length;i++)
		{
			var elem = jQuery(elems[i]);
		    var checkbox = elem.find('>.aacheckbox_value');
        	if (checkbox.length > 0 && ! elems[i].hidden && checkbox[0].checked != select )
        	{
        		if (checkbox[0].checked != select)
     			    cntr.ToogleCheckbox(cntr.Context,elem);
        		aa_checked(checkbox[0], select);
        	}
		}

	    return ["true"];
	},
	HasClass: function(profile, data, context)
	{
		var cls = aa_text(data,profile,'Cls',context);
		var elems = ajaxart.getControlElement(context);
		if (elems.length == 0) return [];
		if ( jQuery(elems[0]).hasClass(cls) ) return ["true"];
		return [];
	},	
	ReplaceControl: function(profile, data, params)
	{
		var newControl = ajaxart.run(data,profile,'NewControl',params);
		var origControl = ajaxart.getControlElement(params);
		
		if (origControl.length == 0) return [];
		if (newControl.length == 0)
			newControl = [ document.createElement('div') ];
		
		if (origControl[0].id.length > 0 && newControl[0].id.length == 0)
			newControl[0].id = origControl[0].id; 

		ajaxart.replaceXmlElement(origControl[0],newControl[0],true);
		
		return data;
	},
	Select: function(profile, data, context)
	{
		var jItems = jQuery(context.vars.ControlElement).find('.aa_item');
		for(var i=0;i<jItems.length;i++)
			if (jItems[i].ItemData && aa_bool(jItems[i].ItemData,profile,'FilterOnItem',context)) {
				ajaxart.runNativeHelper(jItems[i].ItemData,profile,'Click',aa_ctx(context,{ControlElement:[jItems[i]]}));
				return [];
			}
		
		return [];
	},
	MobileScrollToElement: function(profile, data, context)
	{
		var elem = aa_first(data,profile,'Element',context);
		var iter = elem;
		while (iter && iter.nodeType == 1)
		{
			if (iter.IScroll) {
				iter.IScroll.scrollToElement(elem,400);
				return;
			}
			iter = iter.parentNode;
		}
	},
	ItemElementByFilter: function(profile, data, context)
	{
		var jItems = jQuery(context.vars.ControlElement).find('.aa_item');
		for(var i=0;i<jItems.length;i++)
			if (aa_bool(jItems[i].ItemData,profile,'FilterOnItem',context)) 
				return [jItems[i]];
	},
	ElementByInnerFilter: function(profile, data, params)
	{
	    var elements = ajaxart.run(data,profile,'TopElement',params);
	    if (! ajaxart.ishtml(elements)) return [];
		var out = [];
		
		function _recursive_iteration(elem)
		{
			if (elem.nodeType != 1) return;
			
			if (elem.ajaxart)
				var itemdata = elem.ajaxart.data;
			else
				var itemdata = elem.ItemData;
			
			if (itemdata != null && aa_bool(itemdata,profile,'Filter',params))
				out.push(elem);
			
			var node = elem.firstChild;
			while (node != null)
			{
				if (node.nodeType == 1)
					_recursive_iteration(node);
				node=node.nextSibling;
			}
		}

		for(var i=0;i<elements.length;i++)
			_recursive_iteration(elements[i]);
		
		return out;
	},
	Focus: function(profile, data, context)
	{
	    var elems = ajaxart.getControlElement(context);
	    if (elems.length == 0) return [];
	    var elem = elems[0];
	    var timeout = 1;
	    if (ajaxart.isSafari) timeout = 100;
	    
	    function dofocus(elem) {
	    	if (!elem.tabIndex || elem.tabIndex == -1) elem.tabIndex=1;
	    	if (elem.SetFocus) return elem.SetFocus();
	    	if (aa_bool(data,profile,'OnFirstInput',context)) {
	    		if (elem.tagName.toLowerCase().indexOf('input,textarea') != -1)
	    			elem.focus();
	    		else {
	    			var e2 = jQuery(elem).find(':input')[0];
	    			if (e2) e2.focus();
	    		}
	    	}
	    	else 
	    		elem.focus();
	    }
	    
	    if (jQuery(elem).parents("body").length == 0) { //detached
	    	var set_focus = function(e) {  setTimeout(function() { 
	    		if(! ajaxart.isattached(e)) return;
	    		dofocus(e);
	    	} ,timeout); }
	    	set_focus(elem);
	    }
	    else{
    		dofocus(elem);
	    }
	    
	    return [];
   }, 
   MoveSelection : function(profile, data, params)
   {
  	 var direction = aa_text(data,profile,'Direction',params);
  	 var controls = ajaxart.getControlElement(params);
  	 if (controls.length == 0) return [];
  	 
  	 var selected = jQuery(controls[0]).find(".selected");
  	 var newSelected = [];
  	 switch (direction) {
  	 case 'One Up' 	: newSelected = selected.prev();break;
  	 case 'One Down': newSelected = selected.next();break;
  	 default : ajaxart.log("MoveSelection - no valid direction:" + direction);
  	 }
  	 if (newSelected.length > 0) {
  		 selected.removeClass("selected");
  		 newSelected.addClass("selected");
  		 
  		 ajaxart_selectionchanged(newSelected[0]);
  		 var context = controls[0]["ajaxart"];
  		 ajaxart.run( newSelected[0]["ajaxart"].data, context.script,'OnSelect', context.params );
//  		 ajaxart.run(nextData,aggProfile,'',context)
//  		 ajaxart_runevent( newSelected[0]["ajaxart"].data ,context,'OnSelect');
  	 }
   },
   RefreshAllItemsInItemList: function(profile, data, context)
   {
	   var cntr = context.vars._Cntr[0];
	   aa_recalc_filters_and_refresh(cntr,data,context);  
   },
   DataItemsOfItemInTree: function(profile, data, context)
   {
	  var elem = aa_first(data,profile,'ItemElement',context);
	  if (!elem || !elem.ItemData) return [];
	  elem = jQuery(elem).find('.aa_treenode')[0];
	  if (elem && elem._Items) return [elem._Items];
   },
   MouseRightClick: function(profile, data, context)
   {
     var elems = ajaxart.getControlElement(context);
     for(var i=0;i<elems.length;i++)
     {
       
     }
   },
   SetEnabling : function(profile, data, context)
   {
  	 var enable = aa_bool(data,profile,'Enable',context);
  	 var control = ajaxart.getControlElement(context);
  	 if (control.length == 0) return [];
  	 if (enable)
  		 control[0].removeAttribute("disabled");
     else
    	 control[0].setAttribute("disabled", "true");
   },
   GoToUrl: function(profile, data, context)
   {
	  var url = aa_text(data,profile,'Url',context);
	  if (window._gaq) // google analytics 
		  _gaq.push(['_trackPageview', '/' + url.split('/').pop()]);
      if (ajaxart.inPreviewMode == true) return [];
      var prev_loc = window.location + "_";	//make it string and not reference
	  if (url.length > 0 && window.location != url) window.location = url;
	  if (ajaxart.hash_change_by_js_count != null && prev_loc != window.location + "_")
		  ajaxart.hash_change_by_js_count++;	// for Back of browser handling
	  return ["true"];
   },
   JQueryFind: function(profile, data, context)
   {
	   var exp = aa_text(data,profile,'Expression',context);
	   var all = aa_bool(data,profile,'All',context);
	   var logOnEmptyResult = aa_bool(data,profile,'LogOnEmptyResult',context);
	   var runOnData = aa_bool(data,profile,'RunOnData',context);
	   var runOnScreen = aa_bool(data,profile,'RunOnScreen',context); 
	   var control = null;
	   if (!runOnData)
		   control = ajaxart.getControlElement(context,true);
	   else if (data.length > 0)
	  	 control = data[0];
	   if (control == null)
		   return [];
	   try {
	  	 var result = [];
	  	 if (runOnScreen) eval('result = jQuery("' + exp + '")');
	  	 else if (exp.length > 0 && exp.charAt(0) == '.' && exp.indexOf('(') != -1)
	  		 eval('result = jQuery(control)' + exp);
	  	 else
	  		 result = jQuery(control).find(exp);
		   if (result.length > 0 ) {
			   if (!all) return [ result[0] ];
			   var arr = [];
			   for(i=0;i<result.length;i++) arr.push(result[i]);
			   return arr;
		   }
		   else if (logOnEmptyResult) { ajaxart.log("JQueryFind - found nothing, expression :" + exp,"warning"); }
	   } catch(e) { ajaxart.log("JQueryFind failed, expression :" + exp,"error"); }
	   return [];
   },
   AddTextToTextboxCursor: function(profile, data, context) {
	  	var text = aa_text(data,profile,'Text',context);

	  	var field_id = aa_text(data,profile,'Textbox',context);
	    var control = aa_find_field_controls({ fieldID: field_id, context: context })[0];
    	if (control && control.jbAddTextAtCursor) return control.jbAddTextAtCursor(text);
	    if (control) {
	    	// add to text area
	    	var textarea = control.tagName.toLowerCase() == 'textarea' ? control : $(control).find('textarea')[0];

	    	textarea.value = textarea.value.substring(0,textarea.selectionStart) + text + textarea.value.substring(textarea.selectionStart);
	    }
   },
   RegisterOnPageClose: function(profile, data, context)
   {
	   window.onbeforeunload = function() { 
		   if (window.preventOnBeforeUnload) return;   // because of an ugly tinymce bug in a specific IE8 version
		   var cond = aa_bool(data,profile,'ShowMessageIf',context);
		   var message = aa_multilang_text(data,profile,'Message',context); 
		   if (cond) return message; 
	   }
	   return ["true"];
   },
   MakeCssInline : function(profile, data, context)
   {
	   	var control = aa_first(data,profile,'Control',context);
	   	var replacers_xml = aa_first(data,profile,'CssReplacer',context);
	   	var all_replacers = [];
	   	
		var replacers = aa_xpath(replacers_xml,"*",false);
		 
	    for(var i=0; i<replacers.length; i++) {
	    	var cond = replacers[i].getAttribute("Condition");
	    	var style = replacers[i].getAttribute("Css");
	    	var found = jQuery(control).find("" + cond);
	    	for (var j=0; j<found.length; j++)
	    		found[j].style.cssText = style;
	    }
	    return [control];
   },
   HideMessageBarOnUserClick: function(profile, data, context)
   {
	   var clean_message_bars = function() {
		   var messageBars = ajaxart.getControlElement(context);
		   for (i in messageBars)
			   jQuery(messageBars[i]).hide();
		   ajaxart_capture_onclick(null);
	   }
	   setTimeout(function() {ajaxart_capture_onclick(clean_message_bars)},1);
	   return ["true"];
   },
   RefreshAfterDataItemsChanged: function(profile, data, context)
   {
	   return aa_refreshAfterDataItemsChanged(context);
   },
   DownloadFile: function(profile, data, context)
   {
	   var iframe = document.createElement("IFRAME");
	   iframe.style.width = "0px";
	   iframe.style.height = "0px";
	   iframe.setAttribute("frameborder","0");
	   iframe.src = aa_text(data,profile,'Url',context);
	   jQuery(iframe).appendTo("body");
	   return [];
   },
   BindHashChangeEvent: function(profile, data, context)
   {
	   ajaxart.hash_change_func = function() { ajaxart.run(data,profile,'Action',context); }
	   ajaxart.hash_change_by_js_count = 0;
	   window.onhashchange = function ()
	   {
			// we use counter to make sure that event is not coming from js code
			if (ajaxart.hash_change_by_js_count > 0) {
				ajaxart.hash_change_by_js_count--;
				return;
			}
			if (ajaxart.hash_change_func != null)
				ajaxart.hash_change_func();
		};
	   return [];
   }
});


function aa_fire_event(item,event,context,props)
{
	if (typeof(props) == "undefined") props = {};
	
	if (! ajaxart.isSafari || ajaxart.isattached(item) )
		  aa_xFireEvent(item, event, props,context.vars.InTest != null);
	else {
		ajaxart_source_elem_in_test = item;
		while (item != null)
		{
			aa_xFireEvent(item, event,props,context.vars.InTest != null);
			item = item.parentNode;
		}
		ajaxart_source_elem_in_test = null;
	}
}

function aa_refreshAfterDataItemsChanged(context)
{
   var items = context.vars._Items[0];
   if (items == null) return [];
   if (context.vars._Cntr)
	   aa_invoke_cntr_handlers(context.vars._Cntr[0],context.vars._Cntr[0].DataItemsChange,[],context);

   var candidates = jQuery(document).find('.aa_items_listener');
   if (context.vars.ControlElement && context.vars.ControlElement[0] != null && ! ajaxart.isattached(context.vars.ControlElement[0])) {
	   var root = context.vars.ControlElement[0];
	   while (root.parentNode != null) root = root.parentNode;
	   var candidates2 = jQuery(root).find('.aa_items_listener');
	   if (candidates2.length > 0) candidates = candidates2;
   }
   var jBase = jQuery(context.vars.ControlElement);
   var substract = jBase.parents('.aa_items_listener').get();
   if (jBase.hasClass('aa_items_listener')) substract.push(jBase[0]);
   
   for(var i=0;i<candidates.length;i++) {
	   var item = candidates[i];
	   var found = false;
	   for(var j=0;j<substract.length;j++) if (item == substract[j]) found=true;
	   if (found) continue;
	   if (item._Items == items)
		   item.RefreshAfterItemsChanged.call(item);
	   else if (item._Items.EqualsToDataItems && item._Items.EqualsToDataItems(items) ) {  // used in document tree
		   item._Items.Refresh([],context);
		   item.RefreshAfterItemsChanged.call(item);
	   }
   }
   return [];
}
aa_inuiaction = false;

ajaxart.load_usage_plugin("uiaction");





var aa_intest;

ajaxart.gcs.usage = 
{
  DataUsage: function (profile,data,params)
  {
  	var user_agent = aa_text(data,profile,'UserAgent',params);
  	if (user_agent)	aa_determine_device(user_agent);
		return ajaxart.trycatch( function ()	{
//			if (ajaxart.getVariable(params, "GPXtml").length > 0) // only in aaeditor global preview
			
			ajaxart.run(data,profile,'RunBefore',params);
			var result = ajaxart.run(data,profile,'Result',params);
			var result = ajaxart.run(result,profile,'ResultTransformer',params);
			var passed = aa_bool(result,profile,'ExpectedResult',params);
//			var name = aa_text(data,profile,'Of',params) + " " + aa_text(data,profile,'Name',params);
			ajaxart.run(data,profile,'CleanAfter',params);

	 	    if (params.vars._TestOutput) {
	 	    	var out = jQuery("<span/>").text(ajaxart.usage.resultAsText(result)[0]);
	 	    	out.html(out.html().replace("\n","</br>"));
	 	    	if (params.vars._TestOutput[0].OutputControl) {
	 	    		params.vars._TestOutput[0].OutputControl[0].appendChild(out[0]);
	 	    		aa_fixTopDialogPosition();
	 	    	}
	 	    	else
		 	    	params.vars._TestOutput[0].OutputControl = out[0];
	 	    }
//	 	    if (params.vars._TestOutput) params.vars._TestOutput[0].OutputControl = ajaxart.usage.resultAsText(result);
			if (passed == false) {
				result = ajaxart.usage.resultAsText(result)[0];
				return result ? [result] : ["aa"];	// empty text means success
			}
			return [];
	}, function (e)	{ // catch
		return ["execption: " + e];
	});
  	if (user_agent)	aa_determine_device();	// put back user agent
  },
	JBartDataUsage: function (profile,data,context) {
		window.aa_intest = true;
		window.aa_intest_topControl = null;
  	var user_agent = aa_text(data,profile,'UserAgent',context);
  	if (user_agent)	aa_determine_device(user_agent);

		var ctx = aa_create_jbart_context({
			WidgetXml: context.vars._WidgetXml[0],
			Context: context
		});
		ctx = aa_merge_ctx(context,ctx);

		ajaxart.run(data,profile,'RunBefore',ctx);
		var result = aa_run(data,profile,'Result',ctx);
		var passed = aa_bool(result,profile,'ExpectedResult',ctx);

		aa_run(data, profile, 'CleanAfter', ctx);
		window.aa_intest = false;

    if (context.vars._TestOutput) {
    	var out = jQuery("<span/>").text(ajaxart.usage.resultAsText(result)[0]);
    	out.html(out.html().replace("\n","</br>"));
    	if (context.vars._TestOutput[0].OutputControl) {
    		context.vars._TestOutput[0].OutputControl[0].appendChild(out[0]);
    		aa_fixTopDialogPosition();
    	}
    	else
	    	context.vars._TestOutput[0].OutputControl = out[0];
    }
		if (user_agent)	aa_determine_device(); // put back user agent

		if (!passed) {
			result = ajaxart.usage.resultAsText(result)[0];
			return result ? [result] : ["aa"];	// empty text means success
		}
	},
	JBartActionUsage: function (profile,data,context) {			// async test!
		// Hasn't been tested yet!!!
		var deferred = $.Deferred();

		window.aa_intest = true;
		window.aa_intest_topControl = null;
  	var user_agent = aa_text(data,profile,'UserAgent',context);
  	if (user_agent)	aa_determine_device(user_agent);

		var ctx = aa_create_jbart_context({
			WidgetXml: context.vars._WidgetXml[0],
			Context: context
		});
		ctx = aa_merge_ctx(context,ctx);

		var prmoise = aa_first(data,profile,'Action',ctx);
		$.when(promise).then(function() {
			var result = aa_run(data,profile,'Result',ctx);
			var passed = aa_bool(result,profile,'ExpectedResult',ctx);

			aa_run(data, profile, 'CleanAfter', ctx);
			window.aa_intest = false;
			if (user_agent)	aa_determine_device(); // put back user agent

	    if (context.vars._TestOutput) {
	    	var out = jQuery("<span/>").text(ajaxart.usage.resultAsText(result)[0]);
	    	out.html(out.html().replace("\n","</br>"));
	    	if (context.vars._TestOutput[0].OutputControl) {
	    		context.vars._TestOutput[0].OutputControl[0].appendChild(out[0]);
	    	}
	    	else
		    	context.vars._TestOutput[0].OutputControl = out[0];
	    }

			deferred.resolve(passed ? [] : (result.length ? result : ['failed']) ); // empty means success
		});

		if (context.vars._AsyncPromiseHolder)
			context.vars._AsyncPromiseHolder[0].promise = deferred.promise();

		return [];
	},
  DataUsage_Result: function (profile,data,context)
  {
	  ajaxart.run(data,profile,'RunBefore',context);
	  return ajaxart.run(data,profile,'Result',context);
  },

  DataUsage_Data: function (profile,data,context)
  {
	  if (data.length == 0) return [""];
	  return data;
  },
  RunInTestMode: function (profile,data,context)
  {
		var intest = aa_intest;
		window.aa_intest = true;
		window.aa_intest_topControl = window.aa_intest_topControl || document;
		ajaxart.run(data,profile,'Action',context);
		window.aa_intest = intest;
  },
  RunSingleTest: function (profile,data,context)
  {
	  IsTest = true;
	  if (!ajaxart.isxml(data)) return [];
	  var usageProf = data[0];
	  
	  ajaxart.runTestLoop([usageProf],0);
	  return [];
  },
  ContainsText: function (profile,data,context)
  {
	  var look_in = aa_text(data,profile,'LookIn',context);
	  var input = data;
	  if (look_in == 'current dialog') {
		  input = [];
		  var topDialogNew = aa_top_dialog();
		  if (topDialogNew && topDialogNew.dialogContent) input = [topDialogNew.dialogContent];
		  if (!input[0] && topDialogNew) input = [topDialogNew];
		  if (!input[0]) {
  		    var dlg = openDialogs[openDialogs.length-1];
			if (dlg) input = [dlg];
		  }
	  } else if (look_in == 'current popup') {
	  	input = aa_popupElementForTests() || aa_contentsOfOpenPopup();
	  }
	  
	  if (aa_bool(data,profile,'RemoveHiddenElements',context) && ajaxart.ishtml(input[0]) ) {
	  	$(input).find('.aa_hidden_element').remove();
	  	
			var toRemove = [];
			function clear(node)
			{
				if (node.style && (node.style.display == 'none' || node.display == 'none' ))
					toRemove.push(node);
				else if (node.style && node.style.position.toLowerCase().indexOf('absolute') != -1)
					toRemove.push(node);
				else {
				  for(var i=0;i<node.childNodes.length;i++)
					clear(node.childNodes[node.childNodes.length-i-1]);
				}
			}
			clear(input[0]);
			for(var i in toRemove)
				if (toRemove[i].parentNode)
					toRemove[i].parentNode.removeChild(toRemove[i]);
	  }
		  
	  var ignoreCase = aa_bool(data,profile,'IgnoreCase',context);
	  var ignoreOrder = aa_bool(data,profile,'IgnoreOrder',context);
	  var oneOf = aa_bool(data,profile,'OneOf',context);

	  var data_text = "";
	  if (ajaxart.isxml(input))
	  	data_text = ajaxart.xml2text(input);
	  else
	  	data_text = ajaxart.totext(input);

  	  var text_items = ajaxart.runsubprofiles(data,profile,'Text',context);
  	  var startIndex = 0;
	  if (ignoreCase) data_text = data_text.toLowerCase();
	  var success = (text_items.length == 0);
	  
	  for(var i=0;i<text_items.length;i++) {
			var text = text_items[i];
	  		if (ignoreCase) text = text.toLowerCase();
	  		var new_index = data_text.indexOf(text,startIndex);
	  		if (!oneOf && new_index == -1) return [];
	  		success = true;
	  		startIndex = new_index + text.length;
	  		if (ignoreOrder || oneOf) startIndex=0;
	  };
	  if (!success) return [];

	  var notContainingText = aa_text(data,profile,'AndNotContainingText',context);
	  if (!notContainingText) return ['true'];
	  if (ignoreCase) notContainingText = notContainingText.toLowerCase();
	  
	  if (data_text.indexOf(notContainingText) > -1) return [];
	  
	  return ['true'];
  },
  And: function(profile,data,context) {
  	return ajaxart.gcs.yesno.And(profile,data,context);
  },
  Or: function(profile,data,context) {
  	return ajaxart.gcs.yesno.OR(profile,data,context);
  },
  HasFocus: function(profile,data,context) {
  	var cls = aa_text(data,profile,'CssClass',context);
  	if (jQuery(document.activeElement).hasClass(cls)) return ["true"];
  	if (jQuery(context.vars.TopControlForTest).find('.in_focus').hasClass(cls)) return ["true"];
  	if (jQuery('.in_focus').hasClass(cls)) return ["true"];
  	return [];
  }
}

ajaxart.usage = {};
ajaxart.usage.resultAsText = function(result)
{
	if (result.length == 0) 
		return ["false"];

	if (ajaxart.isxml(result))
		return [ ajaxart.xml2text(result) ];
//		return [ aa_xmlescape(ajaxart.xml2text(result)) ];

	if (ajaxart.isObject(result[0]))
		return [ajaxart.text4trace(result)];
	else
		return result;
	
	return result;
}



aa_gcs("xml", {
	XmlToText: function(profile, data, context) {
		if (!data[0]) return [''];
		if (!data[0].nodeType) {
			try {
			  return [JSON.stringify(data[0])];
			} catch(e) {
				return aa_totext(data);
			}
		}
//	    if (!data[0] || !data[0].nodeType) return [ aa_totext(data) ];
		var pretty_print = aa_bool(data,profile,'PrettyPrint',context);
		var escape = aa_bool(data,profile,'Escape',context);
		if (data.length == 0) return [];
		if (! ajaxart.isxml(data[0]))
			return data[0];
		
		if (pretty_print)
			return [ ajaxart.xml.prettyPrint(data[0]) ];
		else
			return [ ajaxart.xml2text(data[0]) ];	
	},
	TextToXml: function(profile, data, context) {
		var xml = data[0];
		if (xml && xml.nodeType == 1) return [xml];
		if (xml && xml.nodeType == 9 && xml.documentElement) return [xml.documentElement];
		return [aa_parsexml(ajaxart.totext(data),"TextToXml",null,true)];
	},
	ParseXmlCleanNamespaces: function(profile, data, context) {
		var text = aa_text(data,profile,'XmlAsText',context);
		var cleanXml = aa_clean_xml_namespaces(text);
		return [aa_parsexml(cleanXml)];
	},
	XmlToJson: function(profile, data, context) {
		var xml = aa_first(data,profile,'Xml',context);
		return [aa_xml2JSON(xml)];
	},
	JSONToXml: function(profile, data, context)
	{
		var tag = aa_text(data,profile, 'Tag', context);
		var obj = aa_first(data,profile, 'JSON', context);
		if (typeof obj == 'object') {
			obj = jQuery.extend({}, obj); // clone
			delete obj.XtmlSource;
		}
		if (typeof obj != 'object' && aa_text(data,profile, 'InputFormat', context) != 'Object')
			obj = ajaxart.totext_item(obj);
		var xml = obj && aa_JSON2Xml(obj,tag);
		return xml ? [xml] : [];
	},
	CSVToXml: function(profile, data, context)
	{
		var xml = aa_CSV2Xml(aa_text(data,profile, 'CSV', context));
		if (xml)
			return [xml];
		return [];
	},
	XPath: function(profile, original_data, context) {
		var xpath = aa_text(original_data,profile, 'XPath', context);
		var createIfNotExist = aa_bool(original_data,profile, 'CreateIfDoesNotExist', context);
		var def = aa_text(original_data,profile, 'DefaultValue', context);
		var data = ajaxart.run(original_data,profile, 'From', context);
		if (data == null) data = original_data;
		
		if (xpath == "") return data;
		
		if (! ajaxart.isxml(data) || xpath == "") return [];
		var result = aa_xpath(data[0],xpath,createIfNotExist,def);
		return result;
	},
	XPathFromList: function(profile, data, context) {
		var xpath = aa_text(data,profile,'XPath',context);
		var list = ajaxart.run(data,profile,'List',context);

		if (xpath == "") return list;
		
		var isAttr = (xpath.charAt(0) == '&');
		var attr = "";
		if (isAttr) attr = xpath.substring(1);
		
		var out = [];
		for(var i=0;i<list.length;i++) {
			var item = list[i];
			if (isAttr) {
				var nextItem = item.getAttribute(attr);
				if (aa_hasAttribute(item,attr)) out.push(nextItem);
			}
			else {
				var results = aa_xpath(item,xpath);
				ajaxart.concat(out,results);
			}
		}
		
		return out;
	},
	NextSibling: function(profile, data, context) {
		var xml = data[0];
		while (xml) {
			xml = aa_nextElementSibling(xml);
			if (!xml) return [];
			if (aa_bool([xml],profile,'Filter',context)) return [xml];
		}
	},
	PreviousSibling: function(profile, data, context) {
		var result = ajaxart.xml.PrevSibling(data[0],null);
		if (result != null)
			return [result];
		return [];
	},
	CloneNodeCleanNS: function(profile,data,context) {
		var xml = aa_first(data,profile,'Xml',context);
		return [aa_xml_cloneNodeCleanNS(xml)];
	},
    ChildAtPosition: function(profile,data,context)
    {
        var position = aa_int(data,profile,'Position',context);
        if (ajaxart.isxml(data) && data[0].nodeType == 1 )
        {
            var xml_item = data[0];
            var t=0;
            for (var i=0;i<xml_item.childNodes.length;i++)
            {
                if (xml_item.childNodes.item(i).nodeType == 1) t++;
                if (t == position)
                    return [xml_item.childNodes.item(i)];
            }
        }
        return [];
    },
	ToXmlElement: function(profile, data, context) {
		if (data.length == 0) return [];
		var xml = data[0];
		if (xml.nodeType == 1) return data;
		if (xml.nodeType == 2 || xml.nodeType == 3 || xml.nodeType == 4) 
			return aa_xpath(xml,'..');
		
		return [];
	},
	XPathOfNode: function(profile, data, context) {
		var id = aa_text(data,profile, 'StopAtIDAttribute', context);
		var specific = aa_bool(data,profile, 'Specific', context); 
		var top = aa_first(data,profile,'TopXml',context);
		
		if (data.length == 0) return [];
		return [ ajaxart.xml.xpath_of_node(data[0],id,specific,top) ];
	},
	XPathOfNodeWithTopTags: function(profile, data, context) {
		var tags = ajaxart.run(data,profile, 'TopTags', context);
		var top = aa_first(data,profile,'TopXml',context);
		if (! ajaxart.isxml(data)) return [];

		var tagsStr = "";
		for(var i=0;i<tags.length;i++) tagsStr += "," + ajaxart.totext(tags[i]) + ",";

		var out = "";
		var xml = data[0];
		var tag = "";
		
		while (xml != null && xml.nodeType != 9)
		{
			if (top != null && xml == top) break;
			if (xml.nodeType == 2) // atribute
			{
				out = "@" + xml.nodeName;
			}
			else // element
			{
				var tag = aa_tag(xml);
				if (tagsStr.indexOf(","+tag+",") > -1) {
					out = aa_text([tag],profile,'PrefixByTagToAdd',context)+ out;
					break;
				}
	
				if (out.length > 0) 
					out = xml.nodeName + "/" + out;
				else 
					out = xml.nodeName;
			}
			
			xml = ajaxart.xml.parentNode(xml);
		} 
		
		return [ out ];
	}, 
	ChangeXml : function(profile, data, context) 
	{
		var xml_src = aa_first(data,profile,'Xml',context);
		if (xml_src == null) return [];
		xml_src = [xml_src];
		if (! ajaxart.isxml(xml_src)) return [];
		var newContext = ajaxart.clone_context(context);
		ajaxart.setVariable(newContext,"InputForChanges",data);
		var changes = ajaxart.subprofiles(profile,'Change');
		
		ajaxart.each(xml_src, function(item) {
			ajaxart.each(changes,function(changeProfile) {
				ajaxart.run([item],changeProfile, "", newContext);
			});
		});
		return ["true"];		
	},
	ItemByID: function(profile, data, context) {
		var list = ajaxart.run(data,profile,'List',context);
		var id = aa_text(data,profile,'ID',context);
		
		for(var i=0;i<list.length;i++)
			if (typeof(list[i].getAttribute) != "undefined" && list[i].getAttribute('id') == id)
				return [ list[i] ];
		
		return [];
	},
	Delete: function(profile, data, context) {
		var xmls = ajaxart.run(data,profile,"Element",context);
		for(var i=0;i<xmls.length;i++) {
			var item = xmls[i];
			if (item.nodeType == 2) // attribute
			{
				var ownerElement = ajaxart.xml.parentNode(item);
				ownerElement.removeAttribute(item.nodeName);
			}
			var parent = item.parentNode;
			if (parent != null)
			{
				parent.removeChild(item);
				aa_triggerXmlChange(parent);
			}
		}
		return data;
	},
	RemoveMiddleElement: function(profile, data, context) {
		var elems = ajaxart.run(data,profile,'Element',context);
		for(var i in elems) {
			var elem = elems[i];
			if (!elem || elem.nodeType != 1) return;
			var parent = elem.parentNode;
			while (elem.firstChild) parent.appendChild(elem.firstChild);
			parent.removeChild(elem);
		}
	},
	DeleteChildren: function(profile, data, context) {
		var parent = ajaxart.run(data,profile,'ParentElement',context);
		if ( ! ajaxart.isxml(parent) ) return parent;
		var xml = parent[0];
		var hadChildren = !!xml.firstChild;
		while (xml.firstChild != null)
			xml.removeChild(xml.firstChild);
		
		if (hadChildren) aa_triggerXmlChange(xml);
		return data;
	},
	FindXmlByAttribute: function(profile, data, context) {
		var xml = aa_first(data,profile,'ParentXml',context);
		var attr = aa_text(data,profile,'Attribute',context);
		var value = aa_text(data,profile,'Value',context);
		var findAll = aa_bool(data,profile,'FindAll',context);
		
		var out = [];
		
		if (xml == null || xml.nodeType != 1 || attr == "") return [];
		var find = function(xml,attr,value,out,findAll) {
			if (xml.getAttribute(attr) == value) {
				out.push(xml);
				if (!findAll) return;
			}
			var child = xml.firstChild;
			while (child != null) {
				if (child.nodeType == 1) {
					find(child,attr,value,out,findAll);
					if (out.length > 0 && ! findAll) return;				
				}
				child = child.nextSibling;
			}
			return [];
		}
		find(xml,attr,value,out,findAll);
		return out;
	},
	DeleteAttributes: function(profile, data, context) {
		var parent = ajaxart.run(data,profile,'ParentElement',context);
		var exclude = ajaxart.run(data,profile,'Exclude',context);
		
		if ( ! ajaxart.isxml(parent) ) return parent;
		var xml = parent[0];
		if (xml.nodeType != 1) return data;
		
		var exclude_atts = {};
		for (var i=0; i<exclude.length; i++) {
			var exclude_att = ajaxart.totext(exclude[i]);
			if (exclude_att != "")
				exclude_atts[exclude_att] = true;
		}
		var names = [];
		for (var i=0; i<xml.attributes.length; i++)
			names.push(xml.attributes.item(i).name);
		for (var i=0; i<names.length; i++) {
			if (exclude_atts[names[i]] == null) 
				xml.removeAttribute(names[i]);
		}
		
		return data;
	},
	Update :function(profile, data, context) {
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var newValue = ajaxart.run(inputForChanges,profile, 'NewValue', context);
		ajaxart.writevalue(data, newValue);
		return data;
	},
	ReplaceXmlElement: function(profile, data, context)
	{
		var elem = aa_first(data,profile, 'Element', context);
		var newElem = aa_first(data,profile, 'NewElement', context);
		var mode = aa_text(data,profile, 'Mode', context);

		if (newElem && typeof(newElem) == 'string') newElem = aa_parsexml(newElem);
		
		if (!elem || !newElem || elem == newElem || elem.nodeType != 1 || newElem.nodeType != 1) return;

	    if (mode == "keep original tag") {
			ajaxart.xml.copyElementContents(elem,newElem);
		} else if (mode == "replace tag") {
			ajaxart.replaceXmlElement(elem,newElem,false);
			elem = newElem;
		}
		aa_triggerXmlChange(elem);
		ajaxart.run([elem],profile,'RunOnNewElement',context);
	},
	ReplaceElement: function(profile, data, context)
	{
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var elem = aa_first(data,profile, 'Element', context);
		var newElem = aa_first(inputForChanges,profile, 'NewElement', context);
		var mode = aa_text(inputForChanges,profile, 'Mode', context);
	
		if (! ajaxart.isxml(elem) ) return data;  
		if (newElem != null && ! ajaxart.isxml(newElem) ) return data;
		if (newElem == elem) return data;
		var parent = elem.parentNode;

		if (newElem != null) 
		{
		  if (mode == "keep original tag" || aa_tag(elem) == aa_tag(newElem) )
			ajaxart.xml.copyElementContents(elem,newElem);
		  else if (mode == "replace tag")
		  {
			ajaxart.replaceXmlElement(elem,newElem,false);
			elem = newElem;
		  }
		}
		else
			if (parent != null) parent.removeChild(elem);
		
		if (elem != null)
		{
			aa_triggerXmlChange(elem);
			ajaxart.run([elem],profile,'RunOnNewElement',context);
		}
		else
		{
			aa_triggerXmlChange(parent);
		}
		
		return data;
	},
	
	MoveElementAfterIndex: function(profile, data, context)
	{
		var elem = data[0];
		var after = aa_int(data,profile, 'Index', context);
	
		if (typeof(elem) == "undefined" || elem.nodeType != 1 ) return []; // Not Element  
				
		var parent = elem.parentNode;
		var tag = aa_tag(elem);

		var dest = ajaxart.xml.FirstChild(parent,tag);
		var last_of_tag = dest; // helper for last
	  	for(var i=0;i<after;i++)
	  	{
	  		last_of_tag = dest;
	  		dest = ajaxart.xml.NextSibling(dest,tag);
	  	}

		if (dest == elem) return data;
		var theElement = parent.removeChild(elem);
		if (dest == null) // last
		{
			if (last_of_tag == null || last_of_tag.nextSibling == null)
				parent.appendChild(theElement);
			else
				parent.insertBefore(theElement,last_of_tag.nextSibling);
		}
		else if (dest != null)
			parent.insertBefore(theElement,dest);
		
		return data;

	},

	MoveElement: function(profile, data, context)
	{
		var elem = data[0];
		var to = aa_text(data,profile, 'To', context);
	
		if (typeof(elem) == "undefined" || elem.nodeType != 1 ) return []; // Not Element  
		var parent = elem.parentNode;
		var tag = aa_tag(elem);

		var dest = null;
		if (to == "next")
		{
			dest = ajaxart.xml.NextSibling(elem,tag); 
			if (dest == null) return [];
			dest = ajaxart.xml.NextSibling(dest,tag); // no method insertAfter... 
			if (dest == null)
				to = "last";
		}
		if (to == "previous")
			dest = ajaxart.xml.PrevSibling(elem,tag); 
		if (to == "first")
			dest = ajaxart.xml.FirstChild(parent,tag); 
		if (to == "last")
		{
			dest = ajaxart.xml.FirstChild(parent,tag);
			var last_of_tag = dest; // helper for last
		  	while (dest != null)
		  	{
		  		last_of_tag = dest;
		  		dest = ajaxart.xml.NextSibling(dest,tag);
		  	}
			var theElement = parent.removeChild(elem);
			if (last_of_tag == null || last_of_tag.nextSibling == null)
				parent.appendChild(theElement);
			else
				parent.insertBefore(theElement,last_of_tag.nextSibling);
			return;
		}

		if (dest == elem) return data;
		if (dest != null)
		{
			var theElement = parent.removeChild(elem);
			parent.insertBefore(theElement,dest);
		}
		if (parent != null) aa_triggerXmlChange(parent);
		
		return data;
		
	},
	RegisterModifyOnXml: function (profile,data,context)
	{
		var xml = aa_first(data,profile,'Xml',context);
		var id = aa_text(data,profile,'SingletonId',context);
		ajaxart._RegModifyXmlChangeID = ajaxart._RegModifyXmlChangeID || {};
		aa_unbindXmlChange(ajaxart._RegModifyXmlChangeID[id]);

		ajaxart._RegModifyXmlChangeID[id] = aa_bindXmlChange(xml,function(changedXml) {
			ajaxart.run(changedXml ? [changedXml] : [],profile,'Action',context);
		});
	},
	RemoveAttributes: function(profile, data, context) 
	{
		if (data.length == 0 || !ajaxart.isxml(data) || data[0].nodeType != 1)
			return [];
		var attributes = ajaxart_run_commas(data,profile, 'AttributeNames', context);
		for (i in attributes) 
			data[0].removeAttribute( ajaxart.totext(attributes[i]) );
		return data;
	},
	HasAttribute: function(profile, data, context) {
	  var attr = aa_text(data,profile,'Attribute',context);
	  if ((! ajaxart.isxml(data)) || data[0].nodeType != 1) return [];
	  if (aa_hasAttribute(data[0],attr)) 
		  return ["true"];
	  return [];
	},
	HasParent: function(profile, data, context) {
		if (! ajaxart.isxml(data)) return [];
		if (data[0].parentNode == null) return [];
		return ["true"];
	},
	AddSiblings: function(profile, data, context) {
		var elem = aa_first(data,profile,'ExistingElement',context);
		var newElems = aa_run(data,profile,'NewElements',context);
		var addAfter = aa_text(data,profile,'Position',context) == 'after';
		var out = [];

		if (!elem || !elem.parentNode) return;
		for(var i=0;i<newElems.length;i++) {
			if (!newElems[i]) continue;
			var newElem = aa_importNode(newElems[i],elem);
			out.push(newElem);

			if (addAfter)
				elem = $(newElem).insertAfter(elem)[0];
			else
				elem.parentNode.insertBefore(newElem,elem);
		}
		
		aa_run(out,profile,'DoOnNewChild',context);
		aa_triggerXmlChange(elem.parentNode);
	},
	AddChildInPosition: function(profile, data, context) {
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var child = aa_first(inputForChanges,profile, 'Child', context);
		var posObj = aa_first(inputForChanges,profile, 'Position', context);
		if (child == null || ! ajaxart.isxml(child) || ! ajaxart.isxml(data)) return data;
		var identicalTags = aa_bool(data,profile,'IdenticalTags',context);
		
		var parent=data[0];
		var tag = aa_tag(child);
		
		var insertBeforeMe = null;
		if (posObj != null) 
		{
			var pos = parseInt(ajaxart.totext(posObj));
			var counter=0;
			var node = data[0].firstChild;
			while (node != null)
			{
				if (node.nodeType == 1 && ( aa_tag(node) == aa_tag(child) || !identicalTags))
				{
					if (++counter == pos) insertBeforeMe = node;
				}
				node = node.nextSibling;
			}
		}
		child = aa_importNode(child, data[0]);
		
		if (insertBeforeMe == null)
		{
			// find last of tag and add after it
			var dest = ajaxart.xml.FirstChild(parent,tag);
			var last_of_tag = dest; // helper for last
		  	while(dest != null)
		  	{
		  		last_of_tag = dest;
		  		dest = ajaxart.xml.NextSibling(dest,tag);
		  	}

			if (last_of_tag == null || last_of_tag.nextSibling == null)
					parent.appendChild(child);
				else
					parent.insertBefore(child,last_of_tag.nextSibling);
		}
		else
			data[0].insertBefore(child,insertBeforeMe);
		
		ajaxart.run([child],profile,'DoOnNewChild',context);
		aa_triggerXmlChange(parent);
		
		return [child];
	},
	RemoveXmlAttribute: function(profile, data, context) {
		var parent = aa_first(data,profile,'Element',context);
		var attr = aa_text(data,profile,'AttributeName',context);
		if (parent && parent.nodeType == 1 && aa_hasAttribute(parent,attr)) {
			parent.removeAttribute(attr);
			aa_triggerXmlChange(parent);
		}
	},
	RemoveXmlNode: function(profile, data, context) {
		var xml = aa_first(data,profile,'Xml',context);
		if (!xml || !xml.nodeType) return;
		var parent = aa_xpath(xml,'..')[0];
		if (!parent) return;

		if (xml.nodeType == 2) // attribute
			parent.removeAttribute(xml.nodeName);

		if (xml.nodeType == 1)
			parent.removeChild(xml);

		aa_triggerXmlChange(parent);
	},
	AddXmlChildren: function(profile, data, context) {
		var parent = aa_first(data,profile,'Parent',context);
		var children = ajaxart.run(data,profile,'Children',context);
		var clone = aa_bool(data,profile,'CloneChildren',context);
		var asFirst = aa_bool(data,profile,'AddAsFirst',context);
		if (!parent) return;
		
		var adddedChildren = [];
		for(var i=0;i<children.length;i++) {
			if (children[i].nodeType != 1) continue;
			var item = (clone) ? children[i].cloneNode(true) : children[i];
			adddedChildren.push( aa_xml_appendChild(parent,item,asFirst) );
		}
		
		if (children.length > 0) aa_triggerXmlChange(parent);
		
		ajaxart.run(adddedChildren,profile,'DoOnAddedChildren',context);
	},
	ReplaceChildren: function(profile, data, context) {
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var children = ajaxart.run(inputForChanges,profile, 'Children', context);
		var clone = aa_bool(inputForChanges,profile,'CloneChildren',context);
		if (data.length == 0) return [];
		
		while (data[0].firstChild != null)
			data[0].removeChild(data[0].firstChild);
		
		ajaxart.each(children,function(item) {
			if (!clone)
				aa_xml_appendChild(data[0],item);
			else
				aa_xml_appendChild(data[0],ajaxart.xml.clone([item]));
		});
		if (children.length > 0) aa_triggerXmlChange(data[0]);
		return data;
	},
	PerformChanges : function(profile, data, context) {
		var changeProfiles = ajaxart.subprofiles(profile, 'Change');
		for(var i=0;i<changeProfiles.length;i++)
			ajaxart.run(data,changeProfiles[i],'',context);
		return ["true"];
	},
	MultiChange : function(profile, data, context) {
		var changeProfiles = ajaxart.subprofiles(profile, 'Change');
		var inputforChanges = ajaxart.getVariable(context,"InputForChanges");
		var dataForChanges = ajaxart.run(inputforChanges,profile, 'DataForChanges', context);
		var performChangesOn = ajaxart.run(data,profile, 'PerformChangesOn', context);
		var newContext = ajaxart.clone_context(context);

		ajaxart.each(dataForChanges, function(item) {
			ajaxart.setVariable(newContext,"InputForChanges",[item]);
			if (performChangesOn.length == 0) {
				for(var i=0;i<changeProfiles.length;i++)
					ajaxart.run(data,changeProfiles[i],'',newContext);
			} else 
				ajaxart.each(performChangesOn, function(change_item) {
					for(var i=0;i<changeProfiles.length;i++)
						ajaxart.run([change_item],changeProfiles[i],'',newContext);
				});
		});
			
		return data;
	},
	UpTillMatchesFilter: function(profile, data, context)
	{
		if (! ajaxart.isxml(data)) return [];
		var xml = data[0];
		if (aa_bool([xml],profile,'Filter',context))
			return [xml];
		var xml = ajaxart.xml.parentNode(xml);
		while (xml != null && xml.nodeType == 1)
		{
			if (aa_bool([xml],profile,'Filter',context))
				return [xml];
			xml = xml.parentNode;
		}
		return [];
		
	},
	RemoveInnerText: function(profile, data, context)
	{
		if (! ajaxart.isxml(data)) return data;
		var xml = data[0];
		if (xml.nodeType == 1)
		{
			 var node = xml.firstChild;
			 while (node != null)
			 {
				var prev = node;
				node=node.nextSibling;
				if (prev.nodeType == 3 || prev.nodeType == 4) xml.removeChild(prev);
			 }			
			 aa_triggerXmlChange(data[0]);
		}
		return data;
	},
	InnerTextValue: function(profile, data, context) 
	{
		if (!ajaxart.isxml(data)) return [];
		
		var node = data[0].firstChild;
		while (node != null) {
			if (node.nodeType == 3 || node.nodeType == 4) return [node];
			node=node.nextSibling;
		}
		
		return [];
	},
	InnerText: function(profile, data, context) {
		var out = [];
		ajaxart.each(data,function(item) {
			if (! ajaxart.isxml(item)) {
				return [];
			}
			if (item.nodeType == 2) return [item];
			var text_node = item.firstChild;
			if (text_node == null)	{
				text_node = item.ownerDocument.createTextNode("");
				item.appendChild(text_node);
			}
			out.push(text_node);
		});
		return out;
	},
	IndexOfElement: function(profile,data,context)
	{
		var startIndex = aa_text(data,profile,'IndexOfFirstElement',context);
		if (ajaxart.isxml(data) && data[0].nodeType == 1 && data[0].parentNode != null)
		{
			var xml_item = data[0];
			var count = startIndex;

			for (var i=0;i<xml_item.parentNode.childNodes.length;i++)
			{
				var brother = xml_item.parentNode.childNodes.item(i);
				if (brother.nodeType == 1 && aa_tag(brother) == aa_tag(xml_item))
				{
					if ( brother == xml_item ) return [""+count];
					count++;
				}
			}
		}
		return [];
	},
	IsAttribute: function(profile,data,context)
	{
		if (ajaxart.isxml(data) && data[0].nodeType == 2 ) return ["true"];
		return [];
	},
	AreSiblings: function(profile,data,context)
	{
  		var parent = null;
  		for (var i=0;i < data.length; i++)
  		{
  			var new_parent = data[i].parentNode;
  			if (new_parent != parent && i != 0) 
  				return [];
  			parent = new_parent;
  			if (parent == null || parent == undefined) 
  				return [];
  		}
		return ["true"];
	},
	IsElement: function(profile,data,context)
	{
		if (ajaxart.isxml(data) && data[0].nodeType == 1 ) return ["true"];
		return [];
	},
	IsCData: function(profile,data,context)
	{
		if (ajaxart.isxml(data) && data[0].nodeType == 4 ) return ["true"];
		return [];
	},
	ByTag: function(profile,data,context)
	{
		var tag = aa_text(data,profile, 'Tag', context);
		if (tag == "") return [];
		var xmlForDocument = aa_first(data,profile,'XmlForDocument',context);
		var elem = aa_createElement(xmlForDocument,tag);
		
		if (elem == null) return [];
		var newContext = ajaxart.clone_context(context);
		ajaxart.setVariable(newContext,"InputForChanges",data);
		var changes = ajaxart.subprofiles(profile,'Change');
		for(var i=0;i<changes.length;i++)
			ajaxart.run([elem],changes[i], "", newContext);
		return [elem];
	},
	ElementOfDynamicTag: function(profile,data,context)
	{
		var tag = aa_text(data,profile, 'Tag', context);
		if (tag.length == 0) return [];
		var elem = aa_createElement(data[0],tag);  
		if (elem == null) return [];
		var newContext = ajaxart.clone_context(context);
		ajaxart.setVariable(newContext,"InputForChanges",data);
		var changes = ajaxart.subprofiles(profile,'Change');
		ajaxart.each(changes,function(changeProfile) {
			ajaxart.run([elem],changeProfile, "", newContext);
		});
		return [elem];
	},
	XmlWithChangedTag: function(profile,data,context)
	{
		var tag = aa_text(data,profile, 'Tag', context);
		var base = aa_first(data,profile, 'BaseXml', context);
		if (tag.length == 0 || (! ajaxart.isxml(base)) ) return [];
		var elem = aa_createElement(base,tag);  
		if (elem == null) return [];
		ajaxart.xml.copyElementContents(elem,base);
		return [elem];
	},
	FindElementByID: function(profile,data,context)
	{
		var id = aa_text(data,profile, 'Id', context);
		if (data.length == 0) return [];
		result = ajaxart.xml.findById(data[0],id);
		if (result == null) return [];
		return [result];
	},
	Clone: function(profile,data,context)
	{
		var xml = aa_first(data,profile,'Xml',context);
		if (xml == null) return [];
		if (!ajaxart.isxml(xml)) return [];

		return [ ajaxart.xml.clone([xml]) ];
	},
	TextRowToXml: function(profile,data,context)
	{
		var tag = aa_text(data,profile,'Tag',context);
		var atts = aa_text(data,profile,'Attributes',context);
		var sep = aa_text(data,profile,'Separator',context);
		
		var src_list = data[0].split(sep);
		var atts_list = atts.split(',');
		var result = aa_createElement(data[0],tag);  

		for(var i=0;i<atts_list.length;i++)
			result.setAttribute(atts_list[i],src_list[i]);
		
		return [ result ];
	},
	CopyAttributes: function(profile,data,context)
	{
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var source = ajaxart.run(inputForChanges, profile, 'SourceElement', context);
		var overrideExistingAttributes = aa_bool(data,profile, 'OverrideExistingAttributes', context);
		
		if (data.length == 0 || source.length == 0 || source[0].nodeType != 1 || data[0].nodeType != 1) return data;

		var atts = source[0].attributes;
		if (atts != null)
		for (var i = 0; i < atts.length; i++) {
			var attName = atts.item(i).nodeName;
			if (overrideExistingAttributes || aa_hasAttribute(source[0],attName) )
				data[0].setAttribute(attName, source[0].getAttribute(attName) || '' );
		}

		return data;
	},
	OverrideAttributesAndElements: function (profile,data,context)
	{
		var inputForChanges = ajaxart.getVariable(context,"InputForChanges");
		var source = aa_first(inputForChanges, profile, 'SourceXml', context);
		if (data.length == 0 || source == null || source.nodeType != 1 || data[0].nodeType != 1) return data;
		var target = data[0];
		
		var atts = source.attributes;
		for (var i = 0; i < atts.length; i++) {
			var attName = atts.item(i).nodeName;
			  target.setAttribute(attName, source.getAttribute(attName) || '');
		}

		jQuery(target).empty();
		
		var child = source.firstChild; 
		while (child != null)
		{
			if (child.nodeType == 1)
			  target.appendChild(child.cloneNode(true));
			child = child.nextSibling;
		}
		
		return data;
	},
	IfThenElse : function (profile,data,context)
	{
		var passed = aa_bool(data,profile,'If',context);
		if (passed)
			ajaxart.run(data,profile,'Then',context);
		else
			ajaxart.run(data,profile,'Else',context);
		return data;
	},
	  MoveBefore: function (profile,data,context)
	  {
		if (data.length == 0) return [];
	    var item = data[0].Item[0];
	    var to = data[0].BeforeItem[0];
		if (ajaxart.isxml(to) && ajaxart.isxml(item) )
			if (to.parentNode == item.parentNode && item.parentNode != null)
				to.parentNode.insertBefore(item,to);
	    return [];
	  },
	  MoveToEnd: function (profile,data,context)
	  {
		if (data.length == 0) return [];
	    var item = data[0];
		if (ajaxart.isxml(item) && item.parentNode != null)
			item.parentNode.appendChild(item);
				
	    return [];
	  },
	CleanEmptyAttributes: function (profile,data,context)
	{
		var recursive = aa_bool(data,profile,'Recursive',context);
		var ignore = ajaxart.run(data,profile,'IgnoreAttributes',context);
		var ignore_str = "";
		for(var i=0;i<ignore.length;i++) ignore_str += "," + ignore[i] + ",";
		
		if (! ajaxart.isxml(data)) return [];
		
		var cleanElement = function(element,ignore_str,recursive) {
			for (var i=0;i<element.attributes.length;i++) {
				var attr = element.attributes.item(i).name;
				if ((element.getAttribute(attr) == "") && (ignore_str.indexOf(","+attr+",") == -1) )
				{
					element.removeAttribute(attr);
					i--;
				}
			}
			if (recursive) {
				var elem = element.firstChild;
				while (elem != null) {
					if (elem.nodeType == 1) cleanElement(elem,ignore_str,true);
					elem = elem.nextSibling;
				}
			}
		}
		if (data[0].nodeType == 1)
			cleanElement(data[0],ignore_str,recursive);
		
		return ["true"];
	},
	XmlInfo: function (profile,data,context)
	{
		if (! ajaxart.isxml(data)) return;
		var info = aa_getXmlInfo(data[0],context);
		if (info == null) return [];
		return [info];
	},
	UpTillHasXmlInfoWithMethod: function (profile,data,context)
	{
		if (! ajaxart.isxml(data)) return;
		var xml = data[0];
		if (xml.nodeType != "1") xml = aa_xpath(xml,'..')[0];
		
		while (xml.nodeType == 1) {
		  var info = aa_getXmlInfo(xml,context,true);
		  if (info) return [info];
		  xml = xml.parentNode;
		}
	},
	RunMethodOnXml: function (profile,data,context)
	{
		var xml = aa_first(data,profile,'Xml',context);
		var method = aa_text(data,profile,'Method',context);
		var info = aa_getXmlInfo(xml,context);
		if (!info || ! info[method]) return [];
		return info[method](data,context);
	},
	XmlQuery: function (profile,data,context)
	{
		var items = ajaxart.run(data,profile,'Items',context);
		var query = aa_first(data,profile,'Query',context);
		if (query == null) return items;
		
		var subitems = aa_xpath(query,'xmlfilter');
		if (subitems.length == 0) return items;
		var current = items;
		var out = [];
		
		for(var i=0;i<subitems.length;i++) {
			var xmlfilter = subitems[i];
			out = [];
			var xpath = '' + xmlfilter.getAttribute('xpath');
			var op = '' + xmlfilter.getAttribute('op');
			var value = '' + xmlfilter.getAttribute('value') || '';
			if (op == 'contains') var valueLower = value.toLowerCase();
			
			var disabled = '' + xmlfilter.getAttribute('disabled');
			if ("true" == disabled) { out = current; continue; }
			
			if (op == 'date_between') var from = aadate_date2int('' + xmlfilter.getAttribute('from'));
			// to fix: assuming 'to' has no time.
			if (op == 'date_between') var to = aadate_date2int('' + xmlfilter.getAttribute('to')) + 1440;
			if (op == 'date_between' && to == 1440) to = 12949120000;
			var oneOfList = [];
			if (op == 'one of') oneOfList = (''+xmlfilter.getAttribute('value')).split(',');
			
			for(var j=0;j<oneOfList.length;j++)
				oneOfList[j] = ',' + oneOfList[j] + ',';
			
			for (var j=0;j<current.length;j++)
			{
				var item = current[j];
				var inneritem = item;
				if (xpath != null && xpath.length > 0)
				{
					if (xpath[0] == "@")
					{
						var fld = xpath.split("@")[1];
						inneritem = '' + item.getAttribute(fld);
					}
					else if (xpath == "by xtml")
					{
						inneritem = aa_first([item],xmlfilter,'xpath_by_xtml',context);
						if (inneritem == null) continue;
					}
					else {
					  var inneritemslist = aa_xpath(item,xpath);
					  if (inneritemslist.length == 0) continue;
					  inneritem = inneritemslist[0];
					}
				}
				var inneritemValue = ajaxart.totext(inneritem);
				if (op == '=') {
					if ( value == "" || inneritemValue == value ) out.push(item);
				}
				if (op == '!=') {
					if ( inneritemValue != value ) out.push(item);
				}
				if (op == '<' || op == "<=" || op == ">" || op == ">=") {
					try {
					  var valint = parseInt(value);
					  var itemint = parseInt(inneritemValue);
					  if (op == '<' && itemint < valint ) out.push(item);
					  if (op == '<=' && itemint <= valint ) out.push(item);
					  if (op == '>' && itemint > valint ) out.push(item);
					  if (op == '>=' && itemint >= valint ) out.push(item);
					} catch(e) { continue; }
				}
				if (op == 'contains') {
					if (inneritemValue.toLowerCase().indexOf(valueLower) > -1)
						out.push(item);
				}
				else if (op == 'one of' && xmlfilter.getAttribute('value') == "_all") {
					out.push(item);
				}
				else if (op == 'one of' && xmlfilter.getAttribute('value') == "") {
					out.push(item);
				}
				else if (op == 'one of' && xmlfilter.getAttribute('value') == "_blank") {
					if (inneritemValue == '')
						out.push(item);
				}
				else if (op == 'one of') {
					inneritemValue = "," + inneritemValue + ",";
					for(var k=0;k<oneOfList.length;k++) 
						if (inneritemValue.indexOf(oneOfList[k]) != -1) 
							out.push(item);
				}
				else if (op == 'date_between') {
					var intValue = aadate_date2int(inneritemValue);
					if (from <= intValue && intValue <= to)
						out.push(item);
				}
				else if (op == 'xtml') {
					var xtml_list = aa_xpath(xmlfilter,'xtml');
					if (xtml_list.length == 0) continue;
					if ( aa_bool([inneritem],xtml_list[0],'',context) )
					  out.push(item);
				}
			}
			
			current = out;
		}
		return out;
	},
    Switch: function (profile,data,context)
    {
	  return aa_switch(profile,data,context);
    },
    PerformChangeOnElements: function (profile,data,context)
    {
		  var elements = ajaxart.run(data,profile,'Elements',context);
		  for (var i in elements)
				ajaxart.run([elements[i]],profile,'Change',context);
    },
    PerformChangeWithManyInputs: function (profile,data,context)
	{
  	  var inputs = ajaxart.run(data,profile,'Inputs',context);
  	  var local_context = ajaxart.clone_context(context); 
  	  for (var i in inputs) {
  			ajaxart.setVariable(local_context,"InputForChanges",[ inputs[i] ]);
  			ajaxart.run(data,profile,'Change',local_context);
  	  }
  	  return data;
	},
	Filter: function (profile,data,context)
	{
		var items = ajaxart.run(data,profile,'Items',context);
		var filter = aa_text(data,profile,'Filter',context);
		
		var out = [];
		for(var i=0;i<items.length;i++)
		{
			var xpath = "." + filter;
			if (aa_xpath(items[i],xpath).length > 0)
				out.push( items[i] );
		}
		
		return out;
	},
	Siblings: function (profile,data,context)
	{
		var xml_item = aa_first(data,profile,'Element',context);
		if (!xml_item || xml_item.nodeType != 1 || !xml_item.parentNode) return [];
		var onlyWithSameTag = aa_bool(data,profile,'OnlyWithSameTag',context);
		if (xml_item.nodeType != 1)
			return [];
		
		var out = [];
		for (i=0;i<xml_item.parentNode.childNodes.length;i++)
		{
			var sibling = xml_item.parentNode.childNodes.item(i);
			if (sibling != xml_item && sibling.nodeType == 1)
				if (aa_tag(sibling) == aa_tag(xml_item) || !onlyWithSameTag )
					out.push(sibling);
		}
		return out;		
	},
	XmlParsingError: function (profile,data,context)
	{
		var xmlAsText = aa_text(data,profile,'XmlAsText',context);
		var error = [];
		aa_parsexml(xmlAsText,"",error,true);
		return error;
	},
	WriteCData: function (profile,data,context)
	{
		var element = aa_first(data,profile,'Element',context);
		var cdata_text = aa_text(data,profile,'CDataText',context);

		aa_write_cdata(element,cdata_text);
	},
	CDataValue: function (profile,data,context)
	{
		var element = aa_first(data,profile,'Element',context);
		if (!element) return [];
		var cdataValue = aa_cdata_value(element);
		return (cdataValue) ? [cdataValue] : [];
	},
	CData: function (profile,data,context)
	{
		var cdataValue = aa_cdata_value(profile);
		if (!cdataValue) return [];
		if (aa_bool(data,profile,'DynamicContent',context))
	    	return ajaxart.dynamicText(data,cdataValue,context,data,false);
	},
	CDataRef: function (profile,data,context)
	{
		var element = aa_first(data,profile,'Element',context);
		if (aa_cdata_value(element) == null)
			aa_write_cdata(element,'');
		return [element];
	},
	CreateXml: function (profile, data, context)
	{
		var tag = aa_text(data,profile,'Tag',context);
		var xml = aa_createElement(null, tag);
		var attributes = ajaxart.childElems(profile,"Attribute");
		for (var i=0; i<attributes.length; i++) {
			var attrName = aa_text(data,attributes[i],'Name',context);
			var value = aa_text(data,attributes[i],'Value',context);
			if (attrName && value)
				xml.setAttribute(attrName,value);
		}
		var elements =  ajaxart.runsubprofiles(data,profile,'Element',context);
		for (var i=0; i<elements.length; i++)
			if (ajaxart.isxml(elements[i]))
				xml.appendChild( aa_importNode(elements[i], xml) );

		var changes = ajaxart.subprofiles(profile,'Change');
		ajaxart.each(changes,function(changeProfile) {
			ajaxart.run([xml],changeProfile, "", aa_ctx(context, {InputForChanges: data}));
		});

		return [xml];
	},
	CDataNode: function(profile,data,context) {
		var tag = aa_text(data,profile,'Tag',context);
		var xml = aa_createElement(null, tag);
		var cdata_text = aa_text(data,profile,'CDataContent',context);
		aa_write_cdata(xml,cdata_text);
		return [xml];
	}
});


ajaxart.xml.findById = function(node,id)
{
	if (! ajaxart.isxml(node)) return null;
	
	if (node.nodeType != 1)	return null; // not element
	if (node.getAttribute('id') == id) return node;
	var child = node.firstChild;
	while (child != null)
	{
		var result = ajaxart.xml.findById(child,id); 
		if (result != null) return result; 
		child = child.nextSibling;
	}
	return null;
}

ajaxart.xml.xpath_of_node = function(xml,id,specific,top)
{
	if ( ! ajaxart.isxml(xml) ) return "";
	
	var result = "";
	var xml_item = xml;
	if (top == xml) return "";
	while (xml_item != null)
	{
		var slash = "/";
		if (result == "") slash = "";
		var xpath_elem = "";
		if (xml_item.nodeType == 9)	{ // document
			xml_item = null;
			continue;
		}
		if (xml_item.nodeType == 1)	// element
		{
			if (xml_item.parentNode == null || xml_item.parentNode.nodeType == 9) // top level
			{
				xml_item = null;
				continue;
			}
			xpath_elem = '' + aa_tag(xml_item);
			if (specific)
			{
				if (id.length > 0 && aa_hasAttribute(xml_item,id))
					xpath_elem += '[@'+id+"='"+ xml_item.getAttribute(id) +"']";
				else {
					if (typeof(xml_item.parentNode) != "undefined")
					{
						var my_count = 0;
						var count = 0;
						var i=0;
	
						for (i=0;i<xml_item.parentNode.childNodes.length;i++)
						{
							var brother = xml_item.parentNode.childNodes.item(i);
							if (brother.nodeType == 1 && aa_tag(brother) == aa_tag(xml_item))
							{
								count++;
								if ( brother == xml_item ) my_count = count;
							}
						}
						if (my_count > 0 && count > 1) {
							var id_empty = !aa_hasAttribute(xml_item,"id") || xml_item.getAttribute("id") == "";
							var name_empty = !aa_hasAttribute(xml_item,"name") || xml_item.getAttribute("name") == "";
							if ( !id_empty || !name_empty ) {
								if (!id_empty)
									xpath_elem += "[@id='" + xml_item.getAttribute("id") + "']";
								else
									xpath_elem += "[@name='" + xml_item.getAttribute("name") + "']";
							}
							else 
								xpath_elem += "[" + my_count + "]";
						}
					}
				}
			}
		}
		if (xml_item.nodeType == 2) // attribute
			xpath_elem = "@" + xml_item.name;
		
		if (xpath_elem != "")
			result = xpath_elem + slash + result;

		if (id.length > 0 && xml_item.nodeType == 1 && aa_hasAttribute(xml_item,id))
			return result;
		
		var orig_item = xml_item;
		xml_item = xml_item.parentNode;
		if (xml_item == null)
			xml_item = ajaxart.xml.parentNode(orig_item);
		if (xml_item == top) xml_item = null;
	}
	return result;
};

ajaxart.xml.set_tagname = function(old_elem, tagName) 
{
	if (old_elem == null) return null;

	var new_elem = aa_createElement(old_elem, tagName); // aa_parsexml("<" + tagName + "/>"); //old_elem.ownerDocument.createElement(tagName);
	ajaxart.xml.copyElementContents(new_elem,old_elem);

	if (old_elem.parent != null)
		old_elem.parent.replaceChild(new_elem, old_elem);
	return new_elem;
};

ajaxart.xml.copyElementContents = function(target,source,keepSourceContent)
{
	if (source.nodeType != 1 || target.nodeType != 1) return;
	// remove all children & attributes
	if (!keepSourceContent) {
		while(target.firstChild)
			target.removeChild( target.firstChild );
		
		while (target.attributes.length > 0)
			target.removeAttribute(target.attributes.item(0).name);
	}
	
	// copy all attributes
	var atts = source.attributes;
	if (atts != null)
		for (var i = 0; i < atts.length; i++)
			target.setAttribute(atts.item(i).name, atts.item(i).value);

	source = aa_importNode(source,target);
	
	// copy all sub
	var childNode = source.firstChild;
	var ownerDoc = target.ownerDocument;
	while (childNode != null)
	{
		var item = childNode;
		if (typeof(childNode.cloneNode) != "undefined")
			target.appendChild(childNode.cloneNode(true));
		else if (childNode.nodeType == 3 ) // text node
			target.appendChild(ownerDoc.createTextNode(childNode.nodeValue));
		else if (childNode.nodeType == 4) // cdata
			target.appendChild(ownerDoc.createCDATASection(childNode.nodeValue));
		
		childNode = childNode.nextSibling;
	}
}

ajaxart.xml.setAsOnlyChildElem = function(parent,newchild)
{
	if ( parent == null || parent.childNodes == null ) return;
	var node = parent.firstChild;
	while (node != null)
	{
		var next_sibling = node.nextSibling;
		if (node.nodeType == 1) { // element
			parent.removeChild(node);
		}
		node = next_sibling;
	}
	aa_xml_appendChild(parent,newchild);
};
ajaxart.xml.innerTextStr = function(element)
{
	var node = element.firstChild;
	while (node != null) {
		if (node.nodeType == 3 || node.nodeType == 4) return node.nodeValue;
		node=node.nextSibling;
	}
	return "";
}
ajaxart.xml.FirstChild = function(parent,tag)
{
	var res = parent.firstChild;
	if (res == null) return null;
	if (res.nodeType != 1 || aa_tag(res) != tag) 
		res = ajaxart.xml.NextSibling(res,tag);

	return res;
};
ajaxart.xml.NextSibling = function(elem,tag)
{
	if (elem == null) return null;
	var res = elem.nextSibling;
	if (res == null) return null;
	if (res.nodeType != 1) return ajaxart.xml.NextSibling(res,tag);
	if (tag != null && aa_tag(res) != tag) return ajaxart.xml.NextSibling(res,tag);
	return res;
}
ajaxart.xml.PrevSibling = function(elem,tag)
{
	if (elem == null) return null;
	var res = elem.previousSibling;
	if (res == null) return null;
	if (res.nodeType != 1) return ajaxart.xml.PrevSibling(res,tag);
	if (tag != null && aa_tag(res) != tag) return ajaxart.xml.PrevSibling(res,tag);
	return res;
}
ajaxart.xml.root = function(node)
{
	if (!node) return null;
	var parent = ajaxart.xml.parentNode(node);
	if (parent == null) return node;
	var prev,next = parent;
	while (next != null && next.nodeType == 1)
	{
		prev = next;
		next = next.parentNode;
	}
	return prev;
}
ajaxart.xml.autosave = function(xml,attachment,saveAction) 
{
	var savefunc = function(force) {
		if (attachment.saving == true && !force) return false;
		
		attachment.saving = true;
		var success = aa_bool([xml],attachment.profile,'SaveAction',attachment.context);
		if (success) attachment.modified = false;
		attachment.saving = false;
		
		return true;
	}
	if (attachment.autosavedelay == 0) savefunc();
	else 
		aa_delayedRun(savefunc,xml,2500,6000);
};
function ajaxart_delete_child_elem(xml,tag)
{
	var child= xml.firstChild;
	while (child != null) {
		if (aa_tag(child) == tag) { xml.removeChild(child); return; }
		child = child.nextSibling;
	}
		
}
function aa_xmlbyid(list,id)
{
  for(var i=0;i<list.length;i++)
	  if (id == list[i].getAttribute('id')) return list[i];
  return null;
}

function aa_cdata_value(element) {
	if (!element) return null;
	for (var child = element.firstChild; child!=null; child=child.nextSibling)
		if (child.nodeType == 4 && child.nodeValue)
			return child.nodeValue;
	return null;
}

function aa_write_cdata(element,value) {
	if (!element) return;
	value = value || '';
	
	while (element.firstChild) element.removeChild(element.firstChild);  // delete all children first
	var cdata = element.ownerDocument.createCDATASection(value.replace(/]]>/g,']] >'));
	element.appendChild(cdata);
	aa_triggerXmlChange(element);
}

function aa_xml_appendChild(parent,child,asFirst) {
	try {
	  if ( !ajaxart.isxml(parent) ) { ajaxart.log("cannot append to non-xml parent","error");return; }
	  if (child != null && child.nodeType == 1 && parent != null)
	  {
		  child = aa_importNode(child, parent);
		  if (asFirst && parent.firstChild)
			  parent.insertBefore(child,parent.firstChild);
		  else
			  parent.appendChild(child);		  
		  return child;
	  }
	} catch(e) { ajaxart.logException(e);}	
}


function aa_xpath_text(xml,xpath) {
	return aa_totext(aa_xpath(xml,xpath));
}
function aa_xpath_with_hash(xml,xpath) {
	// e.g. %$Data/person[#homer]/@age -> which matches for %$Data/person[@id='homer']/@age%
	var id = xpath.match(/\[\#([^\]]*)\]/)[1];
	var fixed_xpath = xpath.replace('[#'+id+']',"[@id='"+id+"']");
	return aa_xpath(xml,fixed_xpath);
}

ajaxart.xml2text = function(xml) 
{
	if (xml == null) return '';

	if (! ajaxart.ishtml(xml))
		return ajaxart.xml.prettyPrint(xml,"",true);
	
	if (aa_isArray(xml))
	{
		if (xml.length > 0 ) return ajaxart.xml2text(xml[0]);
		return '';
	}
	return aa_xml2htmltext(xml);
};
ajaxart.xml.clone = function(xml)
{
	if (xml.length == 0) return null;
	return xml[0].cloneNode(true);
}
ajaxart.xml.prettyPrint = function(xml,indent,compact)
{
    if (compact) indent = "";
    var newline = compact ? "" : "\r";
	if (xml == null) return "";
	if (aa_isArray(xml))
	{
		if (xml.length > 0 ) return ajaxart.xml.prettyPrint(xml[0],indent,compact);
		return "";
	}

    if (typeof(indent) == "undefined") indent = "";
    if (! ajaxart.isxml(xml)) return xml;
    if (xml.nodeType == 2 || xml.nodeType == 3) 
    	return aa_xmlescape(xml.nodeValue);
    if (xml.nodeType == 4) // cdata
    	return '<![CDATA[' + xml.nodeValue + String.fromCharCode(93) + ']>';	// last 2 parts are separated so this js code could be embedded in xml
    if (xml.nodeType == 8) return ''; // comment
    // head
    var out = indent + "<" + aa_tag(xml);

	var atts = xml.attributes;
	if (atts != null) {
		for (var i = 0; i < atts.length; i++)
		{
			var val = aa_xmlescape(atts.item(i).value).replace(/&apos;/g, "'");
			// var name = atts.item(i).localName || atts.item(i).name;
			var name = atts.item(i).name;
			if (name=='xmlns') continue;
			out += " " + name + '="'+ val +'"';
		}
	}
    if (xml.childNodes.length == 0) out += "/>"
    else out += ">";

    // child elements
    var childs_length = xml.childNodes.length;
    if (childs_length == 1 && (xml.childNodes[0].nodeType == 3)) // || xml.childNodes.item(0).nodeType == 4)) // inner text
    	out += aa_xmlescape(xml.childNodes[0].nodeValue);
    else
    {
    	var only_cdata = false;
    	for (var i = 0; i < childs_length; i++)
    	{
    		var child = xml.childNodes[i];
    		if (child.nodeType == 4) {  // cdata (no need for newline and indents)
    			out += ajaxart.xml.prettyPrint(child);
    			if (childs_length == 1) only_cdata=true;
    		} 
    		else if (child.nodeType != 3) 
    			out += newline + ajaxart.xml.prettyPrint(child,indent + "  ",compact);
    	}
    	if (childs_length > 0 && !compact && !only_cdata) out += newline + indent;
    }
    if (xml.childNodes.length > 0) out += "</" + aa_tag(xml) + ">";
    return out;
} 
ajaxart.isxmlelement = function(xml)
{
	return (ajaxart.isxml(xml) && xml.nodeType == 1);
};
jBart.xpath = function(xml,xpath,createIfDoesNotExist) {
	return aa_xpath(xml,xpath,createIfDoesNotExist);
}

function aa_xpath(xml,xpath,createIfNotExist,defaultValue) {
	if (!xpath) return [xml];
    if (xpath.charAt(0) == "!") 
    	return aa_xpath(xml,xpath.substring(1,xpath.length),true);

	if (!xml || !xml.nodeType ) return [];
	var result = [];

	var isJBartXPath = xpath.indexOf('[#') > -1;

	if (isJBartXPath && !createIfNotExist) 
		return aa_xpath_with_hash(xml,xpath);

	if (!isJBartXPath) {
		try {		
			if (window.jBartNodeJS) 
				result = window.jBartNodeJS.xpath(xml,''+xpath);
			else {
				var isIE =  /msie/i.test(navigator.userAgent) || /trident/i.test(navigator.userAgent);

				if (isIE && typeof(xml.selectNodes) != "undefined" ) // IE && xml
				{
					xml.ownerDocument.setProperty("SelectionLanguage", "XPath");
					var nodes = xml.selectNodes(""+xpath);
					for (var i=0;i<nodes.length;i++)
						result.push(nodes[i]);
				}	else {    
					// Firefox or html in IE
					var docForXpath = xml.ownerDocument;
					if (window.jbUsingJSXPath) docForXpath = document;
					var iter = (!window.jbUsingJSXPath) ? docForXpath.evaluate(xpath, xml, null,0, null) : docForXpath.evaluate2(xpath, xml, null,0, null);

					if (iter) 
					{
						var node = iter.iterateNext();
						while (node) {
							result.push(node);
							node = iter.iterateNext();
						}
					}
				}
			}
		}
		catch (e) {
			var xmltext = (ajaxart.xml2text && ajaxart.xml2text(xml).substring(0,50)) || '';
			log( 'error calculating xpath: ' + xpath + ", xml:" +  xmltext + '  ' + (e.stack || e.message || ''),"warning"); 
	//		ajaxart.log( e.message,"error"); 
			}
		if (result.length > 0 && result[0].nodeType == 9) // document
			return [];
	}
	
	if (result.length == 0 && createIfNotExist)
	{
		try {
			var subpath = xpath;
			var item = xml;
			while (subpath.indexOf('/') > -1 )
			{
				var pos = subpath.indexOf('/');
				var tag = subpath.substring(0,pos);
				
				var item = aa_xpath(item,tag,true)[0];
				subpath = subpath.substring(pos+1);
			}
			if (subpath.charAt(0) == "@") {
				var attrName = subpath.substring(1);
				if (typeof(defaultValue) == "undefined") defaultValue=""; 
				if (attrName.indexOf('/') == -1)
					item.setAttribute(attrName,defaultValue);
			}
			else if (aa_xpath(item,subpath).length == 0) { // element
				if (subpath.indexOf('[#') > -1) {
					var pos = subpath.indexOf('[#');
					var pos2 = subpath.indexOf(']',pos);
					var tag = subpath.substring(0,pos).replace('self::','');
					var id = subpath.substring(pos+2,pos2);

					var newelem = item.ownerDocument.createElement(tag);
					newelem.setAttribute('id',id);
					item.appendChild(newelem);
				} else {
					var newelem = aa_createElement(item,subpath);
					if (typeof(defaultValue) != 'undefined' && defaultValue != "")
						newelem.appendChild(newelem.ownerDocument.createTextNode(defaultValue));
					item.appendChild( newelem );
				}
			}
			result = aa_xpath(xml,xpath,false);
		} catch(e) { log("failed create xpath item :" + xpath + "," + e.message); return []; }
	}
	
	return result;
    
  function log(msg) {
  	if (ajaxart.log) ajaxart.log(msg);
  }	
}
aa_xmlinfos = [];
function aa_getXmlInfo(xml,context,donotcreate)
{
  if (xml && !xml.nodeType ) return xml;
  if (!xml || xml.nodeType != 1) return null;
  for(var i=aa_xmlinfos.length-1;i>=0;i--)   // we'll probably use the last ones defined 
	  if (aa_xmlinfos[i].Xml == xml) return aa_xmlinfos[i];
  
  if (donotcreate) return null;
  
  var out = { isObject: true, Xml: xml };
  aa_xmlinfos.push(out);
  return out;
}
function aa_removeXmlInfo(xml,context)
{
  for(var i=aa_xmlinfos.length-1;i>=0;i--)   // we'll probably use the last ones defined 
	  if (aa_xmlinfos[i].Xml == xml) { 
		  aa_xmlinfos.splice(i,1); 
		  return;
	  }
}

function aa_nextElementSibling(node) {
	var out = node.nextSibling;
	if (out && out.nodeType != 1) return aa_nextElementSibling(out);
	return out;
}

function aa_prevElementSibling(node) {
	var out = node.previousSibling;
	if (out && out.nodeType != 1) return aa_prevElementSibling(out);
	return out;
}

function aa_insertAfter(newnode,existingnode) {
	if (!existingnode) return;
	existingnode.parentNode.insertBefore(newnode,existingnode.nextSibling);
}

function aa_xml_cloneNodeCleanNS(elem,doc) {
	if (elem.nodeType != 1) return null;
	doc = doc || elem.ownerDocument;
	var out = doc.createElement(getLocalName(elem.localName,elem.tagName));

	for (var i=0; i<elem.attributes.length; i++) {
		var attr = elem.attributes.item(i);
		if (attr.name == 'xmlns') continue;
		if (attr.name.indexOf('xmlns:') == 0) continue;
		out.setAttribute(getLocalName(attr.localName,attr.name),attr.nodeValue);		
	}

	for (var childNode = elem.firstChild;childNode != null;childNode=childNode.nextSibling)
	{
		if (childNode.nodeType == 1) 
			out.appendChild(aa_xml_cloneNodeCleanNS(childNode,doc));
		else if (childNode.nodeType == 3)  // text node
			out.appendChild(doc.createTextNode(childNode.nodeValue));		 
		else if (childNode.nodeType == 4)  // CDATA
			out.appendChild(doc.createCDATASection(childNode.nodeValue));		 
		else if (childNode.nodeType == 8)  // Comment
			out.appendChild(doc.createComment(childNode.nodeValue));		 
	}

	return out;

	function getLocalName(localName,name) {
		if (localName) return localName;
		if (name.indexOf(':') == -1) return name;
		return name.split(':')[1];
	}
}

function aa_xml2JSON(topXml) {
	if (!topXml || topXml.nodeType != 1) return {};
	var result = xmlToObject(topXml);

	return JSON.stringify(result);

	function xmlToObject(xml) {
		var obj = {};
		var isArray = false;
		var jbType;

		for (var i=0; i<xml.attributes.length; i++) {
			if (xml.attributes.item(i).name == '_jbType') {
				isArray = true;
				jbType = xml.attributes.item(i).value;
				obj = [];
			} else
				obj[xml.attributes.item(i).name] = xml.attributes.item(i).value;
		}
		for (var i=0;i<xml.childNodes.length;i++) {
			var child = xml.childNodes.item(i);			
			if (child.nodeType == 1) {
				if (isArray) {
					if (jbType == 'string[]')
						obj.push(child.firstChild ? child.firstChild.nodeValue : '');
					else if (jbType == 'number[]')
						obj.push(parseFloat(child.firstChild ? child.firstChild.nodeValue : ''));
					else if (jbType == 'boolean[]')
						obj.push((child.firstChild ? child.firstChild.nodeValue : '') == 'true');
					else
						obj.push(xmlToObject(child))
				} else
					obj[child.tagName] = xmlToObject(child);
			}
		}
		return obj;
	}
}

function aa_JSON2Xml(obj,tag,result)
{
	return json2Xml(obj || {},result || aa_parsexml('<' + tag + '/>'),0);
	function json2Xml(obj,result,depth)
	{
		if (typeof obj.cloneNode == 'function') 
			return obj.cloneNode(); // xml inside js object
		if (depth == 20) { debugger; return result.ownerDocument.createElement('TooMuchRecursion'); }
		if (typeof obj == 'string') {
			try {
				return json2Xml(JSON.parse(obj),result,depth+1);
			} catch(e) { 
				ajaxart.log("jsonToxml - Can not parse json " + obj,"error");
				return null; 
			}
		}
	
		try {
			var inner_tag;
			var isArray = aa_isArray(obj);
			if (isArray)
			{
				result.setAttribute('_jbType','array');
				inner_tag = 'item';
				var primitiveArrayItemType = '';
				for(var att in obj) {
				  if (typeof(obj[att]) == 'string') primitiveArrayItemType = 'string';
				  else if (typeof(obj[att]) == 'number') primitiveArrayItemType = 'number';
				  else if (typeof(obj[att]) == 'boolean') primitiveArrayItemType = 'boolean';
				}

				if (primitiveArrayItemType)
				{
					result.setAttribute('_jbType',primitiveArrayItemType+'[]');
					for(var k=0;k<obj.length;k++) {
						var item = result.ownerDocument.createElement(inner_tag);
						item.appendChild(item.ownerDocument.createTextNode(obj[k]));
						result.appendChild(item);
					}
					return result;
				}
			}
			// atts
			for(var att in obj) 
			 if (obj.hasOwnProperty(att)) {
				var inner = obj[att];
				if (inner == null) continue;
				var matchResult = att.match(/[a-zA-Z_0-9]+/);
				var att_fixed = matchResult ? matchResult[0] : '';
				if (att_fixed == '' || !isNaN(att_fixed.charAt(0)))
					att_fixed = '_jb_' + att_fixed;
				
				var _type = typeof(inner);
				if (_type == 'string' || _type == 'number' || _type == 'boolean') {
				  result.setAttribute(att_fixed,inner);
				} else { // elements
					var child = result.ownerDocument.createElement(inner_tag || att_fixed);
					child = json2Xml(inner,child,depth+1);
					result.appendChild(child);
				}
			}
		} catch (e) {
					debugger;
					alert(e);
		}
		return result;
	}
}

function aa_xml_clean_inner_texts(xml)
{
	var innerTexts = [];
	for(var iter=xml.firstChild;iter;iter=iter.nextSibling)
		if (iter.nodeType == 3) innerTexts.push(iter);

	for(var i=0;i<innerTexts.length;i++)
		xml.removeChild(innerTexts[i]);
}

function aa_innerText(elem,autoCreate) {
	for(var iter=elem && elem.firstChild;iter;iter=iter.nextSibling)
		if (iter.nodeType == 3) return iter;
	if (autoCreate) {
		var out = elem.ownerDocument.createTextNode('');
		elem.appendChild(out);
		return out;
	}
}
ajaxart.load_usage_plugin("xml");



aa_gcs("xmlui",{
	CallUpdateOfCodeMirror: function(profile, data, context) {
		var iframe = ajaxart.getControlElement(context, true);
		if (iframe != null && iframe.contentWindow != null) {
			var txt = iframe.contentWindow.editor.getCode();
			if (iframe.getAttribute("type") == "css") txt = txt.replace(/\n/g, '/*nl*/');
			ajaxart_update(iframe, txt);
		}
	},
	InsertTextToCodeMirror: function(profile, data, context) {
		var wrapper = ajaxart.getControlElement(context, true);
		if (!wrapper || !wrapper.jbCodeMirrorEditor) {
			ajaxart.log("InsertTextToCodeMirror: Cannot find codemirror", "error");
			return;
		}
		wrapper.jbCodeMirrorEditor.replaceSelection(aa_text(data, profile, 'Text', context));
	},
	CodeMirrorTextarea: function(profile, data, context) {
		// return [ aa_codemirror({}) ];
		var text = ajaxart.run(data, profile, 'Text', context);
		var type = aa_text(data, profile, 'Type', context);
		var width = aa_text(data, profile, 'Width', context);
		var height = aa_text(data, profile, 'Height', context);
		var useResizing = aa_bool(data, profile, 'Resizer', context);
		var autoIntent = aa_bool(data, profile, 'AutoIndent', context);
		if (useResizing) {
			var identifier = aa_text(data, profile, 'IdentifierToRecallLastSize', context);
			jBart.vars.codeMirrorSizes = jBart.vars.codeMirrorSizes || {};
			var lastSize = jBart.vars.codeMirrorSizes[identifier];
			if (lastSize) {
				width = lastSize.width + 'px';
				height = lastSize.height + 'px';
			}
		}
		var mode = '';
		switch (type) {
			case 'xml':
				mode = 'xml';
				break;
			case 'js':
				mode = 'javascript';
				break;
			case 'css':
				mode = 'css';
				break;
			case 'html':
				mode = 'htmlmixed';
				break;
		}
		var settings = {
			value: aa_totext(text),
			mode: mode,
			lineNumbers: aa_bool(data, profile, 'LineNumbers', context),
			lineWrapping: aa_bool(data, profile, 'TextWrapping', context),
			readOnly: aa_bool(data, profile, 'ReadOnly', context),
			autofocus: aa_bool(data, profile, 'AutoFocus', context),
			height: height,
			width: width,
			extraKeys: {
				"Ctrl-Enter": function(editor) {
					ajaxart.run([editor.getValue()], profile, 'OnCtrlEnter', context);
				},
				"Shift-Enter": function(editor) {
					ajaxart.run([editor.getValue()], profile, 'OnShiftEnter', context);
				},
				"Ctrl-I": function(editor) {
					var cursorPos = editor.getCursor(true);
					indent(editor);
					editor.setCursor(cursorPos);
					editor.setSelection(cursorPos);
				}
			},
			onchange: function(editor) {
				ajaxart.writevalue(text, editor.getValue());
				ajaxart.run(text, profile, 'OnUpdate', aa_ctx(context, {
					ControlElement: [wrapper]
				}));
			},
			oninit: function(editor) {
				if (autoIntent)
					indent(editor);
				if (aa_bool(data, profile, 'Resizer', context)) {
					setTimeout(function() {
						aa_addResizer(wrapper, {
							onResize: function(width, height) {
								jBart.vars.codeMirrorSizes[identifier] = jBart.vars.codeMirrorSizes[identifier] || {};
								jBart.vars.codeMirrorSizes[identifier].width = width;
								jBart.vars.codeMirrorSizes[identifier].height = height;
								editor.setSize(width, height);
							}
						});
					}, 20);
				}
			}
		};

		if (aa_bool(data, profile, 'ShowJavascriptErrorsOnCtrlSpace', context) && mode == 'javascript') aa_showJsErrorsOnCodeMirror(settings);

		if (aa_bool(data, profile, 'EnableFullScreen', context)) aa_enableFullScreenForCodeMirror(settings);

		var wrapper = aa_codemirror(settings);
		jQuery(wrapper).addClass(aa_attach_global_css(aa_text(data, profile, 'Css', context), null, 'codemirror_wrapper'));
		return [wrapper];

		function indent(editor) {
			if (mode == 'css')
				editor.setValue(css_beautify(editor.getValue(), { indent_size: 2 }).replace(/\n\n/g,'\n').replace(/: /g,':'));
			if (mode == 'javascript')
				editor.setValue(js_beautify(editor.getValue(), { indent_size: 2 }).replace(/\n\n/g,'\n'));
			if (mode == 'xml')
				editor.setValue(html_beautify(editor.getValue(), { indent_size: 2}).replace(/\n\n/g,'\n'));			
		}
	}
});

function aa_codemirror(settings) {
	var wrapper = document.createElement('div');

	if (!window.CodeMirror)
		console.error('CodeMirror lib is not loaded: https://codemirror.net/');

	init();
	// var cssList = [ aa_base_lib() + '/codemirror-3.2/codemirror4jbart.css' ];
	// var jsList = [ aa_base_lib() + '/codemirror-3.2/codemirror4jbart.js', aa_base_lib() + '/codemirror-3.2/js-beautify-jbart.min.js'];
	// $.when( aa_loadLib("codemirror", cssList , jsList) ).then( init );

	jQuery(wrapper).css({
		height: settings.height,
		width: settings.width
	}); // to give the right size untill code mirror is loaded
	settings.extraKeys = settings.extraKeys || {};
	settings.extraKeys["Ctrl-Space"] =	 function(cm) {
		if (settings.mode == 'javascript') CodeMirror.showHint(cm, CodeMirror.javascriptHint);
		if (settings.mode == 'xml') CodeMirror.showHint(cm, CodeMirror.xmlHint);
	};
	settings.extraKeys["Ctrl-H"] = 'replace';

	function init() {
		aa_addOnAttachMultiple(wrapper, function() {
			var editor = CodeMirror(wrapper, settings);
			var width = settings.width;
			var height = settings.height;

			if (settings.resizer && sessionStorage['jbCodeMirrorResizerWidth' + settings.identifier]) {
				width = sessionStorage['jbCodeMirrorResizerWidth' + settings.identifier];
				height = sessionStorage['jbCodeMirrorResizerHeight' + settings.identifier];
			}
			editor.setSize(width, height);
			wrapper.style.height = '';
			wrapper.style.width = '';
			if (settings.onchange) editor.on("change", settings.onchange);
			editor.setOption("theme", "solarized light");

			// jQuery(wrapper).removeClass('aa_dialog_not_ready');
			wrapper.jbCodeMirrorEditor = editor;
			aa_fixTopDialogPosition(); // Sometimes the dialog position changes becuase of codemirror size
			editor.refresh(); // When codemirror in open and not visible, it needs a refresh when becomes visible

			if (settings.oninit) settings.oninit(editor);
			if (settings.resizer) initResizer(wrapper, editor);
			if (settings.mode == 'xml') addXmlValidation(wrapper,editor);
		});
	}

	// jQuery(wrapper).addClass('aa_dialog_not_ready');	// marking the dialog as not ready to wait for code mirror to load
	return wrapper;

	function initResizer(wrapper, editor) {
		aa_addResizer(wrapper.firstChild, {
			onResizeEnd: function(width, height) {
				sessionStorage['jbCodeMirrorResizerWidth' + settings.identifier] = width;
				sessionStorage['jbCodeMirrorResizerHeight' + settings.identifier] = height;
			}
		});
	}

	function addXmlValidation(wrapper,editor) {
		$(wrapper).addClass('aa_has_validations');
		aa_bind(wrapper,'validation',function(validationObject) {
			var error = [];
			aa_parsexml(editor.getValue(),"",error,true);
			if (aa_totext(error)) {
				validationObject.passed = false;
				validationObject.errorMessage = 'xml parsing error: ' + aa_totext(error);
			}
		},'CodeMirrorXmlValidation');

	}
};

function aa_enableFullScreenForCodeMirror(cmSettings, settings) {
	settings = settings || {};
	jQuery.extend(settings, {
		escText: "<span>Press ESC or F11 to exit full screen</span>",
		escCss: '#this { cursor:default; text-align: center; width: 100%; position:absolute; top:0px; left:0px; font-family: arial; font-size: 11px; color: #a00; padding: 2px 5px 3px; } #this:hover { text-decoration: underline; }',
		escHeight: 20,
		fullScreenBtnHtml: '<div><img title="Full Screen (F11)" src="http://png-1.findicons.com/files/icons/1150/tango/22/view_fullscreen.png"/></div>',
		fullScreenBtnCss: "#this { position:absolute; bottom:5px; right:5px; -webkit-transition: opacity 1s; z-index: 20; } #this.hidden { opacity:0; } ",
		editorCss: "#this { position:relative; }",
		fullScreenEditorCss: "#this { display: block; position: fixed !important; top: 0; left: 0; z-index: 9999; }",
		lineNumbers: true
	});
	var prevOnInit = cmSettings.oninit;
	var prevOverflow = document.documentElement.style.overflow;
	cmSettings.oninit = function(editor) {
		if (prevOnInit) prevOnInit(editor);
		var jEditorElem = jQuery(editor.getWrapperElement()).addClass(aa_attach_global_css(settings.editorCss));
		var prevLineNumbers = editor.getOption("lineNumbers");
		var jFullScreenButton = jQuery(settings.fullScreenBtnHtml).addClass(aa_attach_global_css(settings.fullScreenBtnCss)).appendTo(jEditorElem)
			.addClass('hidden').click(function() {
			switchMode();
		});
		jEditorElem.
		mouseover(function() {
			jFullScreenButton.removeClass('hidden');
		}).
		mouseout(function() {
			jFullScreenButton.addClass('hidden');
		});
		var fullScreenClass = aa_attach_global_css(settings.fullScreenEditorCss + "#this { padding-top: " + settings.escHeight + "px; }");

		function onresize() {
			var screen_size = aa_screen_size();
			editor.setSize(screen_size.width, screen_size.height - settings.escHeight);
			// jEditorElem.height( aa_document_height() + 'px' );
		}

		function switchMode(onlyBackToNormal) {
			if (jEditorElem.hasClass(fullScreenClass)) {
				jEditorElem.removeClass(fullScreenClass);
				window.removeEventListener('resize', onresize);
				document.documentElement.style.overflow = prevOverflow;
				editor.setOption("lineNumbers", prevLineNumbers);
				editor.setSize(cmSettings.width, cmSettings.height);
				editor.refresh();
				jEditorElem[0].jEsc.remove();
			} else if (!onlyBackToNormal) {
				jEditorElem.addClass(fullScreenClass);
				window.addEventListener('resize', onresize);
				onresize();
				document.documentElement.style.overflow = "hidden";
				if (settings.lineNumbers) editor.setOption("lineNumbers", true);
				editor.refresh();
				var jEsc = jQuery(settings.escText).addClass(aa_attach_global_css(settings.escCss)).click(function() {
					switchMode(true)
				});
				jEditorElem.append(jEsc);
				jEditorElem[0].jEsc = jEsc;
				editor.focus();
			}
		}
		editor.addKeyMap({
			"F11": function(editor) {
				switchMode();
			},
			"Esc": function(editor) {
				switchMode(true);
			}
		});
	}
}

function aa_showJsErrorsOnCodeMirror(cmSettings, settings) {
	var errorCss = (settings && settings.errorCss) ? settings.errorCss :
		"#this { font-family: arial; font-size: 10px; background: #ffa; color: #a00; padding: 2px 5px 3px; }" +
		"#this .icon { color: white; background-color: red; font-weight: bold; border-radius: 50%; padding: 0 3px; margin-right: 7px;}";

	var prevOnChange = cmSettings.onchange;
	cmSettings.onchange = function(editor) {
		if (prevOnChange) prevOnChange(editor);
		// cleaning error on every change
		editor.jbWidgets = editor.jbWidgets || [];
		for (var i = 0; i < editor.jbWidgets.length; ++i)
		editor.removeLineWidget(editor.jbWidgets[i]);
	}
	cmSettings.extraKeys = cmSettings.extraKeys || {};
	var prevCtrlEnter = cmSettings.extraKeys["Ctrl-Enter"];
	cmSettings.extraKeys["Ctrl-Enter"] = function(editor) {
		editor.jbWidgets = editor.jbWidgets || [];
		for (var i = 0; i < editor.jbWidgets.length; ++i)
		editor.removeLineWidget(editor.jbWidgets[i]);
		jBart.onJsError = function(e, js) {
			if (js != editor.getValue()) return; // not our error
			var stack = e.stack;
			var message = stack.split("\n")[0];
			var line = stack.match(/<anonymous>:([0-9]+)/);
			if (line && line.length > 1) line = parseInt(line[1]);
			line = line || 1;

			var jText = $('<span class="text"></span>').text(message);
			var jErr = $('<div><span class="icon">!</span></div>').append(jText).addClass(aa_attach_global_css(errorCss));

			editor.jbWidgets.push(editor.addLineWidget(line - 1, jErr[0], {
				coverGutter: false,
				noHScroll: true,
				above: true
			}));
		}
		if (prevCtrlEnter) prevCtrlEnter(editor);
		jBart.onJsError = null;
	}
}
ajaxart.load_usage_plugin("xmlui");




aa_gcs("xtml", {
  RunXtml: function (profile,data,context)
  {
	  var xtml = ajaxart.run(data,profile,'Xtml',context);
	  if (xtml.length == 0) return [];

	  var method = "";
	  if (aa_hasAttribute(profile,'Method') || ajaxart.childElem(profile,'Method') != null)
		  method = aa_text(data,profile,'Method',context); 

	  var field = "";
	  if (aa_hasAttribute(profile,'Field')) // || ajaxart.childElem(profile,'Field') != null)
		  field = aa_text(data,profile,'Field',context);

	  var input = data;
	  if (aa_hasAttribute(profile,'Input') || ajaxart.childElem(profile,'Input') != null)
		  input = ajaxart.run(data,profile,'Input',context);

	  if (typeof(xtml[0].script) != "undefined" || xtml[0].compiled != null)	// xtml containing script and context
	  {
		  if (typeof(xtml[0].input) != "undefined")
			  if (! aa_bool(data,profile,'ForceInputParam',context) )
				  input = xtml[0].input;

	  	  if (xtml[0].compiled == "same") return input;

	  	  var newContext = ajaxart.newContext();
	  	  
		  if (xtml[0].context) { // the xtml object comes with its own context
		  	  newContext.params = xtml[0].context.params;
		  	  newContext.componentContext = xtml[0].context.componentContext;
		  } 
 	      newContext.vars = context.vars;
		  if (typeof(xtml[0].objectForMethod) != 'undefined')
			  newContext._This = xtml[0].objectForMethod[0];
		  
		  if (xtml[0].compiled == null) {
  		    if (xtml[0].script == null) return null;
		    return ajaxart.run(input,xtml[0].script,field,newContext,method);
		  }
		  else
			return xtml[0].compiled(input,newContext);
	  }
	  
	  if (! ajaxart.isxml(xtml[0]) ) {
		  // dynamic text maybe
		  var result = ajaxart.dynamicText(input,aa_totext(xtml),context,null,false);
		  return [result];
	  }

	  /* var newContext = ajaxart.clone_context(context);	// SLOW. is done because of $InputForChanges - find a way to fix that  
	    */
	  var newContext = {};
	  newContext.vars = context.vars;
	  newContext.componentContext = context.componentContext;
	  newContext.params = [];
	  
	  return ajaxart.run(input,xtml[0],field,newContext,method);
  },
  RunCircuit: function (profile,data,context)
  {
  	var circuit = aa_first(data,profile,'Circuit',context);
  	if (!circuit || !circuit.script || !circuit.context) return [];
  	var input = circuit.OrigData || circuit.Input || [];
  	return ajaxart.run(input,circuit.script,'',circuit.context);
  },
	Profile: function(profile, data, context) {
		return [profile.parentNode];
	},
	RunXtmlByComponentId: function(profile, data, context) {
		var id = aa_text(data, profile, 'ComponentID', context);
		if (id == '') return [];
		var input = ajaxart.run(data, profile, 'Input', context);
		return aa_run_component(id, input, context);
	},
	RunDynamicText: function(profile, data, context) {
		var text = aa_text(data, profile, 'Text', context);
		var relevant_context = aa_first(data, profile, 'Context', context);
		if (relevant_context == null) relevant_context = context;
		var relevant_data = ajaxart.run(data, profile, 'Input', context);
		if (relevant_data == null) relevant_data = data;
		if (relevant_context == null) return [];
		return ajaxart.dynamicText(relevant_data, text, relevant_context);
	},
	RunXtmlAsBoolean: function(profile, data, context) {
		var xtml = ajaxart.run(data, profile, 'Xtml', context);
		var emptyAsTrue = aa_bool(data, profile, 'EmptyAsTrue', context);

		if (xtml.length == 0) return [];

		var method = "";
		if (profile.getAttribute('Method') != null) // || ajaxart.childElem(profile,'Method') != null)
		method = aa_text(data, profile, 'Method', context);

		var field = "";
		if (profile.getAttribute('Field') != null) // || ajaxart.childElem(profile,'Field') != null)
		field = aa_text(data, profile, 'Field', context);

		var input = data;
		if (profile.getAttribute('Input') != null || ajaxart.childElem(profile, 'Input') != null) input = ajaxart.run(data, profile, 'Input', context);

		//	  if (typeof(xtml[0])=="function") {
		//		  var text = aa_totext(xtml[0](input,context));
		//		  var bool = aa_text2bool(text);
		//		  return (bool) ? ["true"] : [];
		//	  }

		if (xtml[0].script != null) // typeof(xtml[0].script) != "undefined")	// xtml containing script and context
		{
			if (emptyAsTrue) if (xtml[0].script.getAttribute(field) == null && aa_xpath(xtml[0].script, field).length == 0) return ["true"];

			if (typeof(xtml[0].input) != "undefined") if (!aa_bool(data, profile, 'ForceInputParam', context)) input = xtml[0].input;

			var newContext = ajaxart.newContext();

			if (xtml[0].context != null) { // the xtml object comes with its own context
				newContext.params = xtml[0].context.params;
				newContext.componentContext = xtml[0].context.componentContext;
			}
			newContext.vars = context.vars;
			if (xtml[0].objectForMethod) newContext._This = xtml[0].objectForMethod[0];

			if (!ajaxart.isxml(xtml[0].script)) {
				ajaxart.log("RunXtml trying to run script not in xml");
				return [];
			}
			var result = aa_bool(input, xtml[0].script, field, newContext, method);
			if (result) return ["true"];
			else return [];
		}

		if (!ajaxart.isxml(xtml[0])) return emptyAsTrue ? ["true"] : [];
		if (emptyAsTrue) if (xtml[0].getAttribute(field) == null && aa_xpath(xtml[0], field).length == 0) return ["true"];

		/* var newContext = ajaxart.clone_context(context);	// SLOW. is done because of $InputForChanges - find a way to fix that  
		 */
		var newContext = {};
		newContext.vars = context.vars;
		newContext.componentContext = context.componentContext;
		newContext.params = [];

		var result = aa_bool(input, xtml[0], field, newContext, method);
		if (result) return ["true"];
		else return [];
	},
	UseParamAsBoolean: function(profile, data, context) {
		var param = aa_text(data, profile, 'Param', context);
		var input = ajaxart.run(data, profile, 'Input', context);

		var paramScript = context.params[param];
		if (aa_isArray(paramScript)) // script='false'
		return paramScript;

		if (paramScript == null || paramScript.script == null) return [];
		if (paramScript.compiled == "same") return input;

		// if we're here we are in script=true

		var newContext = {};
		newContext.vars = context.vars;
		newContext.params = context.componentContext.params;
		newContext.componentContext = context.componentContext.componentContext;

		if (paramScript.compiled == null) return aa_bool(input, paramScript.script, "", newContext);
		else return aa_text2bool(aa_totext(paramScript.compiled(input, newContext)));
	},
	UseParamExcludeVariable: function(profile, data, context) {
		var param = aa_text(data, profile, 'Param', context);
		var excludeVar = aa_text(data, profile, 'ExcludeVariable', context);

		var paramScript = context.params[param];
		if (paramScript == null || paramScript.script == null) return [];

		var newContext = ajaxart.newContext();
		for (i in context.vars) {
			if (i != excludeVar) newContext.vars[i] = context.vars[i];
		}
		newContext.params = context.componentContext.params;
		newContext.componentContext = context.componentContext.componentContext;

		return ajaxart.run(data, paramScript.script, "", newContext);
	},
	ParamEmpty: function(profile, data, context) {
		var paramName = aa_text(data, profile, 'Param', context);
		var param = ajaxart.getVariable(context, paramName);
		if (param == null) return ["true"];
		if (typeof(param.script) != "undefined" || param.length > 0) return [];

		return ["true"];
	},
	ParamsWithChanges: function(profile, data, context) {
		var orig = aa_first(data, profile, 'Params', context);
		var overrides = ajaxart.gcs.xtml.Params(profile, data, context)[0];
		var out = {
			isObject: true
		};
		for (var i in orig)
		out[i] = orig[i];
		for (var i in overrides)
		out[i] = overrides[i];

		return [out];
	},
	CopyAllParams: function(profile, data, context) {
		var out = {};

		for (var i in context.params) {
			var name = i;
			var val = context.params[i];
			if (val.isParamScript == true) {
				out[name] = val;
				out[name].context = context.componentContext;
			} else out[name] = val;
		}

		return [out];
	},
	ScriptParamArrayContents: function(profile, data, context) {
		var param = aa_text(data, profile, 'Param', context);
		var paramValue = context.params[param];
		if (typeof(paramValue) == "undefined" || !aa_isArray(paramValue)) return [];
		out = [];
		for (var i = 0; i < paramValue.length; i++)
		out.push({
			script: paramValue[i],
			context: context.componentContext
		});

		return out;
	},
	Xtml: function(profile, data, context) {
		var xtml = ajaxart.run(data, profile, 'Xtml', context);
		var input = ajaxart.run(data, profile, 'Input', context);
		var definedContext = aa_first(data, profile, 'Context', context);

		if (xtml.length == 0) return [];
		var out = {};
		if (typeof(xtml[0].script) != "undefined") {
			for (i in xtml[0]) out[i] = xtml[0][i];
		} else out = {
			script: xtml[0],
			context: context.componentContext
		};

		if (definedContext != null) out.context = definedContext;
		if (out.context == null) out.context = ajaxart.newContext();

		// put resources as vars as well
		if (context.vars._GlobalVars && !aa_tobool(context.vars._DisableResourcesAsVars)) {
			out.context.vars._GlobalVars = context.vars._GlobalVars;
		}
		if (input.length > 0) out["input"] = input;

		return [out];
	},
	ToScript: function(profile, data, context) {
		data = ajaxart.run(data, profile, 'Xtml', context);
		if (data.length == 0) return [];
		if (typeof(data[0].script) == "undefined") return [];
		return [data[0].script];
	},
	ToInput: function(profile, data, context) {
		if (data.length == 0) return [];
		if (typeof(data[0].input) == "undefined") return [];
		return data[0].input;
	},
	VariableValue: function(profile, data, context) {
		var varName = aa_text(data, profile, 'VarName', context);

		var out = context.vars[varName];
		if (out == null || typeof(out) == "undefined") return [];
		return out;
	},
	UsagesOfPlugin: function(profile, data, context) {
		var plugin = aa_text(data, profile, 'Plugin', context);

		var out = [];
		for (_plugin in ajaxart.usages)
		if (plugin == "" || plugin == _plugin) {
			for (usage in ajaxart.usages[_plugin])
			out.push(ajaxart.usages[_plugin][usage]);
		}
		return out;
	},
	ComponentsOfPlugin: function(profile, data, context) {
		var plugin = aa_text(data, profile, 'Plugin', context);
		var type = aa_text(data, profile, 'Type', context);
		var resultType = aa_text(data, profile, 'Result', context);
		var alsoHidden = aa_bool(data, profile, 'AlsoHidden', context);
		if (plugin.length == 0) return [];

		var out = [];
		var plugin_obj = ajaxart.components[plugin];
		for (i in plugin_obj) {
			if (type.length > 0 && type != plugin_obj[i].getAttribute('type')) continue;

			if (!alsoHidden && "true" == plugin_obj[i].getAttribute('hidden')) continue;

			if (resultType == "full id") out.push(plugin + "." + i);
			else out.push(plugin_obj[i]);
		}
		return out;
	},
	LoadedPlugins: function(profile, data, context) {
		var includeUsages = aa_bool(data, profile, 'IncludeUsages', context);

		var list = {};
		var out = [];
		for (i in ajaxart.components) {
			if (!includeUsages && i.indexOf("usage", i.length - 5) != -1) continue;
			out.push(i);
			list[i] = true;
		}
		if (includeUsages) {
			for (i in ajaxart.usages)
			if (list[i] == null) {
				out.push(i);
				list[i] = true;
			}
		}
		return out;
	},
	LoadComponents: function(profile, data, context) {
		var ns = aa_text(data, profile, 'Namespace', context);
		var comps = ajaxart.run(data, profile, 'Components', context);

		if (ajaxart.components[ns] == null || aa_bool(data, profile, 'ClearNSBefore', context)) ajaxart.components[ns] = [];

		for (var i = 0; i < comps.length; i++) {
			if (!ajaxart.isxml(comps[i])) continue;
			ajaxart.components[ns][comps[i].getAttribute("id")] = comps[i];
			aa_load_inplace_gc(comps[i], ns);
		}

		ajaxart.componentsXtmlCache = [];
		window.aaxtmldt_options_cache = window.ajaxart_light_compoftype = window.ajaxart_comp_of_type_cache = null;

		return ["true"];
	},
	PluginDescriptor: function(profile, data, context) {
		var plugin_name = aa_text(data, profile, 'Plugin', context);
		var plugin = ajaxart.plugins[plugin_name];
		if (typeof(plugin) == "undefined") return [];
		return [plugin];
	},
	AllTypes: function(profile, data, context) {
		var out = [];
		for (var i in ajaxart.types) {
			var ns = ajaxart.types[i].parentNode.getAttribute('ns');
			if (ns == null) ns = ajaxart.types[i].parentNode.getAttribute('id');
			var id = ajaxart.types[i].getAttribute('id');
			var text = ns + "." + id;
			out.push(text);
		}
		return out;
	},
	TypeDefinition: function(profile, data, context) {
		var type = aa_text(data, profile, 'Type', context);
		type = type.replace("\.", "_");
		var typeobj = ajaxart.types[type];
		if (typeobj == null) return [];
		return [typeobj];
	},
	GlobalVariables: function(profile, data, context) {
		var out = [];
		if (context.vars._GlobalVars) for (var i in context.vars._GlobalVars[0])
		out.push(i);
		return out;
	},
	DebugVariableValue: function(profile, data, context) {
		var varName = aa_text(data, profile, 'Variable', context);
		if (varName == "") return [];
		if (ajaxart.debugData && ajaxart.debugData[varName] != null) return ajaxart.debugData[varName];
		return [];
	},
	DebugDataVariables: function(profile, data, context) {
		var out = [];
		for (varName in ajaxart.debugData)
		out.push(varName);
		return out;
	},
	VariablesOfContext: function(profile, data, context) {
		var scriptAndContext = aa_first(data, profile, 'ScriptAndContext', context);
		var out = [];
		var ctx;
		if (scriptAndContext != null && 'context' in scriptAndContext) ctx = scriptAndContext.context;
		else return [];
		for (varName in ctx.params)
		out.push(varName);
		for (varName in ctx.vars) {
			if (varName != '_GlobalVars') out.push(varName);
			else {
				var gvars = ctx.vars._GlobalVars[0];
				for (varName2 in gvars) out.push(varName2);
			}
		}
		return out;
	},
	VariableValueFromContext: function(profile, data, context) {
		var scriptAndContext = aa_first(data, profile, 'ScriptAndContext', context);
		if (!scriptAndContext) return [];
		var varName = aa_text(data, profile, 'Variable', context);
		if (scriptAndContext.context) {
			var val = ajaxart.getVariable(scriptAndContext.context, varName);
			if (val == null) val = [scriptAndContext.context.params[varName]];
			return val;
		}
		return [];
	},
	Logs: function(profile, data, context) {
		var out = [];
		var errors = ajaxart.logs["error"];
		if (errors) {
			for (var i in errors)
			out.push({
				isObject: true,
				Level: "error",
				Log: errors[i]
			});
		}
		for (i in ajaxart.logs)
		if (i != 'error') for (var j in ajaxart.logs[i])
		out.push({
			isObject: true,
			Level: i,
			Log: ajaxart.logs[i][j]
		});

		return out;
	},
	LogContent: function(profile, data, context) {
		var level = aa_text(data, profile, 'Level', context);
		var out = ajaxart.logs[level];
		return (out == null) ? [] : out;
	},
	ActiveLogLevels: function(profile, data, context) {
		var out = [];
		for (i in ajaxart.logs)
		if (i == 'error') // insert at beginning
		out = [i].concat(out);
		else out.push(i);
		return out;
	},
	LoadXtmlFile: function(profile, data, context) {
		var contents = aa_first(data, profile, 'Contents', context);
		if (ajaxart.isxml(contents)) ajaxart.load_xtml_content('', contents);
		return ["true"];
	},
	RunUsage: function(profile, data, context) {
		if (data.length == 0) return data;

		var result = ajaxart.run([""], data[0], "", context);
		if (result.length == 0) // success
		ajaxart.run(data, profile, 'OnSuccess', context);
		else ajaxart.run(data, profile, 'OnFailure', context);
		ajaxart.run(data, profile, 'OnFinish', context);
	},
	CleanLog: function(profile, data, context) {
		var cleanAllLogs = aa_bool(data, profile, 'CleanAllLogs', context);
		var level = aa_text(data, profile, 'Level', context);
		if (cleanAllLogs) logs = {};
		else if (level != "") ajaxart.logs[level] = [];

		return data;
	},
	AllComponentIds: function(profile, data, context) {
		var out = [];
		for (plugin in ajaxart.components)
		for (j in ajaxart.components[plugin])
		out.push(plugin + "." + ajaxart.components[plugin][j].getAttribute("id"));
		return out;
	},
	AllComponentDefinitions: function(profile, data, context) {
		var out = [];
		for (plugin in ajaxart.components)
		for (j in ajaxart.components[plugin])
			out.push(ajaxart.components[plugin][j]);
		return out;
	},
	ComponentIdsOfType: function(profile, data, context) {
		var type = aa_text(data, profile, 'Type', context);
		var out = [];
		for (plugin in ajaxart.components)
		for (j in ajaxart.components[plugin]) {
			if (ajaxart.components[plugin][j].getAttribute("type") == type) out.push(plugin + "." + ajaxart.components[plugin][j].getAttribute("id"));
		}
		return out;
	},
	PartsOfContext: function(profile, data, context) {
		var ctx = aa_first(data, profile, 'Context', context);
		if (ctx == null) return [];
		var part = aa_text(data, profile, 'Part', context);
		var out = [];
		if (part == "Global Variable Names") {
			if (!ctx.vars._GlobalVars) return [];
			for (var j in ctx.vars._GlobalVars[0]) {
				if (j != 'isObject' && j != 'XtmlSource') out.push(j);
			}
		}
		if (part == "Variable Names") {
			for (i in ctx.vars) {
				if (i != "_GlobalVars") out.push(i);
				else for (j in ctx.vars._GlobalVars[0]) {
					if (j != 'isObject' && j != 'XtmlSource') out.push(j);
				}
			}
		} else if (part == "Param Names") {
			for (i in ctx.params)
			out.push(i);
		} else if (part == "Component Context") return [ctx.componentContext];
		return out;
	},
	CurrentContext: function(profile, data, context) {
		return [context];
	},
	ManualContext: function(profile, data, context) {
		var vars = ajaxart.run(data, profile, 'Variables', context);
		var out = ajaxart.newContext();
		for (var i = 0; i < vars.length; i++)
		ajaxart.setVariable(out, vars[i]["Name"], vars[i]["Value"]);
		return [out];
	},
	BuildVersion: function(profile, data, context) {
		return [ajaxart.build_version];
	},
	XtmlOfParamArray: function(profile, data, context) {
		var param = aa_text(data, profile, 'Param', context);
		var paramScript = context.params[param];
		if (aa_isArray(paramScript)) return []; // script='false'

		return aa_xpath(paramScript.script, param);
	},
	ClearComponentsCache: function(profile, data, context) {
		ajaxart.componentsXtmlCache = [];
	}
});


if (!ajaxart.xtml) ajaxart.xtml = {};
ajaxart.run_xtml_object = function(data, xtmlObject, context) {
	var newContext = ajaxart.newContext();

	if (xtmlObject.context != null) { // the xtml object comes with its own context
		newContext.params = xtmlObject.context.params;
		newContext.componentContext = xtmlObject.context.componentContext;
	}
	newContext.vars = context.vars;
	if (xtmlObject.objectForMethod) newContext._This = xtmlObject.objectForMethod[0];

	return ajaxart.run(data, xtmlObject.script, '', newContext);
}
ajaxart.component_exists = function(id) {
	var middlePos = id.indexOf('.');
	var ns = id.substring(0, middlePos);
	var compName = id.substr(middlePos + 1);
	if (ajaxart.components[ns] == null) return false;
	if (ajaxart.components[ns][compName] == null) return false;
	return true;
}
//ajaxart_runMethod = function(data,object,method,context)
//{
//	return ajaxart.runScriptParam(data,object[method],context);
//}

function aa_component_definition(component) {
	if (!component) return null;
	var middlePos = component.indexOf('.');
	var ns = component.substring(0, middlePos);
	var compName = component.substr(middlePos + 1);

	return ajaxart.components[ns] && ajaxart.components[ns][compName];
}

function aa_component_param_def(component_id, param) {
	var comp = aa_component_definition(component_id);
	var param = aa_xpath(comp, "Param[@name='" + param + "']");
	if (param.length > 0) return param[0];
	else return null;
}

function aa_component_param_type(component, param) {
	var type = aa_totext(aa_xpath(component, "Param[@name='" + param + "']/@type"));
	if (type == "") return "data.Data";
	return type;
}
ajaxart.load_usage_plugin("xtml");





aa_gcs("yesno", {
	EqualsTo: function(profile, data, context) {
		var to = ajaxart.run(data, profile, 'To', context);

		if (to.length == 0 && data.length == 0) return ["true"];
		if (to.length == 0 || data.length == 0) return [];

		var to_comp = to[0];
		var data_comp = data[0];

		if (aa_itemsEqual(to_comp, data_comp)) return ["true"];
		return [];
	},
	BooleansEqual: function(profile, data, context) {
		var item1 = aa_bool(data, profile, 'Item1', context);
		var item2 = aa_bool(data, profile, 'Item2', context);
		if (item1 == item2) return ["true"];
		return [];
	},
	IsOneOf: function(profile, data, context) {
		var val = aa_first(data, profile, 'Value', context);
		var optionProfs = ajaxart.subprofiles(profile, 'Option');

		if (val == null) return [];

		for (var i in optionProfs) {
			var options = ajaxart.run(data, optionProfs[i], '', context);
			for (var j in options)
			if (aa_itemsEqual(val, options[j])) return ["true"];
		}
		return [];
	},
	EqualsToList: function(profile, data, context) {
		var list = ajaxart.run(data, profile, 'To', context);
		if (list.length != data.length) return [];

		for (var i = 0; i < list.length; i++) {
			if (!aa_itemsEqual(list[i], data[i])) return [];
		}
		return ["true"];
	},
	GreaterThan: function(profile, data, context) {
		var type = aa_text(data, profile, 'Type', context);
		var alsoEqual = aa_bool(data, profile, 'AlsoEqual', context);
		var i1,i2;
		if (type == 'number') { i1 = aa_int(data, profile, 'Item', context); i2 = aa_int(data, profile, 'Than', context) }
		if (type == 'text') { i1 = aa_text(data, profile, 'Item', context); i2 = aa_text(data, profile, 'Than', context) }
		if (type == 'date') { i1 = aadate_date2int(aa_text(data, profile, 'Item', context)); i2 = aadate_date2int(aa_text(data, profile, 'Than', context)) };
	    if (i1 > i2 || (alsoEqual && i1 >= i2)) return ['true'];
		return [];
	},
	LessThan: function(profile, data, context) {
		var type = aa_text(data, profile, 'Type', context);
		var alsoEqual = aa_bool(data, profile, 'AlsoEqual', context);
		var i1,i2;
		if (type == 'number') { i1 = aa_int(data, profile, 'Item', context); i2 = aa_int(data, profile, 'Than', context) }
		if (type == 'text') { i1 = aa_text(data, profile, 'Item', context); i2 = aa_text(data, profile, 'Than', context) }
		if (type == 'date') { i1 = aadate_date2int(aa_text(data, profile, 'Item', context)); i2 = aadate_date2int(aa_text(data, profile, 'Than', context)) };
	    if (i1 < i2 || (alsoEqual && i1 <= i2)) return ['true'];
		return [];
	},
	MathCondition: function(profile, data, context) {
	  var exp = aa_text(data,profile,'Expression',context);
	  try
	  {
		  eval('var val = ' + exp);
		  return aa_frombool(!!val);
	  }
	  catch(e) {}
	},
	DynamicAnd: function(profile, data, context) {
		var items = ajaxart.run(data, profile, 'DynamicItems', context);
		var ctx1 = aa_ctx(context, { OriginalInput: data });

		for (var i = 0; i < items.length; i++) {
			if (!aa_bool([items[i]], profile, 'ConditionOnItem', ctx1)) return [];
		}
		return ["true"];
	},
	ContainsRegex: function(profile, data, context) {
		var text = aa_text(data, profile, 'Text', context);
		var regex = aa_text(data, profile, 'Regex', context);

		if (text.search(regex) > -1) return ["true"];
	},
	Contains: function(profile, data, context) {
		var ignoreCase = aa_bool(data, profile, 'IgnoreCase', context);
		var ignoreOrder = aa_bool(data, profile, 'IgnoreOrder', context);
		var oneOf = aa_bool(data, profile, 'OneOf', context);
		var allText = ajaxart.run(data, profile, 'AllText', context);

		var data_text = "";
		if (ajaxart.isxml(allText)) data_text = ajaxart.xml2text(allText);
		else data_text = ajaxart.totext(allText);

		data_text = data_text.replace(/\s+/g, ' '); // normalize white spaces
		//if (data_text == "") return [];
		var text_items = ajaxart.runsubprofiles(data, profile, 'Text', context);
		//var text_profiles = ajaxart.subprofiles(profile,'Text');
		var startIndex = 0;
		if (data_text == null || text_items.length == 0) return [];
		if (ignoreCase) data_text = data_text.toLowerCase();
		for (var i = 0; i < text_items.length; i++) {
			var text = ajaxart.totext_item(text_items[i]).replace(/\s+/g, ' ');
			if (ignoreCase) text = text.toLowerCase();
			var new_index = data_text.indexOf(text, startIndex);
			if (!oneOf && new_index == -1) return [];
			if (oneOf && new_index != -1) return ['true'];
			startIndex = new_index + text.length;
			if (ignoreOrder || oneOf) startIndex = 0;
		};

		if (oneOf) return [];
		return ['true'];
	},
	IsInList: function(profile, data, context) {
		var list = ajaxart.run(data, profile, 'List', context);
		var item = aa_first(data, profile, 'Item', context);
		if (item == null) return [];

		for (var i = 0; i < list.length; i++) {
			if (aa_itemsEqual(item, list[i])) return ["true"];
		}
		return [];
	},
	IsStruct: function(profile, data, context) {
		return aa_frombool(ajaxart.isObject(data[0]));
	},
	IsXml: function(profile, data, context) {
		if (data.length == 0) return [];
		if (ajaxart.isxml(data[0])) return ["true"];
		return [];
	},
	VariableExists: function(profile, data, context) {
		var varname = aa_text(data, profile, 'VarName', context);
		if (!context.vars[varname]) return [];
		return ["true"];
	},
	NotInLocalHost: function(profile, data, context) {
		if (window.location.href.indexOf('localhost') > -1) return [];
		return ["true"];
	},
	ConditionByJavascript: function(profile, data, context) {
		var code = aa_text(data, profile, 'Javascript', context);
		var result = aa_run_js_code(code, data, context);
		if (result == true) return ['true'];
	},
	IsSingleValue: function(profile, data, context) {
		var val = ajaxart.run(data, profile, 'Value', context);
		if (val.length == 1) return ["true"];
		return [];
	},
	IsMultipleValue: function(profile, data, context) {
		var value = ajaxart.run(data, profile, 'Value', context);
		if (value.length > 1) return ["true"];
		return [];
	},
	ListContains: function(profile, data, context) {
		var inner = aa_run(data,profile,'InnerList',context);
		var outer = aa_run(data,profile,'OuterList',context);
		var contains = aa_text(data,profile,'Contains',context);

		for(var i=0;i<inner.length;i++) {
			var found = itemInOuter(inner[i]);
			if (contains == 'one of' && found) return ['true'];
			if (contains == 'all' && !found) return [];
		}
		if (contains == 'one of') return [];
		return ['true'];

		function itemInOuter(item) {
			for(var i=0;i<outer.length;i++)
				if (outer[i] == item) return true;

			return false;
		}
	},
	NumberInRange: function(profile, data, context) {
		var from = aa_float(data, profile, 'From', context);
		var to = aa_float(data, profile, 'To', context);
		var num = parseFloat(ajaxart.totext(data));
		if (num >= from && num <= to) return ["true"];
		return [];
	},
	NotAnyOf: function(profile, data, context) {
		var subprofiles = ajaxart.subprofiles(profile, 'Item');

		for (var i = 0; i < subprofiles.length; i++) {
			if (aa_bool(data, subprofiles[i], "", context)) return [];
		};
		return ["true"];
	},
	PassesCondition: function(profile, data, context) {
		return aa_bool(data, profile, 'Expression', context);
	},
	IsWritableText: function(profile, data, context) {
		if (ajaxart.isxml(data)) return ["true"];
		return [];
	},
	IsNumber: function(profile, data, context) {
		var value = aa_text(data, profile, 'Value', context);
		if (value == "") return [];
		if (!isNaN(Number(value))) return ["true"];
		return [];
	},
	InStudio: function(profile, data, context) {
		return aa_frombool(ajaxart.jbart_studio);
	}

});


function aa_textInList(text, list) {
	for (var i = 0; i < list.length; i++)
	if (text == list[i]) return true;
	return false;
}

function aa_isEmpty(data, checkInnerText) {
	if (data.length == 0) return ["true"];
	for (var i=0; i<data.length; i++)
		if (!isEmpty(data[i]))
			return [];
	return ["true"];
	
	function isEmpty(item) {
		if (item.GetValue) item = item.GetValue()[0];
		if (typeof(item) == "string" && item == "") return true;
		if (ajaxart.isxml(item)) {
			if (item.nodeType == 3 || item.nodeType == 4) // inner text
			return item.nodeValue == "";
			if (item.nodeType == 2) // attribute
			return item.nodeValue == "";
			if (item.nodeType == 1 && checkInnerText) // element
			{
				if (item.attributes.length > 0) return false;
				var children = item.childNodes;
				if (children.length == 0) return true;
				if (children.length == 1 && (children[0].nodeType == 3 || children[0].nodeType == 4) && children[0].nodeValue == "") return ["true"];
			}
		}
	}
}

function aa_itemsEqual(item1, item2) {
	var item1Comp = item1;
	var item2Comp = item2;

	if (ajaxart.isxml(item1)) {
		if (item1.nodeType == 2) // att
		item1Comp = '' + item1.nodeValue;
		else item1Comp = ajaxart.xml2text(item1).replace(/\n/g, "").replace(/\r/g, "").replace(/\t/g, "").replace(/>[ ]*</g, "><");
		if (ajaxart.ishtml(item1)) item1Comp = item1Comp.replace(/class=(\w+)/g, 'class="$1"');
	}
	if (ajaxart.isxml(item2)) {
		if (item2.nodeType == 2) // att
		item2Comp = '' + item2.nodeValue;
		else item2Comp = ajaxart.xml2text(item2).replace(/\n/g, "").replace(/\r/g, "").replace(/\t/g, "").replace(/>[ ]*</g, "><");
		if (ajaxart.ishtml(item2)) item2Comp = item2Comp.replace(/class=(\w+)/g, 'class="$1"');
	}
	// Compare text to xml element : compare to inner text
	if (ajaxart.isxml(item1) && !ajaxart.isxmlelement(item2) && item1.nodeType == 1) item1Comp = ajaxart.xml.innerTextStr(item1);
	if (ajaxart.isxml(item2) && !ajaxart.isxmlelement(item1) && item2.nodeType == 1) item2Comp = ajaxart.xml.innerTextStr(item2);

	if (ajaxart.isObject(item1) || ajaxart.isObject(item2)) {
		if (ajaxart.isObject(item1) && ajaxart.isObject(item2)) {
			for (i in item1) {
				if (i != "isObject") {
					var item1val = item1[i];
					var item2val = item2[i];
					if (typeof(item2val) != typeof(item1val)) return false;
					if (typeof(item1val) == "undefined" && typeof(item2val) == "undefined") continue;
					if (aa_isArray(item1val) && item1val.length > 0) item1val = item1val[0];
					if (aa_isArray(item2val) && item2val.length > 0) item2val = item2val[0];
					if (aa_isArray(item1val) && item1val.length == 0 && aa_isArray(item2val) && item2val.length == 0) continue;
					if (!aa_itemsEqual(item1val, item2val)) return false;
				}
			}
			return true;
		}
		return false;
	}

	if (item1Comp == item2Comp) return true;

	return false;
}
ajaxart.load_usage_plugin("yesno");

aa_wicked_good_xpath();

function aa_wicked_good_xpath() {
    // https://code.google.com/p/wicked-good-xpath/
// all .toLowerCase() was removed from the code [YANIV]
  if (window.document.evaluate) {
		var xml = aa_parsexml('<xml><elem/></xml>');
		if (aa_xpath(xml,'elem')[0]) return;
	}
	
	if (ajaxart.log) ajaxart.log('Using wicked good xpath lib');
	window.jbUsingJSXPath = true;

(function(){function h(a){return function(){return this[a]}}function k(a){return function(){return a}}var l=this;
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function m(a){return"string"==typeof a}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function n(a,b,c){n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return n.apply(null,arguments)}function da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function r(a){var b=s;function c(){}c.prototype=b.prototype;a.t=b.prototype;a.prototype=new c}
Function.prototype.bind=Function.prototype.bind||function(a,b){if(1<arguments.length){var c=Array.prototype.slice.call(arguments,1);c.unshift(this,a);return n.apply(null,c)}return n(this,a)};function t(a,b,c){this.a=a;this.b=b||1;this.d=c||1};var u,ea,fa,ga;function ha(){return l.navigator?l.navigator.userAgent:null}ga=fa=ea=u=!1;var w;if(w=ha()){var ia=l.navigator;u=0==w.lastIndexOf("Opera",0);ea=!u&&(-1!=w.indexOf("MSIE")||-1!=w.indexOf("Trident"));fa=!u&&-1!=w.indexOf("WebKit");ga=!u&&!fa&&!ea&&"Gecko"==ia.product}var y=ea,ja=ga,ka=fa;function la(){var a=l.document;return a?a.documentMode:void 0}var ma;
n:{var na="",oa;if(u&&l.opera)var pa=l.opera.version,na="function"==typeof pa?pa():pa;else if(ja?oa=/rv\:([^\);]+)(\)|;)/:y?oa=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:ka&&(oa=/WebKit\/(\S+)/),oa)var qa=oa.exec(ha()),na=qa?qa[1]:"";if(y){var ra=la();if(ra>parseFloat(na)){ma=String(ra);break n}}ma=na}var sa=ma,ta={};
function ua(a){if(!ta[a]){for(var b=0,c=String(sa).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",p=d[f]||"",q=RegExp("(\\d*)(\\D*)","g"),x=RegExp("(\\d*)(\\D*)","g");do{var v=q.exec(g)||["","",""],J=x.exec(p)||["","",""];if(0==v[0].length&&0==J[0].length)break;b=((0==v[1].length?0:parseInt(v[1],10))<(0==J[1].length?0:parseInt(J[1],10))?-1:(0==v[1].length?0:parseInt(v[1],10))>
(0==J[1].length?0:parseInt(J[1],10))?1:0)||((0==v[2].length)<(0==J[2].length)?-1:(0==v[2].length)>(0==J[2].length)?1:0)||(v[2]<J[2]?-1:v[2]>J[2]?1:0)}while(0==b)}ta[a]=0<=b}}var va=l.document,wa=va&&y?la()||("CSS1Compat"==va.compatMode?parseInt(sa,10):5):void 0;var z=y&&!(y&&9<=wa),xa=y&&!(y&&8<=wa);function A(a,b,c,d){this.a=a;this.nodeName=c;this.nodeValue=d;this.nodeType=2;this.parentNode=this.ownerElement=b}function ya(a,b){var c=xa&&"href"==b.nodeName?a.getAttribute(b.nodeName,2):b.nodeValue;return new A(b,a,b.nodeName,c)};function za(a){this.b=a;this.a=0}function Aa(a){a=a.match(Ba);for(var b=0;b<a.length;b++)Ca.test(a[b])&&a.splice(b,1);return new za(a)}var Ba=RegExp("\\$?(?:(?![0-9-])[\\w-]+:)?(?![0-9-])[\\w-]+|\\/\\/|\\.\\.|::|\\d+(?:\\.\\d*)?|\\.\\d+|\"[^\"]*\"|'[^']*'|[!<>]=|\\s+|.","g"),Ca=/^\s/;function B(a,b){return a.b[a.a+(b||0)]}function C(a){return a.b[a.a++]};var D=Array.prototype,Da=D.indexOf?function(a,b,c){return D.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(m(a))return m(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},E=D.forEach?function(a,b,c){D.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=m(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Ea=D.filter?function(a,b,c){return D.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=m(a)?
a.split(""):a,p=0;p<d;p++)if(p in g){var q=g[p];b.call(c,q,p,a)&&(e[f++]=q)}return e},F=D.reduce?function(a,b,c,d){d&&(b=n(b,d));return D.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;E(a,function(c,g){e=b.call(d,e,c,g,a)});return e},Fa=D.some?function(a,b,c){return D.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=m(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};
function Ga(a,b){var c;n:{c=a.length;for(var d=m(a)?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){c=e;break n}c=-1}return 0>c?null:m(a)?a.charAt(c):a[c]}function Ha(a){return D.concat.apply(D,arguments)}function Ia(a,b,c){return 2>=arguments.length?D.slice.call(a,b):D.slice.call(a,b,c)};!ja&&!y||y&&y&&9<=wa||ja&&ua("1.9.1");y&&ua("9");function Ja(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}
function Ka(a,b){if(a==b)return 0;if(a.compareDocumentPosition)return a.compareDocumentPosition(b)&2?1:-1;if(y&&!(y&&9<=wa)){if(9==a.nodeType)return-1;if(9==b.nodeType)return 1}if("sourceIndex"in a||a.parentNode&&"sourceIndex"in a.parentNode){var c=1==a.nodeType,d=1==b.nodeType;if(c&&d)return a.sourceIndex-b.sourceIndex;var e=a.parentNode,f=b.parentNode;return e==f?La(a,b):!c&&Ja(e,b)?-1*Ma(a,b):!d&&Ja(f,a)?Ma(b,a):(c?a.sourceIndex:e.sourceIndex)-(d?b.sourceIndex:f.sourceIndex)}d=9==a.nodeType?a:
a.ownerDocument||a.document;c=d.createRange();c.selectNode(a);c.collapse(!0);d=d.createRange();d.selectNode(b);d.collapse(!0);return c.compareBoundaryPoints(l.Range.START_TO_END,d)}function Ma(a,b){var c=a.parentNode;if(c==b)return-1;for(var d=b;d.parentNode!=c;)d=d.parentNode;return La(d,a)}function La(a,b){for(var c=b;c=c.previousSibling;)if(c==a)return-1;return 1};function G(a){var b=null,c=a.nodeType;1==c&&(b=a.textContent,b=void 0==b||null==b?a.innerText:b,b=void 0==b||null==b?"":b);if("string"!=typeof b)if(z&&"title"==a.nodeName&&1==c)b=a.text;else if(9==c||1==c){a=9==c?a.documentElement:a.firstChild;for(var c=0,d=[],b="";a;){do 1!=a.nodeType&&(b+=a.nodeValue),z&&"title"==a.nodeName&&(b+=a.text),d[c++]=a;while(a=a.firstChild);for(;c&&!(a=d[--c].nextSibling););}}else b=a.nodeValue;return""+b}
function H(a,b,c){if(null===b)return!0;try{if(!a.getAttribute)return!1}catch(d){return!1}xa&&"class"==b&&(b="className");return null==c?!!a.getAttribute(b):a.getAttribute(b,2)==c}function Na(a,b,c,d,e){return(z?Oa:Pa).call(null,a,b,m(c)?c:null,m(d)?d:null,e||new I)}
function Oa(a,b,c,d,e){if(a instanceof K||8==a.b||c&&null===a.b){var f=b.all;if(!f)return e;a=Qa(a);if("*"!=a&&(f=b.getElementsByTagName(a),!f))return e;if(c){for(var g=[],p=0;b=f[p++];)H(b,c,d)&&g.push(b);f=g}for(p=0;b=f[p++];)"*"==a&&"!"==b.tagName||L(e,b);return e}Ra(a,b,c,d,e);return e}
function Pa(a,b,c,d,e){b.getElementsByName&&d&&"name"==c&&!y?(b=b.getElementsByName(d),E(b,function(b){a.a(b)&&L(e,b)})):b.getElementsByClassName&&d&&"class"==c?(b=b.getElementsByClassName(d),E(b,function(b){b.className==d&&a.a(b)&&L(e,b)})):a instanceof M?Ra(a,b,c,d,e):b.getElementsByTagName&&(b=b.getElementsByTagName(a.d()),E(b,function(a){H(a,c,d)&&L(e,a)}));return e}
function Sa(a,b,c,d,e){var f;if((a instanceof K||8==a.b||c&&null===a.b)&&(f=b.childNodes)){var g=Qa(a);if("*"!=g&&(f=Ea(f,function(a){return a.tagName&&a.tagName==g}),!f))return e;c&&(f=Ea(f,function(a){return H(a,c,d)}));E(f,function(a){"*"==g&&("!"==a.tagName||"*"==g&&1!=a.nodeType)||L(e,a)});return e}return Ta(a,b,c,d,e)}function Ta(a,b,c,d,e){for(b=b.firstChild;b;b=b.nextSibling)H(b,c,d)&&a.a(b)&&L(e,b);return e}
function Ra(a,b,c,d,e){for(b=b.firstChild;b;b=b.nextSibling)H(b,c,d)&&a.a(b)&&L(e,b),Ra(a,b,c,d,e)}function Qa(a){if(a instanceof M){if(8==a.b)return"!";if(null===a.b)return"*"}return a.d()};function I(){this.b=this.a=null;this.i=0}function Ua(a){this.b=a;this.a=this.d=null}function Va(a,b){if(!a.a)return b;if(!b.a)return a;for(var c=a.a,d=b.a,e=null,f=null,g=0;c&&d;)c.b==d.b||c.b instanceof A&&d.b instanceof A&&c.b.a==d.b.a?(f=c,c=c.a,d=d.a):0<Ka(c.b,d.b)?(f=d,d=d.a):(f=c,c=c.a),(f.d=e)?e.a=f:a.a=f,e=f,g++;for(f=c||d;f;)f.d=e,e=e.a=f,g++,f=f.a;a.b=e;a.i=g;return a}function Wa(a,b){var c=new Ua(b);c.a=a.a;a.b?a.a.d=c:a.a=a.b=c;a.a=c;a.i++}
function L(a,b){var c=new Ua(b);c.d=a.b;a.a?a.b.a=c:a.a=a.b=c;a.b=c;a.i++}function Xa(a){return(a=a.a)?a.b:null}function Ya(a){return(a=Xa(a))?G(a):""}function N(a,b){return new Za(a,!!b)}function Za(a,b){this.d=a;this.b=(this.c=b)?a.b:a.a;this.a=null}function O(a){var b=a.b;if(null==b)return null;var c=a.a=b;a.b=a.c?b.d:b.a;return c.b};function $a(a){switch(a.nodeType){case 1:return da(ab,a);case 9:return $a(a.documentElement);case 2:return a.ownerElement?$a(a.ownerElement):bb;case 11:case 10:case 6:case 12:return bb;default:return a.parentNode?$a(a.parentNode):bb}}function bb(){return null}function ab(a,b){if(a.prefix==b)return a.namespaceURI||"http://www.w3.org/1999/xhtml";var c=a.getAttributeNode("xmlns:"+b);return c&&c.specified?c.value||null:a.parentNode&&9!=a.parentNode.nodeType?ab(a.parentNode,b):null};function s(a){this.g=a;this.b=this.f=!1;this.d=null}function P(a){return"\n  "+a.toString().split("\n").join("\n  ")}function cb(a,b){a.f=b}function db(a,b){a.b=b}function Q(a,b){var c=a.a(b);return c instanceof I?+Ya(c):+c}function R(a,b){var c=a.a(b);return c instanceof I?Ya(c):""+c}function S(a,b){var c=a.a(b);return c instanceof I?!!c.i:!!c};function eb(a,b,c){s.call(this,a.g);this.c=a;this.e=b;this.j=c;this.f=b.f||c.f;this.b=b.b||c.b;this.c==fb&&(c.b||c.f||4==c.g||0==c.g||!b.d?b.b||b.f||4==b.g||0==b.g||!c.d||(this.d={name:c.d.name,l:b}):this.d={name:b.d.name,l:c})}r(eb);
function T(a,b,c,d,e){b=b.a(d);c=c.a(d);var f;if(b instanceof I&&c instanceof I){e=N(b);for(d=O(e);d;d=O(e))for(b=N(c),f=O(b);f;f=O(b))if(a(G(d),G(f)))return!0;return!1}if(b instanceof I||c instanceof I){b instanceof I?e=b:(e=c,c=b);e=N(e);b=typeof c;for(d=O(e);d;d=O(e)){switch(b){case "number":d=+G(d);break;case "boolean":d=!!G(d);break;case "string":d=G(d);break;default:throw Error("Illegal primitive type for comparison.");}if(a(d,c))return!0}return!1}return e?"boolean"==typeof b||"boolean"==typeof c?
a(!!b,!!c):"number"==typeof b||"number"==typeof c?a(+b,+c):a(b,c):a(+b,+c)}eb.prototype.a=function(a){return this.c.k(this.e,this.j,a)};eb.prototype.toString=function(){var a="Binary Expression: "+this.c,a=a+P(this.e);return a+=P(this.j)};function gb(a,b,c,d){this.a=a;this.p=b;this.g=c;this.k=d}gb.prototype.toString=h("a");var hb={};function U(a,b,c,d){if(hb.hasOwnProperty(a))throw Error("Binary operator already created: "+a);a=new gb(a,b,c,d);return hb[a.toString()]=a}
U("div",6,1,function(a,b,c){return Q(a,c)/Q(b,c)});U("mod",6,1,function(a,b,c){return Q(a,c)%Q(b,c)});U("*",6,1,function(a,b,c){return Q(a,c)*Q(b,c)});U("+",5,1,function(a,b,c){return Q(a,c)+Q(b,c)});U("-",5,1,function(a,b,c){return Q(a,c)-Q(b,c)});U("<",4,2,function(a,b,c){return T(function(a,b){return a<b},a,b,c)});U(">",4,2,function(a,b,c){return T(function(a,b){return a>b},a,b,c)});U("<=",4,2,function(a,b,c){return T(function(a,b){return a<=b},a,b,c)});
U(">=",4,2,function(a,b,c){return T(function(a,b){return a>=b},a,b,c)});var fb=U("=",3,2,function(a,b,c){return T(function(a,b){return a==b},a,b,c,!0)});U("!=",3,2,function(a,b,c){return T(function(a,b){return a!=b},a,b,c,!0)});U("and",2,2,function(a,b,c){return S(a,c)&&S(b,c)});U("or",1,2,function(a,b,c){return S(a,c)||S(b,c)});function ib(a,b){if(b.a.length&&4!=a.g)throw Error("Primary expression must evaluate to nodeset if filter has predicate(s).");s.call(this,a.g);this.c=a;this.e=b;this.f=a.f;this.b=a.b}r(ib);ib.prototype.a=function(a){a=this.c.a(a);return jb(this.e,a)};ib.prototype.toString=function(){var a;a="Filter:"+P(this.c);return a+=P(this.e)};function kb(a,b){if(b.length<a.o)throw Error("Function "+a.h+" expects at least"+a.o+" arguments, "+b.length+" given");if(null!==a.n&&b.length>a.n)throw Error("Function "+a.h+" expects at most "+a.n+" arguments, "+b.length+" given");a.s&&E(b,function(b,d){if(4!=b.g)throw Error("Argument "+d+" to function "+a.h+" is not of type Nodeset: "+b);});s.call(this,a.g);this.e=a;this.c=b;cb(this,a.f||Fa(b,function(a){return a.f}));db(this,a.r&&!b.length||a.q&&!!b.length||Fa(b,function(a){return a.b}))}r(kb);
kb.prototype.a=function(a){return this.e.k.apply(null,Ha(a,this.c))};kb.prototype.toString=function(){var a="Function: "+this.e;if(this.c.length)var b=F(this.c,function(a,b){return a+P(b)},"Arguments:"),a=a+P(b);return a};function lb(a,b,c,d,e,f,g,p,q){this.h=a;this.g=b;this.f=c;this.r=d;this.q=e;this.k=f;this.o=g;this.n=void 0!==p?p:g;this.s=!!q}lb.prototype.toString=h("h");var mb={};
function V(a,b,c,d,e,f,g,p){if(mb.hasOwnProperty(a))throw Error("Function already created: "+a+".");mb[a]=new lb(a,b,c,d,!1,e,f,g,p)}V("boolean",2,!1,!1,function(a,b){return S(b,a)},1);V("ceiling",1,!1,!1,function(a,b){return Math.ceil(Q(b,a))},1);V("concat",3,!1,!1,function(a,b){var c=Ia(arguments,1);return F(c,function(b,c){return b+R(c,a)},"")},2,null);V("contains",2,!1,!1,function(a,b,c){b=R(b,a);a=R(c,a);return-1!=b.indexOf(a)},2);V("count",1,!1,!1,function(a,b){return b.a(a).i},1,1,!0);
V("false",2,!1,!1,k(!1),0);V("floor",1,!1,!1,function(a,b){return Math.floor(Q(b,a))},1);V("id",4,!1,!1,function(a,b){function c(a){if(z){var b=e.all[a];if(b){if(b.nodeType&&a==b.id)return b;if(b.length)return Ga(b,function(b){return a==b.id})}return null}return e.getElementById(a)}var d=a.a,e=9==d.nodeType?d:d.ownerDocument,d=R(b,a).split(/\s+/),f=[];E(d,function(a){a=c(a);!a||0<=Da(f,a)||f.push(a)});f.sort(Ka);var g=new I;E(f,function(a){L(g,a)});return g},1);V("lang",2,!1,!1,k(!1),1);
V("last",1,!0,!1,function(a){if(1!=arguments.length)throw Error("Function last expects ()");return a.d},0);V("local-name",3,!1,!0,function(a,b){var c=b?Xa(b.a(a)):a.a;return c?c.nodeName:""},0,1,!0);V("name",3,!1,!0,function(a,b){var c=b?Xa(b.a(a)):a.a;return c?c.nodeName:""},0,1,!0);V("namespace-uri",3,!0,!1,k(""),0,1,!0);V("normalize-space",3,!1,!0,function(a,b){return(b?R(b,a):G(a.a)).replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},0,1);
V("not",2,!1,!1,function(a,b){return!S(b,a)},1);V("number",1,!1,!0,function(a,b){return b?Q(b,a):+G(a.a)},0,1);V("position",1,!0,!1,function(a){return a.b},0);V("round",1,!1,!1,function(a,b){return Math.round(Q(b,a))},1);V("starts-with",2,!1,!1,function(a,b,c){b=R(b,a);a=R(c,a);return 0==b.lastIndexOf(a,0)},2);V("string",3,!1,!0,function(a,b){return b?R(b,a):G(a.a)},0,1);V("string-length",1,!1,!0,function(a,b){return(b?R(b,a):G(a.a)).length},0,1);
V("substring",3,!1,!1,function(a,b,c,d){c=Q(c,a);if(isNaN(c)||Infinity==c||-Infinity==c)return"";d=d?Q(d,a):Infinity;if(isNaN(d)||-Infinity===d)return"";c=Math.round(c)-1;var e=Math.max(c,0);a=R(b,a);if(Infinity==d)return a.substring(e);b=Math.round(d);return a.substring(e,c+b)},2,3);V("substring-after",3,!1,!1,function(a,b,c){b=R(b,a);a=R(c,a);c=b.indexOf(a);return-1==c?"":b.substring(c+a.length)},2);
V("substring-before",3,!1,!1,function(a,b,c){b=R(b,a);a=R(c,a);a=b.indexOf(a);return-1==a?"":b.substring(0,a)},2);V("sum",1,!1,!1,function(a,b){for(var c=N(b.a(a)),d=0,e=O(c);e;e=O(c))d+=+G(e);return d},1,1,!0);V("translate",3,!1,!1,function(a,b,c,d){b=R(b,a);c=R(c,a);var e=R(d,a);a=[];for(d=0;d<c.length;d++){var f=c.charAt(d);f in a||(a[f]=e.charAt(d))}c="";for(d=0;d<b.length;d++)f=b.charAt(d),c+=f in a?a[f]:f;return c},3);V("true",2,!1,!1,k(!0),0);function M(a,b){this.e=a;this.c=void 0!==b?b:null;this.b=null;switch(a){case "comment":this.b=8;break;case "text":this.b=3;break;case "processing-instruction":this.b=7;break;case "node":break;default:throw Error("Unexpected argument");}}function nb(a){return"comment"==a||"text"==a||"processing-instruction"==a||"node"==a}M.prototype.a=function(a){return null===this.b||this.b==a.nodeType};M.prototype.d=h("e");M.prototype.toString=function(){var a="Kind Test: "+this.e;null===this.c||(a+=P(this.c));return a};function ob(a){s.call(this,3);this.c=a.substring(1,a.length-1)}r(ob);ob.prototype.a=h("c");ob.prototype.toString=function(){return"Literal: "+this.c};function K(a,b){this.h=a;this.c=b?b:"http://www.w3.org/1999/xhtml"}K.prototype.a=function(a){var b=a.nodeType;return 1!=b&&2!=b?!1:"*"!=this.h&&this.h!=a.nodeName?!1:this.c==(a.namespaceURI?a.namespaceURI:"http://www.w3.org/1999/xhtml")};K.prototype.d=h("h");K.prototype.toString=function(){return"Name Test: "+("http://www.w3.org/1999/xhtml"==this.c?"":this.c+":")+this.h};function pb(a){s.call(this,1);this.c=a}r(pb);pb.prototype.a=h("c");pb.prototype.toString=function(){return"Number: "+this.c};function qb(a,b){s.call(this,a.g);this.e=a;this.c=b;this.f=a.f;this.b=a.b;if(1==this.c.length){var c=this.c[0];c.m||c.c!=rb||(c=c.j,"*"!=c.d()&&(this.d={name:c.d(),l:null}))}}r(qb);function sb(){s.call(this,4)}r(sb);sb.prototype.a=function(a){var b=new I;a=a.a;9==a.nodeType?L(b,a):L(b,a.ownerDocument);return b};sb.prototype.toString=k("Root Helper Expression");function tb(){s.call(this,4)}r(tb);tb.prototype.a=function(a){var b=new I;L(b,a.a);return b};tb.prototype.toString=k("Context Helper Expression");
qb.prototype.a=function(a){var b=this.e.a(a);if(!(b instanceof I))throw Error("Filter expression must evaluate to nodeset.");a=this.c;for(var c=0,d=a.length;c<d&&b.i;c++){var e=a[c],f=N(b,e.c.a),g;if(e.f||e.c!=ub)if(e.f||e.c!=vb)for(g=O(f),b=e.a(new t(g));null!=(g=O(f));)g=e.a(new t(g)),b=Va(b,g);else g=O(f),b=e.a(new t(g));else{for(g=O(f);(b=O(f))&&(!g.contains||g.contains(b))&&b.compareDocumentPosition(g)&8;g=b);b=e.a(new t(g))}}return b};
qb.prototype.toString=function(){var a;a="Path Expression:"+P(this.e);if(this.c.length){var b=F(this.c,function(a,b){return a+P(b)},"Steps:");a+=P(b)}return a};function wb(a,b){this.a=a;this.b=!!b}
function jb(a,b,c){for(c=c||0;c<a.a.length;c++)for(var d=a.a[c],e=N(b),f=b.i,g,p=0;g=O(e);p++){var q=a.b?f-p:p+1;g=d.a(new t(g,q,f));if("number"==typeof g)q=q==g;else if("string"==typeof g||"boolean"==typeof g)q=!!g;else if(g instanceof I)q=0<g.i;else throw Error("Predicate.evaluate returned an unexpected type.");if(!q){q=e;g=q.d;var x=q.a;if(!x)throw Error("Next must be called at least once before remove.");var v=x.d,x=x.a;v?v.a=x:g.a=x;x?x.d=v:g.b=v;g.i--;q.a=null}}return b}
wb.prototype.toString=function(){return F(this.a,function(a,b){return a+P(b)},"Predicates:")};function W(a,b,c,d){s.call(this,4);this.c=a;this.j=b;this.e=c||new wb([]);this.m=!!d;b=0<this.e.a.length?this.e.a[0].d:null;a.b&&b&&(a=b.name,a=z?a:a,this.d={name:a,l:b.l});n:{a=this.e;for(b=0;b<a.a.length;b++)if(c=a.a[b],c.f||1==c.g||0==c.g){a=!0;break n}a=!1}this.f=a}r(W);
W.prototype.a=function(a){var b=a.a,c=null,c=this.d,d=null,e=null,f=0;c&&(d=c.name,e=c.l?R(c.l,a):null,f=1);if(this.m)if(this.f||this.c!=xb)if(a=N((new W(yb,new M("node"))).a(a)),b=O(a))for(c=this.k(b,d,e,f);null!=(b=O(a));)c=Va(c,this.k(b,d,e,f));else c=new I;else c=Na(this.j,b,d,e),c=jb(this.e,c,f);else c=this.k(a.a,d,e,f);return c};W.prototype.k=function(a,b,c,d){a=this.c.d(this.j,a,b,c);return a=jb(this.e,a,d)};
W.prototype.toString=function(){var a;a="Step:"+P("Operator: "+(this.m?"//":"/"));this.c.h&&(a+=P("Axis: "+this.c));a+=P(this.j);if(this.e.a.length){var b=F(this.e.a,function(a,b){return a+P(b)},"Predicates:");a+=P(b)}return a};function zb(a,b,c,d){this.h=a;this.d=b;this.a=c;this.b=d}zb.prototype.toString=h("h");var Ab={};function X(a,b,c,d){if(Ab.hasOwnProperty(a))throw Error("Axis already created: "+a);b=new zb(a,b,c,!!d);return Ab[a]=b}
X("ancestor",function(a,b){for(var c=new I,d=b;d=d.parentNode;)a.a(d)&&Wa(c,d);return c},!0);X("ancestor-or-self",function(a,b){var c=new I,d=b;do a.a(d)&&Wa(c,d);while(d=d.parentNode);return c},!0);
var rb=X("attribute",function(a,b){var c=new I,d=a.d();if("style"==d&&b.style&&z)return L(c,new A(b.style,b,"style",b.style.cssText)),c;var e=b.attributes;if(e)if(a instanceof M&&null===a.b||"*"==d)for(var d=0,f;f=e[d];d++)z?f.nodeValue&&L(c,ya(b,f)):L(c,f);else(f=e.getNamedItem(d))&&(z?f.nodeValue&&L(c,ya(b,f)):L(c,f));return c},!1),xb=X("child",function(a,b,c,d,e){return(z?Sa:Ta).call(null,a,b,m(c)?c:null,m(d)?d:null,e||new I)},!1,!0);X("descendant",Na,!1,!0);
var yb=X("descendant-or-self",function(a,b,c,d){var e=new I;H(b,c,d)&&a.a(b)&&L(e,b);return Na(a,b,c,d,e)},!1,!0),ub=X("following",function(a,b,c,d){var e=new I;do for(var f=b;f=f.nextSibling;)H(f,c,d)&&a.a(f)&&L(e,f),e=Na(a,f,c,d,e);while(b=b.parentNode);return e},!1,!0);X("following-sibling",function(a,b){for(var c=new I,d=b;d=d.nextSibling;)a.a(d)&&L(c,d);return c},!1);X("namespace",function(){return new I},!1);
var Bb=X("parent",function(a,b){var c=new I;if(9==b.nodeType)return c;if(2==b.nodeType)return L(c,b.ownerElement),c;var d=b.parentNode;a.a(d)&&L(c,d);return c},!1),vb=X("preceding",function(a,b,c,d){var e=new I,f=[];do f.unshift(b);while(b=b.parentNode);for(var g=1,p=f.length;g<p;g++){var q=[];for(b=f[g];b=b.previousSibling;)q.unshift(b);for(var x=0,v=q.length;x<v;x++)b=q[x],H(b,c,d)&&a.a(b)&&L(e,b),e=Na(a,b,c,d,e)}return e},!0,!0);
X("preceding-sibling",function(a,b){for(var c=new I,d=b;d=d.previousSibling;)a.a(d)&&Wa(c,d);return c},!0);var Cb=X("self",function(a,b){var c=new I;a.a(b)&&L(c,b);return c},!1);function Db(a){s.call(this,1);this.c=a;this.f=a.f;this.b=a.b}r(Db);Db.prototype.a=function(a){return-Q(this.c,a)};Db.prototype.toString=function(){return"Unary Expression: -"+P(this.c)};function Eb(a){s.call(this,4);this.c=a;cb(this,Fa(this.c,function(a){return a.f}));db(this,Fa(this.c,function(a){return a.b}))}r(Eb);Eb.prototype.a=function(a){var b=new I;E(this.c,function(c){c=c.a(a);if(!(c instanceof I))throw Error("Path expression must evaluate to NodeSet.");b=Va(b,c)});return b};Eb.prototype.toString=function(){return F(this.c,function(a,b){return a+P(b)},"Union Expression:")};function Fb(a,b){this.a=a;this.b=b}function Gb(a){for(var b,c=[];;){Y(a,"Missing right hand side of binary expression.");b=Hb(a);var d=C(a.a);if(!d)break;var e=(d=hb[d]||null)&&d.p;if(!e){a.a.a--;break}for(;c.length&&e<=c[c.length-1].p;)b=new eb(c.pop(),c.pop(),b);c.push(b,d)}for(;c.length;)b=new eb(c.pop(),c.pop(),b);return b}function Y(a,b){if(a.a.b.length<=a.a.a)throw Error(b);}function Ib(a,b){var c=C(a.a);if(c!=b)throw Error("Bad token, expected: "+b+" got: "+c);}
function Jb(a){a=C(a.a);if(")"!=a)throw Error("Bad token: "+a);}function Kb(a){a=C(a.a);if(2>a.length)throw Error("Unclosed literal string");return new ob(a)}function Lb(a){var b=C(a.a),c=b.indexOf(":");if(-1==c)return new K(b);var d=b.substring(0,c);a=a.b(d);if(!a)throw Error("Namespace prefix not declared: "+d);b=b.substr(c+1);return new K(b,a)}
function Mb(a){var b,c=[],d;if("/"==B(a.a)||"//"==B(a.a)){b=C(a.a);d=B(a.a);if("/"==b&&(a.a.b.length<=a.a.a||"."!=d&&".."!=d&&"@"!=d&&"*"!=d&&!/(?![0-9])[\w]/.test(d)))return new sb;d=new sb;Y(a,"Missing next location step.");b=Nb(a,b);c.push(b)}else{n:{b=B(a.a);d=b.charAt(0);switch(d){case "$":throw Error("Variable reference not allowed in HTML XPath");case "(":C(a.a);b=Gb(a);Y(a,'unclosed "("');Ib(a,")");break;case '"':case "'":b=Kb(a);break;default:if(isNaN(+b))if(!nb(b)&&/(?![0-9])[\w]/.test(d)&&
"("==B(a.a,1)){b=C(a.a);b=mb[b]||null;C(a.a);for(d=[];")"!=B(a.a);){Y(a,"Missing function argument list.");d.push(Gb(a));if(","!=B(a.a))break;C(a.a)}Y(a,"Unclosed function argument list.");Jb(a);b=new kb(b,d)}else{b=null;break n}else b=new pb(+C(a.a))}"["==B(a.a)&&(d=new wb(Ob(a)),b=new ib(b,d))}if(b)if("/"==B(a.a)||"//"==B(a.a))d=b;else return b;else b=Nb(a,"/"),d=new tb,c.push(b)}for(;"/"==B(a.a)||"//"==B(a.a);)b=C(a.a),Y(a,"Missing next location step."),b=Nb(a,b),c.push(b);return new qb(d,c)}
function Nb(a,b){var c,d,e;if("/"!=b&&"//"!=b)throw Error('Step op should be "/" or "//"');if("."==B(a.a))return d=new W(Cb,new M("node")),C(a.a),d;if(".."==B(a.a))return d=new W(Bb,new M("node")),C(a.a),d;var f;if("@"==B(a.a))f=rb,C(a.a),Y(a,"Missing attribute name");else if("::"==B(a.a,1)){if(!/(?![0-9])[\w]/.test(B(a.a).charAt(0)))throw Error("Bad token: "+C(a.a));c=C(a.a);f=Ab[c]||null;if(!f)throw Error("No axis with name: "+c);C(a.a);Y(a,"Missing node name")}else f=xb;c=B(a.a);if(/(?![0-9])[\w]/.test(c.charAt(0)))if("("==
B(a.a,1)){if(!nb(c))throw Error("Invalid node type: "+c);c=C(a.a);if(!nb(c))throw Error("Invalid type name: "+c);Ib(a,"(");Y(a,"Bad nodetype");e=B(a.a).charAt(0);var g=null;if('"'==e||"'"==e)g=Kb(a);Y(a,"Bad nodetype");Jb(a);c=new M(c,g)}else c=Lb(a);else if("*"==c)c=Lb(a);else throw Error("Bad token: "+C(a.a));e=new wb(Ob(a),f.a);return d||new W(f,c,e,"//"==b)}
function Ob(a){for(var b=[];"["==B(a.a);){C(a.a);Y(a,"Missing predicate expression.");var c=Gb(a);b.push(c);Y(a,"Unclosed predicate expression.");Ib(a,"]")}return b}function Hb(a){if("-"==B(a.a))return C(a.a),new Db(Hb(a));var b=Mb(a);if("|"!=B(a.a))a=b;else{for(b=[b];"|"==C(a.a);)Y(a,"Missing next union location path."),b.push(Mb(a));a.a.a--;a=new Eb(b)}return a};function Pb(a,b){if(!a.length)throw Error("Empty XPath expression.");var c=Aa(a);if(c.b.length<=c.a)throw Error("Invalid XPath expression.");b?"function"==aa(b)||(b=n(b.lookupNamespaceURI,b)):b=k(null);var d=Gb(new Fb(c,b));if(!(c.b.length<=c.a))throw Error("Bad token: "+C(c));this.evaluate=function(a,b){var c=d.a(new t(a));return new Z(c,b)}}
function Z(a,b){if(0==b)if(a instanceof I)b=4;else if("string"==typeof a)b=2;else if("number"==typeof a)b=1;else if("boolean"==typeof a)b=3;else throw Error("Unexpected evaluation result.");if(2!=b&&1!=b&&3!=b&&!(a instanceof I))throw Error("value could not be converted to the specified type");this.resultType=b;var c;switch(b){case 2:this.stringValue=a instanceof I?Ya(a):""+a;break;case 1:this.numberValue=a instanceof I?+Ya(a):+a;break;case 3:this.booleanValue=a instanceof I?0<a.i:!!a;break;case 4:case 5:case 6:case 7:var d=
N(a);c=[];for(var e=O(d);e;e=O(d))c.push(e instanceof A?e.a:e);this.snapshotLength=a.i;this.invalidIteratorState=!1;break;case 8:case 9:d=Xa(a);this.singleNodeValue=d instanceof A?d.a:d;break;default:throw Error("Unknown XPathResult type.");}var f=0;this.iterateNext=function(){if(4!=b&&5!=b)throw Error("iterateNext called with wrong result type");return f>=c.length?null:c[f++]};this.snapshotItem=function(a){if(6!=b&&7!=b)throw Error("snapshotItem called with wrong result type");return a>=c.length||
0>a?null:c[a]}}Z.ANY_TYPE=0;Z.NUMBER_TYPE=1;Z.STRING_TYPE=2;Z.BOOLEAN_TYPE=3;Z.UNORDERED_NODE_ITERATOR_TYPE=4;Z.ORDERED_NODE_ITERATOR_TYPE=5;Z.UNORDERED_NODE_SNAPSHOT_TYPE=6;Z.ORDERED_NODE_SNAPSHOT_TYPE=7;Z.ANY_UNORDERED_NODE_TYPE=8;Z.FIRST_ORDERED_NODE_TYPE=9;function Qb(a){this.lookupNamespaceURI=$a(a)};function Rb(a){a=a||l;var b=a.document;(a.XPathResult=Z,b.evaluate2=function(a,b,e,f){return(new Pb(a,e)).evaluate(b,f)},b.createExpression=function(a,b){return new Pb(a,b)},b.createNSResolver=function(a){return new Qb(a)})}var Sb=["wgxpath","install"],$=l;Sb[0]in $||!$.execScript||$.execScript("var "+Sb[0]);for(var Tb;Sb.length&&(Tb=Sb.shift());)Sb.length||void 0===Rb?$=$[Tb]?$[Tb]:$[Tb]={}:$[Tb]=Rb;})()

	wgxpath.install();
}

function aa_moment(arg) {
	if (!window.moment)
		console.error('moment.js lib is not loaded: http://momentjs.com/');
	if (arg)
		return moment.apply(moment,arguments);
	else
		return moment;
}
/*!

JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,f,g,h,i,j="",k=0;k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),e=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|e>>6,i=63&e,isNaN(c)?h=i=64:isNaN(e)&&(i=64),j=j+d.charAt(f)+d.charAt(g)+d.charAt(h)+d.charAt(i);return j},c.decode=function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=d.indexOf(a.charAt(k++)),g=d.indexOf(a.charAt(k++)),h=d.indexOf(a.charAt(k++)),i=d.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(e));return j}},{}],2:[function(a,b){"use strict";function c(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}c.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},b.exports=c},{}],3:[function(a,b,c){"use strict";c.STORE={magic:"\x00\x00",compress:function(a){return a},uncompress:function(a){return a},compressInputType:null,uncompressInputType:null},c.DEFLATE=a("./flate")},{"./flate":8}],4:[function(a,b){"use strict";var c=a("./utils"),d=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var e="string"!==c.getTypeOf(a);"undefined"==typeof b&&(b=0);var f=0,g=0,h=0;b=-1^b;for(var i=0,j=a.length;j>i;i++)h=e?a[i]:a.charCodeAt(i),g=255&(b^h),f=d[g],b=b>>>8^f;return-1^b}},{"./utils":21}],5:[function(a,b){"use strict";function c(){this.data=null,this.length=0,this.index=0}var d=a("./utils");c.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<a||0>a)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return d.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1)}},b.exports=c},{"./utils":21}],6:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!1,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],7:[function(a,b,c){"use strict";var d=a("./utils");c.string2binary=function(a){return d.string2binary(a)},c.string2Uint8Array=function(a){return d.transformTo("uint8array",a)},c.uint8Array2String=function(a){return d.transformTo("string",a)},c.string2Blob=function(a){var b=d.transformTo("arraybuffer",a);return d.arrayBuffer2Blob(b)},c.arrayBuffer2Blob=function(a){return d.arrayBuffer2Blob(a)},c.transformTo=function(a,b){return d.transformTo(a,b)},c.getTypeOf=function(a){return d.getTypeOf(a)},c.checkSupport=function(a){return d.checkSupport(a)},c.MAX_VALUE_16BITS=d.MAX_VALUE_16BITS,c.MAX_VALUE_32BITS=d.MAX_VALUE_32BITS,c.pretty=function(a){return d.pretty(a)},c.findCompression=function(a){return d.findCompression(a)},c.isRegExp=function(a){return d.isRegExp(a)}},{"./utils":21}],8:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,e=a("pako");c.uncompressInputType=d?"uint8array":"array",c.compressInputType=d?"uint8array":"array",c.magic="\b\x00",c.compress=function(a,b){return e.deflateRaw(a,{level:b.level||-1})},c.uncompress=function(a){return e.inflateRaw(a)}},{pako:24}],9:[function(a,b){"use strict";function c(a,b){return this instanceof c?(this.files={},this.comment=null,this.root="",a&&this.load(a,b),void(this.clone=function(){var a=new c;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a})):new c(a,b)}var d=a("./base64");c.prototype=a("./object"),c.prototype.load=a("./load"),c.support=a("./support"),c.defaults=a("./defaults"),c.utils=a("./deprecatedPublicUtils"),c.base64={encode:function(a){return d.encode(a)},decode:function(a){return d.decode(a)}},c.compressions=a("./compressions"),b.exports=c},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(a,b){"use strict";var c=a("./base64"),d=a("./zipEntries");b.exports=function(a,b){var e,f,g,h;for(b=b||{},b.base64&&(a=c.decode(a)),f=new d(a,b),e=f.files,g=0;g<e.length;g++)h=e[g],this.file(h.fileName,h.decompressed,{binary:!0,optimizedBinaryString:!0,date:h.date,dir:h.dir,comment:h.fileComment.length?h.fileComment:null,unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions,createFolders:b.createFolders});return f.zipComment.length&&(this.comment=f.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(a,b){(function(a){"use strict";b.exports=function(b,c){return new a(b,c)},b.exports.test=function(b){return a.isBuffer(b)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(a,b){"use strict";function c(a){this.data=a,this.length=this.data.length,this.index=0}var d=a("./uint8ArrayReader");c.prototype=new d,c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.index,this.index+a);return this.index+=a,b},b.exports=c},{"./uint8ArrayReader":18}],13:[function(a,b){"use strict";var c=a("./support"),d=a("./utils"),e=a("./crc32"),f=a("./signature"),g=a("./defaults"),h=a("./base64"),i=a("./compressions"),j=a("./compressedObject"),k=a("./nodeBuffer"),l=a("./utf8"),m=a("./stringWriter"),n=a("./uint8ArrayWriter"),o=function(a){if(a._data instanceof j&&(a._data=a._data.getContent(),a.options.binary=!0,a.options.base64=!1,"uint8array"===d.getTypeOf(a._data))){var b=a._data;a._data=new Uint8Array(b.length),0!==b.length&&a._data.set(b,0)}return a._data},p=function(a){var b=o(a),e=d.getTypeOf(b);return"string"===e?!a.options.binary&&c.nodebuffer?k(b,"utf-8"):a.asBinary():b},q=function(a){var b=o(this);return null===b||"undefined"==typeof b?"":(this.options.base64&&(b=h.decode(b)),b=a&&this.options.binary?D.utf8decode(b):d.transformTo("string",b),a||this.options.binary||(b=d.transformTo("string",D.utf8encode(b))),b)},r=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this.options=c,this._initialMetadata={dir:c.dir,date:c.date}};r.prototype={asText:function(){return q.call(this,!0)},asBinary:function(){return q.call(this,!1)},asNodeBuffer:function(){var a=p(this);return d.transformTo("nodebuffer",a)},asUint8Array:function(){var a=p(this);return d.transformTo("uint8array",a)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var s=function(a,b){var c,d="";for(c=0;b>c;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},t=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},u=function(a){return a=a||{},a.base64!==!0||null!==a.binary&&void 0!==a.binary||(a.binary=!0),a=t(a,g),a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),a},v=function(a,b,c){var e,f=d.getTypeOf(b);if(c=u(c),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(a=x(a)),c.createFolders&&(e=w(a))&&y.call(this,e,!0),c.dir||null===b||"undefined"==typeof b)c.base64=!1,c.binary=!1,b=null,f=null;else if("string"===f)c.binary&&!c.base64&&c.optimizedBinaryString!==!0&&(b=d.string2binary(b));else{if(c.base64=!1,c.binary=!0,!(f||b instanceof j))throw new Error("The data of '"+a+"' is in an unsupported format !");"arraybuffer"===f&&(b=d.transformTo("uint8array",b))}var g=new r(a,b,c);return this.files[a]=g,g},w=function(a){"/"==a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},x=function(a){return"/"!=a.slice(-1)&&(a+="/"),a},y=function(a,b){return b="undefined"!=typeof b?b:!1,a=x(a),this.files[a]||v.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},z=function(a,b,c){var f,g=new j;return a._data instanceof j?(g.uncompressedSize=a._data.uncompressedSize,g.crc32=a._data.crc32,0===g.uncompressedSize||a.dir?(b=i.STORE,g.compressedContent="",g.crc32=0):a._data.compressionMethod===b.magic?g.compressedContent=a._data.getCompressedContent():(f=a._data.getContent(),g.compressedContent=b.compress(d.transformTo(b.compressInputType,f),c))):(f=p(a),(!f||0===f.length||a.dir)&&(b=i.STORE,f=""),g.uncompressedSize=f.length,g.crc32=e(f),g.compressedContent=b.compress(d.transformTo(b.compressInputType,f),c)),g.compressedSize=g.compressedContent.length,g.compressionMethod=b.magic,g},A=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},B=function(a){return 63&(a||0)},C=function(a,b,c,g,h){var i,j,k,m,n=(c.compressedContent,d.transformTo("string",l.utf8encode(b.name))),o=b.comment||"",p=d.transformTo("string",l.utf8encode(o)),q=n.length!==b.name.length,r=p.length!==o.length,t=b.options,u="",v="",w="";k=b._initialMetadata.dir!==b.dir?b.dir:t.dir,m=b._initialMetadata.date!==b.date?b.date:t.date;var x=0,y=0;k&&(x|=16),"UNIX"===h?(y=798,x|=A(b.unixPermissions,k)):(y=20,x|=B(b.dosPermissions,k)),i=m.getHours(),i<<=6,i|=m.getMinutes(),i<<=5,i|=m.getSeconds()/2,j=m.getFullYear()-1980,j<<=4,j|=m.getMonth()+1,j<<=5,j|=m.getDate(),q&&(v=s(1,1)+s(e(n),4)+n,u+="up"+s(v.length,2)+v),r&&(w=s(1,1)+s(this.crc32(p),4)+p,u+="uc"+s(w.length,2)+w);var z="";z+="\n\x00",z+=q||r?"\x00\b":"\x00\x00",z+=c.compressionMethod,z+=s(i,2),z+=s(j,2),z+=s(c.crc32,4),z+=s(c.compressedSize,4),z+=s(c.uncompressedSize,4),z+=s(n.length,2),z+=s(u.length,2);var C=f.LOCAL_FILE_HEADER+z+n+u,D=f.CENTRAL_FILE_HEADER+s(y,2)+z+s(p.length,2)+"\x00\x00\x00\x00"+s(x,4)+s(g,4)+n+u+p;return{fileRecord:C,dirRecord:D,compressedObject:c}},D={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(a){var b,c,d,e,f=[];for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],e=new r(d.name,d._data,t(d.options)),c=b.slice(this.root.length,b.length),b.slice(0,this.root.length)===this.root&&a(c,e)&&f.push(e));return f},file:function(a,b,c){if(1===arguments.length){if(d.isRegExp(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}return this.filter(function(b,c){return!c.dir&&b===a})[0]||null}return a=this.root+a,v.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d.isRegExp(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=y.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!=a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){a=t(a||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),d.checkSupport(a.type),("darwin"===a.platform||"freebsd"===a.platform||"linux"===a.platform||"sunos"===a.platform)&&(a.platform="UNIX"),"win32"===a.platform&&(a.platform="DOS");var b,c,e=[],g=0,j=0,k=d.transformTo("string",this.utf8encode(a.comment||this.comment||""));for(var l in this.files)if(this.files.hasOwnProperty(l)){var o=this.files[l],p=o.options.compression||a.compression.toUpperCase(),q=i[p];if(!q)throw new Error(p+" is not a valid compression method !");var r=o.options.compressionOptions||a.compressionOptions||{},u=z.call(this,o,q,r),v=C.call(this,l,o,u,g,a.platform);g+=v.fileRecord.length+u.compressedSize,j+=v.dirRecord.length,e.push(v)}var w="";w=f.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+s(e.length,2)+s(e.length,2)+s(j,4)+s(g,4)+s(k.length,2)+k;var x=a.type.toLowerCase();for(b="uint8array"===x||"arraybuffer"===x||"blob"===x||"nodebuffer"===x?new n(g+j+w.length):new m(g+j+w.length),c=0;c<e.length;c++)b.append(e[c].fileRecord),b.append(e[c].compressedObject.compressedContent);for(c=0;c<e.length;c++)b.append(e[c].dirRecord);b.append(w);var y=b.finalize();switch(a.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return d.transformTo(a.type.toLowerCase(),y);case"blob":return d.arrayBuffer2Blob(d.transformTo("arraybuffer",y),a.mimeType);case"base64":return a.base64?h.encode(y):y;default:return y}},crc32:function(a,b){return e(a,b)},utf8encode:function(a){return d.transformTo("string",l.utf8encode(a))},utf8decode:function(a){return l.utf8decode(a)}};b.exports=D},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],15:[function(a,b){"use strict";function c(a,b){this.data=a,b||(this.data=e.string2binary(this.data)),this.length=this.data.length,this.index=0}var d=a("./dataReader"),e=a("./utils");c.prototype=new d,c.prototype.byteAt=function(a){return this.data.charCodeAt(a)},c.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)},c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.index,this.index+a);return this.index+=a,b},b.exports=c},{"./dataReader":5,"./utils":21}],16:[function(a,b){"use strict";var c=a("./utils"),d=function(){this.data=[]};d.prototype={append:function(a){a=c.transformTo("string",a),this.data.push(a)},finalize:function(){return this.data.join("")}},b.exports=d},{"./utils":21}],17:[function(a,b,c){(function(a){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof a,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var b=new ArrayBuffer(0);try{c.blob=0===new Blob([b],{type:"application/zip"}).size}catch(d){try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e;f.append(b),c.blob=0===f.getBlob("application/zip").size}catch(d){c.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(a,b){"use strict";function c(a){a&&(this.data=a,this.length=this.data.length,this.index=0)}var d=a("./dataReader");c.prototype=new d,c.prototype.byteAt=function(a){return this.data[a]},c.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f;return-1},c.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.index,this.index+a);return this.index+=a,b},b.exports=c},{"./dataReader":5}],19:[function(a,b){"use strict";var c=a("./utils"),d=function(a){this.data=new Uint8Array(a),this.index=0};d.prototype={append:function(a){0!==a.length&&(a=c.transformTo("uint8array",a),this.data.set(a,this.index),this.index+=a.length)},finalize:function(){return this.data}},b.exports=d},{"./utils":21}],20:[function(a,b,c){"use strict";for(var d=a("./utils"),e=a("./support"),f=a("./nodeBuffer"),g=new Array(256),h=0;256>h;h++)g[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;g[254]=g[254]=1;var i=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=e.uint8array?new Uint8Array(i):new Array(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},j=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+g[a[c]]>b?c:b},k=function(a){var b,c,e,f,h=a.length,i=new Array(2*h);for(c=0,b=0;h>b;)if(e=a[b++],128>e)i[c++]=e;else if(f=g[e],f>4)i[c++]=65533,b+=f-1;else{for(e&=2===f?31:3===f?15:7;f>1&&h>b;)e=e<<6|63&a[b++],f--;f>1?i[c++]=65533:65536>e?i[c++]=e:(e-=65536,i[c++]=55296|e>>10&1023,i[c++]=56320|1023&e)}return i.length!==c&&(i.subarray?i=i.subarray(0,c):i.length=c),d.applyFromCharCode(i)};c.utf8encode=function(a){return e.nodebuffer?f(a,"utf-8"):i(a)},c.utf8decode=function(a){if(e.nodebuffer)return d.transformTo("nodebuffer",a).toString("utf-8");a=d.transformTo(e.uint8array?"uint8array":"array",a);for(var b=[],c=0,f=a.length,g=65536;f>c;){var h=j(a,Math.min(c+g,f));b.push(e.uint8array?k(a.subarray(c,h)):k(a.slice(c,h))),c=h}return b.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(a,b,c){"use strict";function d(a){return a}function e(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function f(a){var b=65536,d=[],e=a.length,f=c.getTypeOf(a),g=0,h=!0;try{switch(f){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,j(0))}}catch(i){h=!1}if(!h){for(var k="",l=0;l<a.length;l++)k+=String.fromCharCode(a[l]);return k}for(;e>g&&b>1;)try{d.push("array"===f||"nodebuffer"===f?String.fromCharCode.apply(null,a.slice(g,Math.min(g+b,e))):String.fromCharCode.apply(null,a.subarray(g,Math.min(g+b,e)))),g+=b}catch(i){b=Math.floor(b/2)}return d.join("")}function g(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var h=a("./support"),i=a("./compressions"),j=a("./nodeBuffer");c.string2binary=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(255&a.charCodeAt(c));return b},c.arrayBuffer2Blob=function(a,b){c.checkSupport("blob"),b=b||"application/zip";try{return new Blob([a],{type:b})}catch(d){try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}},c.applyFromCharCode=f;var k={};k.string={string:d,array:function(a){return e(a,new Array(a.length))},arraybuffer:function(a){return k.string.uint8array(a).buffer},uint8array:function(a){return e(a,new Uint8Array(a.length))},nodebuffer:function(a){return e(a,j(a.length))}},k.array={string:f,array:d,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return j(a)}},k.arraybuffer={string:function(a){return f(new Uint8Array(a))},array:function(a){return g(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:d,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return j(new Uint8Array(a))}},k.uint8array={string:f,array:function(a){return g(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:d,nodebuffer:function(a){return j(a)}},k.nodebuffer={string:f,array:function(a){return g(a,new Array(a.length))},arraybuffer:function(a){return k.nodebuffer.uint8array(a).buffer},uint8array:function(a){return g(a,new Uint8Array(a.length))},nodebuffer:d},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=k[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":h.nodebuffer&&j.test(a)?"nodebuffer":h.uint8array&&a instanceof Uint8Array?"uint8array":h.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=h[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this browser")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(16>b?"0":"")+b.toString(16).toUpperCase();return d},c.findCompression=function(a){for(var b in i)if(i.hasOwnProperty(b)&&i[b].magic===a)return i[b];return null},c.isRegExp=function(a){return"[object RegExp]"===Object.prototype.toString.call(a)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(a,b){"use strict";function c(a,b){this.files=[],this.loadOptions=b,a&&this.load(a)}var d=a("./stringReader"),e=a("./nodeBufferReader"),f=a("./uint8ArrayReader"),g=a("./utils"),h=a("./signature"),i=a("./zipEntry"),j=a("./support"),k=a("./object");c.prototype={checkSignature:function(a){var b=this.reader.readString(4);if(b!==a)throw new Error("Corrupted zip or bug : unexpected signature ("+g.pretty(b)+", expected "+g.pretty(a)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=k.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;d>e;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readString(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===h.CENTRAL_FILE_HEADER;)a=new i({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(-1===a){var b=!0;try{this.reader.setIndex(0),this.checkSignature(h.LOCAL_FILE_HEADER),b=!1}catch(c){}throw new Error(b?"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(a),this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===g.MAX_VALUE_16BITS||this.diskWithCentralDirStart===g.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===g.MAX_VALUE_16BITS||this.centralDirRecords===g.MAX_VALUE_16BITS||this.centralDirSize===g.MAX_VALUE_32BITS||this.centralDirOffset===g.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===a)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(a),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(a){var b=g.getTypeOf(a);this.reader="string"!==b||j.uint8array?"nodebuffer"===b?new e(a):new f(g.transformTo("uint8array",a)):new d(a,this.loadOptions.optimizedBinaryString)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=c},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(a,b){"use strict";function c(a,b){this.options=a,this.loadOptions=b}var d=a("./stringReader"),e=a("./utils"),f=a("./compressedObject"),g=a("./object"),h=0,i=3;c.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(a,b,c){return function(){var d=a.index;a.setIndex(b);var e=a.readData(c);return a.setIndex(d),e}},prepareContent:function(a,b,c,d,f){return function(){var a=e.transformTo(d.uncompressInputType,this.getCompressedContent()),b=d.uncompress(a);if(b.length!==f)throw new Error("Bug : uncompressed data size mismatch");return b}},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readString(this.fileNameLength),a.skip(c),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(b=e.findCompression(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new f,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(a,a.index,this.compressedSize,b),this.decompressed.getContent=this.prepareContent(a,a.index,this.compressedSize,b,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=e.transformTo("string",this.decompressed.getContent()),g.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(a){if(this.versionMadeBy=a.readInt(2),this.versionNeeded=a.readInt(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4),this.fileNameLength=a.readInt(2),this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=a.readString(this.fileNameLength),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=16&this.externalFileAttributes?!0:!1,a===h&&(this.dosPermissions=63&this.externalFileAttributes),a===i&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileName.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=new d(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index;for(this.extraFields=this.extraFields||{};a.index<e+this.extraFieldsLength;)b=a.readInt(2),c=a.readInt(2),d=a.readString(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){if(this.useUTF8())this.fileName=g.utf8decode(this.fileName),this.fileComment=g.utf8decode(this.fileComment);else{var a=this.findExtraFieldUnicodePath();null!==a&&(this.fileName=a);var b=this.findExtraFieldUnicodeComment();null!==b&&(this.fileComment=b)}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=new d(a.value);return 1!==b.readInt(1)?null:g.crc32(this.fileName)!==b.readInt(4)?null:g.utf8decode(b.readString(a.length-5))
}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=new d(a.value);return 1!==b.readInt(1)?null:g.crc32(this.fileComment)!==b.readInt(4)?null:g.utf8decode(b.readString(a.length-5))}return null}},b.exports=c},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(a,b){"use strict";var c=a("./lib/utils/common").assign,d=a("./lib/deflate"),e=a("./lib/inflate"),f=a("./lib/zlib/constants"),g={};c(g,d,e,f),b.exports=g},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(a,b,c){"use strict";function d(a,b){var c=new s(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}function f(a,b){return b=b||{},b.gzip=!0,d(a,b)}var g=a("./zlib/deflate.js"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=0,m=4,n=0,o=1,p=-1,q=0,r=8,s=function(a){this.options=h.assign({level:p,method:r,chunkSize:16384,windowBits:15,memLevel:8,strategy:q,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=g.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==n)throw new Error(j[c]);b.header&&g.deflateSetHeader(this.strm,b.header)};s.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?m:l,e.input="string"==typeof a?i.string2buf(a):a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new h.Buf8(f),e.next_out=0,e.avail_out=f),c=g.deflate(e,d),c!==o&&c!==n)return this.onEnd(c),this.ended=!0,!1;(0===e.avail_out||0===e.avail_in&&d===m)&&this.onData("string"===this.options.to?i.buf2binstring(h.shrinkBuf(e.output,e.next_out)):h.shrinkBuf(e.output,e.next_out))}while((e.avail_in>0||0===e.avail_out)&&c!==o);return d===m?(c=g.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===n):!0},s.prototype.onData=function(a){this.chunks.push(a)},s.prototype.onEnd=function(a){a===n&&(this.result="string"===this.options.to?this.chunks.join(""):h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=s,c.deflate=d,c.deflateRaw=e,c.gzip=f},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(a,b,c){"use strict";function d(a,b){var c=new m(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}var f=a("./zlib/inflate.js"),g=a("./utils/common"),h=a("./utils/strings"),i=a("./zlib/constants"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=a("./zlib/gzheader"),m=function(a){this.options=g.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=f.inflateInit2(this.strm,b.windowBits);if(c!==i.Z_OK)throw new Error(j[c]);this.header=new l,f.inflateGetHeader(this.strm,this.header)};m.prototype.push=function(a,b){var c,d,e,j,k,l=this.strm,m=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,l.input="string"==typeof a?h.binstring2buf(a):a,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new g.Buf8(m),l.next_out=0,l.avail_out=m),c=f.inflate(l,i.Z_NO_FLUSH),c!==i.Z_STREAM_END&&c!==i.Z_OK)return this.onEnd(c),this.ended=!0,!1;l.next_out&&(0===l.avail_out||c===i.Z_STREAM_END||0===l.avail_in&&d===i.Z_FINISH)&&("string"===this.options.to?(e=h.utf8border(l.output,l.next_out),j=l.next_out-e,k=h.buf2string(l.output,e),l.next_out=j,l.avail_out=m-j,j&&g.arraySet(l.output,l.output,e,j,0),this.onData(k)):this.onData(g.shrinkBuf(l.output,l.next_out)))}while(l.avail_in>0&&c!==i.Z_STREAM_END);return c===i.Z_STREAM_END&&(d=i.Z_FINISH),d===i.Z_FINISH?(c=f.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===i.Z_OK):!0},m.prototype.onData=function(a){this.chunks.push(a)},m.prototype.onEnd=function(a){a===i.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):g.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=m,c.inflate=d,c.inflateRaw=e,c.ungzip=d},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;c>b;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;c>b;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],28:[function(a,b,c){"use strict";function d(a,b){if(65537>b&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;b>d;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;256>j;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=new e.Buf8(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;d>c;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;h>c;)if(f=a[c++],128>f)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&h>c;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:65536>f?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":27}],29:[function(a,b){"use strict";function c(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=c},{}],30:[function(a,b){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(a,b){"use strict";function c(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function d(a,b,c,d){var f=e,g=d+c;a=-1^a;for(var h=d;g>h;h++)a=a>>>8^f[255&(a^b[h])];return-1^a}var e=c();b.exports=d},{}],32:[function(a,b,c){"use strict";function d(a,b){return a.msg=G[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(C.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){D._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,C.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=E(a.adler,b,e,c):2===a.state.wrap&&(a.adler=F(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-jb?a.strstart-(a.w_size-jb):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ib,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&m>f);if(d=ib-(m-f),f=m-ib,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-jb)){C.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=hb)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+hb-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<hb)););}while(a.lookahead<jb&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===H)return sb;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return sb;if(a.strstart-a.block_start>=a.w_size-jb&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?sb:sb}function o(a,b){for(var c,d;;){if(a.lookahead<jb){if(m(a),a.lookahead<jb&&b===H)return sb;if(0===a.lookahead)break}if(c=0,a.lookahead>=hb&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-jb&&(a.match_length=l(a,c)),a.match_length>=hb)if(d=D._tr_tally(a,a.strstart-a.match_start,a.match_length-hb),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=hb){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=a.strstart<hb-1?a.strstart:hb-1,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function p(a,b){for(var c,d,e;;){if(a.lookahead<jb){if(m(a),a.lookahead<jb&&b===H)return sb;if(0===a.lookahead)break}if(c=0,a.lookahead>=hb&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=hb-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-jb&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===S||a.match_length===hb&&a.strstart-a.match_start>4096)&&(a.match_length=hb-1)),a.prev_length>=hb&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-hb,d=D._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-hb),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+hb-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=hb-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return sb}else if(a.match_available){if(d=D._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return sb}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=D._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<hb-1?a.strstart:hb-1,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ib){if(m(a),a.lookahead<=ib&&b===H)return sb;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=hb&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ib;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&f>e);a.match_length=ib-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=hb?(c=D._tr_tally(a,1,a.match_length-hb),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===H)return sb;break}if(a.match_length=0,c=D._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return sb}return a.insert=0,b===K?(h(a,!0),0===a.strm.avail_out?ub:vb):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sb:tb}function s(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=B[a.level].max_lazy,a.good_match=B[a.level].good_length,a.nice_match=B[a.level].nice_length,a.max_chain_length=B[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=hb-1,a.match_available=0,a.ins_h=0}function t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new C.Buf16(2*fb),this.dyn_dtree=new C.Buf16(2*(2*db+1)),this.bl_tree=new C.Buf16(2*(2*eb+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new C.Buf16(gb+1),this.heap=new C.Buf16(2*cb+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new C.Buf16(2*cb+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function u(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=X,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?lb:qb,a.adler=2===b.wrap?0:1,b.last_flush=H,D._tr_init(b),M):d(a,O)}function v(a){var b=u(a);return b===M&&s(a.state),b}function w(a,b){return a&&a.state?2!==a.state.wrap?O:(a.state.gzhead=b,M):O}function x(a,b,c,e,f,g){if(!a)return O;var h=1;if(b===R&&(b=6),0>e?(h=0,e=-e):e>15&&(h=2,e-=16),1>f||f>Z||c!==Y||8>e||e>15||0>b||b>9||0>g||g>V)return d(a,O);8===e&&(e=9);var i=new t;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+hb-1)/hb),i.window=new C.Buf8(2*i.w_size),i.head=new C.Buf16(i.hash_size),i.prev=new C.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new C.Buf8(i.pending_buf_size),i.d_buf=i.lit_bufsize>>1,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,v(a)}function y(a,b){return x(a,b,Y,$,_,W)}function z(a,b){var c,h,k,l;if(!a||!a.state||b>L||0>b)return a?d(a,O):O;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===rb&&b!==K)return d(a,0===a.avail_out?Q:O);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===lb)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=T||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=F(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=mb):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=T||h.level<2?4:0),i(h,wb),h.status=qb);else{var m=Y+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=T||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=kb),m+=31-m%31,h.status=qb,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===mb)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=nb)}else h.status=nb;if(h.status===nb)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=ob)}else h.status=ob;if(h.status===ob)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=F(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=pb)}else h.status=pb;if(h.status===pb&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=qb)):h.status=qb),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,M}else if(0===a.avail_in&&e(b)<=e(c)&&b!==K)return d(a,Q);if(h.status===rb&&0!==a.avail_in)return d(a,Q);if(0!==a.avail_in||0!==h.lookahead||b!==H&&h.status!==rb){var o=h.strategy===T?r(h,b):h.strategy===U?q(h,b):B[h.level].func(h,b);if((o===ub||o===vb)&&(h.status=rb),o===sb||o===ub)return 0===a.avail_out&&(h.last_flush=-1),M;if(o===tb&&(b===I?D._tr_align(h):b!==L&&(D._tr_stored_block(h,0,0,!1),b===J&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,M}return b!==K?M:h.wrap<=0?N:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?M:N)}function A(a){var b;return a&&a.state?(b=a.state.status,b!==lb&&b!==mb&&b!==nb&&b!==ob&&b!==pb&&b!==qb&&b!==rb?d(a,O):(a.state=null,b===qb?d(a,P):M)):O}var B,C=a("../utils/common"),D=a("./trees"),E=a("./adler32"),F=a("./crc32"),G=a("./messages"),H=0,I=1,J=3,K=4,L=5,M=0,N=1,O=-2,P=-3,Q=-5,R=-1,S=1,T=2,U=3,V=4,W=0,X=2,Y=8,Z=9,$=15,_=8,ab=29,bb=256,cb=bb+1+ab,db=30,eb=19,fb=2*cb+1,gb=15,hb=3,ib=258,jb=ib+hb+1,kb=32,lb=42,mb=69,nb=73,ob=91,pb=103,qb=113,rb=666,sb=1,tb=2,ub=3,vb=4,wb=3,xb=function(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e};B=[new xb(0,0,0,0,n),new xb(4,4,8,4,o),new xb(4,5,16,8,o),new xb(4,6,32,32,o),new xb(4,4,16,16,p),new xb(8,16,32,32,p),new xb(8,16,128,128,p),new xb(8,32,128,256,p),new xb(32,128,258,1024,p),new xb(32,258,258,4096,p)],c.deflateInit=y,c.deflateInit2=x,c.deflateReset=v,c.deflateResetKeep=u,c.deflateSetHeader=w,c.deflate=z,c.deflateEnd=A,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(a,b){"use strict";function c(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=c},{}],34:[function(a,b){"use strict";var c=30,d=12;b.exports=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;e=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=e.dmax,l=e.wsize,m=e.whave,n=e.wnext,o=e.window,p=e.hold,q=e.bits,r=e.lencode,s=e.distcode,t=(1<<e.lenbits)-1,u=(1<<e.distbits)-1;a:do{15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){e.mode=d;break a}a.msg="invalid literal/length code",e.mode=c;break a}x=65535&v,w&=15,w&&(w>q&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",e.mode=c;break a}if(y=65535&v,w&=15,w>q&&(p+=B[f++]<<q,q+=8,w>q&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",e.mode=c;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&e.sane){a.msg="invalid distance too far back",e.mode=c;break a}if(z=0,A=o,0===n){if(z+=l-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(w>n){if(z+=l+n-w,w-=n,x>w){x-=w;do C[h++]=o[z++];while(--w);if(z=0,x>n){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(g>f&&j>h);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=g>f?5+(g-f):5-(f-g),a.avail_out=j>h?257+(j-h):257-(h-j),e.hold=p,e.bits=q}},{}],35:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=K,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new r.Buf32(ob),b.distcode=b.distdyn=new r.Buf32(pb),b.sane=1,b.back=-1,C):F}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):F}function h(a,b){var c,d;return a&&a.state?(d=a.state,0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15)),b&&(8>b||b>15)?F:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):F}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==C&&(a.state=null),c):F}function j(a){return i(a,rb)}function k(a){if(sb){var b;for(p=new r.Buf32(512),q=new r.Buf32(32),b=0;144>b;)a.lens[b++]=8;for(;256>b;)a.lens[b++]=9;for(;280>b;)a.lens[b++]=7;for(;288>b;)a.lens[b++]=8;for(v(x,a.lens,0,288,p,0,a.work,{bits:9}),b=0;32>b;)a.lens[b++]=5;v(y,a.lens,0,32,q,0,a.work,{bits:5}),sb=!1}a.lencode=p,a.lenbits=9,a.distcode=q,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new r.Buf8(f.wsize)),d>=f.wsize?(r.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),r.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(r.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab=0,Bb=new r.Buf8(4),Cb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return F;c=a.state,c.mode===V&&(c.mode=W),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xb=C;a:for(;;)switch(c.mode){case K:if(0===c.wrap){c.mode=W;break}for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0),m=0,n=0,c.mode=L;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=lb;break}if((15&m)!==J){a.msg="unknown compression method",c.mode=lb;break}if(m>>>=4,n-=4,wb=(15&m)+8,0===c.wbits)c.wbits=wb;else if(wb>c.wbits){a.msg="invalid window size",c.mode=lb;break}c.dmax=1<<wb,a.adler=c.check=1,c.mode=512&m?T:V,m=0,n=0;break;case L:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==J){a.msg="unknown compression method",c.mode=lb;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=lb;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0,c.mode=M;case M:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,Bb[2]=m>>>16&255,Bb[3]=m>>>24&255,c.check=t(c.check,Bb,4,0)),m=0,n=0,c.mode=N;case N:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0,c.mode=O;case O:if(1024&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Bb[0]=255&m,Bb[1]=m>>>8&255,c.check=t(c.check,Bb,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=P;case P:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wb=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),r.arraySet(c.head.extra,e,g,q,wb)),512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=Q;case Q:if(2048&c.flags){if(0===i)break a;q=0;do wb=e[g+q++],c.head&&wb&&c.length<65536&&(c.head.name+=String.fromCharCode(wb));while(wb&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wb)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=R;case R:if(4096&c.flags){if(0===i)break a;q=0;do wb=e[g+q++],c.head&&wb&&c.length<65536&&(c.head.comment+=String.fromCharCode(wb));while(wb&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wb)break a}else c.head&&(c.head.comment=null);c.mode=S;case S:if(512&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=lb;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=V;break;case T:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=U;case U:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,E;a.adler=c.check=1,c.mode=V;case V:if(b===A||b===B)break a;case W:if(c.last){m>>>=7&n,n-=7&n,c.mode=ib;break}for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=X;break;case 1:if(k(c),c.mode=bb,b===B){m>>>=2,n-=2;break a}break;case 2:c.mode=$;break;case 3:a.msg="invalid block type",c.mode=lb}m>>>=2,n-=2;break;case X:for(m>>>=7&n,n-=7&n;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=lb;break}if(c.length=65535&m,m=0,n=0,c.mode=Y,b===B)break a;case Y:c.mode=Z;case Z:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;r.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=V;break;case $:for(;14>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=lb;break}c.have=0,c.mode=_;case _:for(;c.have<c.ncode;){for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Cb[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Cb[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,yb={bits:c.lenbits},xb=v(w,c.lens,0,19,c.lencode,0,c.work,yb),c.lenbits=yb.bits,xb){a.msg="invalid code lengths set",c.mode=lb;break}c.have=0,c.mode=ab;case ab:for(;c.have<c.nlen+c.ndist;){for(;Ab=c.lencode[m&(1<<c.lenbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(16>sb)m>>>=qb,n-=qb,c.lens[c.have++]=sb;else{if(16===sb){for(zb=qb+2;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qb,n-=qb,0===c.have){a.msg="invalid bit length repeat",c.mode=lb;break}wb=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sb){for(zb=qb+3;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qb,n-=qb,wb=0,q=3+(7&m),m>>>=3,n-=3}else{for(zb=qb+7;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qb,n-=qb,wb=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=lb;break}for(;q--;)c.lens[c.have++]=wb}}if(c.mode===lb)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=lb;break}if(c.lenbits=9,yb={bits:c.lenbits},xb=v(x,c.lens,0,c.nlen,c.lencode,0,c.work,yb),c.lenbits=yb.bits,xb){a.msg="invalid literal/lengths set",c.mode=lb;break}if(c.distbits=6,c.distcode=c.distdyn,yb={bits:c.distbits},xb=v(y,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,yb),c.distbits=yb.bits,xb){a.msg="invalid distances set",c.mode=lb;break}if(c.mode=bb,b===B)break a;case bb:c.mode=cb;case cb:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,u(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===V&&(c.back=-1);
break}for(c.back=0;Ab=c.lencode[m&(1<<c.lenbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(rb&&0===(240&rb)){for(tb=qb,ub=rb,vb=sb;Ab=c.lencode[vb+((m&(1<<tb+ub)-1)>>tb)],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=tb+qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=tb,n-=tb,c.back+=tb}if(m>>>=qb,n-=qb,c.back+=qb,c.length=sb,0===rb){c.mode=hb;break}if(32&rb){c.back=-1,c.mode=V;break}if(64&rb){a.msg="invalid literal/length code",c.mode=lb;break}c.extra=15&rb,c.mode=db;case db:if(c.extra){for(zb=c.extra;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=eb;case eb:for(;Ab=c.distcode[m&(1<<c.distbits)-1],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&rb)){for(tb=qb,ub=rb,vb=sb;Ab=c.distcode[vb+((m&(1<<tb+ub)-1)>>tb)],qb=Ab>>>24,rb=Ab>>>16&255,sb=65535&Ab,!(n>=tb+qb);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=tb,n-=tb,c.back+=tb}if(m>>>=qb,n-=qb,c.back+=qb,64&rb){a.msg="invalid distance code",c.mode=lb;break}c.offset=sb,c.extra=15&rb,c.mode=fb;case fb:if(c.extra){for(zb=c.extra;zb>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=lb;break}c.mode=gb;case gb:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=lb;break}q>c.wnext?(q-=c.wnext,ob=c.wsize-q):ob=c.wnext-q,q>c.length&&(q=c.length),pb=c.window}else pb=f,ob=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pb[ob++];while(--q);0===c.length&&(c.mode=cb);break;case hb:if(0===j)break a;f[h++]=c.length,j--,c.mode=cb;break;case ib:if(c.wrap){for(;32>n;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?t(c.check,f,p,h-p):s(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=lb;break}m=0,n=0}c.mode=jb;case jb:if(c.wrap&&c.flags){for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=lb;break}m=0,n=0}c.mode=kb;case kb:xb=D;break a;case lb:xb=G;break a;case mb:return H;case nb:default:return F}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<lb&&(c.mode<ib||b!==z))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=mb,H):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?t(c.check,f,p,a.next_out-p):s(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===V?128:0)+(c.mode===bb||c.mode===Y?256:0),(0===o&&0===p||b===z)&&xb===C&&(xb=I),xb)}function n(a){if(!a||!a.state)return F;var b=a.state;return b.window&&(b.window=null),a.state=null,C}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?F:(c.head=b,b.done=!1,C)):F}var p,q,r=a("../utils/common"),s=a("./adler32"),t=a("./crc32"),u=a("./inffast"),v=a("./inftrees"),w=0,x=1,y=2,z=4,A=5,B=6,C=0,D=1,E=2,F=-2,G=-3,H=-4,I=-5,J=8,K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9,T=10,U=11,V=12,W=13,X=14,Y=15,Z=16,$=17,_=18,ab=19,bb=20,cb=21,db=22,eb=23,fb=24,gb=25,hb=26,ib=27,jb=28,kb=29,lb=30,mb=31,nb=32,ob=852,pb=592,qb=15,rb=qb,sb=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(a,b){"use strict";var c=a("../utils/common"),d=15,e=852,f=592,g=0,h=1,i=2,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,n,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new c.Buf16(d+1),Q=new c.Buf16(d+1),R=null,S=0;for(D=0;d>=D;D++)P[D]=0;for(E=0;o>E;E++)P[b[n+E]]++;for(H=C,G=d;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;G>F&&0===P[F];F++);for(F>H&&(H=F),K=1,D=1;d>=D;D++)if(K<<=1,K-=P[D],0>K)return-1;if(K>0&&(a===g||1!==G))return-1;for(Q[1]=0,D=1;d>D;D++)Q[D+1]=Q[D]+P[D];for(E=0;o>E;E++)0!==b[n+E]&&(r[Q[b[n+E]]++]=E);if(a===g?(N=R=r,y=19):a===h?(N=j,O-=257,R=k,S-=257,y=256):(N=l,R=m,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===h&&L>e||a===i&&L>f)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[n+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;G>I+J&&(K-=P[I+J],!(0>=K));)I++,K<<=1;if(L+=1<<I,a===h&&L>e||a===i&&L>f)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":27}],37:[function(a,b){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a){return 256>a?gb[a]:gb[256+(a>>>7)]}function f(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function g(a,b,c){a.bi_valid>V-c?(a.bi_buf|=b<<a.bi_valid&65535,f(a,a.bi_buf),a.bi_buf=b>>V-a.bi_valid,a.bi_valid+=c-V):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function h(a,b,c){g(a,c[2*b],c[2*b+1])}function i(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function j(a){16===a.bi_valid?(f(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function k(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;U>=f;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;T>c;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function l(a,b,c){var d,e,f=new Array(U+1),g=0;for(d=1;U>=d;d++)f[d]=g=g+c[d-1]<<1;for(e=0;b>=e;e++){var h=a[2*e+1];0!==h&&(a[2*e]=i(f[h]++,h))}}function m(){var a,b,c,d,e,f=new Array(U+1);for(c=0,d=0;O-1>d;d++)for(ib[d]=c,a=0;a<1<<_[d];a++)hb[c++]=d;for(hb[c-1]=d,e=0,d=0;16>d;d++)for(jb[d]=e,a=0;a<1<<ab[d];a++)gb[e++]=d;for(e>>=7;R>d;d++)for(jb[d]=e<<7,a=0;a<1<<ab[d]-7;a++)gb[256+e++]=d;for(b=0;U>=b;b++)f[b]=0;for(a=0;143>=a;)eb[2*a+1]=8,a++,f[8]++;for(;255>=a;)eb[2*a+1]=9,a++,f[9]++;for(;279>=a;)eb[2*a+1]=7,a++,f[7]++;for(;287>=a;)eb[2*a+1]=8,a++,f[8]++;for(l(eb,Q+1,f),a=0;R>a;a++)fb[2*a+1]=5,fb[2*a]=i(a,5);kb=new nb(eb,_,P+1,Q,U),lb=new nb(fb,ab,0,R,U),mb=new nb(new Array(0),bb,0,S,W)}function n(a){var b;for(b=0;Q>b;b++)a.dyn_ltree[2*b]=0;for(b=0;R>b;b++)a.dyn_dtree[2*b]=0;for(b=0;S>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*X]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function o(a){a.bi_valid>8?f(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function p(a,b,c,d){o(a),d&&(f(a,c),f(a,~c)),E.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function q(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function r(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&q(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!q(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function s(a,b,c){var d,f,i,j,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],f=a.pending_buf[a.l_buf+k],k++,0===d?h(a,f,b):(i=hb[f],h(a,i+P+1,b),j=_[i],0!==j&&(f-=ib[i],g(a,f,j)),d--,i=e(d),h(a,i,c),j=ab[i],0!==j&&(d-=jb[i],g(a,d,j)));while(k<a.last_lit);h(a,X,b)}function t(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=T,c=0;i>c;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=2>j?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)r(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],r(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,r(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],k(a,b),l(f,j,a.bl_count)}function u(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;c>=d;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(j>h?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*Y]++):10>=h?a.bl_tree[2*Z]++:a.bl_tree[2*$]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function v(a,b,c){var d,e,f=-1,i=b[1],j=0,k=7,l=4;for(0===i&&(k=138,l=3),d=0;c>=d;d++)if(e=i,i=b[2*(d+1)+1],!(++j<k&&e===i)){if(l>j){do h(a,e,a.bl_tree);while(0!==--j)}else 0!==e?(e!==f&&(h(a,e,a.bl_tree),j--),h(a,Y,a.bl_tree),g(a,j-3,2)):10>=j?(h(a,Z,a.bl_tree),g(a,j-3,3)):(h(a,$,a.bl_tree),g(a,j-11,7));j=0,f=e,0===i?(k=138,l=3):e===i?(k=6,l=3):(k=7,l=4)}}function w(a){var b;for(u(a,a.dyn_ltree,a.l_desc.max_code),u(a,a.dyn_dtree,a.d_desc.max_code),t(a,a.bl_desc),b=S-1;b>=3&&0===a.bl_tree[2*cb[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function x(a,b,c,d){var e;for(g(a,b-257,5),g(a,c-1,5),g(a,d-4,4),e=0;d>e;e++)g(a,a.bl_tree[2*cb[e]+1],3);v(a,a.dyn_ltree,b-1),v(a,a.dyn_dtree,c-1)}function y(a){var b,c=4093624447;for(b=0;31>=b;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return G;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return H;for(b=32;P>b;b++)if(0!==a.dyn_ltree[2*b])return H;return G}function z(a){pb||(m(),pb=!0),a.l_desc=new ob(a.dyn_ltree,kb),a.d_desc=new ob(a.dyn_dtree,lb),a.bl_desc=new ob(a.bl_tree,mb),a.bi_buf=0,a.bi_valid=0,n(a)}function A(a,b,c,d){g(a,(J<<1)+(d?1:0),3),p(a,b,c,!0)}function B(a){g(a,K<<1,3),h(a,X,eb),j(a)}function C(a,b,c,d){var e,f,h=0;a.level>0?(a.strm.data_type===I&&(a.strm.data_type=y(a)),t(a,a.l_desc),t(a,a.d_desc),h=w(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,e>=f&&(e=f)):e=f=c+5,e>=c+4&&-1!==b?A(a,b,c,d):a.strategy===F||f===e?(g(a,(K<<1)+(d?1:0),3),s(a,eb,fb)):(g(a,(L<<1)+(d?1:0),3),x(a,a.l_desc.max_code+1,a.d_desc.max_code+1,h+1),s(a,a.dyn_ltree,a.dyn_dtree)),n(a),d&&o(a)}function D(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(hb[c]+P+1)]++,a.dyn_dtree[2*e(b)]++),a.last_lit===a.lit_bufsize-1}var E=a("../utils/common"),F=4,G=0,H=1,I=2,J=0,K=1,L=2,M=3,N=258,O=29,P=256,Q=P+1+O,R=30,S=19,T=2*Q+1,U=15,V=16,W=7,X=256,Y=16,Z=17,$=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ab=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],bb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],cb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],db=512,eb=new Array(2*(Q+2));d(eb);var fb=new Array(2*R);d(fb);var gb=new Array(db);d(gb);var hb=new Array(N-M+1);d(hb);var ib=new Array(O);d(ib);var jb=new Array(R);d(jb);var kb,lb,mb,nb=function(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length},ob=function(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b},pb=!1;c._tr_init=z,c._tr_stored_block=A,c._tr_flush_block=C,c._tr_tally=D,c._tr_align=B},{"../utils/common":27}],39:[function(a,b){"use strict";function c(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=c},{}]},{},[9])(9)});
aa_loadZippedXtml('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');
