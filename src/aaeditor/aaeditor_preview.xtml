<xtml ns="aaeditor" light="false">  <Component id="PreviewControl" type="ui.Control" execution="xtml">    <Param name="PreviewContext" />      <xtml t="ui.Section" Name="aaeditor preview" CssStyle="max-width:600px">        <Control t="ui.IfThenElse">          <Var name="PreviewComp" value="%$AAEditorState/SelectedInTree/Xtml/@t%_Preview"/>          <If t="yesno.And">            <Item t="yesno.NotEmpty" Data="%$AAEditorState/SelectedInTree/Xtml/@t%" />            <Item t="xtml.ComponentExists" ComponentID="%$PreviewComp%"/>          </If>          <Then t="xtml.RunXtmlByComponentId" ComponentID="%$PreviewComp%">            <Var name="Preview" t="aaeditor.CalcLocalPreviewData"/>          </Then>          <Else t="ui.SectionsList">            <Var name="PreviewData" t="data.FirstSucceeding">              <Item value="%$PreviewContext%" />              <Item t="aaeditor.CalcLocalPreviewData"/>            </Var>            <Var name="RealInput" t="data.FirstSucceeding">              <Item value="%$PreviewData/OrigData%"/>              <Item value="%$PreviewData/Input%"/>            </Var>            <Section t="ui.SectionListPage">              <Title t="data.FirstSucceeding">                <Item t="data.Pipeline">                  <Item value="%$RealInput%"/>                  <Item t="data.RuntimeObjectType"/>                  <Item value="Preview Input (%%)"/>                </Item>                <Item value="Preview Input"/>              </Title>              <Condition t="yesno.NotEmpty" Value="%$RealInput%"/>              <Control t="ui.IfThenElse">                <Then t="debugui.RuntimeObjectControl" Data="%$RealInput%" Class="aaeditor_input"/>                <If t="yesno.Not">                  <Of t="yesno.IsMultipleValue" Value="%$PreviewData%"/>                </If>                <Else t="field.ShowFieldControl" Class="aaeditor_input">                  <Field t="field.ItemList" ID="items_table">                    <View t="itemlist_style.JBartTable" MinWidth="200px"/>                    <FieldAspect t="field_aspect.ItemListContainer">                      <Items t="itemlist.Items" Items="%$PreviewData%"/>                    </FieldAspect>                    <FieldAspect t="field_feature.Css" Css="font-family: Arial;" />                    <FieldAspect t="itemlist_aspect.LongList">                      <MaxTimeToRenderItems t="data.Pipeline">                        <Item t="xtml_dt_tree.PreviewSettings" />                        <Item value="%maxTableViewTime%" />                      </MaxTimeToRenderItems>                    </FieldAspect>                    <Field t="field.CustomControl" ShowTitle="true">                      <Control t="debugui.RuntimeObjectControl" Data="%Input%" />                      <Title t="data.Pipeline">                        <Item value="%$PreviewData%"/>                        <Aggregator t="data.Count"/>                        <Aggregator value="%% items"/>                      </Title>                    </Field>                    <Field t="field.CustomControl" ShowTitle="true" Title="view output">                      <Control t="ui.ButtonOld" Image="%$_Images%/studio/down1616.png">                        <OnClick t="uiaction.ReplaceControl" RunOn=".preview_output">                          <NewControl t="debugui.RuntimeObjectControl" Object="%Output%" Class="preview_output"/>                        </OnClick>                        <Style t="ui.ButtonAsImage"/>                      </Control>                    </Field>                  </Field>                </Else>                <Else1 t="ui.ItemList" Class="aaeditor_input">                  <Presentation t="uiaspect.Table" />                  <Items t="data_items.Items" Items="%$PreviewData%" />                  <Fields t="field.Fields">                  </Fields>                </Else1>              </Control>            </Section>            <Section t="ui.SectionListPage">              <Var name="OpenDialog" value="false"/>              <Title t="data.FirstSucceeding">                <Item t="data.Pipeline">                  <Item value="%$RealInput%"/>                  <Item t="data.RuntimeObjectType"/>                  <Item value="Preview Output (%%)"/>                </Item>                <Item value="Preview Output"/>              </Title>              <Condition t="yesno.NotEmpty" Value="%$PreviewData/Output%"/>              <Control t="debugui.RuntimeObjectControl" Object="%$PreviewData/Output%" Class="preview_output"/>            </Section>          </Else>        </Control>      </xtml>    </Component>  <Component id="CalculateTopCircuit" type="data.Data" execution="native">    <Param name="Xtml" />  </Component>     <Component id="ProbeXtmlNew" type="data.Data" execution="native">      <Param name="Xtml" essential="true"/>  </Component>    <Component id="ProbeFieldData" type="data.Data" execution="native">    <Param name="FieldXtml" />  </Component>  <Component id="ProbeXtml" type="data.Data">      <Param name="Xtml" essential="true"/>      <xtml t="aaeditor.CalcLocalPreviewData">        <State t="aaeditor.State">          <TreeXtml t="xtml.Xtml" Xtml="%$Xtml%"/>          <SelectedInTree t="aaeditor.TreeItemData" Xtml="%$Xtml%" ParentXtml="%$Xtml%"/>        </State>        <MainCircuitRunner t="object.RunMethod" Method="RunCircuit" Object="%$TopCircuit%"/>        <Var name="TopCircuit" t="aaeditor.CalculateTopCircuit" Xtml="%$Xtml%" />      </xtml>    </Component>    <Component id="CalcLocalPreviewData" type="data.Data" execution="native">    <Param name="State">      <Default value="%$AAEditorState%" />    </Param>    <Param name="ReturnAll" type="data.Boolean" Description="Return all results or only one result" />    <Param name="MainCircuitRunner" type="action.Action" script="true" />  </Component>  <Component id="AsyncObjectControl" type="ui.Control" execution="native">    <NativeHelper name="ShowSync" t="debugui.RuntimeObjectControl" />  </Component>    <Component id="RuntimeObjectControl" type="ui.Control" execution="xtml">      <Param name="Object">        <Default value="%%"/>      </Param>      <xtml t="data.Pipeline">        <Item value="%$Object%"/>        <Aggregator Class="aaeditor_runtime_object_control" t="ui.Switch">          <Value t="data.RuntimeObjectType"/>          <Case IfCondition="%_isAsyncObject%">            <Then t="aaeditor.AsyncObjectControl"/>          </Case>          <Case>            <IfCondition t="yesno.IsMultipleValue" Value="%$Object%"/>            <Then t="field.ShowFieldControl" Class="aaeditor_input">              <Field t="field.ItemList" ID="items_table">                <View t="itemlist_style.JBartTable" MinWidth="200px"/>                <FieldAspect t="field_aspect.ItemListContainer">                  <Items t="itemlist.Items" Items="%$Object%"/>                </FieldAspect>                <FieldAspect t="field_feature.Css" Css="font-family: Arial;" />                <FieldAspect t="itemlist_aspect.LongList">                  <MaxTimeToRenderItems t="data.Pipeline">                    <Item t="xtml_dt_tree.PreviewSettings" />                    <Item value="%maxTableViewTime%" />                  </MaxTimeToRenderItems>                </FieldAspect>                <Field t="field.CustomControl" ShowTitle="true">                  <Control t="debugui.RuntimeObjectControl"/>                  <Title t="data.Pipeline">                    <Item value="%$Object%"/>                    <Aggregator t="data.Count"/>                    <Aggregator value="%% items"/>                  </Title>                </Field>              </Field>            </Then>          </Case>          <Case If="text">            <Then t="ui.Text" Text="%%"/>          </Case>          <Case If="html">            <Then t="data.Same"/>          </Case>          <Case If="xml">            <Then t="ui.List">              <Layout t="ui.Horizontal"/>              <Control t="ui.ButtonOld" Image="%$_Images%/studio/copy.png" Text="Copy">                <Style t="ui.ButtonAsImage"/>                <OnClick t="xmlui.ShowTextareaXmlDialog" Xml="%%"/>              </Control>              <Control t="tree.Tree" RootItems="%%" AutoExpandFirstLevel="false" NextLevel="%*%" Class="noborder" Height="100%" ItemImage="%$_Images%/default1616.gif">                <ItemControl t="aaeditor.XmlElementInTree"/>              </Control>            </Then>          </Case>          <Case If="struct">            <Then t="tree.Tree" AutoExpandFirstLevel="false" ItemImage="%$_Images%/studio/integer.gif" Borderless="true">              <RootItems t="data.StructEntryNames"/>              <Var name="Input"/>              <NextLevel t="data.Struct">                <Var name="Val" value="%$Input/{}%"/>                <Condition t="yesno.And">                  <Item t="yesno.IsEmpty" Value="%StructValue%"/>                  <Item t="yesno.ItemsNotEqual" Item1="text">                    <Item2 t="data.RuntimeObjectType" Data="%$Val%"/>                  </Item>                </Condition>                <Item Name="StructValue" Value="%$Val%"/>              </NextLevel>              <ItemControl t="ui.Switch">                <Var name="Val" value="%$Input/{}%"/>                <Case>                  <IfCondition t="yesno.NotEmpty" Value="%StructValue%"/>                  <Then t="debugui.RuntimeObjectControl" Data="%StructValue%"/>                </Case>                <Case>                  <IfCondition t="yesno.And">                    <Item t="yesno.NotEmpty" Value="%$Val%"/>                    <Item t="yesno.ItemsEqual" Item1="text">                      <Item2 t="data.RuntimeObjectType" Data="%$Val%"/>                    </Item>                  </IfCondition>                  <Then t="ui.Text" Text="%%: %$Val%"/>                </Case>                <Default t="ui.Text" Text="%%"/>              </ItemControl>              <ItemControl1 t="ui.List">                <Control t="ui.Text" Text="%%: "/>                <Control t="debugui.RuntimeObjectControl" Data="%$Input/{}%" TODO="prevent endless loop"/>                <Layout t="ui.SpanList"/>              </ItemControl1>            </Then>          </Case>          <Case If="context">            <Then t="tree.Tree" ItemImage="%$_Images%/studio/yesno1616.gif">              <RootItems t="data.List">                <Item value="__vars"/>                <Item value="__params"/>              </RootItems>              <Var name="Input"/>              <ItemControl t="ui.IfThenElse">                <If t="text.StartsWith" With="__"/>                <Then t="ui.Text">                  <Text t="text.RemovePrefix" Prefix="__"/>                </Then>                <Else t="debugui.RuntimeObjectControl"/>              </ItemControl>              <NextLevel t="data.Switch">                <Case If="__vars">                  <Then t="data.Pipeline">                    <Item t="xtml.PartsOfContext" Context="%$Input%" Part="Variable Names"/>                    <Item value="__%%"/>                  </Then>                </Case>                <Case If="__params">                  <Then t="data.Pipeline">                    <Item t="xtml.PartsOfContext" Context="%$Input%" Part="Param Names"/>                    <Item value="__%%"/>                  </Then>                </Case>                <Case>                  <IfCondition t="text.StartsWith" With="__"/>                  <Then t="xtml.RunXtml" Context="%$Input%">                    <Xtml t="data.Pipeline">                      <Item t="text.RemovePrefix" Prefix="__"/>                      <Item value="\\%$%%\\%"/>                    </Xtml>                  </Then>                </Case>              </NextLevel>            </Then>          </Case>          <Case If="function">            <Then t="ui.Text" Text="%%"/>          </Case>          <Default t="aaeditor.RuntimeObjectSelector"/>        </Aggregator>      </xtml>    </Component>  <Component id="RuntimeObjectSelector" type="ui.Control" execution="xtml">    <Param name="OnSelect" type="action.Action" script="true" />    <xtml t="tree.Tree" Class="noborder" Height="100%" ItemImage="%$_Images%/default1616.gif">      <Var name="Input" />      <RootItems value="%$Input%" />      <NextLevel t="xml.XPath" XPath="*">        <Condition t="yesno.EqualsTo" To="xml">          <Data t="data.RuntimeObjectType" />        </Condition>      </NextLevel>      <ItemControl t="ui.Switch">        <Value t="data.RuntimeObjectType" />        <Case If="html">          <Then t="data.Same" />        </Case>        <Case If="text">          <Then t="ui.Text" Text="%%" />        </Case>        <Default t="aaeditor.XmlElementInTree" t1="ui.DynamicList">          <Items t="data.List">            <Item t="data.Same" />            <Item t="xml.Attributes" />          </Items>          <Control t="data.IfThenElse">            <If t="xml.IsAttribute" />            <Then t="xml.WithChanges">              <Var name="attrname" t="xml.AttributeName" />              <Xml t="ui.Html" DynamicContent="true">                <span onclick="ajaxart_runevent(this,'','OnSelect');" class="xml_selector_attribute">%$attrname%=               <span class="xml_selector_attribute_value">%%</span>             </span>            </Xml>            <Change t="ui.DataBind"/>          </Then>          <Else t="xml.WithChanges">            <Var name="innertext" t="xml.InnerTextValue"/>            <Var name="onlytag" t="xml.Tag"/>            <Var name="tag" t="data.Pipeline">              <Item value="%$onlytag%"/>              <Item t="data.IfThenElse">                <If t="yesno.Empty" Data="%$innertext%"/>                <Then value="%%"/>                <Else value="%%="/>              </Item>            </Var>            <Xml t="ui.Html" DynamicContent="true">              <span onclick="ajaxart_runevent(this,'','OnSelect');" class="xml_selector_tag">%$tag%                <span class="xml_selector_attribute_value">%$innertext%</span>              </span>            </Xml>            <Change t="ui.DataBind"/>          </Else>        </Control>        <Layout t="ui.NoLayout"/>        </Default>      </ItemControl>    </xtml></Component> <Component id="XmlElementInTree" type="ui.Control" execution="native"> </Component>  <Component id="SimulateRunningContextForPreview" type="data.Data" execution="native" /> </xtml>