<xtml ns="gstudio_deploy"><Component id="OpenDeployPopup" type="action.Action">  <xtml t="action.RunActions">    <Action t="object.RunMethod" Object="%$_JBartStudio%" Method="BeforeDeploy" />    <Action t="action.IfThenElse">      <If t="yesno.NotEmpty" Value="%$_InstanceEditor%" />      <Then t="instance_editor.Save" />      <Else t="gstudio.Save" AlsoDeploy="false"/>    </Action>    <Action t="popup.OpenPopup" PopupTitle="%$_WidgetXml/@name%">    <Style t="gstudio.GoogleDrivePopup"/>    <Contents t="field.InnerPage" Title="Deploy">      <Field t="control.Layout" ID="_LinkGroup" Title="Link">        <Field t="control.Label" ID="_Label81" Title="Label" Text="Widget has been successfully published to:">          <Style t="uitext.PlainText"/>        </Field>        <Layout t="ui.CustomCss" base="layout.Vertical">          <Style t="layout.Vertical" Spacing="10px"/>          <Css><![CDATA[#this >.field:not(:last-child) {  margin-bottom: 10px;}]]></Css>        </Layout>        <Field t="control.Layout" ID="Link" Title="">          <FieldAspect t="field_aspect.Variable" VarName="Link">            <Value t="data.Pipeline">              <Item t="google_drive.WidgetDeployID"/>              <Item value="http://jbartwix1.appspot.com/file/%%.html"/>              <Item value="%%?cobrowseagent=true"/>            </Value>          </FieldAspect>          <Field t="control.Hyperlink" ID="_Hyperlink" Title="%$Link%" Target="_blank" Link="%$Link%">            <Style t="hyperlink_style.Simple"/>          </Field>          <Layout t="layout.Default"/>        </Field>        <FieldAspect t="async.AsyncActionBeforeLoad" LoadingText="Publishing" ShowLoadingTextInStudio="false">          <LoadingStyle t="ui.CustomStyle" base="loading_style.Default">            <Html><![CDATA[<div>  <div class="text field" />  <img class="field" src="%$_Images%/running_animated.gif" /></div>]]></Html>            <Css><![CDATA[#this { font-style: italic; height: 100px; width: 450px; }]]></Css>            <Javascript><![CDATA[function(elem) {  elem.$el.find(".text").html(elem.text);  elem.getControlsCount = function() { return 1; }  elem.getControl = function() { }  aa_horizontalBoxLayout(elem,{ spacing: "10px" });}]]></Javascript>          </LoadingStyle>          <Action t="async.RunInParallel">            <Action t="gstudio.Save"/>            <Action t="gstudio_deploy.DeployWidget" Condition="%$_JBartStudio/Type%=='widget'"/>            <Action t="gstudio_deploy.DeployInstance" Condition="%$_JBartStudio/Type%=='instance'"/>            <Action t="gstudio_deploy.DeployInstance">              <Condition t="yesno.NotEmpty" Value="%$_InstanceEditor%" />            </Action>          </Action>        </FieldAspect>      </Field>      <Layout t="layout.Default"/>    </Contents>    <Feature t="popup.PopupSize" Width="500px" Height=""/>  </Action>  </xtml></Component>  <Component id="DeployWidget" type="action.Action">    <Param name="Server" Default="http://jbartwix1.appspot.com" />    <xtml t="action.RunActions">      <Var name="ID" t="google_drive.WidgetDeployID" DebugIDInLocalhost="instance_debug"/>      <Var name="HeadElements" t="object.RunMethod" Object="%$_AppContext%" Method="DeployHeadElements" />      <Action t="notification_box.ShowNotification" NotificationBox="GStudio_NotificationBox" Text="Deploying Widget ..." Status="saving"/>      <Action t="jbart_studio.SaveWidgetJSToJBartDB" Server="%$Server%" WidgetId="%$ID%" FileName="%$ID%.js">        <OnSuccess t="jbartdb.SaveFileToJBartDB" Server="%$Server%" ID="%$ID%.html" >          <Content t="xml.CData" DynamicContent="true" >       <![CDATA[<!DOCTYPE html><html><head>  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>  %$HeadElements%  </head><body margin="0">  <div id="placeholder"></div>  <script type="text/javascript" src="%$Server%/file/%$ID%.js"></script>  <script type="text/javascript">    var page = window.location.href.match(/page=([a-zA-Z0-9]+)/) && window.location.href.match(/page=([a-zA-Z0-9]+)/)[1];    page = page || 'main';    if (!window.location.href.match(/margins=true/))      $("body").css("margin","0");    jBartWidgets.%$ID%.show(document.getElementById('placeholder'),{ page: page, jbartdb_server: '%$Server%' } );  </script></body> </html>]]>          </Content>          <OnSuccess t="notification_box.ShowNotification" NotificationBox="GStudio_NotificationBox" Text="Widget deployed" Status="saved"/>        </OnSuccess>      </Action>    </xtml>  </Component>  <Component id="DeployInstance" type="action.Action">    <Param name="Server" Default="http://jbartwix1.appspot.com" />    <xtml t="async.RunAsyncActions">      <Var name="ID" t="google_drive.WidgetDeployID" />      <Var name="InstanceXml" value="%$Settings%" />      <Var name="WidgetID" value="%$InstanceXml/@_widget%" />      <Var name="WidgetVersion" value="%$InstanceXml/@_version%" />      <Var name="HeadElements" t="object.RunMethod" Object="%$_AppContext%" Method="DeployHeadElements" />      <Var name="LoaderElements" t="object.RunMethod" Object="%$_AppContext%" Method="LoaderBodyElement" />      <Var name="BodyElements" t="object.RunMethod" Object="%$_AppContext%" Method="DeployBodyElements" />      <Var name="WidgetBaseUrl" t="text.FirstSucceeding">        <Item value="%$InstanceXml/@deploy_WidgetBaseUrl%" />        <Item value="//jbartlib.appspot.com/apps" />              </Var>      <Action t="notification_box.ShowNotification" NotificationBox="GStudio_NotificationBox" Text="Deploying Widget ..." Status="saving"/>      <Action t="jbartdb.SaveFileToJBartDB" Server="%$Server%" ID="%$ID%.js">        <Content t="gstudio_deploy.InstanceJS" />      </Action>      <Action t="jbartdb.SaveFileToJBartDB" Server="%$Server%" ID="%$ID%.html" >          <Content t="xml.CData" DynamicContent="true" >       <![CDATA[<!DOCTYPE html><html><head>  %$HeadElements%  </head><body margin="0">  %$LoaderElements%  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>  %$BodyElements%  <div id="placeholder"></div>  <script type="text/javascript" src="%$WidgetBaseUrl%/%$WidgetID%/%$WidgetVersion%/jbart_%$WidgetID%_src.js"></script>  <script type="text/javascript" src="%$Server%/file/%$ID%.js"></script>  <script type="text/javascript">    var page = window.location.href.match(/page=([a-zA-Z0-9]+)/) && window.location.href.match(/page=([a-zA-Z0-9]+)/)[1];    page = page || 'main';    if (!window.location.href.match(/margins=true/))      $("body").css("margin","0");    jBartWidgets.%$WidgetID%.show(document.getElementById('placeholder'),{ page: page, jbartdb_server: '%$Server%' } );  </script></body> </html>]]>          </Content>                </Action>      <Action t="notification_box.ShowNotification" NotificationBox="GStudio_NotificationBox" Text="Widget deployed" Status="saved"/>          </xtml>  </Component>  <Component id="InstanceJS" type="data.Data">    <xtml t="data.Pipeline">      <Var name="InstanceXml" value="%$Settings%" />      <Item t="bart_dt.XmlInOneLine" Xml="%$InstanceXml%">        <Prefix value="window.jBartWidget_%$InstanceXml/@_widget%_Settings = jbart_data('" />        <Suffix value="','single');" />      </Item>    </xtml>  </Component></xtml>